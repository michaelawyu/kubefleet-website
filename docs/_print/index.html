<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://kubefleet-dev.github.io/website/docs/><link rel=alternate type=application/rss+xml href=https://kubefleet-dev.github.io/website/docs/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/website/favicons/favicon.ico><link rel=apple-touch-icon href=/website/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/website/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/website/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/website/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/website/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/website/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/website/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/website/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/website/favicons/android-192x192.png sizes=192x192><title>Welcome to KubeFleet Documentation | KubeFleet</title>
<meta name=description content="Learn more about KubeFleet, a CNCF sandbox project for simplified Kubernetes multi-cluster management at scale."><meta property="og:url" content="https://kubefleet-dev.github.io/website/docs/"><meta property="og:site_name" content="KubeFleet"><meta property="og:title" content="Welcome to KubeFleet Documentation"><meta property="og:description" content="Welcome ✨ This documentation can help you learn more about the KubeFleet project, get started with a KubeFleet deployment of your own, and complete common KubeFleet related tasks.
WIP We are actively working on the documentation site. About KubeFleet KubeFleet is a CNCF sandbox project that aims to simplify Kubernetes multi-cluster management . It can greatly enhance your multi-cluster management experience; specifically, with the help of KubeFleet, one is able to easily:"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Welcome to KubeFleet Documentation"><meta itemprop=description content="Welcome ✨ This documentation can help you learn more about the KubeFleet project, get started with a KubeFleet deployment of your own, and complete common KubeFleet related tasks.
WIP We are actively working on the documentation site. About KubeFleet KubeFleet is a CNCF sandbox project that aims to simplify Kubernetes multi-cluster management . It can greatly enhance your multi-cluster management experience; specifically, with the help of KubeFleet, one is able to easily:"><meta itemprop=wordCount content="262"><meta name=twitter:card content="summary"><meta name=twitter:title content="Welcome to KubeFleet Documentation"><meta name=twitter:description content="Welcome ✨ This documentation can help you learn more about the KubeFleet project, get started with a KubeFleet deployment of your own, and complete common KubeFleet related tasks.
WIP We are actively working on the documentation site. About KubeFleet KubeFleet is a CNCF sandbox project that aims to simplify Kubernetes multi-cluster management . It can greatly enhance your multi-cluster management experience; specifically, with the help of KubeFleet, one is able to easily:"><link rel=preload href=/website/scss/main.min.879d78706ddc3417bab47ec223b501bf207298e24a447bada63812f126e3e760.css as=style><link href=/website/scss/main.min.879d78706ddc3417bab47ec223b501bf207298e24a447bada63812f126e3e760.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/website/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>KubeFleet</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/website/docs/><span>Docs</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/website/zh-cn/docs/>中文（简体）</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/website/offline-search-index.3462c77180604ebb39dffa597e85cc8e.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/website/docs/>Return to the regular view of this page</a>.</p></div><h1 class=title>Welcome to KubeFleet Documentation</h1><ul><li>1: <a href=#pg-dd948255948d6b59b32c471abcb62997>Concepts</a></li><ul><li>1.1: <a href=#pg-490f2b78db8fecdc0bed1e8d68c8c706>Fleet components</a></li><li>1.2: <a href=#pg-b62b5665dfb021b8bec0a6ab728a3a54>MemberCluster</a></li><li>1.3: <a href=#pg-b8f6b720329f015f06846c43b2d48212>ClusterResourcePlacement</a></li><li>1.4: <a href=#pg-bd269a3c0871a350c7f51b81d2a79af9>Scheduler</a></li><li>1.5: <a href=#pg-e149527fa64d0c3eacbb2ff5e7b6ffea>Scheduling Framework</a></li><li>1.6: <a href=#pg-716d7f944c3423c5dfa17047db699aed>Properties and Property Provides</a></li><li>1.7: <a href=#pg-057b31916d61f2f113de30f88397f691>Safe Rollout</a></li><li>1.8: <a href=#pg-f14a979ac0ba3b2cbfcab451b17d9e7a>Override</a></li><li>1.9: <a href=#pg-8ddd4e0ab9f151e89ec11f8f8feb3f69>Staged Update</a></li><li>1.10: <a href=#pg-4289eaa321cf089fdf9ee9aab7a3ade8>Eviction and Placement Disruption Budget</a></li></ul><li>2: <a href=#pg-17b09a9dc5200475d8a306f18e63a0f9>Getting Started</a></li><ul><li>2.1: <a href=#pg-b2dc1a1b66163662e5965b95ed325462>Getting started with Fleet using KinD clusters</a></li><li>2.2: <a href=#pg-7d7f0216d2307a9e20af121afa63dd3e>Getting started with Fleet using on-premises clusters</a></li></ul><li>3: <a href=#pg-8688845c6027fb5b07b8644ad7348d4a>How-To Guides</a></li><ul><li>3.1: <a href=#pg-4072dca0095c74b9490cd7c99ea027d9>Managing clusters</a></li><li>3.2: <a href=#pg-7461dbc76e53ff75d54dd11074048123>Using the ClusterResourcePlacement API</a></li><li>3.3: <a href=#pg-dae736fee36bb429124e070c298551ea>Using Affinity to Pick Clusters</a></li><li>3.4: <a href=#pg-ccbad31a9eb5ff37ffc3f405928edd58>Using Topology Spread Constraints to Spread Resources</a></li><li>3.5: <a href=#pg-8f6885002eeb6f5c362b9414ff970412>Using Property-Based Scheduling</a></li><li>3.6: <a href=#pg-06445baf57d9bbc7fde02bf249b4a0fa>Using Taints and Tolerations</a></li><li>3.7: <a href=#pg-f53861fa149aba83d55219c600a493a6>Using the ClusterResourceOverride API</a></li><li>3.8: <a href=#pg-4f07136e38cf9fb330102a16c2742234>Using the ResourceOverride API</a></li><li>3.9: <a href=#pg-b44fd8dfb69a651370335b35322594c6>Using Envelope Objects to Place Resources</a></li><li>3.10: <a href=#pg-9e6acaf2aaf7ab5737e91dce54ade3d3>Controlling How Fleet Handles Pre-Existing Resources</a></li><li>3.11: <a href=#pg-934276b9448b25f33e6f2421e293bbf7>Enabling Drift Detection in Fleet</a></li><li>3.12: <a href=#pg-305fa8c74ee8f62995ad9a0d77561184>Using the ReportDiff Apply Mode</a></li><li>3.13: <a href=#pg-dcd05a852eca01d185729a33f973f1ea>How to Roll Out and Roll Back Changes in Stage</a></li><li>3.14: <a href=#pg-3d9472b6f83afdc50046a1c5ab64a789>Evicting Resources and Setting up Disruption Budgets</a></li></ul><li>4: <a href=#pg-4588103fb9a692533044ee756a5f863f>Frequently Asked Questions</a></li><ul></ul><li>5: <a href=#pg-b5568d681972077a2a3f45e40a59d61a>API Reference</a></li><ul></ul><li>6: <a href=#pg-d9ce62896f60f2efcc2db9da011ba5cf></a></li></ul><div class=content><p>Welcome ✨ This documentation can help you learn more about the KubeFleet project,
get started with a KubeFleet deployment of your own, and complete common KubeFleet related tasks.</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>WIP</h4>We are actively working on the documentation site.</div><h2 id=about-kubefleet>About KubeFleet</h2><p>KubeFleet is a CNCF sandbox project that aims to simplify Kubernetes multi-cluster management .
It can greatly enhance your multi-cluster management experience; specifically,
with the help of KubeFleet, one is able to easily:</p><ul><li>manage clusters through one unified portal; and</li><li>place Kubernetes resources across a group of clusters with advanced scheduling capabilities; and</li><li>roll out changes progressively; and</li><li>perform administrative tasks easily, such as observing application status, detecting configuration drifts, migrating workloads across clusters, etc.</li></ul><h2 id=is-kubefleet-right-for-my-multi-cluster-setup>Is KubeFleet right for my multi-cluster setup?</h2><ul><li><p>✅ KubeFleet can work with any Kubernetes clusters running supported Kubernetes versions, regardless of where they are set up.</p><p>You can set up KubeFleet with an on-premises cluster, a cluster hosted on public clouds such as
Azure, or even a local kind cluster.</p></li><li><p>✅ KubeFleet can manage Kubernetes cluster groups of various sizes.</p><p>KubeFleet is designed with performance and scalablity in mind. It functions well with both
smaller Kubernetes cluster groups and those with up to hundreds of Kubernetes clusters and
thousands of nodes.</p></li><li><p>🚀 KubeFleet is evolving fast.</p><p>We are actively developing new features and functionalities for KubeFleet. If you have any questions, suggestions, or feedbacks, please <a href=https://github.com/kubefleet-dev/kubefleet/issues>let us know</a>.</p></li></ul><h2 id=get-started>Get started</h2><p>Find out how to deploy KubeFleet with one of our <a href=/website/docs/getting-started/>Getting Started</a> tutorials. You can use a local setup to experiment with KubeFleet&rsquo;s features, and explore its UX.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-dd948255948d6b59b32c471abcb62997>1 - Concepts</h1><div class=lead>Core concepts in Fleet</div><div class="pageinfo pageinfo-primary"><p>The documentation in this section explains core Fleet concepts. Pick one below to proceed.</p></div></div><div class=td-content><h1 id=pg-490f2b78db8fecdc0bed1e8d68c8c706>1.1 - Fleet components</h1><div class=lead>Concept about the Fleet components</div><h1 id=components>Components</h1><p>This document provides an overview of the components required for a fully functional and operational Fleet setup.</p><p><img src=/images/en/docs/concepts/components/architecture.jpg alt></p><p>The fleet consists of the following components:</p><ul><li>fleet-hub-agent is a Kubernetes controller that creates and reconciles all the fleet related CRs in the hub cluster.</li><li>fleet-member-agent is a Kubernetes controller that creates and reconciles all the fleet related CRs in the member cluster.
The fleet-member-agent is pulling the latest CRs from the hub cluster and consistently reconciles the member clusters to
the desired state.</li></ul><p>The fleet implements agent-based pull mode. So that the working pressure can be distributed to the member clusters, and it
helps to breach the bottleneck of scalability, by dividing the load into each member cluster. On the other hand, hub
cluster does not need to directly access to the member clusters. Fleet can support the member clusters which only have
the outbound network and no inbound network access.</p><p>To allow multiple clusters to run securely, fleet will create a reserved namespace on the hub cluster to isolate the access permissions and
resources across multiple clusters.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b62b5665dfb021b8bec0a6ab728a3a54>1.2 - MemberCluster</h1><div class=lead>Concept about the MemberCluster API</div><h2 id=overview>Overview</h2><p>The fleet constitutes an implementation of a <a href=https://multicluster.sigs.k8s.io/api-types/cluster-set/><code>ClusterSet</code></a> and
encompasses the following attributes:</p><ul><li>A collective of clusters managed by a centralized authority.</li><li>Typically characterized by a high level of mutual trust within the cluster set.</li><li>Embraces the principle of Namespace Sameness across clusters:<ul><li>Ensures uniform permissions and characteristics for a given namespace across all clusters.</li><li>While not mandatory for every cluster, namespaces exhibit consistent behavior across those where they are present.</li></ul></li></ul><p>The <code>MemberCluster</code> represents a cluster-scoped API established within the hub cluster, serving as a representation of
a cluster within the fleet. This API offers a dependable, uniform, and automated approach for multi-cluster applications
(frameworks, toolsets) to identify registered clusters within a fleet. Additionally, it facilitates applications in querying
a list of clusters managed by the fleet or observing cluster statuses for subsequent actions.</p><p>Some illustrative use cases encompass:</p><ul><li>The Fleet Scheduler utilizing managed cluster statuses or specific cluster properties (e.g., labels, taints) of a <code>MemberCluster</code>
for resource scheduling.</li><li>Automation tools like GitOps systems (e.g., ArgoCD or Flux) automatically registering/deregistering clusters in compliance
with the <code>MemberCluster</code> API.</li><li>The <a href=https://multicluster.sigs.k8s.io/concepts/multicluster-services-api/>MCS API</a> automatically generating <code>ServiceImport</code> CRs
based on the <code>MemberCluster</code> CR defined within a fleet.</li></ul><p>Moreover, it furnishes a user-friendly interface for human operators to monitor the managed clusters.</p><h2 id=membercluster-lifecycle>MemberCluster Lifecycle</h2><h3 id=joining-the-fleet>Joining the Fleet</h3><p>The process to join the Fleet involves creating a <code>MemberCluster</code>. The <code>MemberCluster</code> controller, a constituent of the
hub-cluster-agent described in the <a href=/website/docs/concepts/components/>Component</a>, watches the <code>MemberCluster</code> CR and generates
a corresponding namespace for the member cluster within the hub cluster. It configures roles and role bindings within the
hub cluster, authorizing the specified member cluster identity (as detailed in the <code>MemberCluster</code> spec) access solely
to resources within that namespace. To collate member cluster status, the controller generates another internal CR named
<code>InternalMemberCluster</code> within the newly formed namespace. Simultaneously, the <code>InternalMemberCluster</code> controller, a component
of the member-cluster-agent situated in the member cluster, gathers statistics on cluster usage, such as capacity utilization,
and reports its status based on the <code>HeartbeatPeriodSeconds</code> specified in the CR. Meanwhile, the <code>MemberCluster</code> controller
consolidates agent statuses and marks the cluster as <code>Joined</code>.</p><h3 id=leaving-the-fleet>Leaving the Fleet</h3><p>Fleet administrators can deregister a cluster by deleting the <code>MemberCluster</code> CR. Upon detection of deletion events by
the <code>MemberCluster</code> controller within the hub cluster, it removes the corresponding <code>InternalMemberCluster</code> CR in the
reserved namespace of the member cluster. It awaits completion of the &ldquo;leave&rdquo; process by the <code>InternalMemberCluster</code>
controller of member agents, and then deletes role and role bindings and other resources including the member cluster reserved
namespaces on the hub cluster.</p><h2 id=taints>Taints</h2><p>Taints are a mechanism to prevent the Fleet Scheduler from scheduling resources to a <code>MemberCluster</code>. We adopt the concept of
<a href=https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/>taints and tolerations</a> introduced in Kubernetes to
the multi-cluster use case.</p><p>The <code>MemberCluster</code> CR supports the specification of list of taints, which are applied to the <code>MemberCluster</code>. Each Taint object comprises
the following fields:</p><ul><li><code>key</code>: The key of the taint.</li><li><code>value</code>: The value of the taint.</li><li><code>effect</code>: The effect of the taint, which can be <code>NoSchedule</code> for now.</li></ul><p>Once a <code>MemberCluster</code> is tainted with a specific taint, it lets the Fleet Scheduler know that the <code>MemberCluster</code> should not receive resources
as part of the workload propagation from the hub cluster.</p><p>The <code>NoSchedule</code> taint is a signal to the Fleet Scheduler to avoid scheduling resources from a <code>ClusterResourcePlacement</code> to the <code>MemberCluster</code>.
Any <code>MemberCluster</code> already selected for resource propagation will continue to receive resources even if a new taint is added.</p><p>Taints are only honored by <code>ClusterResourcePlacement</code> with <strong>PickAll</strong>, <strong>PickN</strong> placement policies. In the case of <strong>PickFixed</strong> placement policy
the taints are ignored because the user has explicitly specify the <code>MemberClusters</code> where the resources should be placed.</p><p>For detailed instructions, please refer to this <a href=/website/docs/how-tos/taints-tolerations/>document</a>.</p><h2 id=whats-next>What&rsquo;s next</h2><ul><li>Get hands-on experience <a href=/website/docs/how-tos/clusters/>how to add a member cluster to a fleet</a>.</li><li>Explore the <a href=crpc><code>ClusterResourcePlacement</code> concept to placement cluster scope resources among managed clusters</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b8f6b720329f015f06846c43b2d48212>1.3 - ClusterResourcePlacement</h1><div class=lead>Concept about the ClusterResourcePlacement API</div><h2 id=overview>Overview</h2><p><code>ClusterResourcePlacement</code> concept is used to dynamically select cluster scoped resources (especially namespaces and all
objects within it) and control how they are propagated to all or a subset of the member clusters.
A <code>ClusterResourcePlacement</code> mainly consists of three parts:</p><ul><li><p><strong>Resource selection</strong>: select which cluster-scoped Kubernetes
resource objects need to be propagated from the hub cluster to selected member clusters.</p><p>It supports the following forms of resource selection:</p><ul><li>Select resources by specifying just the &lt;group, version, kind>. This selection propagates all resources with matching &lt;group, version, kind>.</li><li>Select resources by specifying the &lt;group, version, kind> and name. This selection propagates only one resource that matches the &lt;group, version, kind> and name.</li><li>Select resources by specifying the &lt;group, version, kind> and a set of labels using ClusterResourcePlacement -> LabelSelector.
This selection propagates all resources that match the &lt;group, version, kind> and label specified.</li></ul><p><strong>Note:</strong> When a namespace is selected, all the namespace-scoped objects under this namespace are propagated to the
selected member clusters along with this namespace.</p></li><li><p><strong>Placement policy</strong>: limit propagation of selected resources to a specific subset of member clusters.
The following types of target cluster selection are supported:</p><ul><li><strong>PickAll (Default)</strong>: select any member clusters with matching cluster <code>Affinity</code> scheduling rules. If the <code>Affinity</code>
is not specified, it will select all joined and healthy member clusters.</li><li><strong>PickFixed</strong>: select a fixed list of member clusters defined in the <code>ClusterNames</code>.</li><li><strong>PickN</strong>: select a <code>NumberOfClusters</code> of member clusters with optional matching cluster <code>Affinity</code> scheduling rules or topology spread constraints <code>TopologySpreadConstraints</code>.</li></ul></li><li><p><strong>Rollout strategy</strong>: how to propagate new changes to the selected member clusters.</p></li></ul><p>A simple <code>ClusterResourcePlacement</code> looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>topologySpreadConstraints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>maxSkew</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>topologyKey</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;env&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>whenUnsatisfiable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DoNotSchedule</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>revisionHistoryLimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>rollingUpdate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxSurge</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxUnavailable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>unavailablePeriodSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RollingUpdate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=when-to-use-clusterresourceplacement>When To Use <code>ClusterResourcePlacement</code></h2><p><code>ClusterResourcePlacement</code> is useful when you want for a general way of managing and running workloads across multiple clusters.
Some example scenarios include the following:</p><ul><li>As a platform operator, I want to place my cluster-scoped resources (especially namespaces and all objects within it)
to a cluster that resides in the us-east-1.</li><li>As a platform operator, I want to spread my cluster-scoped resources (especially namespaces and all objects within it)
evenly across the different regions/zones.</li><li>As a platform operator, I prefer to place my test resources into the staging AKS cluster.</li><li>As a platform operator, I would like to separate the workloads for compliance or policy reasons.</li><li>As a developer, I want to run my cluster-scoped resources (especially namespaces and all objects within it) on 3 clusters.
In addition, each time I update my workloads, the updates take place with zero downtime by rolling out to these three clusters incrementally.</li></ul><h2 id=placement-workflow>Placement Workflow</h2><p><img src=/images/en/docs/concepts/crpc/placement-concept-overview.jpg alt></p><p>The placement controller will create <code>ClusterSchedulingPolicySnapshot</code> and <code>ClusterResourceSnapshot</code> snapshots by watching
the <code>ClusterResourcePlacement</code> object. So that it can trigger the scheduling and resource rollout process whenever needed.</p><p>The override controller will create the corresponding snapshots by watching the <code>ClusterResourceOverride</code> and <code>ResourceOverride</code>
which captures the snapshot of the overrides.</p><p>The placement workflow will be divided into several stages:</p><ol><li>Scheduling: multi-cluster scheduler makes the schedule decision by creating the <code>clusterResourceBinding</code> for a bundle
of resources based on the latest <code>ClusterSchedulingPolicySnapshot</code>generated by the <code>ClusterResourcePlacement</code>.</li><li>Rolling out resources: rollout controller applies the resources to the selected member clusters based on the rollout strategy.</li><li>Overriding: work generator applies the override rules defined by <code>ClusterResourceOverride</code> and <code>ResourceOverride</code> to
the selected resources on the target clusters.</li><li>Creating or updating works: work generator creates the work on the corresponding member cluster namespace. Each work
contains the (overridden) manifest workload to be deployed on the member clusters.</li><li>Applying resources on target clusters: apply work controller applies the manifest workload on the member clusters.</li><li>Checking resource availability: apply work controller checks the resource availability on the target clusters.</li></ol><h2 id=resource-selection>Resource Selection</h2><p>Resource selectors identify cluster-scoped objects to include based on standard Kubernetes identifiers - namely, the <code>group</code>,
<code>kind</code>, <code>version</code>, and <code>name</code> of the object. Namespace-scoped objects are included automatically when the namespace they
are part of is selected. The example <code>ClusterResourcePlacement</code> above would include the <code>test-deployment</code> namespace and
any objects that were created in that namespace.</p><p>The clusterResourcePlacement controller creates the <code>ClusterResourceSnapshot</code> to store a snapshot of selected resources
selected by the placement. The <code>ClusterResourceSnapshot</code> spec is immutable. Each time when the selected resources are updated,
the clusterResourcePlacement controller will detect the resource changes and create a new <code>ClusterResourceSnapshot</code>. It implies
that resources can change independently of any modifications to the <code>ClusterResourceSnapshot</code>. In other words, resource
changes can occur without directly affecting the <code>ClusterResourceSnapshot</code> itself.</p><p>The total amount of selected resources may exceed the 1MB limit for a single Kubernetes object. As a result, the controller
may produce more than one <code>ClusterResourceSnapshot</code>s for all the selected resources.</p><p><code>ClusterResourceSnapshot</code> sample:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourceSnapshot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/number-of-enveloped-object</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/number-of-resource-snapshots</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/resource-hash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>e0927e7d75c7f52542a6d4299855995018f4a6de46edf0f814cfaa6e806543f3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>creationTimestamp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2023-11-10T08:23:38Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/is-latest-snapshot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/parent-CRP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/resource-index</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;4&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1-4-snapshot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ownerReferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>blockOwnerDeletion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>controller</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>757f2d2c-682f-433f-b85c-265b74c3090b</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1641940&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>d6e2108b-882b-4f6c-bb5e-c5ec5491dd20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selectedResources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kubernetes.io/metadata.name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>finalizers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>kubernetes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>key1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>key2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>key3</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConfigMap</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=placement-policy>Placement Policy</h2><p><code>ClusterResourcePlacement</code> supports three types of policy as mentioned above. <code>ClusterSchedulingPolicySnapshot</code> will be
generated whenever policy changes are made to the <code>ClusterResourcePlacement</code> that require a new scheduling. Similar to
<code>ClusterResourceSnapshot</code>, its spec is immutable.</p><p><code>ClusterSchedulingPolicySnapshot</code> sample:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterSchedulingPolicySnapshot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/CRP-generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/number-of-clusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>creationTimestamp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2023-11-06T10:22:56Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/is-latest-snapshot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/parent-CRP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/policy-index</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ownerReferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>blockOwnerDeletion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>controller</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>757f2d2c-682f-433f-b85c-265b74c3090b</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1639412&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>768606f2-aa5a-481a-aa12-6e01e6adbea2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policyHash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NDc5ZjQwNWViNzgwOGNmYzU4MzY2YjI2NDg2ODBhM2E4MTVlZjkxNGZlNjc1NmFlOGRmMGQ2Zjc0ODg1NDE2YQ==</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2023-11-06T10:22:56Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>found all the clusters needed as specified by the scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SchedulingPolicyFulfilled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>observedCRPGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>targetClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aks-member-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusterScore</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>affinityScore</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>priorityScore</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>picked by scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>selected</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aks-member-2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusterScore</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>affinityScore</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>priorityScore</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>picked by scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>selected</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><img src=/images/en/docs/concepts/crpc/scheduling.jpg alt></p><p>In contrast to the original scheduler framework in Kubernetes, the multi-cluster scheduling process involves selecting a cluster for placement through a structured 5-step operation:</p><ol><li>Batch & PostBatch</li><li>Filter</li><li>Score</li><li>Sort</li><li>Bind</li></ol><p>The <em>batch & postBatch</em> step is to define the batch size according to the desired and current <code>ClusterResourceBinding</code>.
The postBatch is to adjust the batch size if needed.</p><p>The <em>filter</em> step finds the set of clusters where it&rsquo;s feasible to schedule the placement, for example, whether the cluster
is matching required <code>Affinity</code> scheduling rules specified in the <code>Policy</code>. It also filters out any clusters which are
leaving the fleet or no longer connected to the fleet, for example, its heartbeat has been stopped for a prolonged period of time.</p><p>In the <em>score</em> step (only applied to the pickN type), the scheduler assigns a score to each cluster that survived filtering.
Each cluster is given a topology spread score (how much a cluster would satisfy the topology spread
constraints specified by the user), and an affinity score (how much a cluster would satisfy the preferred affinity terms
specified by the user).</p><p>In the <em>sort</em> step (only applied to the pickN type), it sorts all eligible clusters by their scores, sorting first by topology
spread score and breaking ties based on the affinity score.</p><p>The <em>bind</em> step is to create/update/delete the <code>ClusterResourceBinding</code> based on the desired and current member cluster list.</p><h2 id=rollout-strategy>Rollout Strategy</h2><p>Update strategy determines how changes to the <code>ClusterWorkloadPlacement</code> will be rolled out across member clusters.
The only supported update strategy is <code>RollingUpdate</code> and it replaces the old placed resource using rolling update, i.e.
gradually create the new one while replace the old ones.</p><h2 id=placement-status>Placement status</h2><p>After a <code>ClusterResourcePlacement</code> is created, details on current status can be seen by performing a <code>kubectl describe crp &lt;name></code>.
The status output will indicate both placement conditions and individual placement statuses on each member cluster that was selected.
The list of resources that are selected for placement will also be included in the describe output.</p><p>Sample output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>Name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#000>crp-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#000>&lt;none&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>&lt;none&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>API Version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>placement.kubernetes-fleet.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>Policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Placement Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>Resource Selectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>application-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>Revision History Limit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>Strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Rolling Update</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Max Surge</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                   </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Max Unavailable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>             </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Unavailable Period Seconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                          </span><span style=color:#000>RollingUpdate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>Conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>found all the clusters needed as specified by the scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#000>SchedulingPolicyFulfilled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                   </span><span style=color:#000>ClusterResourcePlacementScheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>All 3 cluster(s) start rolling out the latest resource</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#000>RolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                   </span><span style=color:#000>ClusterResourcePlacementRolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>No</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>override rules are configured for the selected resources</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#000>NoOverrideSpecified</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                   </span><span style=color:#000>ClusterResourcePlacementOverridden</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>Works(s) are succcesfully created or updated in the 3 target clusters&#39; namespaces</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#000>WorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                   </span><span style=color:#000>ClusterResourcePlacementWorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>The selected resources are successfully applied to 3 clusters</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#000>ApplySucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                   </span><span style=color:#000>ClusterResourcePlacementApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>The selected resources in 3 cluster are available now</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#000>ResourceAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                   </span><span style=color:#000>ClusterResourcePlacementAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>Observed Resource Index</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>Placement Statuses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Cluster Name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>kind-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message:               Successfully scheduled resources for placement in kind-cluster-1 (affinity score: 0, topology spread score: 0)</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>picked by scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>Detected the new changes on the resources and started the rollout process</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>RolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>RolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>No</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>override rules are configured for the selected resources</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>NoOverrideSpecified</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Overridden</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>All of the works are synchronized to the latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>AllWorkSynced</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>WorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>All corresponding work objects are applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>AllWorkHaveBeenApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>The availability of work object crp-1-work is not trackable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>WorkNotTrackable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Cluster Name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>kind-cluster-2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message:               Successfully scheduled resources for placement in kind-cluster-2 (affinity score: 0, topology spread score: 0)</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>picked by scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>Detected the new changes on the resources and started the rollout process</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>RolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>RolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>No</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>override rules are configured for the selected resources</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>NoOverrideSpecified</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Overridden</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>All of the works are synchronized to the latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>AllWorkSynced</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>WorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>All corresponding work objects are applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>AllWorkHaveBeenApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>The availability of work object crp-1-work is not trackable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>WorkNotTrackable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Cluster Name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>kind-cluster-3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message:               Successfully scheduled resources for placement in kind-cluster-3 (affinity score: 0, topology spread score: 0)</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>picked by scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>Detected the new changes on the resources and started the rollout process</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>RolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>RolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>No</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>override rules are configured for the selected resources</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>NoOverrideSpecified</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Overridden</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>All of the works are synchronized to the latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>AllWorkSynced</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>WorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>All corresponding work objects are applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>AllWorkHaveBeenApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Last Transition Time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>2024-04-29T09:58:20Z</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000>The availability of work object crp-1-work is not trackable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Observed Generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000>WorkNotTrackable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>Type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#000>Available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>Selected Resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#000>application-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#000>ConfigMap</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#000>app-config-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>application-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>Version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Events</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>Type    Reason                        Age    From                                   Message</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>---- <span style=color:#f8f8f8;text-decoration:underline>   </span>------ <span style=color:#f8f8f8;text-decoration:underline>                       </span>---- <span style=color:#f8f8f8;text-decoration:underline>  </span>---- <span style=color:#f8f8f8;text-decoration:underline>                                  </span>-------<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>Normal  PlacementRolloutStarted       3m46s  cluster-resource-placement-controller  Started rolling out the latest resources</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>Normal  PlacementOverriddenSucceeded  3m46s  cluster-resource-placement-controller  Placement has been successfully overridden</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>Normal  PlacementWorkSynchronized     3m46s  cluster-resource-placement-controller  Work(s) have been created or updated successfully for the selected cluster(s)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>Normal  PlacementApplied              3m46s  cluster-resource-placement-controller  Resources have been applied to the selected cluster(s)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>Normal  PlacementRolloutCompleted     3m46s  cluster-resource-placement-controller  Resources are available in the selected clusters</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=tolerations>Tolerations</h2><p>Tolerations are a mechanism to allow the Fleet Scheduler to schedule resources to a <code>MemberCluster</code> that has taints specified on it.
We adopt the concept of <a href=https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/>taints & tolerations</a>
introduced in Kubernetes to the multi-cluster use case.</p><p>The <code>ClusterResourcePlacement</code> CR supports the specification of list of tolerations, which are applied to the <code>ClusterResourcePlacement</code>
object. Each Toleration object comprises the following fields:</p><ul><li><code>key</code>: The key of the toleration.</li><li><code>value</code>: The value of the toleration.</li><li><code>effect</code>: The effect of the toleration, which can be <code>NoSchedule</code> for now.</li><li><code>operator</code>: The operator of the toleration, which can be <code>Exists</code> or <code>Equal</code>.</li></ul><p>Each toleration is used to tolerate one or more specific taints applied on the <code>MemberCluster</code>. Once all taints on a <code>MemberCluster</code>
are tolerated by tolerations on a <code>ClusterResourcePlacement</code>, resources can be propagated to the <code>MemberCluster</code> by the scheduler for that
<code>ClusterResourcePlacement</code> resource.</p><p>Tolerations cannot be updated or removed from a <code>ClusterResourcePlacement</code>. If there is a need to update toleration a better approach is to
add another toleration. If we absolutely need to update or remove existing tolerations, the only option is to delete the existing <code>ClusterResourcePlacement</code>
and create a new object with the updated tolerations.</p><p>For detailed instructions, please refer to this <a href=/website/docs/how-tos/taints-tolerations/>document</a>.</p><h2 id=envelope-object>Envelope Object</h2><p>The <code>ClusterResourcePlacement</code> leverages the fleet hub cluster as a staging environment for customer resources. These resources are then propagated to member clusters that are part of the fleet, based on the <code>ClusterResourcePlacement</code> spec.</p><p>In essence, the objective is not to apply or create resources on the hub cluster for local use but to propagate these resources to other member clusters within the fleet.</p><p>Certain resources, when created or applied on the hub cluster, may lead to unintended side effects. These include:</p><ul><li>Validating/Mutating Webhook Configurations</li><li>Cluster Role Bindings</li><li>Resource Quotas</li><li>Storage Classes</li><li>Flow Schemas</li><li>Priority Classes</li><li>Ingress Classes</li><li>Ingresses</li><li>Network Policies</li></ul><p>To address this, we support the use of <code>ConfigMap</code> with a fleet-reserved annotation. This allows users to encapsulate resources that might have side effects on the hub cluster within the <code>ConfigMap</code>. For detailed instructions, please refer to this <a href=/website/docs/how-tos/envelope-object/>document</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-bd269a3c0871a350c7f51b81d2a79af9>1.4 - Scheduler</h1><div class=lead>Concept about the Fleet scheduler</div><p>The scheduler component is a vital element in Fleet workload scheduling. Its primary responsibility is to determine the
schedule decision for a bundle of resources based on the latest <code>ClusterSchedulingPolicySnapshot</code>generated by the <code>ClusterResourcePlacement</code>.
By default, the scheduler operates in batch mode, which enhances performance. In this mode, it binds a <code>ClusterResourceBinding</code>
from a <code>ClusterResourcePlacement</code> to multiple clusters whenever possible.</p><h2 id=batch-in-nature>Batch in nature</h2><p>Scheduling resources within a <code>ClusterResourcePlacement</code> involves more dependencies compared with scheduling pods within
a deployment in Kubernetes. There are two notable distinctions:</p><ol><li>In a <code>ClusterResourcePlacement</code>, multiple replicas of resources cannot be scheduled on the same cluster, whereas pods
belonging to the same deployment in Kubernetes can run on the same node.</li><li>The <code>ClusterResourcePlacement</code> supports different placement types within a single object.</li></ol><p>These requirements necessitate treating the scheduling policy as a whole and feeding it to the scheduler, as opposed to
handling individual pods like Kubernetes today. Specially:</p><ol><li>Scheduling the entire <code>ClusterResourcePlacement</code> at once enables us to increase the parallelism of the scheduler if
needed.</li><li>Supporting the <code>PickAll</code> mode would require generating the replica for each cluster in the fleet to scheduler. This
approach is not only inefficient but can also result in scheduler repeatedly attempting to schedule unassigned replica when
there are no possibilities of placing them.</li><li>To support the <code>PickN</code> mode, the scheduler needs to compute the filtering and scoring for each replica. Conversely,
in batch mode, these calculations are performed once. Scheduler sorts all the eligible clusters and pick the top N clusters.</li></ol><h2 id=placement-decisions>Placement Decisions</h2><p>The output of the scheduler is an array of <code>ClusterResourceBinding</code>s on the hub cluster.</p><p><code>ClusterResourceBinding</code> sample:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourceBinding</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/previous-binding-state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Bound</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>creationTimestamp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2023-11-06T09:53:11Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>finalizers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>kubernetes-fleet.io/work-cleanup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/parent-CRP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1-aks-member-1-2f8fe606</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1641949&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>3a443dec-a5ad-4c15-9c6d-05727b9e1d15</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterDecision</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aks-member-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusterScore</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>affinityScore</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>priorityScore</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>picked by scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>selected</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSnapshotName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1-4-snapshot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>schedulingPolicySnapshotName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Bound</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>targetCluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>aks-member-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2023-11-06T09:53:11Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AllWorkSynced</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Bound</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2023-11-10T08:23:38Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AllWorkHasBeenApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><code>ClusterResourceBinding</code> can have three states:</p><ul><li><em>Scheduled</em>: It indicates that the scheduler has selected this cluster for placing the resources. The resource is waiting
to be picked up by the rollout controller.</li><li><em>Bound</em>: It indicates that the rollout controller has initiated the placement of resources on the target cluster. The
resources are actively being deployed.</li><li><em>Unscheduled</em>: This states signifies that the target cluster is no longer selected by the scheduler for the placement.
The resource associated with this cluster are in the process of being removed. They are awaiting deletion from the cluster.</li></ul><p>The scheduler operates by generating scheduling decisions through the creating of new bindings in the &ldquo;scheduled&rdquo; state
and the removal of existing bindings by marking them as &ldquo;unscheduled&rdquo;. There is a separate rollout controller which is
responsible for executing these decisions based on the defined rollout strategy.</p><h2 id=enforcing-the-semantics-of-ignoreduringexecutiontime>Enforcing the semantics of &ldquo;IgnoreDuringExecutionTime&rdquo;</h2><p>The <code>ClusterResourcePlacement</code> enforces the semantics of &ldquo;IgnoreDuringExecutionTime&rdquo; to prioritize the stability of resources
running in production. Therefore, the resources should not be moved or rescheduled without explicit changes to the scheduling
policy.</p><p>Here are some high-level guidelines outlining the actions that trigger scheduling and corresponding behavior:</p><ol><li><p><code>Policy</code> changes trigger scheduling:</p><ul><li>The scheduler makes the placement decisions based on the latest <code>ClusterSchedulingPolicySnapshot</code>.</li><li>When it&rsquo;s just a scale out operation (<code>NumberOfClusters</code> of pickN mode is increased), the <code>ClusterResourcePlacement</code>
controller updates the label of the existing <code>ClusterSchedulingPolicySnapshot</code> instead of creating a new one, so that
the scheduler won&rsquo;t move any existing resources that are already scheduled and just fulfill the new requirement.</li></ul></li><li><p>The following cluster changes trigger scheduling:</p><ul><li>a cluster, originally ineligible for resource placement for some reason, becomes eligible, such as:<ul><li>the cluster setting changes, specifically <code>MemberCluster</code> labels has changed</li><li>an unexpected deployment which originally leads the scheduler to discard the cluster (for example, agents not joining,
networking issues, etc.) has been resolved</li></ul></li><li>a cluster, originally eligible for resource placement, is leaving the fleet and becomes ineligible</li></ul><blockquote><p>Note: The scheduler is only going to place the resources on the new cluster and won&rsquo;t touch the existing clusters.</p></blockquote></li><li><p>Resource-only changes <strong>do not</strong> trigger scheduling including:</p><ul><li><code>ResourceSelectors</code> is updated in the <code>ClusterResourcePlacement</code> spec.</li><li>The selected resources is updated without directly affecting the <code>ClusterResourcePlacement</code>.</li></ul></li></ol><h2 id=whats-next>What&rsquo;s next</h2><ul><li>Read about <a href=scheduler-framework>Scheduling Framework</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e149527fa64d0c3eacbb2ff5e7b6ffea>1.5 - Scheduling Framework</h1><div class=lead>Concept about the Fleet scheduling framework</div><p>The fleet scheduling framework closely aligns with the native <a href=https://kubernetes.io/docs/concepts/scheduling-eviction/scheduling-framework/>Kubernetes scheduling framework</a>,
incorporating several modifications and tailored functionalities.</p><p><img src=/website/images/en/docs/concepts/scheduling-framework/scheduling-framework.jpg alt></p><p>The primary advantage of this framework lies in its capability to compile plugins directly into the scheduler. Its API
facilitates the implementation of diverse scheduling features as plugins, thereby ensuring a lightweight and maintainable
core.</p><p>The fleet scheduler integrates three fundamental built-in plugin types:</p><ul><li><strong>Topology Spread Plugin</strong>: Supports the TopologySpreadConstraints stipulated in the placement policy.</li><li><strong>Cluster Affinity Plugin</strong>: Facilitates the Affinity clause of the placement policy.</li><li><strong>Same Placement Affinity Plugin</strong>: Uniquely designed for the fleet, preventing multiple replicas (selected resources) from
being placed within the same cluster. This distinguishes it from Kubernetes, which allows multiple pods on a node.</li><li><strong>Cluster Eligibility Plugin</strong>: Enables cluster selection based on specific status criteria.</li><li>** Taint & Toleration Plugin**: Enables cluster selection based on taints on the cluster & tolerations on the ClusterResourcePlacement.</li></ul><p>Compared to the Kubernetes scheduling framework, the fleet framework introduces additional stages for the pickN placement type:</p><ul><li><strong>Batch & PostBatch</strong>:<ul><li>Batch: Defines the batch size based on the desired and current <code>ClusterResourceBinding</code>.</li><li>PostBatch: Adjusts the batch size as necessary. Unlike the Kubernetes scheduler, which schedules pods individually (batch size = 1).</li></ul></li><li><strong>Sort</strong>:<ul><li>Fleet&rsquo;s sorting mechanism selects a number of clusters, whereas Kubernetes&rsquo; scheduler prioritizes nodes with the highest scores.</li></ul></li></ul><p>To streamline the scheduling framework, certain stages, such as <code>permit</code> and <code>reserve</code>, have been omitted due to the absence
of corresponding plugins or APIs enabling customers to reserve or permit clusters for specific placements. However, the
framework remains designed for easy extension in the future to accommodate these functionalities.</p><h2 id=in-tree-plugins>In-tree plugins</h2><p>The scheduler includes default plugins, each associated with distinct extension points:</p><table><thead><tr><th>Plugin</th><th>PostBatch</th><th>Filter</th><th>Score</th></tr></thead><tbody><tr><td>Cluster Affinity</td><td>❌</td><td>✅</td><td>✅</td></tr><tr><td>Same Placement Anti-affinity</td><td>❌</td><td>✅</td><td>❌</td></tr><tr><td>Topology Spread Constraints</td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td>Cluster Eligibility</td><td>❌</td><td>✅</td><td>❌</td></tr><tr><td>Taint & Toleration</td><td>❌</td><td>✅</td><td>❌</td></tr></tbody></table><p>The Cluster Affinity Plugin serves as an illustrative example and operates within the following extension points:</p><ol><li><strong>PreFilter</strong>:
Verifies whether the policy contains any required cluster affinity terms. If absent, the plugin bypasses the subsequent
Filter stage.</li><li><strong>Filter</strong>:
Filters out clusters that fail to meet the specified required cluster affinity terms outlined in the policy.</li><li><strong>PreScore</strong>:
Determines if the policy includes any preferred cluster affinity terms. If none are found, this plugin will be skipped
during the Score stage.</li><li><strong>Score</strong>:
Assigns affinity scores to clusters based on compliance with the preferred cluster affinity terms stipulated in the policy.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-716d7f944c3423c5dfa17047db699aed>1.6 - Properties and Property Provides</h1><div class=lead>Concept about cluster properties and property provides</div><p>This document explains the concepts of property provider and cluster properties in Fleet.</p><p>Fleet allows developers to implement a property provider to expose arbitrary properties about
a member cluster, such as its node count and available resources for workload placement. Platforms
could also enable their property providers to expose platform-specific properties via Fleet.
These properties can be useful in a variety of cases: for example, administrators could monitor the
health of a member cluster using related properties; Fleet also supports making scheduling
decisions based on the property data.</p><h2 id=property-provider>Property provider</h2><p>A property provider implements Fleet&rsquo;s property provider interface:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// PropertyProvider is the interface that every property provider must implement.</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>PropertyProvider</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Collect is called periodically by the Fleet member agent to collect properties.</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>//</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Note that this call should complete promptly. Fleet member agent will cancel the</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// context if the call does not complete in time.</span>
</span></span><span style=display:flex><span>	<span style=color:#000>Collect</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>PropertyCollectionResponse</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Start is called when the Fleet member agent starts up to initialize the property provider.</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// This call should not block.</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>//</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Note that Fleet member agent will cancel the context when it exits.</span>
</span></span><span style=display:flex><span>	<span style=color:#000>Start</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>config</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>rest</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Config</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>error</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>For the details, see the <a href=../../../pkg/propertyprovider/interface.go>Fleet source code</a>.</p><p>A property provider should be shipped as a part of the Fleet member agent and run alongside it.
Refer to the <a href=../../../cmd/memberagent/main.go>Fleet source code</a>
for specifics on how to set it up with the Fleet member agent.
At this moment, only one property provider can be set up with the Fleet member agent at a time.
Once connected, the Fleet member agent will attempt to start it when
the agent itself initializes; the agent will then start collecting properties from the
property provider periodically.</p><p>A property provider can expose two types of properties: resource properties, and non-resource
properties. To learn about the two types, see the section below. In addition, the provider can
choose to report its status, such as any errors encountered when preparing the properties,
in the form of Kubernetes conditions.</p><p>The Fleet member agent can run with or without a property provider. If a provider is not set up, or
the given provider fails to start properly, the agent will collect limited properties about
the cluster on its own, specifically the node count, plus the total/allocatable
CPU and memory capacities of the host member cluster.</p><h2 id=cluster-properties>Cluster properties</h2><p>A cluster property is an attribute of a member cluster. There are two types of properties:</p><ul><li><p>Resource property: the usage information of a resource in a member cluster; the
name of the resource should be in the format of
<a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#syntax-and-character-set>a Kubernetes label key</a>,
such as <code>cpu</code> and <code>memory</code>, and the usage information should consist of:</p><ul><li>the total capacity of the resource, which is the amount of the resource
installed in the cluster;</li><li>the allocatable capacity of the resource, which is the maximum amount of the resource
that can be used for running user workloads, as some amount of the resource might be
reserved by the OS, kubelet, etc.;</li><li>the available capacity of the resource, which is the amount of the resource that
is currently free for running user workloads.</li></ul><p>Note that you may report a virtual resource via the property provider, if applicable.</p></li><li><p>Non-resource property: a metric about a member cluster, in the form of a key/value
pair; the key should be in the format of
<a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#syntax-and-character-set>a Kubernetes label key</a>,
such as <code>kubernetes-fleet.io/node-count</code>, and the value at this moment should be a sortable
numeric that can be parsed as
<a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/>a Kubernetes quantity</a>.</p></li></ul><p>Eventually, all cluster properties are exposed via the Fleet <code>MemberCluster</code> API, with the
non-resource properties in the <code>.status.properties</code> field and the resource properties
<code>.status.resourceUsage</code> field:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MemberCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agentStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>properties</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/node-count</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observationTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-30T14:54:24Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceUsage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>allocatable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>cpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;16Gi&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>available</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>cpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;800Mi&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>capacity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>cpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>40</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;20Gi&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Note that conditions reported by the property provider (if any), would be available in the
<code>.status.conditions</code> array as well.</p><h3 id=core-properties>Core properties</h3><p>The following properties are considered core properties in Fleet, which should be supported
in all property provider implementations. Fleet agents will collect them even when no
property provider has been set up.</p><table><thead><tr><th>Property Type</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>Non-resource property</td><td><code>kubernetes-fleet.io/node-count</code></td><td>The number of nodes in a cluster.</td></tr><tr><td>Resource property</td><td><code>cpu</code></td><td>The usage information (total, allocatable, and available capacity) of CPU resource in a cluster.</td></tr><tr><td>Resource property</td><td><code>memory</code></td><td>The usage information (total, allocatable, and available capacity) of memory resource in a cluster.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-057b31916d61f2f113de30f88397f691>1.7 - Safe Rollout</h1><div class=lead>Concept about rolling out changes safely in Fleet</div><p>One of the most important features of Fleet is the ability to safely rollout changes across multiple clusters. We do
this by rolling out the changes in a controlled manner, ensuring that we only continue to propagate the changes to the
next target clusters if the resources are successfully applied to the previous target clusters.</p><h2 id=overview>Overview</h2><p>We automatically propagate any resource changes that are selected by a <code>ClusterResourcePlacement</code> from the hub cluster
to the target clusters based on the placement policy defined in the <code>ClusterResourcePlacement</code>. In order to reduce the
blast radius of such operation, we provide users a way to safely rollout the new changes so that a bad release
won&rsquo;t affect all the running instances all at once.</p><h2 id=rollout-strategy>Rollout Strategy</h2><p>We currently only support the <code>RollingUpdate</code> rollout strategy. It updates the resources in the selected target clusters
gradually based on the <code>maxUnavailable</code> and <code>maxSurge</code> settings.</p><h2 id=in-place-update-policy>In place update policy</h2><p>We always try to do in-place update by respecting the rollout strategy if there is no change in the placement. This is to avoid unnecessary
interrupts to the running workloads when there is only resource changes. For example, if you only change the tag of the
deployment in the namespace you want to place, we will do an in-place update on the deployments already placed on the
targeted cluster instead of moving the existing deployments to other clusters even if the labels or properties of the
current clusters are not the best to match the current placement policy.</p><h2 id=how-to-use-rollingupdateconfig>How To Use RollingUpdateConfig</h2><p>RolloutUpdateConfig is used to control behavior of the rolling update strategy.</p><h3 id=maxunavailable-and-maxsurge>MaxUnavailable and MaxSurge</h3><p><code>MaxUnavailable</code> specifies the maximum number of connected clusters to the fleet compared to <code>target number of clusters</code>
specified in <code>ClusterResourcePlacement</code> policy in which resources propagated by the <code>ClusterResourcePlacement</code> can be
unavailable. Minimum value for <code>MaxUnavailable</code> is set to 1 to avoid stuck rollout during in-place resource update.</p><p><code>MaxSurge</code> specifies the maximum number of clusters that can be scheduled with resources above the <code>target number of clusters</code>
specified in <code>ClusterResourcePlacement</code> policy.</p><blockquote><p><strong>Note:</strong> <code>MaxSurge</code> only applies to rollouts to newly scheduled clusters, and doesn&rsquo;t apply to rollouts of workload triggered by
updates to already propagated resource. For updates to already propagated resources, we always try to do the updates in
place with no surge.</p></blockquote><p><code>target number of clusters</code> changes based on the <code>ClusterResourcePlacement</code> policy.</p><ul><li>For PickAll, it&rsquo;s the number of clusters picked by the scheduler.</li><li>For PickN, it&rsquo;s the number of clusters specified in the <code>ClusterResourcePlacement</code> policy.</li><li>For PickFixed, it&rsquo;s the length of the list of cluster names specified in the <code>ClusterResourcePlacement</code> policy.</li></ul><h4 id=example-1>Example 1:</h4><p>Consider a fleet with 4 connected member clusters (cluster-1, cluster-2, cluster-3 & cluster-4) where every member
cluster has label <code>env: prod</code>. The hub cluster has a namespace called <code>test-ns</code> with a deployment in it.</p><p>The <code>ClusterResourcePlacement</code> spec is defined as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>rollingUpdate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxUnavailable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxSurge</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The rollout will be as follows:</p><ul><li><p>We try to pick 3 clusters out of 4, for this scenario let&rsquo;s say we pick cluster-1, cluster-2 & cluster-3.</p></li><li><p>Since we can&rsquo;t track the initial availability for the deployment, we rollout the namespace with deployment to
cluster-1, cluster-2 & cluster-3.</p></li><li><p>Then we update the deployment with a bad image name to update the resource in place on cluster-1, cluster-2 & cluster-3.</p></li><li><p>But since we have <code>maxUnavailable</code> set to 1, we will rollout the bad image name update for deployment to one of the clusters
(which cluster the resource is rolled out to first is non-deterministic).</p></li><li><p>Once the deployment is updated on the first cluster, we will wait for the deployment&rsquo;s availability to be true before
rolling out to the other clusters</p></li><li><p>And since we rolled out a bad image name update for the deployment it&rsquo;s availability will always be false and hence the
rollout for the other two clusters will be stuck</p></li><li><p>Users might think <code>maxSurge</code> of 1 might be utilized here but in this case since we are updating the resource in place
<code>maxSurge</code> will not be utilized to surge and pick cluster-4.</p></li></ul><blockquote><p><strong>Note:</strong> <code>maxSurge</code> will be utilized to pick cluster-4, if we change the policy to pick 4 cluster or change placement
type to <code>PickAll</code>.</p></blockquote><h4 id=example-2>Example 2:</h4><p>Consider a fleet with 4 connected member clusters (cluster-1, cluster-2, cluster-3 & cluster-4) where,</p><ul><li>cluster-1 and cluster-2 has label <code>loc: west</code></li><li>cluster-3 and cluster-4 has label <code>loc: east</code></li></ul><p>The hub cluster has a namespace called <code>test-ns</code> with a deployment in it.</p><p>Initially, the <code>ClusterResourcePlacement</code> spec is defined as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1          </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>loc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>west</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>rollingUpdate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxSurge</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The rollout will be as follows:</p><ul><li>We try to pick clusters (cluster-1 and cluster-2) by specifying the label selector <code>loc: west</code>.</li><li>Since we can&rsquo;t track the initial availability for the deployment, we rollout the namespace with deployment to cluster-1
and cluster-2 and wait till they become available.</li></ul><p>Then we update the <code>ClusterResourcePlacement</code> spec to the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1          </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>loc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>east</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>rollingUpdate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxSurge</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The rollout will be as follows:</p><ul><li>We try to pick clusters (cluster-3 and cluster-4) by specifying the label selector <code>loc: east</code>.</li><li>But this time around since we have <code>maxSurge</code> set to 2 we are saying we can propagate resources to a maximum of
4 clusters but our target number of clusters specified is 2, we will rollout the namespace with deployment to both
cluster-3 and cluster-4 before removing the deployment from cluster-1 and cluster-2.</li><li>And since <code>maxUnavailable</code> is always set to 25% by default which is rounded off to 1, we will remove the
resource from one of the existing clusters (cluster-1 or cluster-2) because when <code>maxUnavailable</code> is 1 the policy
mandates at least one cluster to be available.</li></ul><h3 id=unavailableperiodseconds>UnavailablePeriodSeconds</h3><p><code>UnavailablePeriodSeconds</code> is used to configure the waiting time between rollout phases when we cannot determine if the
resources have rolled out successfully or not. This field is used only if the availability of resources we propagate
are not trackable. Refer to the <a href=/website/docs/concepts/safe-rollout/#data-only-objects>Data only object</a> section for more details.</p><h2 id=availability-based-rollout>Availability based Rollout</h2><p>We have built-in mechanisms to determine the availability of some common Kubernetes native resources. We only mark them
as available in the target clusters when they meet the criteria we defined.</p><h3 id=how-it-works>How It Works</h3><p>We have an agent running in the target cluster to check the status of the resources. We have specific criteria for each
of the following resources to determine if they are available or not. Here are the list of resources we support:</p><h4 id=deployment>Deployment</h4><p>We only mark a <code>Deployment</code> as available when all its pods are running, ready and updated according to the latest spec.</p><h4 id=daemonset>DaemonSet</h4><p>We only mark a <code>DaemonSet</code> as available when all its pods are available and updated according to the latest spec on all
desired scheduled nodes.</p><h4 id=statefulset>StatefulSet</h4><p>We only mark a <code>StatefulSet</code> as available when all its pods are running, ready and updated according to the latest revision.</p><h4 id=job>Job</h4><p>We only mark a <code>Job</code> as available when it has at least one succeeded pod or one ready pod.</p><h4 id=service>Service</h4><p>For <code>Service</code> based on the service type the availability is determined as follows:</p><ul><li>For <code>ClusterIP</code> & <code>NodePort</code> service, we mark it as available when a cluster IP is assigned.</li><li>For <code>LoadBalancer</code> service, we mark it as available when a <code>LoadBalancerIngress</code> has been assigned along with an IP or Hostname.</li><li>For <code>ExternalName</code> service, checking availability is not supported, so it will be marked as available with not trackable reason.</li></ul><h4 id=data-only-objects>Data only objects</h4><p>For the objects described below since they are a data resource we mark them as available immediately after creation,</p><ul><li>Namespace</li><li>Secret</li><li>ConfigMap</li><li>Role</li><li>ClusterRole</li><li>RoleBinding</li><li>ClusterRoleBinding</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f14a979ac0ba3b2cbfcab451b17d9e7a>1.8 - Override</h1><div class=lead>Concept about the override APIs</div><h2 id=overview>Overview</h2><p>The <code>ClusterResourceOverride</code> and <code>ResourceOverride</code> provides a way to customize resource configurations before they are propagated
to the target cluster by the <code>ClusterResourcePlacement</code>.</p><h2 id=difference-between-clusterresourceoverride-and-resourceoverride>Difference Between <code>ClusterResourceOverride</code> And <code>ResourceOverride</code></h2><p><code>ClusterResourceOverride</code> represents the cluster-wide policy that overrides the cluster scoped resources to one or more
clusters while <code>ResourceOverride</code> will apply to resources in the same namespace as the namespace-wide policy.</p><blockquote><p><strong>Note:</strong> If a namespace is selected by the <code>ClusterResourceOverride</code>, ALL the resources under the namespace are selected
automatically.</p></blockquote><p>If the resource is selected by both <code>ClusterResourceOverride</code> and <code>ResourceOverride</code>, the <code>ResourceOverride</code> will win
when resolving the conflicts.</p><h2 id=when-to-use-override>When To Use Override</h2><p>Overrides is useful when you want to customize the resources before they are propagated from the hub cluster to the target clusters.
Some example use cases are:</p><ul><li>As a platform operator, I want to propagate a clusterRoleBinding to cluster-us-east and cluster-us-west and would like to
grant the same role to different groups in each cluster.</li><li>As a platform operator, I want to propagate a clusterRole to cluster-staging and cluster-production and would like to
grant more permissions to the cluster-staging cluster than the cluster-production cluster.</li><li>As a platform operator, I want to propagate a namespace to all the clusters and would like to customize the labels for
each cluster.</li><li>As an application developer, I would like to propagate a deployment to cluster-staging and cluster-production and would
like to always use the latest image in the staging cluster and a specific image in the production cluster.</li><li>As an application developer, I would like to propagate a deployment to all the clusters and would like to use different
commands for my container in different regions.</li></ul><h2 id=limits>Limits</h2><ul><li>Each resource can be only selected by one override simultaneously. In the case of namespace scoped resources, up to two
overrides will be allowed, considering the potential selection through both <code>ClusterResourceOverride</code> (select its namespace)
and <code>ResourceOverride</code>.</li><li>At most 100 <code>ClusterResourceOverride</code> can be created.</li><li>At most 100 <code>ResourceOverride</code> can be created.</li></ul><h2 id=resource-selector>Resource Selector</h2><p><code>ClusterResourceSelector</code> of <code>ClusterResourceOverride</code> selects which cluster-scoped resources need to be overridden before
applying to the selected clusters.</p><p>It supports the following forms of resource selection:</p><ul><li>Select resources by specifying the &lt;group, version, kind> and name. This selection propagates only one resource that
matches the &lt;group, version, kind> and name.</li></ul><blockquote><p><strong>Note:</strong> Label selector of <code>ClusterResourceSelector</code> is not supported.</p></blockquote><p><code>ResourceSelector</code> of <code>ResourceOverride</code> selects which namespace-scoped resources need to be overridden before applying to
the selected clusters.</p><p>It supports the following forms of resource selection:</p><ul><li>Select resources by specifying the &lt;group, version, kind> and name. This selection propagates only one resource that
matches the &lt;group, version, kind> and name under the <code>ResourceOverride</code> namespace.</li></ul><h2 id=override-policy>Override Policy</h2><p>Override policy defines how to override the selected resources on the target clusters.</p><p>It contains an array of override rules and its order determines the override order. For example, when there are two rules
selecting the same fields on the target cluster, the last one will win.</p><p>Each override rule contains the following fields:</p><ul><li><code>ClusterSelector</code>: which cluster(s) the override rule applies to. It supports the following forms of cluster selection:<ul><li>Select clusters by specifying the cluster labels.</li><li>An empty selector selects ALL the clusters.</li><li>A nil selector selects NO target cluster.</li></ul></li><li><code>JSONPatchOverrides</code>: a list of JSON path override rules applied to the selected resources following <a href=https://datatracker.ietf.org/doc/html/rfc6902>RFC 6902</a>.</li></ul><blockquote><p><strong>Note:</strong> Updating the fields in the TypeMeta (e.g., <code>apiVersion</code>, <code>kind</code>) is not allowed.</p></blockquote><blockquote><p><strong>Note:</strong> Updating the fields in the ObjectMeta (e.g., <code>name</code>, <code>namespace</code>) excluding annotations and labels is not allowed.</p></blockquote><blockquote><p><strong>Note:</strong> Updating the fields in the Status (e.g., <code>status</code>) is not allowed.</p></blockquote><h2 id=when-to-trigger-rollout>When To Trigger Rollout</h2><p>It will take the snapshot of each override change as a result of <code>ClusterResourceOverrideSnapshot</code> and
<code>ResourceOverrideSnapshot</code>. The snapshot will be used to determine whether the override change should be applied to the existing
<code>ClusterResourcePlacement</code> or not. If applicable, it will start rolling out the new resources to the target clusters by
respecting the rollout strategy defined in the <code>ClusterResourcePlacement</code>.</p><h2 id=examples>Examples</h2><h3 id=add-annotations-to-the-configmap-by-using-clusterresourceoverride>add annotations to the configmap by using clusterResourceOverride</h3><p>Suppose we create a configmap named <code>app-config-1</code> under the namespace <code>application-1</code> in the hub cluster, and we want to
add an annotation to it, which is applied to all the member clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConfigMap</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>creationTimestamp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>app-config-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>application-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1434&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>b4109de8-32f2-4ac8-9e1a-9cb715b3261d</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Create a <code>ClusterResourceOverride</code> named <code>cro-1</code> to add an annotation to the namespace <code>application-1</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourceOverride</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>creationTimestamp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>finalizers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>kubernetes-fleet.io/override-cleanup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cro-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1436&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>32237804</span>-<span style=color:#000>7eb2-4d5f-9996-ff4d8ce778e7</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterResourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>application-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>overrideRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>jsonPatchOverrides</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>op</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>add</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/metadata/annotations</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>cro-test-annotation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cro-test-annotation-val</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Check the configmap on one of the member cluster by running <code>kubectl get configmap app-config-1 -n application-1 -o yaml</code> command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConfigMap</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cro-test-annotation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cro-test-annotation-val</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/last-applied-configuration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;{&#34;apiVersion&#34;:&#34;v1&#34;,&#34;data&#34;:{&#34;data&#34;:&#34;test&#34;},&#34;kind&#34;:&#34;ConfigMap&#34;,&#34;metadata&#34;:{&#34;annotations&#34;:{&#34;cro-test-annotation&#34;:&#34;cro-test-annotation-val&#34;,&#34;kubernetes-fleet.io/spec-hash&#34;:&#34;4dd5a08aed74884de455b03d3b9c48be8278a61841f3b219eca9ed5e8a0af472&#34;},&#34;name&#34;:&#34;app-config-1&#34;,&#34;namespace&#34;:&#34;application-1&#34;,&#34;ownerReferences&#34;:[{&#34;apiVersion&#34;:&#34;placement.kubernetes-fleet.io/v1beta1&#34;,&#34;blockOwnerDeletion&#34;:false,&#34;kind&#34;:&#34;AppliedWork&#34;,&#34;name&#34;:&#34;crp-1-work&#34;,&#34;uid&#34;:&#34;77d804f5-f2f1-440e-8d7e-e9abddacb80c&#34;}]}}&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/spec-hash</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>4dd5a08aed74884de455b03d3b9c48be8278a61841f3b219eca9ed5e8a0af472</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>creationTimestamp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>app-config-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>application-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ownerReferences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>blockOwnerDeletion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AppliedWork</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-1-work</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>77d804f5-f2f1-440e-8d7e-e9abddacb80c</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1449&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>a8601007-1e6b-4b64-bc05-1057ea6bd21b</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=add-annotations-to-the-configmap-by-using-resourceoverride>add annotations to the configmap by using resourceOverride</h3><p>You can use the <code>ResourceOverride</code> to add an annotation to the configmap <code>app-config-1</code> explicitly in the namespace <code>application-1</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceOverride</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>creationTimestamp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:25:31Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>finalizers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>kubernetes-fleet.io/override-cleanup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>generation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ro-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>application-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;3859&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>b4117925-bc3c-438d-a4f6-067bc4577364</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>overrideRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>jsonPatchOverrides</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>op</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>add</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/metadata/annotations</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>ro-test-annotation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ro-test-annotation-val</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConfigMap</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>app-config-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=how-to-validate-if-overrides-are-applied>How To Validate If Overrides Are Applied</h2><p>You can validate if the overrides are applied by checking the <code>ClusterResourcePlacement</code> status. The status output will
indicate both placement conditions and individual placement statuses on each member cluster that was overridden.</p><p>Sample output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>found all the clusters needed as specified by the scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SchedulingPolicyFulfilled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementScheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All 3 cluster(s) start rolling out the latest resource</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementRolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>The selected resources are successfully overridden in the 3 clusters</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OverriddenSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementOverridden</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Works(s) are succcesfully created or updated in the 3 target clusters&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>namespaces</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementWorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>The selected resources are successfully applied to 3 clusters</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApplySucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>The selected resources in 3 cluster are available now</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementAvailable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>observedResourceIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementStatuses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>applicableClusterResourceOverrides</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>cro-1-0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;Successfully scheduled resources for placement in kind-cluster-1 (affinity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        score: 0, topology spread score: 0): picked by scheduling policy&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Detected the new changes on the resources and started the rollout process</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RolloutStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Successfully applied the override rules on the resources</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OverriddenSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Overridden</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All of the works are synchronized to the latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AllWorkSynced</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All corresponding work objects are applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AllWorkHaveBeenApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-05-07T08:06:27Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>The availability of work object crp-1-work is not trackable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WorkNotTrackable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Available</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><code>applicableClusterResourceOverrides</code> in <code>placementStatuses</code> indicates which <code>ClusterResourceOverrideSnapshot</code> that is applied
to the target cluster. Similarly, <code>applicableResourceOverrides</code> will be set if the <code>ResourceOverrideSnapshot</code> is applied.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8ddd4e0ab9f151e89ec11f8f8feb3f69>1.9 - Staged Update</h1><div class=lead>Concept about Staged Update</div><p>While users rely on the <code>RollingUpdate</code> rollout strategy to safely roll out their workloads,
there is also a requirement for a staged rollout mechanism at the cluster level to enable more controlled and systematic continuous delivery (CD) across the fleet.
Introducing a staged update run feature would address this need by enabling gradual deployments, reducing risk, and ensuring greater reliability and consistency in workload updates across clusters.</p><p><img src=/website/images/en/docs/concepts/staged-update/updaterun.jpg alt></p><h2 id=overview>Overview</h2><p>We introduce two new Custom Resources, <code>ClusterStagedUpdateStrategy</code> and <code>ClusterStagedUpdateRun</code>.</p><p><code>ClusterStagedUpdateStrategy</code> defines a reusable orchestration pattern that organizes member clusters into distinct stages, controlling both the rollout sequence within each stage and incorporating post-stage validation tasks that must succeed before proceeding to subsequent stages. For brevity, we&rsquo;ll refer to <code>ClusterStagedUpdateStrategy</code> as <em>updateRun strategy</em> throughout this document.</p><p><code>ClusterStagedUpdateRun</code> orchestrates resource deployment across clusters by executing a <code>ClusterStagedUpdateStrategy</code>. It requires three key inputs: the target <code>ClusterResourcePlacement</code> name, a resource snapshot index specifying the version to deploy, and the strategy name that defines the rollout rules. The term <em>updateRun</em> will be used to represent <code>ClusterStagedUpdateRun</code> in this document.</p><h2 id=specify-rollout-strategy-for-clusterresourceplacement>Specify Rollout Strategy for ClusterResourcePlacement</h2><p>While <code>ClusterResourcePlacement</code> uses <code>RollingUpdate</code> as its default strategy, switching to staged updates requires setting the rollout strategy to <code>External</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>tolerations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gpu-workload</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>External</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># specify External here to use the stagedUpdateRun strategy.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=deploy-a-clusterstagedupdatestrategy>Deploy a ClusterStagedUpdateStrategy</h2><p>The <code>ClusterStagedUpdateStrategy</code> custom resource enables users to organize member clusters into stages and define their rollout sequence. This strategy is reusable across multiple updateRuns, with each updateRun creating an immutable snapshot of the strategy at startup. This ensures that modifications to the strategy do not impact any in-progress updateRun executions.</p><p>An example <code>ClusterStagedUpdateStrategy</code> looks like below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterStagedUpdateStrategy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-strategy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>staging</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>staging</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>afterStageTasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TimedWait</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>waitTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1h</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>afterStageTasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Approval</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>production</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>production</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>sortingLabelKey</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>order</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>afterStageTasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Approval</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TimedWait</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>waitTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1h</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><code>ClusterStagedUpdateStrategy</code> is cluster-scoped resource. Its spec contains a list of <code>stageConfig</code> entries defining the configuration for each stage.
Stages execute sequentially in the order specified. Each stage must have a unique name and uses a labelSelector to identify member clusters for update. In above example, we define 3 stages: <code>staging</code> selecting member clusters labeled with <code>environment: staging</code>, <code>canary</code> selecting member clusters labeled with <code>environment: canary</code> and <code>production</code> selecting member clusters labeled with <code>environment: production</code>.</p><p>Each stage can optionally specify <code>sortingLabelKey</code> and <code>afterStageTasks</code>. <code>sortingLabelKey</code> is used to define a label whose integer value determines update sequence within a stage. With above example, assuming there are 3 clusters selected in the <code>production</code> (all 3 clusters have <code>environment: production</code> label), then the fleet admin can label them with <code>order: 1</code>, <code>order: 2</code>, and <code>order: 3</code> respectively to control the rollout sequence. Without <code>sortingLabelKey</code>, clusters are updated in alphabetical order by name.</p><p>By default, the next stage begins immediately after the current stage completes. A user can control this cross-stage behavior by specifying the <code>afterStageTasks</code> in each stage. These tasks execute after all clusters in a stage update successfully. We currently support two types of tasks: <code>Approval</code> and <code>Timedwait</code>. Each stage can include one task of each type (maximum of two tasks). Both tasks must be satisfied before advancing to the next stage.</p><p><code>Timedwait</code> task requires a specified waitTime duration. The updateRun waits for the duration to pass before executing the next stage. For <code>Approval</code> task, the controller generates a <code>ClusterApprovalRequest</code> object automatically named as <code>&lt;updateRun name>-&lt;stage name></code>. The name is also shown in the updateRun status. The <code>ClusterApprovalRequest</code> object is pretty simple:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterApprovalRequest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run-canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/targetupdaterun</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/targetUpdatingStage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/isLatestUpdateRunApproval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>parentStageRollout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>targetStage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The user then need to manually approve the task by patching its status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl patch clusterapprovalrequests example-run-canary --type<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;merge&#39;</span> -p <span style=color:#4e9a06>&#39;{&#34;status&#34;:{&#34;conditions&#34;:[{&#34;type&#34;:&#34;Approved&#34;,&#34;status&#34;:&#34;True&#34;,&#34;reason&#34;:&#34;lgtm&#34;,&#34;message&#34;:&#34;lgtm&#34;,&#34;lastTransitionTime&#34;:&#34;&#39;</span><span style=color:#204a87;font-weight:700>$(</span>date -u +%Y-%m-%dT%H:%M:%SZ<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#39;&#34;,&#34;observedGeneration&#34;:1}]}}&#39;</span> --subresource<span style=color:#ce5c00;font-weight:700>=</span>status
</span></span></code></pre></div><p>The updateRun will only continue to next stage after the <code>ClusterApprovalRequest</code> is approved.</p><h2 id=trigger-rollout-with-clusterstagedupdaterun>Trigger rollout with ClusterStagedUpdateRun</h2><p>When using <code>External</code> rollout strategy, a <code>ClusterResourcePlacement</code> begins deployment only when triggered by a <code>ClusterStagedUpdateRun</code>. An example <code>ClusterStagedUpdateRun</code> is shown below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterStagedUpdateRun</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSnapshotIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stagedRolloutStrategyName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-strategy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>This cluster-scoped resource requires three key parameters: the <code>placementName</code> specifying the target <code>ClusterResourcePlacement</code>, the <code>resourceSnapshotIndex</code> identifying which version of resources to deploy (learn how to find resourceSnapshotIndex <a href=../howtos/updaterun.md>here</a>), and the <code>stagedRolloutStrategyName</code> indicating the <code>ClusterStagedUpdateStrategy</code> to follow.</p><p>An updateRun executes in two phases. During the initialization phase, the controller performs a one-time setup where it captures a snapshot of the updateRun strategy, collects scheduled and to-be-deleted <code>ClusterResourceBindings</code>, generates the cluster update sequence, and records all this information in the updateRun status.</p><p>In the execution phase, the controller processes each stage sequentially, updates clusters within each stage one at a time, and enforces completion of after-stage tasks. It then executes a final delete stage to clean up resources from unscheduled clusters. The updateRun succeeds when all stages complete successfully. However, it will fail if any execution-affecting events occur, for example, the target ClusterResourcePlacement being deleted, and member cluster changes triggering new scheduling. In such cases, error details are recorded in the updateRun status. Remember that once initialized, an updateRun operates on its strategy snapshot, making it immune to subsequent strategy modifications.</p><h2 id=understand-clusterstagedupdaterun-status>Understand ClusterStagedUpdateRun status</h2><p>Let&rsquo;s take a deep look into the status of a completed <code>ClusterStagedUpdateRun</code>. It displays details about the rollout status for every clusters and stages.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe crsur run example-run
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Conditions:
</span></span><span style=display:flex><span>    Last Transition Time:  2025-03-12T23:21:39Z
</span></span><span style=display:flex><span>    Message:               ClusterStagedUpdateRun initialized successfully
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                UpdateRunInitializedSuccessfully
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Initialized
</span></span><span style=display:flex><span>    Last Transition Time:  2025-03-12T23:21:39Z
</span></span><span style=display:flex><span>    Message:               
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                UpdateRunStarted
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Progressing
</span></span><span style=display:flex><span>    Last Transition Time:  2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>    Message:               
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                UpdateRunSucceeded
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Succeeded
</span></span><span style=display:flex><span>  Deletion Stage Status:
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:       2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>      Message:                    
</span></span><span style=display:flex><span>      Observed Generation:        <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                     StageUpdatingStarted
</span></span><span style=display:flex><span>      Status:                     True
</span></span><span style=display:flex><span>      Type:                       Progressing
</span></span><span style=display:flex><span>      Last Transition Time:       2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>      Message:                    
</span></span><span style=display:flex><span>      Observed Generation:        <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                     StageUpdatingSucceeded
</span></span><span style=display:flex><span>      Status:                     True
</span></span><span style=display:flex><span>      Type:                       Succeeded
</span></span><span style=display:flex><span>    End Time:                     2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>    Stage Name:                   kubernetes-fleet.io/deleteStage
</span></span><span style=display:flex><span>    Start Time:                   2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>  Policy Observed Cluster Count:  <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>  Policy Snapshot Index Used:     <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>  Staged Update Strategy Snapshot:
</span></span><span style=display:flex><span>    Stages:
</span></span><span style=display:flex><span>      After Stage Tasks:
</span></span><span style=display:flex><span>        Type:       Approval
</span></span><span style=display:flex><span>        Wait Time:  0s
</span></span><span style=display:flex><span>        Type:       TimedWait
</span></span><span style=display:flex><span>        Wait Time:  1m0s
</span></span><span style=display:flex><span>      Label Selector:
</span></span><span style=display:flex><span>        Match Labels:
</span></span><span style=display:flex><span>          Environment:  staging
</span></span><span style=display:flex><span>      Name:             staging
</span></span><span style=display:flex><span>      After Stage Tasks:
</span></span><span style=display:flex><span>        Type:       Approval
</span></span><span style=display:flex><span>        Wait Time:  0s
</span></span><span style=display:flex><span>      Label Selector:
</span></span><span style=display:flex><span>        Match Labels:
</span></span><span style=display:flex><span>          Environment:    canary
</span></span><span style=display:flex><span>      Name:               canary
</span></span><span style=display:flex><span>      Sorting Label Key:  name
</span></span><span style=display:flex><span>      After Stage Tasks:
</span></span><span style=display:flex><span>        Type:       TimedWait
</span></span><span style=display:flex><span>        Wait Time:  1m0s
</span></span><span style=display:flex><span>        Type:       Approval
</span></span><span style=display:flex><span>        Wait Time:  0s
</span></span><span style=display:flex><span>      Label Selector:
</span></span><span style=display:flex><span>        Match Labels:
</span></span><span style=display:flex><span>          Environment:    production
</span></span><span style=display:flex><span>      Name:               production
</span></span><span style=display:flex><span>      Sorting Label Key:  order
</span></span><span style=display:flex><span>  Stages Status:
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Approval Request Name:  example-run-staging
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:21:54Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestCreated
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:22:55Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestApproved
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestApproved
</span></span><span style=display:flex><span>      Type:                    Approval
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:22:54Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskWaitTimeElapsed
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  WaitTimeElapsed
</span></span><span style=display:flex><span>      Type:                    TimedWait
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>      Cluster Name:  member1
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:21:39Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingStarted
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Started
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:21:54Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingSucceeded
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Succeeded
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:21:54Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingWaiting
</span></span><span style=display:flex><span>      Status:                False
</span></span><span style=display:flex><span>      Type:                  Progressing
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:22:55Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingSucceeded
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Succeeded
</span></span><span style=display:flex><span>    End Time:                2025-03-12T23:22:55Z
</span></span><span style=display:flex><span>    Stage Name:              staging
</span></span><span style=display:flex><span>    Start Time:              2025-03-12T23:21:39Z
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Approval Request Name:  example-run-canary
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:23:10Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestCreated
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestApproved
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestApproved
</span></span><span style=display:flex><span>      Type:                    Approval
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>      Cluster Name:  member2
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:22:55Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingStarted
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Started
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:23:10Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingSucceeded
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Succeeded
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:23:10Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingWaiting
</span></span><span style=display:flex><span>      Status:                False
</span></span><span style=display:flex><span>      Type:                  Progressing
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingSucceeded
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Succeeded
</span></span><span style=display:flex><span>    End Time:                2025-03-12T23:25:15Z
</span></span><span style=display:flex><span>    Stage Name:              canary
</span></span><span style=display:flex><span>    Start Time:              2025-03-12T23:22:55Z
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskWaitTimeElapsed
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  WaitTimeElapsed
</span></span><span style=display:flex><span>      Type:                    TimedWait
</span></span><span style=display:flex><span>      Approval Request Name:   example-run-production
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestCreated
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:25:25Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestApproved
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestApproved
</span></span><span style=display:flex><span>      Type:                    Approval
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingWaiting
</span></span><span style=display:flex><span>      Status:                False
</span></span><span style=display:flex><span>      Type:                  Progressing
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingSucceeded
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Succeeded
</span></span><span style=display:flex><span>    End Time:                2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>    Stage Name:              production
</span></span><span style=display:flex><span>Events:                      &lt;none&gt;
</span></span></code></pre></div><h3 id=updaterun-overall-status>UpdateRun overall status</h3><p>At the very top, <code>Status.Conditions</code> gives the overall status of the updateRun. The execution an update run consists of two phases: initialization and execution.
During initialization, the controller performs a one-time setup where it captures a snapshot of the updateRun strategy, collects scheduled and to-be-deleted <code>ClusterResourceBindings</code>,
generates the cluster update sequence, and records all this information in the updateRun status.
The <code>UpdateRunInitializedSuccessfully</code> condition indicates the initialization is successful.</p><p>After initialization, the controller starts executing the updateRun. The <code>UpdateRunStarted</code> condition indicates the execution has started.</p><p>After all clusters are updated, all after-stage tasks are completed, and thus all stages are finished, the <code>UpdateRunSucceeded</code> condition is set to <code>True</code>, indicating the updateRun has succeeded.</p><h3 id=fields-recorded-in-the-updaterun-status-during-initialization>Fields recorded in the updateRun status during initialization</h3><p>During initialization, the controller records the following fields in the updateRun status:</p><ul><li><code>PolicySnapshotIndexUsed</code>: the index of the policy snapshot used for the updateRun, it should be the latest one.</li><li><code>PolicyObservedClusterCount</code>: the number of clusters selected by the scheduling policy.</li><li><code>StagedUpdateStrategySnapshot</code>: the snapshot of the updateRun strategy, which ensures any strategy changes will not affect executing updateRuns.</li></ul><h3 id=stages-and-clusters-status>Stages and clusters status</h3><p>The <code>Stages Status</code> section displays the status of each stage and cluster. As shown in the strategy snapshot, the updateRun has three stages: <code>staging</code>, <code>canary</code>, and <code>production</code>. During initialization, the controller generates the rollout plan, classifies the scheduled clusters
into these three stages and dumps the plan into the updateRun status. As the execution progresses, the controller updates the status of each stage and cluster. Take the <code>staging</code> stage as an example, <code>member1</code> is included in this stage. <code>ClusterUpdatingStarted</code> condition indicates the cluster is being updated and <code>ClusterUpdatingSucceeded</code> condition shows the cluster is updated successfully.</p><p>After all clusters are updated in a stage, the controller executes the specified after-stage tasks. Stage <code>staging</code> has two after-stage tasks: <code>Approval</code> and <code>TimedWait</code>. The <code>Approval</code> task requires the admin to manually approve a <code>ClusterApprovalRequest</code> generated by the controller. The name of the <code>ClusterApprovalRequest</code> is also included in the status, which is <code>example-run-staging</code>. <code>AfterStageTaskApprovalRequestCreated</code> condition indicates the approval request is created and <code>AfterStageTaskApprovalRequestApproved</code> condition indicates the approval request has been approved. The <code>TimedWait</code> task enforces a suspension of the rollout until the specified wait time has elapsed and in this case, the wait time is 1 minute. <code>AfterStageTaskWaitTimeElapsed</code> condition indicates the wait time has elapsed and the rollout can proceed to the next stage.</p><p>Each stage also has its own conditions. When a stage starts, the <code>Progressing</code> condition is set to <code>True</code>. When all the cluster updates complete, the <code>Progressing</code> condition is set to <code>False</code> with reason <code>StageUpdatingWaiting</code> as shown above. It means the stage is waiting for
after-stage tasks to pass.
And thus the <code>lastTransitionTime</code> of the <code>Progressing</code> condition also serves as the start time of the wait in case there&rsquo;s a <code>TimedWait</code> task. When all after-stage tasks pass, the <code>Succeeded</code> condition is set to <code>True</code>. Each stage status also has <code>Start Time</code> and <code>End Time</code> fields, making it easier to read.</p><p>There&rsquo;s also a <code>Deletion Stage Status</code> section, which displays the status of the deletion stage. The deletion stage is the last stage of the updateRun. It deletes resources from the unscheduled clusters. The status is pretty much the same as a normal update stage, except that there are no after-stage tasks.</p><p>Note that all these conditions have <code>lastTransitionTime</code> set to the time when the controller updates the status. It can help debug and check
the progress of the updateRun.</p><h2 id=relationship-between-clusterstagedupdaterun-and-clusterresourceplacement>Relationship between ClusterStagedUpdateRun and ClusterResourcePlacement</h2><p>A <code>ClusterStagedUpdateRun</code> serves as the trigger mechanism for rolling out a <code>ClusterResourcePlacement</code>. The key points of this relationship are:</p><ul><li>The <code>ClusterResourcePlacement</code> remains in a scheduled state without being deployed until a corresponding <code>ClusterStagedUpdateRun</code> is created.</li><li>During rollout, the <code>ClusterResourcePlacement</code> status is continuously updated with detailed information from each target cluster.</li><li>While a <code>ClusterStagedUpdateRun</code> only indicates whether updates have started and completed for each member cluster (as described in <a href=/website/docs/concepts/staged-update/#understand-clusterstagedupdaterun-status>previous section</a>), the <code>ClusterResourcePlacement</code> provides comprehensive details including:<ul><li>Success/failure of resource creation</li><li>Application of overrides</li><li>Specific error messages</li></ul></li></ul><p>For example, below is the status of an in-progress <code>ClusterStagedUpdateRun</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe crsur example-run
</span></span><span style=display:flex><span>Name:         example-run
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Conditions:
</span></span><span style=display:flex><span>    Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>    Message:               ClusterStagedUpdateRun initialized successfully
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                UpdateRunInitializedSuccessfully
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Initialized
</span></span><span style=display:flex><span>    Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>    Message:               
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                UpdateRunStarted <span style=color:#8f5902;font-style:italic># updateRun started</span>
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Progressing
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>  Stages Status:
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Approval Request Name:  example-run-staging
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-17T21:37:29Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestCreated
</span></span><span style=display:flex><span>      Type:                    Approval
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-17T21:38:29Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskWaitTimeElapsed
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  WaitTimeElapsed
</span></span><span style=display:flex><span>      Type:                    TimedWait
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>      Cluster Name:  member1
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingStarted
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Started
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-17T21:37:29Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingSucceeded <span style=color:#8f5902;font-style:italic># member1 has updated successfully</span>
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Succeeded
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:29Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingWaiting <span style=color:#8f5902;font-style:italic># waiting for approval</span>
</span></span><span style=display:flex><span>      Status:                False
</span></span><span style=display:flex><span>      Type:                  Progressing
</span></span><span style=display:flex><span>    Stage Name:              staging
</span></span><span style=display:flex><span>    Start Time:              2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Approval Request Name:  example-run-canary
</span></span><span style=display:flex><span>      Type:                   Approval
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>      Cluster Name:  member2
</span></span><span style=display:flex><span>    Stage Name:      canary
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Type:                   TimedWait
</span></span><span style=display:flex><span>      Approval Request Name:  example-run-production
</span></span><span style=display:flex><span>      Type:                   Approval
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>    Stage Name:  production
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>In above status, member1 from stage <code>staging</code> has been updated successfully. The stage is waiting for approval to proceed to the next stage. And member2 from stage <code>canary</code> is not updated yet.</p><p>Let&rsquo;s take a look at the status of the <code>ClusterResourcePlacement</code> <code>example-placement</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe crp example-placement
</span></span><span style=display:flex><span>Name:         example-placement
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Conditions:
</span></span><span style=display:flex><span>    Last Transition Time:   2025-03-12T23:01:32Z
</span></span><span style=display:flex><span>    Message:                found all cluster needed as specified by the scheduling policy, found <span style=color:#0000cf;font-weight:700>2</span> cluster<span style=color:#ce5c00;font-weight:700>(</span>s<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    Observed Generation:    <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                 SchedulingPolicyFulfilled
</span></span><span style=display:flex><span>    Status:                 True
</span></span><span style=display:flex><span>    Type:                   ClusterResourcePlacementScheduled
</span></span><span style=display:flex><span>    Last Transition Time:   2025-03-13T07:35:25Z
</span></span><span style=display:flex><span>    Message:                There are still <span style=color:#0000cf;font-weight:700>1</span> cluster<span style=color:#ce5c00;font-weight:700>(</span>s<span style=color:#ce5c00;font-weight:700>)</span> in the process of deciding whether to roll out the latest resources or not
</span></span><span style=display:flex><span>    Observed Generation:    <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                 RolloutStartedUnknown
</span></span><span style=display:flex><span>    Status:                 Unknown
</span></span><span style=display:flex><span>    Type:                   ClusterResourcePlacementRolloutStarted
</span></span><span style=display:flex><span>  Observed Resource Index:  <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>  Placement Statuses:
</span></span><span style=display:flex><span>    Cluster Name:  member1
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:01:32Z
</span></span><span style=display:flex><span>      Message:               Successfully scheduled resources <span style=color:#204a87;font-weight:700>for</span> placement in <span style=color:#4e9a06>&#34;member1&#34;</span> <span style=color:#ce5c00;font-weight:700>(</span>affinity score: 0, topology spread score: 0<span style=color:#ce5c00;font-weight:700>)</span>: picked by scheduling policy
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                Scheduled
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Scheduled
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>      Message:               Detected the new changes on the resources and started the rollout process, resourceSnapshotIndex: 5, clusterStagedUpdateRun: example-run
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                RolloutStarted
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  RolloutStarted
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>      Message:               No override rules are configured <span style=color:#204a87;font-weight:700>for</span> the selected resources
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                NoOverrideSpecified
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Overridden
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>      Message:               All of the works are synchronized to the latest
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                AllWorkSynced
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  WorkSynchronized
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>      Message:               All corresponding work objects are applied
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                AllWorkHaveBeenApplied
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Applied
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>      Message:               All corresponding work objects are available
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                AllWorkAreAvailable <span style=color:#8f5902;font-style:italic># member1 is all good</span>
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Available
</span></span><span style=display:flex><span>    Cluster Name:            member2
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:01:32Z
</span></span><span style=display:flex><span>      Message:               Successfully scheduled resources <span style=color:#204a87;font-weight:700>for</span> placement in <span style=color:#4e9a06>&#34;member2&#34;</span> <span style=color:#ce5c00;font-weight:700>(</span>affinity score: 0, topology spread score: 0<span style=color:#ce5c00;font-weight:700>)</span>: picked by scheduling policy
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                Scheduled
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Scheduled
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-13T07:35:25Z
</span></span><span style=display:flex><span>      Message:               In the process of deciding whether to roll out the latest resources or not
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                RolloutStartedUnknown <span style=color:#8f5902;font-style:italic># member2 is not updated yet</span>
</span></span><span style=display:flex><span>      Status:                Unknown
</span></span><span style=display:flex><span>      Type:                  RolloutStarted
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>In the <code>Placement Statuses</code> section, we can see the status of each member cluster. For member1, the <code>RolloutStarted</code> condition is set to <code>True</code>, indicating the rollout has started.
In the condition message, we print the <code>ClusterStagedUpdateRun</code> name, which is <code>example-run</code>. This indicates the most recent cluster update is triggered by <code>example-run</code>.
It also displays the detailed update status: the works are synced and applied and are detected available. As a comparison, member2 is still in <code>Scheduled</code> state only.</p><p>When troubleshooting a stalled updateRun, examining the <code>ClusterResourcePlacement</code> status offers valuable diagnostic information that can help identify the root cause.
For comprehensive troubleshooting steps, refer to the <a href=../troubleshooting/updaterun.md>troubleshooting guide</a>.</p><h2 id=concurrent-updateruns>Concurrent updateRuns</h2><p>Multiple concurrent <code>ClusterStagedUpdateRun</code>s can be created for the same <code>ClusterResourcePlacement</code>, allowing fleet administrators to pipeline the rollout of different resource versions. However, to maintain consistency across the fleet and prevent member clusters from running different resource versions simultaneously, we enforce a key constraint: all concurrent <code>ClusterStagedUpdateRun</code>s must use identical <code>ClusterStagedUpdateStrategy</code> settings.</p><p>This strategy consistency requirement is validated during the initialization phase of each updateRun. This validation ensures predictable rollout behavior and prevents configuration drift across your cluster fleet, even when multiple updates are in progress.</p><h2 id=next-steps>Next Steps</h2><ul><li>Learn how to <a href=../howtos/updaterun.md>rollout and rollback CRP resources with Staged Update Run</a></li><li>Learn how to <a href=../troubleshooting/updaterun.md>troubleshoot a Staged Update Run</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-4289eaa321cf089fdf9ee9aab7a3ade8>1.10 - Eviction and Placement Disruption Budget</h1><div class=lead>Concept about Eviction and Placement Disrupiton Budget</div><p>This document explains the concept of <code>Eviction</code> and <code>Placement Disruption Budget</code> in the context of the fleet.</p><h2 id=overview>Overview</h2><p><code>Eviction</code> provides a way to force remove resources from a target cluster once the resources have already been propagated from the hub cluster by a <code>Placement</code> object.
<code>Eviction</code> is considered as an voluntary disruption triggered by the user. <code>Eviction</code> alone doesn&rsquo;t guarantee that resources won&rsquo;t be propagated to target cluster again by the scheduler.
The users need to use <a href=../howtos/taint-toleration.md>taints</a> in conjunction with <code>Eviction</code> to prevent the scheduler from picking the target cluster again.</p><p>The <code>Placement Disruption Budget</code> object protects against voluntary disruptions.</p><p>The only voluntary disruption that can occur in the fleet is the eviction of resources from a target cluster which can be achieved by creating the <code>ClusterResourcePlacementEviction</code> object.</p><p>Some cases of involuntary disruptions in the context of fleet,</p><ul><li>The removal of resources from a member cluster by the scheduler due to scheduling policy changes.</li><li>Users manually deleting workload resources running on a member cluster.</li><li>Users manually deleting the <code>ClusterResourceBinding</code> object which is an internal resource the represents the placement of resources on a member cluster.</li><li>Workloads failing to run properly on a member cluster due to misconfiguration or cluster related issues.</li></ul><p>For all the cases of involuntary disruptions described above, the <code>Placement Disruption Budget</code> object does not protect against them.</p><h2 id=clusterresourceplacementeviction>ClusterResourcePlacementEviction</h2><p>An eviction object is used to remove resources from a member cluster once the resources have already been propagated from the hub cluster.</p><p>The eviction object is only reconciled once after which it reaches a terminal state. Below is the list of terminal states for <code>ClusterResourcePlacementEviction</code>,</p><ul><li><code>ClusterResourcePlacementEviction</code> is valid and it&rsquo;s executed successfully.</li><li><code>ClusterResourcePlacementEviction</code> is invalid.</li><li><code>ClusterResourcePlacementEviction</code> is valid but it&rsquo;s not executed.</li></ul><p>To successfully evict resources from a cluster, the user needs to specify:</p><ul><li>The name of the <code>ClusterResourcePlacement</code> object which propagated resources to the target cluster.</li><li>The name of the target cluster from which we need to evict resources.</li></ul><p>When specifying the <code>ClusterResourcePlacement</code> object in the eviction&rsquo;s spec, the user needs to consider the following cases:</p><ul><li>For <code>PickFixed</code> CRP, eviction is not allowed; it is recommended that one directly edit the list of target clusters on the CRP object.</li><li>For <code>PickAll</code> & <code>PickN</code> CRPs, eviction is allowed because the users cannot deterministically pick or unpick a cluster based on the placement strategy; it&rsquo;s up to the scheduler.</li></ul><blockquote><p><strong>Note:</strong> After an eviction is executed, there is no guarantee that the cluster won&rsquo;t be picked again by the scheduler to propagate resources for a <code>ClusterResourcePlacement</code> resource.
The user needs to specify a <a href=../howtos/taint-toleration.md>taint</a> on the cluster to prevent the scheduler from picking the cluster again. This is especially true for <code>PickAll ClusterResourcePlacement</code> because
the scheduler will try to propagate resources to all the clusters in the fleet.</p></blockquote><h2 id=clusterresourceplacementdisruptionbudget>ClusterResourcePlacementDisruptionBudget</h2><p>The <code>ClusterResourcePlacementDisruptionBudget</code> is used to protect resources propagated by a <code>ClusterResourcePlacement</code> to a target cluster from voluntary disruption, i.e., <code>ClusterResourcePlacementEviction</code>.</p><blockquote><p><strong>Note:</strong> When specifying a <code>ClusterResourcePlacementDisruptionBudget</code>, the name should be the same as the <code>ClusterResourcePlacement</code> that it&rsquo;s trying to protect.</p></blockquote><p>Users are allowed to specify one of two fields in the <code>ClusterResourcePlacementDisruptionBudget</code> spec since they are mutually exclusive:</p><ul><li>MaxUnavailable - specifies the maximum number of clusters in which a placement can be unavailable due to any form of disruptions.</li><li>MinAvailable - specifies the minimum number of clusters in which placements are available despite any form of disruptions.</li></ul><p>for both <code>MaxUnavailable</code> and <code>MinAvailable</code>, the user can specify the number of clusters as an integer or as a percentage of the total number of clusters in the fleet.</p><blockquote><p><strong>Note:</strong> For both MaxUnavailable and MinAvailable, involuntary disruptions are not subject to the disruption budget but will still count against it.</p></blockquote><p>When specifying a disruption budget for a particular <code>ClusterResourcePlacement</code>, the user needs to consider the following cases:</p><table><thead><tr><th>CRP type</th><th><code>MinAvailable</code> DB with an integer</th><th><code>MinAvailable</code> DB with a percentage</th><th><code>MaxUnavailable</code> DB with an integer</th><th><code>MaxUnavailable</code> DB with a percentage</th></tr></thead><tbody><tr><td><code>PickFixed</code></td><td>❌</td><td>❌</td><td>❌</td><td>❌</td></tr><tr><td><code>PickAll</code></td><td>✅</td><td>❌</td><td>❌</td><td>❌</td></tr><tr><td><code>PickN</code></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td></tr></tbody></table><blockquote><p><strong>Note:</strong> We don&rsquo;t allow eviction for <code>PickFixed</code> CRP and hence specifying a <code>ClusterResourcePlacementDisruptionBudget</code> for <code>PickFixed</code> CRP does nothing.
And for <code>PickAll</code> CRP, the user can only specify <code>MinAvailable</code> because total number of clusters selected by a <code>PickAll</code> CRP is non-deterministic.
If the user creates an invalid <code>ClusterResourcePlacementDisruptionBudget</code> object, when an eviction is created, the eviction won&rsquo;t be successfully executed.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-17b09a9dc5200475d8a306f18e63a0f9>2 - Getting Started</h1><div class=lead>Getting started with Fleet</div><div class="pageinfo pageinfo-primary"><p>Fleet documentation features a number of getting started tutorials to help you learn
about Fleet with an environment of your preference. Pick one below to proceed.</p><p>If you are not sure about which one is the best option, for simplicity reasons, it is
recommended that you start with the
<a href=/website/docs/getting-started/kind/>Getting started with Fleet using KinD clusters</a>.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b2dc1a1b66163662e5965b95ed325462>2.1 - Getting started with Fleet using KinD clusters</h1><div class=lead>Use KinD clusters to learn about Fleet</div><p>In this tutorial, you will try Fleet out using
<a href=https://kind.sigs.k8s.io/>KinD</a> clusters, which are Kubernetes clusters running on your own
local machine via <a href=https://docker.com>Docker</a> containers. This is the easiest way
to get started with Fleet, which can help you understand how Fleet simiplify the day-to-day multi-cluster management experience with very little setup needed.</p><blockquote><p>Note</p><p>kind is a tool for setting up a Kubernetes environment for experimental purposes;
some instructions below for running Fleet in the kind environment may not apply to other
environments, and there might also be some minor differences in the Fleet
experience.</p></blockquote><h2 id=before-you-begin>Before you begin</h2><p>To complete this tutorial, you will need:</p><ul><li>The following tools on your local machine:<ul><li><code>kind</code>, for running Kubernetes clusters on your local machine</li><li>Docker</li><li><code>git</code></li><li><code>curl</code></li><li><code>helm</code>, the Kubernetes package manager</li><li><code>jq</code></li><li><code>base64</code></li></ul></li></ul><h2 id=spin-up-a-few-kind-clusters>Spin up a few kind clusters</h2><p>The Fleet open-source project manages a multi-cluster environment using a hub-spoke pattern,
which consists of one hub cluster and one or more member clusters:</p><ul><li>The hub cluster is the portal to which every member cluster connects; it also serves as an
interface for centralized management, through which you can perform a number of tasks,
primarily orchestrating workloads across different clusters.</li><li>A member cluster connects to the hub cluster and runs your workloads as orchestrated by the
hub cluster.</li></ul><p>In this tutorial you will create two kind clusters; one of which serves as the Fleet
hub cluster, and the other the Fleet member cluster. Run the commands below to create them:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace YOUR-KIND-IMAGE with a kind node image name of your</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># choice. It should match with the version of kind installed</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># on your system; for more information, see</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># [kind releases](https://github.com/kubernetes-sigs/kind/releases).</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>KIND_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-KIND-IMAGE
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace YOUR-KUBECONFIG-PATH with the path to a Kubernetes</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># configuration file of your own, typically $HOME/.kube/config.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG_PATH</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-KUBECONFIG-PATH
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The names of the kind clusters; you may use values of your own if you&#39;d like to.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>hub
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>member-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kind create cluster --name <span style=color:#000>$HUB_CLUSTER</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --image<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$KIND_IMAGE</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --kubeconfig<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$KUBECONFIG_PATH</span>
</span></span><span style=display:flex><span>kind create cluster --name <span style=color:#000>$MEMBER_CLUSTER</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --image<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$KIND_IMAGE</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --kubeconfig<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$KUBECONFIG_PATH</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Export the configurations for the kind clusters.</span>
</span></span><span style=display:flex><span>kind <span style=color:#204a87>export</span> kubeconfig -n <span style=color:#000>$HUB_CLUSTER</span>
</span></span><span style=display:flex><span>kind <span style=color:#204a87>export</span> kubeconfig -n <span style=color:#000>$MEMBER_CLUSTER</span>
</span></span></code></pre></div><h1 id=set-up-the-fleet-hub-cluster>Set up the Fleet hub cluster</h1><p>To set up the hub cluster, run the commands below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_CLUSTER_CONTEXT</span><span style=color:#ce5c00;font-weight:700>=</span>kind-<span style=color:#000>$HUB_CLUSTER</span>
</span></span><span style=display:flex><span>kubectl config use-context <span style=color:#000>$HUB_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The variables below uses the Fleet images kept in the Microsoft Container Registry (MCR),</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># and will retrieve the latest version from the Fleet GitHub repository.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># You can, however, build the Fleet images of your own; see the repository README for</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># more information.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>REGISTRY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;mcr.microsoft.com/aks/fleet&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>FLEET_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>curl <span style=color:#4e9a06>&#34;https://api.github.com/repos/Azure/fleet/tags&#34;</span> <span style=color:#000;font-weight:700>|</span> jq -r <span style=color:#4e9a06>&#39;.[0].name&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_AGENT_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hub-agent&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Clone the Fleet repository from GitHub.</span>
</span></span><span style=display:flex><span>git clone https://github.com/Azure/fleet.git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Install the helm chart for running Fleet agents on the hub cluster.</span>
</span></span><span style=display:flex><span>helm install hub-agent fleet/charts/hub-agent/ <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set image.pullPolicy<span style=color:#ce5c00;font-weight:700>=</span>Always <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set image.repository<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$REGISTRY</span>/<span style=color:#000>$HUB_AGENT_IMAGE</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set image.tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$FLEET_VERSION</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>logVerbosity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>namespace</span><span style=color:#ce5c00;font-weight:700>=</span>fleet-system <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>enableWebhook</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>webhookClientConnectionType</span><span style=color:#ce5c00;font-weight:700>=</span>service <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>enableV1Alpha1APIs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>enableV1Beta1APIs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><p>It may take a few seconds for the installation to complete. Once it finishes, verify that
the Fleet hub agents are up and running with the commands below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods -n fleet-system
</span></span></code></pre></div><p>You should see that all the pods are in the ready state.</p><h2 id=set-up-the-fleet-member-custer>Set up the Fleet member custer</h2><p>Next, you will set up the other kind cluster you created earlier as the Fleet
member cluster, which requires that you install the Fleet member agent on
the cluster and connect it to the Fleet hub cluster.</p><p>For your convenience, Fleet provides a script that can automate the process of joining a cluster
into a fleet. To use the script, follow the steps below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Query the API server address of the hub cluster.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_CLUSTER_ADDRESS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;https://</span><span style=color:#204a87;font-weight:700>$(</span>docker inspect <span style=color:#000>$HUB_CLUSTER</span>-control-plane --format<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span><span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>:6443&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER_CONTEXT</span><span style=color:#ce5c00;font-weight:700>=</span>kind-<span style=color:#000>$MEMBER_CLUSTER</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run the script.</span>
</span></span><span style=display:flex><span>chmod +x fleet/hack/membership/join.sh
</span></span><span style=display:flex><span>./fleet/hack/membership/join.sh
</span></span></code></pre></div><p>It may take a few minutes for the script to finish running. Once it is completed, verify
that the cluster has joined successfully with the command below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context <span style=color:#000>$HUB_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>kubectl get membercluster <span style=color:#000>$MEMBER_CLUSTER</span>
</span></span></code></pre></div><p>The newly joined cluster should have the <code>JOINED</code> status field set to <code>True</code>. If you see that
the cluster is still in an unknown state, it might be that the member cluster
is still connecting to the hub cluster. Should this state persist for a prolonged
period, refer to the <a href=/docs/troubleshooting>Troubleshooting Guide</a> for
more information.</p><blockquote><p>Note</p><p>If you would like to know more about the steps the script runs, or would like to join
a cluster into a fleet manually, refer to the <a href=/website/docs/how-tos/clusters/>Managing Clusters</a> How-To
Guide.</p></blockquote><h2 id=use-the-clusterresourceplacement-api-to-orchestrate-resources-among-member-clusters>Use the <code>ClusterResourcePlacement</code> API to orchestrate resources among member clusters.</h2><p>Fleet offers an API, <code>ClusterResourcePlacement</code>, which helps orchestrate workloads, i.e., any group
Kubernetes resources, among all member clusters. In this last part of the tutorial, you will use
this API to place some Kubernetes resources automatically into the member clusters via the hub
cluster, saving the trouble of having to create them one by one in each member cluster.</p><h3 id=create-the-resources-for-placement>Create the resources for placement</h3><p>Run the commands below to create a namespace and a config map, which will be placed onto the
member clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create namespace work
</span></span><span style=display:flex><span>kubectl create configmap app -n work --from-literal<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>test</span>
</span></span></code></pre></div><p>It may take a few seconds for the commands to complete.</p><h3 id=create-the-clusterresourceplacement-api-object>Create the <code>ClusterResourcePlacement</code> API object</h3><p>Next, create a <code>ClusterResourcePlacement</code> API object in the hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl apply -f - <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterResourcePlacement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: crp
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSelectors:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1          
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: work
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  policy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    placementType: PickAll
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>Note that the CRP object features a resource selector, which targets the <code>work</code> namespace you
just created. This will instruct the CRP to place the namespace itself, and all resources
registered under the namespace, such as the config map, to the target clusters. Also, in the <code>policy</code>
field, a <code>PickAll</code> placement type has been specified. This allows the CRP to automatically perform
the placement on all member clusters in the fleet, including those that join after the CRP object
is created.</p><p>It may take a few seconds for Fleet to successfully place the resources. To check up on the
progress, run the commands below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement crp
</span></span></code></pre></div><p>Verify that the placement has been completed successfully; you should see that the <code>APPLIED</code> status
field has been set to <code>True</code>. You may need to repeat the commands a few times to wait for
the completion.</p><h3 id=confirm-the-placement>Confirm the placement</h3><p>Now, log into the member clusters to confirm that the placement has been completed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context <span style=color:#000>$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>kubectl get ns
</span></span><span style=display:flex><span>kubectl get configmap -n work
</span></span></code></pre></div><p>You should see the namespace <code>work</code> and the config map <code>app</code> listed in the output.</p><h2 id=clean-things-up>Clean things up</h2><p>To remove all the resources you just created, run the commands below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This would also remove the namespace and config map placed in all member clusters.</span>
</span></span><span style=display:flex><span>kubectl delete crp crp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl delete ns work
</span></span><span style=display:flex><span>kubectl delete configmap app -n work
</span></span></code></pre></div><p>To uninstall Fleet, run the commands below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context <span style=color:#000>$HUB_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>helm uninstall hub-agent
</span></span><span style=display:flex><span>kubectl config use-context <span style=color:#000>$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>helm uninstall member-agent
</span></span></code></pre></div><h2 id=whats-next>What&rsquo;s next</h2><p>Congratulations! You have completed the getting started tutorial for Fleet. To learn more about
Fleet:</p><ul><li><a href=/website/docs/concepts/>Read about Fleet concepts</a></li><li><a href=/website/docs/how-tos/crp/>Read about the ClusterResourcePlacement API</a></li><li><a href=/website/docs/api-reference/>Read the Fleet API reference</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-7d7f0216d2307a9e20af121afa63dd3e>2.2 - Getting started with Fleet using on-premises clusters</h1><div class=lead>Use on-premises clusters of your own to learn about Fleet</div><p>In this tutorial, you will try Fleet out using a few of your own Kubernetes clusters; Fleet can
help you manage workloads seamlessly across these clusters, greatly simplifying the experience
of day-to-day Kubernetes management.</p><blockquote><p>Note</p><p>This tutorial assumes that you have some experience of performing administrative tasks for
Kubernetes clusters. If you are just gettings started with Kubernetes, or do not have much
experience of setting up a Kubernetes cluster, it is recommended that you follow the
<a href=/website/docs/getting-started/kind/>Getting started with Fleet using Kind clusters</a> tutorial instead.</p></blockquote><h2 id=before-you-begin>Before you begin</h2><p>To complete this tutorial, you will need:</p><ul><li>At least two Kubernetes clusters of your own.<ul><li>Note that one of these clusters will serve as your hub cluster; other clusters must be able
to reach it via the network.</li></ul></li><li>The following tools on your local machine:<ul><li><code>kubectl</code>, the Kubernetes CLI tool.</li><li><code>git</code></li><li><code>curl</code></li><li><code>helm</code>, the Kubernetes package manager</li><li><code>jq</code></li><li><code>base64</code></li></ul></li></ul><h2 id=set-up-a-fleet-hub-cluster>Set up a Fleet hub cluster</h2><p>The Fleet open-source project manages a multi-cluster environment using a hub-spoke pattern,
which consists of one hub cluster and one or more member clusters:</p><ul><li>The hub cluster is the portal to which every member cluster connects; it also serves as an
interface for centralized management, through which you can perform a number of tasks,
primarily orchestrating workloads across different clusters.</li><li>A member cluster connects to the hub cluster and runs your workloads as orchestrated by the
hub cluster.</li></ul><p>Any Kubernetes cluster running a supported version of Kubernetes can serve as the hub cluster;
it is recommended that you reserve a cluster
specifically for this responsibility, and do not run other workloads on it. For the best
experience, consider disabling the built-in <code>kube-controller-manager</code> controllers for the
cluster: you could achieve this by setting the <code>--controllers</code> CLI argument; for more information,
see the <a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-controller-manager/><code>kube-controller-manager</code> documentation</a>.</p><p>To set up the hub cluster, run the commands below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace YOUR-HUB-CLUSTER-CONTEXT with the name of the kubeconfig context for your hub cluster.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_CLUSTER_CONTEXT</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-HUB-CLUSTER-CONTEXT
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl config use-context <span style=color:#000>$HUB_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The variables below uses the Fleet images kept in the Microsoft Container Registry (MCR),</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># and will retrieve the latest version from the Fleet GitHub repository.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># You can, however, build the Fleet images of your own; see the repository README for</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># more information.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>REGISTRY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;mcr.microsoft.com/aks/fleet&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>FLEET_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>curl <span style=color:#4e9a06>&#34;https://api.github.com/repos/Azure/fleet/tags&#34;</span> <span style=color:#000;font-weight:700>|</span> jq -r <span style=color:#4e9a06>&#39;.[0].name&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_AGENT_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hub-agent&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Clone the Fleet repository from GitHub.</span>
</span></span><span style=display:flex><span>git clone https://github.com/Azure/fleet.git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Install the helm chart for running Fleet agents on the hub cluster.</span>
</span></span><span style=display:flex><span>helm install hub-agent fleet/charts/hub-agent/ <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set image.pullPolicy<span style=color:#ce5c00;font-weight:700>=</span>Always <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set image.repository<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$REGISTRY</span>/<span style=color:#000>$HUB_AGENT_IMAGE</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set image.tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$FLEET_VERSION</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>logVerbosity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>namespace</span><span style=color:#ce5c00;font-weight:700>=</span>fleet-system <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>enableWebhook</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>webhookClientConnectionType</span><span style=color:#ce5c00;font-weight:700>=</span>service <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>enableV1Alpha1APIs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>enableV1Beta1APIs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><p>It may take a few seconds for the installation to complete. Once it finishes, verify that
the Fleet hub agents are up and running with the commands below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods -n fleet-system
</span></span></code></pre></div><p>You should see that all the pods are in the ready state.</p><h2 id=connect-a-member-cluster-to-the-hub-cluster>Connect a member cluster to the hub cluster</h2><p>Next, you will set up a cluster as the member cluster for your fleet. This cluster should
run a supported version of Kubernetes and be able to connect to the hub cluster via the network.</p><p>For your convenience, Fleet provides a script that can automate the process of joining a cluster
into a fleet. To use the script, follow the steps below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of HUB_CLUSTER_ADDRESS with the address of your hub cluster API server.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_CLUSTER_ADDRESS</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-HUB-CLUSTER-ADDRESS
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of MEMBER_CLUSTER with the name you would like to assign to the new member</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># cluster.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Note that Fleet will recognize your cluster with this name once it joins.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-MEMBER-CLUSTER
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of MEMBER_CLUSTER_CONTEXT with the name of the kubeconfig context you use</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># for accessing your member cluster.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER_CONTEXT</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-MEMBER-CLUSTER-CONTEXT
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run the script.</span>
</span></span><span style=display:flex><span>chmod +x fleet/hack/membership/join.sh
</span></span><span style=display:flex><span>./fleet/hack/membership/join.sh
</span></span></code></pre></div><p>It may take a few minutes for the script to finish running. Once it is completed, verify
that the cluster has joined successfully with the command below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context <span style=color:#000>$HUB_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>kubectl get membercluster <span style=color:#000>$MEMBER_CLUSTER</span>
</span></span></code></pre></div><p>The newly joined cluster should have the <code>JOINED</code> status field set to <code>True</code>. If you see that
the cluster is still in an unknown state, it might be that the member cluster
is still connecting to the hub cluster. Should this state persist for a prolonged
period, refer to the <a href=/docs/troubleshooting>Troubleshooting Guide</a> for
more information.</p><blockquote><p>Note</p><p>If you would like to know more about the steps the script runs, or would like to join
a cluster into a fleet manually, refer to the <a href=/dpcs/howtos/clusters>Managing Clusters</a> How-To
Guide.</p></blockquote><p>Repeat the steps above to join more clusters into your fleet.</p><h2 id=use-the-clusterresourceplacement-api-to-orchestrate-resources-among-member-clusters>Use the <code>ClusterResourcePlacement</code> API to orchestrate resources among member clusters.</h2><p>Fleet offers an API, <code>ClusterResourcePlacement</code>, which helps orchestrate workloads, i.e., any group
Kubernetes resources, among all member clusters. In this last part of the tutorial, you will use
this API to place some Kubernetes resources automatically into the member clusters via the hub
cluster, saving the trouble of having to create them one by one in each member cluster.</p><h3 id=create-the-resources-for-placement>Create the resources for placement</h3><p>Run the commands below to create a namespace and a config map, which will be placed onto the
member clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create namespace work
</span></span><span style=display:flex><span>kubectl create configmap app -n work --from-literal<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>test</span>
</span></span></code></pre></div><p>It may take a few seconds for the commands to complete.</p><h3 id=create-the-clusterresourceplacement-api-object>Create the <code>ClusterResourcePlacement</code> API object</h3><p>Next, create a <code>ClusterResourcePlacement</code> API object in the hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl apply -f - <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterResourcePlacement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: crp
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSelectors:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1          
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: work
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  policy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    placementType: PickAll
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>Note that the CRP object features a resource selector, which targets the <code>work</code> namespace you
just created. This will instruct the CRP to place the namespace itself, and all resources
registered under the namespace, such as the config map, to the target clusters. Also, in the <code>policy</code>
field, a <code>PickAll</code> placement type has been specified. This allows the CRP to automatically perform
the placement on all member clusters in the fleet, including those that join after the CRP object
is created.</p><p>It may take a few seconds for Fleet to successfully place the resources. To check up on the
progress, run the commands below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement crp
</span></span></code></pre></div><p>Verify that the placement has been completed successfully; you should see that the <code>APPLIED</code> status
field has been set to <code>True</code>. You may need to repeat the commands a few times to wait for
the completion.</p><h3 id=confirm-the-placement>Confirm the placement</h3><p>Now, log into the member clusters to confirm that the placement has been completed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context <span style=color:#000>$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>kubectl get ns
</span></span><span style=display:flex><span>kubectl get configmap -n work
</span></span></code></pre></div><p>You should see the namespace <code>work</code> and the config map <code>app</code> listed in the output.</p><h2 id=clean-things-up>Clean things up</h2><p>To remove all the resources you just created, run the commands below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This would also remove the namespace and config map placed in all member clusters.</span>
</span></span><span style=display:flex><span>kubectl delete crp crp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl delete ns work
</span></span><span style=display:flex><span>kubectl delete configmap app -n work
</span></span></code></pre></div><p>To uninstall Fleet, run the commands below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context <span style=color:#000>$HUB_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>helm uninstall hub-agent
</span></span><span style=display:flex><span>kubectl config use-context <span style=color:#000>$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>helm uninstall member-agent
</span></span></code></pre></div><h2 id=whats-next>What&rsquo;s next</h2><p>Congratulations! You have completed the getting started tutorial for Fleet. To learn more about
Fleet:</p><ul><li><a href=/website/docs/concepts/>Read about Fleet concepts</a></li><li><a href=/website/docs/how-tos/crp/>Read about the ClusterResourcePlacement API</a></li><li><a href=/website/docs/api-reference/>Read the Fleet API reference</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8688845c6027fb5b07b8644ad7348d4a>3 - How-To Guides</h1><div class=lead>Guides for completing common Fleet tasks</div><div class="pageinfo pageinfo-primary"><p>Fleet documentation features a number of how-to guides to help you complete
common Fleet tasks. Pick one below to proceed.</p></div></div><div class=td-content><h1 id=pg-4072dca0095c74b9490cd7c99ea027d9>3.1 - Managing clusters</h1><div class=lead>How to join or remove a cluster from a fleet, and how to view the status of and label a member cluster</div><p>This how-to guide discusses how to manage clusters in a fleet, specifically:</p><ul><li>how to join a cluster into a fleet; and</li><li>how to set a cluster to leave a fleet; and</li><li>how to add labels to a member cluster</li></ul><h2 id=joining-a-cluster-into-a-fleet>Joining a cluster into a fleet</h2><p>A cluster can join in a fleet if:</p><ul><li>it runs a supported Kubernetes version; it is recommended that you use Kubernetes 1.24 or later
versions, and</li><li>it has network connectivity to the hub cluster of the fleet.</li></ul><p>For your convenience, Fleet provides a script that can automate the process of joining a cluster
into a fleet. To use the script, run the commands below:</p><blockquote><p>Note</p><p>To run this script, make sure that you have already installed the following tools in your
system:</p><ul><li><code>kubectl</code>, the Kubernetes CLI</li><li><code>helm</code>, a Kubernetes package manager</li><li><code>curl</code></li><li><code>jq</code></li><li><code>base64</code></li></ul></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of HUB_CLUSTER_CONTEXT with the name of the kubeconfig context you use for</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># accessing your hub cluster.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_CLUSTER_CONTEXT</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-HUB-CLUSTER-CONTEXT
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of HUB_CLUSTER_ADDRESS with the address of your hub cluster API server.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_CLUSTER_ADDRESS</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-HUB-CLUSTER-ADDRESS
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of MEMBER_CLUSTER with the name you would like to assign to the new member</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># cluster.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Note that Fleet will recognize your cluster with this name once it joins.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-MEMBER-CLUSTER
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of MEMBER_CLUSTER_CONTEXT with the name of the kubeconfig context you use</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># for accessing your member cluster.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER_CONTEXT</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-MEMBER-CLUSTER-CONTEXT
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Clone the Fleet GitHub repository.</span>
</span></span><span style=display:flex><span>git clone https://github.com/Azure/fleet.git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run the script.</span>
</span></span><span style=display:flex><span>chmod +x fleet/hack/membership/join.sh
</span></span><span style=display:flex><span>./fleet/hack/membership/join.sh
</span></span></code></pre></div><p>It may take a few minutes for the script to finish running. Once it is completed, verify
that the cluster has joined successfully with the command below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context <span style=color:#000>$HUB_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>kubectl get membercluster <span style=color:#000>$MEMBER_CLUSTER</span>
</span></span></code></pre></div><p>If you see that the cluster is still in an unknown state, it might be that the member cluster
is still connecting to the hub cluster. Should this state persist for a prolonged
period, refer to the <a href=/docs/troubleshooting>Troubleshooting Guide</a> for
more information.</p><p>Alternatively, if you would like to find out the exact steps the script performs, or if you feel
like fine-tuning some of the steps, you may join a cluster manually to your fleet with the
instructions below:</p><details><summary>Joining a member cluster manually</summary><ol><li><p>Make sure that you have installed <code>kubectl</code>, <code>helm</code>, <code>curl</code>, <code>jq</code>, and <code>base64</code> in your
system.</p></li><li><p>Create a Kubernetes service account in your hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of HUB_CLUSTER_CONTEXT with the name of the kubeconfig</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># context you use for accessing your hub cluster.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_CLUSTER_CONTEXT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;YOUR-HUB-CLUSTER-CONTEXT&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of MEMBER_CLUSTER with a name you would like to assign to the new</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># member cluster.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Note that the value of MEMBER_CLUSTER will be used as the name the member cluster registers</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># with the hub cluster.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;YOUR-MEMBER-CLUSTER&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SERVICE_ACCOUNT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#000>$MEMBER_CLUSTER</span><span style=color:#4e9a06>-hub-cluster-access&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl config use-context <span style=color:#000>$HUB_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The service account can, in theory, be created in any namespace; for simplicity reasons,</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># here you will use the namespace reserved by Fleet installation, `fleet-system`.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Note that if you choose a different value, commands in some steps below need to be</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># modified accordingly.</span>
</span></span><span style=display:flex><span>kubectl create serviceaccount <span style=color:#000>$SERVICE_ACCOUNT</span> -n fleet-system
</span></span></code></pre></div></li><li><p>Create a Kubernetes secret of the service account token type, which the member cluster will
use to access the hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SERVICE_ACCOUNT_SECRET</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#000>$MEMBER_CLUSTER</span><span style=color:#4e9a06>-hub-cluster-access-token&#34;</span>
</span></span><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Secret
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    name: $SERVICE_ACCOUNT_SECRET
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    namespace: fleet-system
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    annotations:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        kubernetes.io/service-account.name: $SERVICE_ACCOUNT
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>type: kubernetes.io/service-account-token
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>After the secret is created successfully, extract the token from the secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>TOKEN</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get secret <span style=color:#000>$SERVICE_ACCOUNT_SECRET</span> -n fleet-system -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.data.token}&#39;</span> <span style=color:#000;font-weight:700>|</span> base64 -d<span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><blockquote><p>Note</p><p>Keep the token in a secure place; anyone with access to this token can access the hub cluster
in the same way as the Fleet member cluster does.</p></blockquote><p>You may have noticed that at this moment, no access control has been set on the service
account; Fleet will set things up when the member cluster joins. The service account will be
given the minimally viable set of permissions for the Fleet member cluster to connect to the
hub cluster; its access will be restricted to one namespace, specifically reserved for the
member cluster, as per security best practices.</p></li><li><p>Register the member cluster with the hub cluster; Fleet manages cluster membership using the
<code>MemberCluster</code> API:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: cluster.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: MemberCluster
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    name: $MEMBER_CLUSTER
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    identity:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        name: $SERVICE_ACCOUNT
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        namespace: fleet-system
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        apiGroup: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    heartbeatPeriodSeconds: 60
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></li><li><p>Set up the member agent, the Fleet component that works on the member cluster end, to enable
Fleet connection:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Clone the Fleet repository from GitHub.</span>
</span></span><span style=display:flex><span>git clone https://github.com/Azure/fleet.git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Install the member agent helm chart on the member cluster.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of MEMBER_CLUSTER_CONTEXT with the name of the kubeconfig context you use</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># for member cluster access.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER_CONTEXT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;YOUR-MEMBER-CLUSTER-CONTEXT&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of HUB_CLUSTER_ADDRESS with the address of the hub cluster API server.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>HUB_CLUSTER_ADDRESS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;YOUR-HUB-CLUSTER-ADDRESS&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The variables below uses the Fleet images kept in the Microsoft Container Registry (MCR),</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># and will retrieve the latest version from the Fleet GitHub repository.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># You can, however, build the Fleet images of your own; see the repository README for</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># more information.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>REGISTRY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;mcr.microsoft.com/aks/fleet&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>FLEET_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>curl <span style=color:#4e9a06>&#34;https://api.github.com/repos/Azure/fleet/tags&#34;</span> <span style=color:#000;font-weight:700>|</span> jq -r <span style=color:#4e9a06>&#39;.[0].name&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_AGENT_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;member-agent&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>REFRESH_TOKEN_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;refresh-token&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl config use-context <span style=color:#000>$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create the secret with the token extracted previously for member agent to use.</span>
</span></span><span style=display:flex><span>kubectl create secret generic hub-kubeconfig-secret --from-literal<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>token</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$TOKEN</span>
</span></span><span style=display:flex><span>helm install member-agent fleet/charts/member-agent/ <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set config.hubURL<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$HUB_CLUSTER_ADDRESS</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set image.repository<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$REGISTRY</span>/<span style=color:#000>$MEMBER_AGENT_IMAGE</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set image.tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$FLEET_VERSION</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set refreshtoken.repository<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$REGISTRY</span>/<span style=color:#000>$REFRESH_TOKEN_IMAGE</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set refreshtoken.tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$FLEET_VERSION</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set image.pullPolicy<span style=color:#ce5c00;font-weight:700>=</span>Always <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set refreshtoken.pullPolicy<span style=color:#ce5c00;font-weight:700>=</span>Always <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set config.memberClusterName<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#000>$MEMBER_CLUSTER</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>logVerbosity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>namespace</span><span style=color:#ce5c00;font-weight:700>=</span>fleet-system <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>enableV1Alpha1APIs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --set <span style=color:#000>enableV1Beta1APIs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div></li><li><p>Verify that the installation of the member agent is successful:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods -n fleet-system
</span></span></code></pre></div><p>You should see that all the returned pods are up and running. Note that it may take a few
minutes for the member agent to get ready.</p></li><li><p>Verify that the member cluster has joined the fleet successfully:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context <span style=color:#000>$HUB_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>kubectl get membercluster <span style=color:#000>$MEMBER_CLUSTER</span>
</span></span></code></pre></div></li></ol></details><h2 id=setting-a-cluster-to-leave-a-fleet>Setting a cluster to leave a fleet</h2><p>Fleet uses the <code>MemberCluster</code> API to manage cluster memberships. To remove a member cluster
from a fleet, simply delete its corresponding <code>MemberCluster</code> object from your hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of MEMBER-CLUSTER with the name of the member cluster you would like to</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># remove from a fleet.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-MEMBER-CLUSTER
</span></span><span style=display:flex><span>kubectl delete membercluster <span style=color:#000>$MEMBER_CLUSTER</span>
</span></span></code></pre></div><p>It may take a while before the member cluster leaves the fleet successfully. Fleet will perform
some cleanup; all the resources placed onto the cluster will be removed.</p><p>After the member cluster leaves, you can remove the member agent installation from it using Helm:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of MEMBER_CLUSTER_CONTEXT with the name of the kubeconfig context you use</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># for member cluster access.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER_CONTEXT</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-MEMBER-CLUSTER-CONTEXT
</span></span><span style=display:flex><span>kubectl config use-context <span style=color:#000>$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style=display:flex><span>helm uninstall member-agent
</span></span></code></pre></div><p>It may take a few moments before the uninstallation completes.</p><h2 id=viewing-the-status-of-a-member-cluster>Viewing the status of a member cluster</h2><p>Similarly, you can use the <code>MemberCluster</code> API in the hub cluster to view the status of a
member cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the value of MEMBER-CLUSTER with the name of the member cluster of which you would like</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># to view the status.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-MEMBER-CLUSTER
</span></span><span style=display:flex><span>kubectl get membercluster <span style=color:#000>$MEMBER_CLUSTER</span> -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;{.status}&#34;</span>
</span></span></code></pre></div><p>The status consists of:</p><ul><li><p>an array of conditions, including:</p><ul><li>the <code>ReadyToJoin</code> condition, which signals whether the hub cluster is ready to accept
the member cluster; and</li><li>the <code>Joined</code> condition, which signals whether the cluster has joined the fleet; and</li><li>the <code>Healthy</code> condition, which signals whether the cluster is in a healthy state.</li></ul><p>Typically, a member cluster should have all three conditions set to true. Refer to the
<a href=/docs/troubleshooting>Troubleshooting Guide</a> for help if a cluster fails to join
into a fleet.</p></li><li><p>the resource usage of the cluster; at this moment Fleet reports the capacity and
the allocatable amount of each resource in the cluster, summed up from all nodes in the cluster.</p></li><li><p>an array of agent status, which reports the status of specific Fleet agents installed in
the cluster; each entry features:</p><ul><li>an array of conditions, in which <code>Joined</code> signals whether the specific agent has been
successfully installed in the cluster, and <code>Healthy</code> signals whether the agent is in a
healthy state; and</li><li>the timestamp of the last received heartbeat from the agent.</li></ul></li></ul><h2 id=adding-labels-to-a-member-cluster>Adding labels to a member cluster</h2><p>You can add labels to a <code>MemberCluster</code> object in the same as with any other Kubernetes object.
These labels can then be used for targeting specific clusters in resource placement. To add a label,
run the command below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace the values of MEMBER_CLUSTER, LABEL_KEY, and LABEL_VALUE with those of your own.</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MEMBER_CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-MEMBER-CLUSTER
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>LABEL_KEY</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-LABEL-KEY
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>LABEL_VALUE</span><span style=color:#ce5c00;font-weight:700>=</span>YOUR-LABEL-VALUE
</span></span><span style=display:flex><span>kubectl label membercluster <span style=color:#000>$MEMBER_CLUSTER</span> <span style=color:#000>$LABEL_KEY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$LABEL_VALUE</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7461dbc76e53ff75d54dd11074048123>3.2 - Using the ClusterResourcePlacement API</h1><div class=lead>How to use the <code>ClusterResourcePlacement</code> API</div><p>This guide provides an overview of how to use the Fleet <code>ClusterResourcePlacement</code> (CRP) API to orchestrate workload distribution across your fleet.</p><h2 id=overview>Overview</h2><p>The CRP API is a core Fleet API that facilitates the distribution of specific resources from the hub cluster to
member clusters within a fleet. This API offers scheduling capabilities that allow you to target the most suitable
group of clusters for a set of resources using a complex rule set. For example, you can distribute resources to
clusters in specific regions (North America, East Asia, Europe, etc.) and/or release stages (production, canary, etc.).
You can even distribute resources according to certain topology spread constraints.</p><h2 id=api-components>API Components</h2><p>The CRP API generally consists of the following components:</p><ul><li><strong>Resource Selectors</strong>: These specify the set of resources selected for placement.</li><li><strong>Scheduling Policy</strong>: This determines the set of clusters where the resources will be placed.</li><li><strong>Rollout Strategy</strong>: This controls the behavior of resource placement when the resources themselves and/or the
scheduling policy are updated, minimizing interruptions caused by refreshes.</li></ul><p>The following sections discuss these components in depth.</p><h2 id=resource-selectors>Resource selectors</h2><p>A <code>ClusterResourcePlacement</code> object may feature one or more resource selectors,
specifying which resources to select for placement. To add a resource selector, edit
the <code>resourceSelectors</code> field in the <code>ClusterResourcePlacement</code> spec:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;rbac.authorization.k8s.io&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1          </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secretReader</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The example above will pick a <code>ClusterRole</code> named <code>secretReader</code> for resource placement.</p><p>It is important to note that, as its name implies, <code>ClusterResourcePlacement</code> <strong>selects only
cluster-scoped resources</strong>. However, if you select a namespace, all the resources under the
namespace will also be placed.</p><h3 id=different-types-of-resource-selectors>Different types of resource selectors</h3><p>You can specify a resource selector in many different ways:</p><ul><li><p>To select <strong>one specific resource</strong>, such as a namespace, specify its API GVK (group, version, and
kind), and its name, in the resource selector:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># As mentioned earlier, all the resources under the namespace will also be selected.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1          </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>Alternately, you may also select a set of resources of the same API GVK using a label selector;
it also requires that you specify the API GVK and the filtering label(s):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># As mentioned earlier, all the resources under the namespaces will also be selected.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1          </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>critical</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In the example above, all the namespaces in the hub cluster with the label <code>system=critical</code>
will be selected (along with the resources under them).</p><p>Fleet uses standard Kubernetes label selectors; for its specification and usage, see the
<a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#labelselector-v1-meta>Kubernetes API reference</a>.</p></li><li><p>Very occasionally, you may need to select all the resources under a specific GVK; to achieve
this, use a resource selector with only the API GVK added:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;rbac.authorization.k8s.io&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1          </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In the example above, all the cluster roles in the hub cluster will be picked.</p></li></ul><h3 id=multiple-resource-selectors>Multiple resource selectors</h3><p>You may specify up to 100 different resource selectors; Fleet will pick a resource if it matches
any of the resource selectors specified (i.e., all selectors are OR&rsquo;d).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># As mentioned earlier, all the resources under the namespace will also be selected.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1          </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;rbac.authorization.k8s.io&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterRole</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secretReader      </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In the example above, Fleet will pick the namespace <code>work</code> (along with all the resources
under it) and the cluster role <code>secretReader</code>.</p><blockquote><p>Note</p><p>You can find the GVKs of built-in Kubernetes API objects in the
<a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/>Kubernetes API reference</a>.</p></blockquote><h2 id=scheduling-policy>Scheduling policy</h2><p>Each scheduling policy is associated with a placement type, which determines how Fleet will
pick clusters. The <code>ClusterResourcePlacement</code> API supports the following placement types:</p><table><thead><tr><th>Placement type</th><th>Description</th></tr></thead><tbody><tr><td><code>PickFixed</code></td><td>Pick a specific set of clusters by their names.</td></tr><tr><td><code>PickAll</code></td><td>Pick all the clusters in the fleet, per some standard.</td></tr><tr><td><code>PickN</code></td><td>Pick a count of N clusters in the fleet, per some standard.</td></tr></tbody></table><blockquote><p>Note</p><p>Scheduling policy itself is optional. If you do not specify a scheduling policy,
Fleet will assume that you would like to use
a scheduling of the <code>PickAll</code> placement type; it effectively sets Fleet to pick
all the clusters in the fleet.</p></blockquote><p>Fleet does not support switching between different placement types; if you need to do
so, re-create a new <code>ClusterResourcePlacement</code> object.</p><h3 id=pickfixed-placement-type><code>PickFixed</code> placement type</h3><p><code>PickFixed</code> is the most straightforward placement type, through which you directly tell Fleet
which clusters to place resources at. To use this placement type, specify the target cluster
names in the <code>clusterNames</code> field, such as</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickFixed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusterNames</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>bravelion</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>smartfish </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The example above will place resources to two clusters, <code>bravelion</code> and <code>smartfish</code>.</p><h3 id=pickall-placement-type><code>PickAll</code> placement type</h3><p><code>PickAll</code> placement type allows you to pick all clusters in the fleet per some standard. With
this placement type, you may use affinity terms to fine-tune which clusters you would like
for Fleet to pick:</p><ul><li><p>An affinity term specifies a requirement that a cluster needs to meet, usually the presence
of a label.</p><p>There are two types of affinity terms:</p><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code> terms are requirements that a cluster
must meet before it can be picked; and</li><li><code>preferredDuringSchedulingIgnoredDuringExecution</code> terms are requirements that, if a
cluster meets, will set Fleet to prioritize it in scheduling.</li></ul><p>In the scheduling policy of the <code>PickAll</code> placement type, you may only use the
<code>requiredDuringSchedulingIgnoredDuringExecution</code> terms.</p></li></ul><blockquote><p>Note</p><p>You can learn more about affinities in <a href=/website/docs/how-tos/affinities/>Using Affinities to Pick Clusters</a> How-To
Guide.</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                            </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>critical</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> object above will pick all the clusters with the label
<code>system:critical</code> on them; clusters without the label will be ignored.</p><p>Fleet is forward-looking with the <code>PickAll</code> placement type: any cluster that satisfies the
affinity terms of a <code>ClusterResourcePlacement</code> object, even if it joins after the
<code>ClsuterResourcePlacement</code> object is created, will be picked.</p><blockquote><p>Note</p><p>You may specify a scheduling policy of the <code>PickAll</code> placement with no affinity; this will set
Fleet to select all clusters currently present in the fleet.</p></blockquote><h3 id=pickn-placement-type><code>PickN</code> placement type</h3><p><code>PickN</code> placement type allows you to pick a specific number of clusters in the fleet for resource
placement; with this placement type, you may use affinity terms and topology spread constraints
to fine-tune which clusters you would like Fleet to pick.</p><ul><li><p>An affinity term specifies a requirement that a cluster needs to meet, usually the presence
of a label.</p><p>There are two types of affinity terms:</p><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code> terms are requirements that a cluster
must meet before it can be picked; and</li><li><code>preferredDuringSchedulingIgnoredDuringExecution</code> terms are requirements that, if a
cluster meets, will set Fleet to prioritize it in scheduling.</li></ul></li><li><p>A topology spread constraint can help you spread resources evenly across different groups
of clusters. For example, you may want to have a database replica deployed in each region
to enable high-availability.</p></li></ul><blockquote><p>Note</p><p>You can learn more about affinities in <a href=/website/docs/how-tos/affinities/>Using Affinities to Pick Clusters</a>
How-To Guide, and more about topology spread constraints in
<a href=/website/docs/how-tos/topology-spread-constraints/>Using Topology Spread Constraints to Pick Clusters</a> How-To Guide.</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>preferredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>preference</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                            </span><span style=color:#204a87;font-weight:700>critical-level</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> object above will pick first clusters with the <code>critical-level=1</code>
on it; if only there are not enough (less than 3) such clusters, will Fleet pick clusters with no
such label.</p><p>To be more precise, with this placement type, Fleet scores clusters on how well it satisfies the
affinity terms and the topology spread constraints; Fleet will assign:</p><ul><li>an affinity score, for how well the cluster satisfies the affinity terms; and</li><li>a topology spread score, for how well the cluster satisfies the topology spread constraints.</li></ul><blockquote><p>Note</p><p>For more information on the scoring specifics, see
<a href=/website/docs/how-tos/affinities/>Using Affinities to Pick Clusters</a> How-To Guide (for affinity score) and
<a href=/website/docs/how-tos/topology-spread-constraints/>Using Topology Spread Constraints to Pick Clusters</a> How-To
Guide (for topology spread score).</p></blockquote><p>After scoring, Fleet ranks the clusters using the rule below and picks the top N clusters:</p><ul><li><p>the cluster with the highest topology spread score ranks the highest;</p></li><li><p>if there are multiple clusters with the same topology spread score, the one with the highest
affinity score ranks the highest;</p></li><li><p>if there are multiple clusters with same topology spread score and affinity score, sort their
names by alphanumeric order; the one with the most significant name ranks the highest.</p><p>This helps establish deterministic scheduling behavior.</p></li></ul><p>Both affinity terms and topology spread constraints are optional. If you do not specify
affinity terms or topology spread constraints, all clusters will be assigned 0 in
affinity score or topology spread score respectively. When neither is added in the scheduling
policy, Fleet will simply rank clusters by their names, and pick N out of them, with
most significant names in alphanumeric order.</p><h4 id=when-there-are-not-enough-clusters-to-pick>When there are not enough clusters to pick</h4><p>It may happen that Fleet cannot find enough clusters to pick. In this situation, Fleet will
keep looking until all N clusters are found.</p><p>Note that Fleet will stop looking once all N clusters are found, even if there appears a
cluster that scores higher.</p><h4 id=up-scaling-and-downscaling>Up-scaling and downscaling</h4><p>You can edit the <code>numberOfClusters</code> field in the scheduling policy to pick more or less clusters.
When up-scaling, Fleet will score all the clusters that have not been picked earlier, and find
the most appropriate ones; for downscaling, Fleet will unpick the clusters that ranks lower
first.</p><blockquote><p>Note</p><p>For downscaling, the ranking Fleet uses for unpicking clusters is composed when the scheduling
is performed, i.e., it may not reflect the latest setup in the Fleet.</p></blockquote><h3 id=a-few-more-points-about-scheduling-policies>A few more points about scheduling policies</h3><h4 id=responding-to-changes-in-the-fleet>Responding to changes in the fleet</h4><p>Generally speaking, once a cluster is picked by Fleet for a <code>ClusterResourcePlacement</code> object,
it will not be unpicked even if you modify the cluster in a way that renders it unfit for
the scheduling policy, e.g., you have removed a label for the cluster, which is required for
some affinity term. Fleet will also not remove resources from the cluster even if the cluster
becomes unhealthy, e.g., it gets disconnected from the hub cluster. This helps reduce service
interruption.</p><p>However, Fleet will unpick a cluster if it leaves the fleet. If you are using a scheduling
policy of the <code>PickN</code> placement type, Fleet will attempt to find a new cluster as replacement.</p><h4 id=finding-the-scheduling-decisions-fleet-makes>Finding the scheduling decisions Fleet makes</h4><p>You can find out why Fleet picks a cluster in the status of a <code>ClusterResourcePlacement</code> object.
For more information, see the
<a href=crp-status>Understanding the Status of a <code>ClusterResourcePlacement</code></a> How-To Guide.</p><h4 id=available-fields-for-each-placement-type>Available fields for each placement type</h4><p>The table below summarizes the available scheduling policy fields for each placement type:</p><table><thead><tr><th></th><th><code>PickFixed</code></th><th><code>PickAll</code></th><th><code>PickN</code></th></tr></thead><tbody><tr><td><code>placementType</code></td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td><code>numberOfClusters</code></td><td>❌</td><td>❌</td><td>✅</td></tr><tr><td><code>clusterNames</code></td><td>✅</td><td>❌</td><td>❌</td></tr><tr><td><code>affinity</code></td><td>❌</td><td>✅</td><td>✅</td></tr><tr><td><code>topologySpreadConstraints</code></td><td>❌</td><td>❌</td><td>✅</td></tr></tbody></table><h2 id=rollout-strategy>Rollout strategy</h2><p>After a <code>ClusterResourcePlacement</code> is created, you may want to</p><ul><li>Add, update, or remove the resources that have been selected by the
<code>ClusterResourcePlacement</code> in the hub cluster</li><li>Update the resource selectors in the <code>ClusterResourcePlacement</code></li><li>Update the scheduling policy in the <code>ClusterResourcePlacement</code></li></ul><p>These changes may trigger the following outcomes:</p><ul><li>New resources may need to be placed on all picked clusters</li><li>Resources already placed on a picked cluster may get updated or deleted</li><li>Some clusters picked previously are now unpicked, and resources must be removed from such clusters</li><li>Some clusters are newly picked, and resources must be added to them</li></ul><p>Most outcomes can lead to service interruptions. Apps running on member clusters may temporarily become
unavailable as Fleet dispatches updated resources. Clusters that are no longer selected will lose all placed resources,
resulting in lost traffic. If too many new clusters are selected and Fleet places resources on them simultaneously,
your backend may become overloaded. The exact interruption pattern may vary depending on the resources you place using Fleet.</p><p>To minimize interruption, Fleet allows users to configure the rollout strategy, similar to native Kubernetes deployment,
to transition between changes as smoothly as possible. Currently, Fleet supports only one rollout strategy: rolling update.
This strategy ensures changes, including the addition or removal of selected clusters and resource refreshes,
are applied incrementally in a phased manner at a pace suitable for you. This is the default option and applies to all changes you initiate.</p><p>This rollout strategy can be configured with the following parameters:</p><ul><li><p><code>maxUnavailable</code> determines how many clusters may become unavailable during a change for the selected set of resources.
It can be set as an absolute number or a percentage. The default is 25%, and zero should not be used for this value.</p><ul><li><p>Setting this parameter to a lower value will result in less interruption during a change but will lead to slower rollouts.</p></li><li><p>Fleet considers a cluster as unavailable if resources have not been successfully applied to the cluster.</p></li><li><details><summary>How Fleet interprets this value</summary>Fleet, in actuality, makes sure that at any time, there are **at least** N - `maxUnavailable`
number of clusters available, where N is:<ul><li>for scheduling policies of the <code>PickN</code> placement type, the <code>numberOfClusters</code> value given;</li><li>for scheduling policies of the <code>PickFixed</code> placement type, the number of cluster names given;</li><li>for scheduling policies of the <code>PickAll</code> placement type, the number of clusters Fleet picks.</li></ul><p>If you use a percentage for the <code>maxUnavailable</code> parameter, it is calculated against N as
well.</p></details></li></ul></li><li><p><code>maxSurge</code> determines the number of additional clusters, beyond the required number, that will receive resource placements.
It can also be set as an absolute number or a percentage. The default is 25%, and zero should not be used for this value.</p><ul><li><p>Setting this parameter to a lower value will result in fewer resource placements on additional
clusters by Fleet, which may slow down the rollout process.</p></li><li><details><summary>How Fleet interprets this value</summary>Fleet, in actuality, makes sure that at any time, there are **at most** N + `maxSurge`
number of clusters available, where N is:<ul><li>for scheduling policies of the <code>PickN</code> placement type, the <code>numberOfClusters</code> value given;</li><li>for scheduling policies of the <code>PickFixed</code> placement type, the number of cluster names given;</li><li>for scheduling policies of the <code>PickAll</code> placement type, the number of clusters Fleet picks.</li></ul><p>If you use a percentage for the <code>maxUnavailable</code> parameter, it is calculated against N as well.</p></details></li></ul></li><li><p><code>unavailablePeriodSeconds</code> allows users to inform the fleet when the resources are deemed &ldquo;ready&rdquo;.
The default value is 60 seconds.</p><ul><li>Fleet only considers newly applied resources on a cluster as &ldquo;ready&rdquo; once <code>unavailablePeriodSeconds</code> seconds
have passed <strong>after</strong> the resources have been <strong>successfully</strong> applied to that cluster.</li><li>Setting a lower value for this parameter will result in faster rollouts. However, we <strong>strongly</strong>
recommend that users set it to a value that all the initialization/preparation tasks can be completed within
that time frame. This ensures that the resources are typically ready after the <code>unavailablePeriodSeconds</code> have passed.</li><li>We are currently designing a generic &ldquo;ready gate&rdquo; for resources being applied to clusters. Please feel free to raise
issues or provide feedback if you have any thoughts on this.</li></ul></li></ul><blockquote><p>Note</p><p>Fleet will round numbers up if you use a percentage for <code>maxUnavailable</code> and/or <code>maxSurge</code>.</p></blockquote><p>For example, if you have a <code>ClusterResourcePlacement</code> with a scheduling policy of the <code>PickN</code>
placement type and a target number of clusters of 10, with the default rollout strategy, as
shown in the example below,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RollingUpdate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>rollingUpdate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxUnavailable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxSurge</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>%</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>unavailablePeriodSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>60</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Every time you initiate a change on selected resources, Fleet will:</p><ul><li>Find <code>10 * 25% = 2.5, rounded up to 3</code> clusters, which will receive the resource refresh;</li><li>Wait for 60 seconds (<code>unavailablePeriodSeconds</code>), and repeat the process;</li><li>Stop when all the clusters have received the latest version of resources.</li></ul><p>The exact period of time it takes for Fleet to complete a rollout depends not only on the
<code>unavailablePeriodSeconds</code>, but also the actual condition of a resource placement; that is,
if it takes longer for a cluster to get the resources applied successfully, Fleet will wait
longer to complete the rollout, in accordance with the rolling update strategy you specified.</p><blockquote><p>Note</p><p>In very extreme circumstances, rollout may get stuck, if Fleet just cannot apply resources
to some clusters. You can identify this behavior if CRP status; for more information, see
<a href=crp-status>Understanding the Status of a <code>ClusterResourcePlacement</code></a> How-To Guide.</p></blockquote><h2 id=snapshots-and-revisions>Snapshots and revisions</h2><p>Internally, Fleet keeps a history of all the scheduling policies you have used with a
<code>ClusterResourcePlacement</code>, and all the resource versions (snapshots) the
<code>ClusterResourcePlacement</code> has selected. These are kept as <code>ClusterSchedulingPolicySnapshot</code>
and <code>ClusterResourceSnapshot</code> objects respectively.</p><p>You can list and view such objects for reference, but you should not modify their contents
(in a typical setup, such requests will be rejected automatically). To control the length
of the history (i.e., how many snapshot objects Fleet will keep for a <code>ClusterResourcePlacement</code>),
configure the <code>revisionHistoryLimit</code> field:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>revisionHistoryLimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The default value is 10.</p><blockquote><p>Note</p><p>In this early stage, the history is kept for reference purposes only; in the future, Fleet
may add features to allow rolling back to a specific scheduling policy and/or resource version.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-dae736fee36bb429124e070c298551ea>3.3 - Using Affinity to Pick Clusters</h1><div class=lead>How to use affinity settings in the <code>ClusterResourcePlacement</code> API to fine-tune Fleet scheduling decisions</div><p>This how-to guide discusses how to use affinity settings to fine-tune how Fleet picks clusters
for resource placement.</p><p>Affinities terms are featured in the <code>ClusterResourcePlacement</code> API, specifically the scheduling
policy section. Each affinity term is a particular requirement that Fleet will check against clusters;
and the fulfillment of this requirement (or the lack of) would have certain effect on whether
Fleet would pick a cluster for resource placement.</p><p>Fleet currently supports two types of affinity terms:</p><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity terms; and</li><li><code>perferredDuringSchedulingIgnoredDuringExecution</code> affinity terms</li></ul><p>Most affinity terms deal with cluster labels. To manage member clusters, specifically
adding/removing labels from a member cluster, see <a href=/website/docs/how-tos/clusters/>Managing Member Clusters</a> How-To
Guide.</p><h2 id=requiredduringschedulingignoredduringexecution-affinity-terms><code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity terms</h2><p>The <code>requiredDuringSchedulingIgnoredDuringExecution</code> type of affinity terms serves as a hard
constraint that <strong>a cluster must satisfy</strong> before it can be picked. Each term may feature:</p><ul><li>a label selector, which specifies a set of labels that a cluster must have or not have before
it can be picked;</li><li>a property selector, which specifies a cluster property requirement that a cluster must satisfy
before it can be picked;</li><li>a combination of both.</li></ul><p>For the specifics about property selectors, see the
<a href=/website/docs/how-tos/property-based-scheduling/>How-To Guide: Using Property-Based Scheduling</a>.</p><h3 id=matchlabels><code>matchLabels</code></h3><p>The most straightforward way is to specify <code>matchLabels</code> in the label selector, as showcased below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                        </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>critical</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The example above includes a <code>requiredDuringSchedulingIgnoredDuringExecution</code> term which requires
that the label <code>system=critical</code> must be present on a cluster before Fleet can pick it for the
<code>ClusterResourcePlacement</code>.</p><p>You can add multiple labels to <code>matchLabels</code>; any cluster that satisfy this affinity term would
have <strong>all</strong> the labels present.</p><h3 id=matchexpressions><code>matchExpressions</code></h3><p>For more complex logic, consider using <code>matchExpressions</code>, which allow you to use operators to
set rules for validating labels on a member cluster. Each <code>matchExpressions</code> requirement
includes:</p><ul><li><p>a key, which is the key of the label; and</p></li><li><p>a list of values, which are the possible values for the label key; and</p></li><li><p>an operator, which represents the relationship between the key and the list of values.</p><p>Supported operators include:</p><ul><li><code>In</code>: the cluster must have a label key with one of the listed values.</li><li><code>NotIn</code>: the cluster must have a label key that is not associated with any of the listed values.</li><li><code>Exists</code>: the cluster must have the label key present; any value is acceptable.</li><li><code>NotExists</code>: the cluster must not have the label key.</li></ul><p>If you plan to use <code>Exists</code> and/or <code>NotExists</code>, you must leave the list of values empty.</p></li></ul><p>Below is an example of <code>matchExpressions</code> affinity term using the <code>In</code> operator:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>In</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span>- <span style=color:#000>critical</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span>- <span style=color:#000>standard</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Any cluster with the label <code>system=critical</code> or <code>system=standard</code> will be picked by Fleet.</p><p>Similarly, you can also specify multiple <code>matchExpressions</code> requirements; any cluster that
satisfy this affinity term would meet all the requirements.</p><h3 id=using-both-matchlabels-and-matchexpressions-in-one-affinity-term>Using both <code>matchLabels</code> and <code>matchExpressions</code> in one affinity term</h3><p>You can specify both <code>matchLabels</code> and <code>matchExpressions</code> in one <code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity term, as showcased below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>east</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>With this affinity term, any cluster picked must:</p><ul><li>have the label <code>region=east</code> present;</li><li>have the label <code>system</code> present, any value would do.</li></ul><h3 id=using-multiple-affinity-terms>Using multiple affinity terms</h3><p>You can also specify multiple <code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity terms,
as showcased below; a cluster will be picked if it can satisfy <strong>any</strong> affinity term.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>west</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DoesNotExist</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>With these two affinity terms, any cluster picked must:</p><ul><li>have the label <code>region=west</code> present; <strong>or</strong></li><li>does not have the label <code>system</code></li></ul><h2 id=preferredduringschedulingignoredduringexecution-affinity-terms><code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity terms</h2><p>The <code>preferredDuringSchedulingIgnoredDuringExecution</code> type of affinity terms serves as a soft
constraint for clusters; any cluster that satisfy such terms would receive an affinity score,
which Fleet uses to rank clusters when processing <code>ClusterResourcePlacement</code> with scheduling
policy of the <code>PickN</code> placement type.</p><p>Each term features:</p><ul><li>a weight, between -100 and 100, which is the affinity score that Fleet would assign to a
cluster if it satisfies this term; and</li><li>a label selector, or a property sorter.</li></ul><p>Both are required for this type of affinity terms to function.</p><p>The label selector is of the same struct as the one used in
<code>requiredDuringSchedulingIgnoredDuringExecution</code> type of affinity terms; see
<a href=/website/docs/how-tos/affinities/#requiredduringschedulingignoredduringexecution-affinity-terms>the documentation above</a> for usage.</p><p>For the specifics about property sorters, see the
<a href=/website/docs/how-tos/property-based-scheduling/>How-To Guide: Using Property-Based Scheduling</a>.</p><p>Below is an example with a <code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity term:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>preferredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>preference</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>west</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Any cluster with the <code>region=west</code> label would receive an affinity score of 20.</p><h3 id=using-multiple-affinity-terms-1>Using multiple affinity terms</h3><p>Similarly, you can use multiple <code>preferredDuringSchedulingIgnoredDuringExection</code> affinity terms,
as showcased below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>preferredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>preference</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                   </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>west</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>-<span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>preference</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Cluster will be validated against each affinity term individually; the affinity scores it
receives will be summed up. For example:</p><ul><li>if a cluster has only the <code>region=west</code> label, it would receive an affinity score of 20; however</li><li>if a cluster has both the <code>region=west</code> and <code>environment=prod</code> labels, it would receive an
affinity score of <code>20 + (-20) = 0</code>.</li></ul><h2 id=use-both-types-of-affinity-terms>Use both types of affinity terms</h2><p>You can, if necessary, add both <code>requiredDuringSchedulingIgnoredDuringExecution</code> and
<code>preferredDuringSchedulingIgnoredDuringExection</code> types of affinity terms. Fleet will
first run all clusters against all the <code>requiredDuringSchedulingIgnoredDuringExecution</code> type
of affinity terms, filter out any that does not meet the requirements, and then
assign the rest with affinity scores per <code>preferredDuringSchedulingIgnoredDuringExection</code> type of
affinity terms.</p><p>Below is an example with both types of affinity terms:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>preferredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>preference</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                   </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>west</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>With these affinity terms, only clusters with the label <code>system</code> (any value would do) can be
picked; and among them, those with the <code>region=west</code> will be prioritized for resource placement
as they receive an affinity score of 20.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ccbad31a9eb5ff37ffc3f405928edd58>3.4 - Using Topology Spread Constraints to Spread Resources</h1><div class=lead>How to use topology spread constraints in the <code>ClusterResourcePlacement</code> API to fine-tune Fleet scheduling decisions</div><p>This how-to guide discusses how to use topology spread constraints to fine-tune how Fleet picks
clusters for resource placement.</p><p>Topology spread constraints are features in the <code>ClusterResourcePlacement</code> API, specifically
the scheduling policy section. Generally speaking, these constraints can help you spread
resources evenly across different groups of clusters in your fleet; or in other words, it
assures that Fleet will not pick too many clusters from one group, and too little from another.
You can use topology spread constraints to, for example:</p><ul><li>achieve high-availability for your database backend by making sure that there is at least
one database replica in each region; or</li><li>verify if your application can support clusters of different configurations; or</li><li>eliminate resource utilization hotspots in your infrastructure through spreading jobs
evenly across sections.</li></ul><h2 id=specifying-a-topology-spread-constraint>Specifying a topology spread constraint</h2><p>A topology spread constraint consists of three fields:</p><ul><li><p><code>topologyKey</code> is a label key which Fleet uses to split your clusters from a fleet into different
groups.</p><p>Specifically, clusters are grouped by the label values they have. For example, if you have
three clusters in a fleet:</p><ul><li>cluster <code>bravelion</code> with the label <code>system=critical</code> and <code>region=east</code>; and</li><li>cluster <code>smartfish</code> with the label <code>system=critical</code> and <code>region=west</code>; and</li><li>cluster <code>jumpingcat</code> with the label <code>system=normal</code> and <code>region=east</code>,</li></ul><p>and you use <code>system</code> as the topology key, the clusters will be split into 2 groups:</p><ul><li>group 1 with cluster <code>bravelion</code> and <code>smartfish</code>, as they both have the value <code>critical</code>
for label <code>system</code>; and</li><li>group 2 with cluster <code>jumpingcat</code>, as it has the value <code>normal</code> for label <code>system</code>.</li></ul><p>Note that the splitting concerns only one label <code>system</code>; other labels,
such as <code>region</code>, do not count.</p><p>If a cluster does not have the given topology key, it <strong>does not</strong> belong to any group.
Fleet may still pick this cluster, as placing resources on it does not violate the
associated topology spread constraint.</p><p>This is a required field.</p></li><li><p><code>maxSkew</code> specifies how <strong>unevenly</strong> resource placements are spread in your fleet.</p><p>The skew of a set of resource placements are defined as the difference in count of
resource placements between the group with the most and the group with
the least, as split by the topology key.</p><p>For example, in the fleet described above (3 clusters, 2 groups):</p><ul><li>if Fleet picks two clusters from group A, but none from group B, the skew would be
<code>2 - 0 = 2</code>; however,</li><li>if Fleet picks one cluster from group A and one from group B, the skew would be
<code>1 - 1 = 0</code>.</li></ul><p>The minimum value of <code>maxSkew</code> is 1. The less you set this value with, the more evenly
resource placements are spread in your fleet.</p><p>This is a required field.</p><blockquote><p>Note</p><p>Naturally, <code>maxSkew</code> only makes sense when there are no less than two groups. If you
set a topology key that will not split the Fleet at all (i.e., all clusters with
the given topology key has exactly the same value), the associated topology spread
constraint will take no effect.</p></blockquote></li><li><p><code>whenUnsatisfiable</code> specifies what Fleet would do when it exhausts all options to satisfy the
topology spread constraint; that is, picking any cluster in the fleet would lead to a violation.</p><p>Two options are available:</p><ul><li><p><code>DoNotSchedule</code>: with this option, Fleet would guarantee that the topology spread constraint
will be enforced all time; scheduling may fail if there is simply no possible way to satisfy
the topology spread constraint.</p></li><li><p><code>ScheduleAnyway</code>: with this option, Fleet would enforce the topology spread constraint
in a best-effort manner; Fleet may, however, pick clusters that would violate the topology
spread constraint if there is no better option.</p></li></ul><p>This is an optional field; if you do not specify a value, Fleet will use <code>DoNotSchedule</code> by
default.</p></li></ul><p>Below is an example of topology spread constraint, which tells Fleet to pick clusters evenly
from different groups, split based on the value of the label <code>system</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>topologySpreadConstraints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>maxSkew</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>topologyKey</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>whenUnsatisfiable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DoNotSchedule</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=how-fleet-enforces-topology-spread-constraints-topology-spread-scores>How Fleet enforces topology spread constraints: topology spread scores</h2><p>When you specify some topology spread constraints in the scheduling policy of
a <code>ClusterResourcePlacement</code> object, Fleet will start picking clusters <strong>one at a time</strong>.
More specifically, Fleet will:</p><ul><li><p>for each cluster in the fleet, evaluate how skew would change if resources were placed on it.</p><p>Depending on the current spread of resource placements, there are three possible outcomes:</p><ul><li>placing resources on the cluster reduces the skew by 1; or</li><li>placing resources on the cluster has no effect on the skew; or</li><li>placing resources on the cluster increases the skew by 1.</li></ul><p>Fleet would then assign a topology spread score to the cluster:</p><ul><li><p>if the provisional placement reduces the skew by 1, the cluster receives a topology spread
score of 1; or</p></li><li><p>if the provisional placement has no effect on the skew, the cluster receives a topology
spread score of 0; or</p></li><li><p>if the provisional placement increases the skew by 1, but does not yet exceed the max skew
specified in the constraint, the cluster receives a topology spread score of -1; or</p></li><li><p>if the provisional placement increases the skew by 1, and has exceeded the max skew specified in the constraint,</p><ul><li>for topology spread constraints with the <code>ScheduleAnyway</code> effect, the cluster receives a topology spread score of -1000; and</li><li>for those with the <code>DoNotSchedule</code> effect, the cluster will be removed from
resource placement consideration.</li></ul></li></ul></li><li><p>rank the clusters based on the topology spread score and other factors (e.g., affinity),
pick the one that is most appropriate.</p></li><li><p>repeat the process, until all the needed count of clusters are found.</p></li></ul><p>Below is an example that illustrates the process:</p><p>Suppose you have a fleet of 4 clusters:</p><ul><li>cluster <code>bravelion</code>, with label <code>region=east</code> and <code>system=critical</code>; and</li><li>cluster <code>smartfish</code>, with label <code>region=east</code>; and</li><li>cluster <code>jumpingcat</code>, with label <code>region=west</code>, and <code>system=critical</code>; and</li><li>cluster <code>flyingpenguin</code>, with label <code>region=west</code>,</li></ul><p>And you have created a <code>ClusterResourcePlacement</code> as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>topologySpreadConstraints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>maxSkew</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>topologyKey</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>region</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>whenUnsatisfiable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DoNotSchedule</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Fleet will first scan all the 4 clusters in the fleet; they all have the <code>region</code> label, with
two different values <code>east</code> and <code>west</code> (2 cluster in each of them). This divides the clusters
into two groups, the <code>east</code> and the <code>west</code></p><p>At this stage, no cluster has been picked yet, so there is no resource placement at all. The
current skew is thus 0, and placing resources on any of them would increase the skew by 1. This
is still below the <code>maxSkew</code> threshold given, so all clusters would receive a topology spread
score of -1.</p><p>Fleet could not find the most appropriate cluster based on the topology spread score so far,
so it would resort to other measures for ranking clusters. This would lead Fleet to pick cluster
<code>smartfish</code>.</p><blockquote><p>Note</p><p>See <a href=/website/docs/how-tos/crp/>Using <code>ClusterResourcePlacement</code> to Place Resources</a> How-To Guide for more
information on how Fleet picks clusters.</p></blockquote><p>Now, one cluster has been picked, and one more is needed by the <code>ClusterResourcePlacement</code>
object (as the <code>numberOfClusters</code> field is set to 2). Fleet scans the left 3 clusters again,
and this time, since <code>smartfish</code> from group <code>east</code> has been picked, any more resource placement
on clusters from group <code>east</code> would increase the skew by 1 more, and would lead to violation
of the topology spread constraint; Fleet will then assign the topology spread score of -1000 to
cluster <code>bravelion</code>, which is in group <code>east</code>. On the contrary, picking a cluster from any
cluster in group <code>west</code> would reduce the skew by 1, so Fleet assigns the topology spread score
of 1 to cluster <code>jumpingcat</code> and <code>flyingpenguin</code>.</p><p>With the higher topology spread score, <code>jumpingcat</code> and <code>flyingpenguin</code> become the leading
candidate in ranking. They have the same topology spread score, and based on the rules Fleet
has for picking clusters, <code>jumpingcat</code> would be picked finally.</p><h2 id=using-multiple-topology-spread-constraints>Using multiple topology spread constraints</h2><p>You can, if necessary, use multiple topology spread constraints. Fleet will evaluate each of them
separately, and add up topology spread scores for each cluster for the final ranking. A cluster
would be removed from resource placement consideration if placing resources on it would violate
any one of the <code>DoNotSchedule</code> topology spread constraints.</p><p>Below is an example where two topology spread constraints are used:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>topologySpreadConstraints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>maxSkew</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>topologyKey</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>region</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>whenUnsatisfiable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DoNotSchedule</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>maxSkew</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>topologyKey</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>environment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>whenUnsatisfiable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ScheduleAnyway</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><blockquote><p>Note</p><p>It might be very difficult to find candidate clusters when multiple topology spread constraints
are added. Considering using the <code>ScheduleAnyway</code> effect to add some leeway to the scheduling,
if applicable.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-8f6885002eeb6f5c362b9414ff970412>3.5 - Using Property-Based Scheduling</h1><div class=lead>How to use property-based scheduling to produce scheduling decisions</div><p>This how-to guide discusses how to use property-based scheduling to produce scheduling decisions
based on cluster properties.</p><blockquote><p>Note</p><p>The availability of properties depend on which (and if) you have a property provider
set up in your Fleet deployment. For more information, see the
<a href=/concepts/properties>Concept: Property Provider and Cluster Properties</a>
documentation.</p><p>It is also recommended that you read the
<a href=/website/docs/how-tos/affinities/>How-To Guide: Using Affinity to Pick Clusters</a> first before following
instructions in this document.</p></blockquote><p>Fleet allows users to pick clusters based on exposed cluster properties via the affinity
terms in the <code>ClusterResourcePlacement</code> API:</p><ul><li>for the <code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity terms, you may specify
property selectors to filter clusters based on their properties;</li><li>for the <code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity terms, you may specify
property sorters to prefer clusters with a property that ranks higher or lower.</li></ul><h1 id=property-selectors-in-requiredduringschedulingignoredduringexecution-affinity-terms>Property selectors in <code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity terms</h1><p>A property selector is an array of expression matchers against cluster properties.
In each matcher you will specify:</p><ul><li><p>A name, which is the name of the property.</p><p>If the property is a non-resource one, you may refer to it directly here; however, if the
property is a resource one, the name here should be of the following format:</p><pre tabindex=0><code>resources.kubernetes-fleet.io/[CAPACITY-TYPE]-[RESOURCE-NAME]
</code></pre><p>where <code>[CAPACITY-TYPE]</code> is one of <code>total</code>, <code>allocatable</code>, or <code>available</code>, depending on
which capacity (usage information) you would like to check against, and <code>[RESOURCE-NAME]</code> is
the name of the resource.</p><p>For example, if you would like to select clusters based on the available CPU capacity of
a cluster, the name used in the property selector should be</p><pre tabindex=0><code>resources.kubernetes-fleet.io/available-cpu
</code></pre><p>and for the allocatable memory capacity, use</p><pre tabindex=0><code>resources.kubernetes-fleet.io/allocatable-memory
</code></pre></li><li><p>A list of values, which are possible values of the property.</p></li><li><p>An operator, which describes the relationship between a cluster&rsquo;s observed value of the given
property and the list of values in the matcher.</p><p>Currently, available operators are</p><ul><li><code>Gt</code> (Greater than): a cluster&rsquo;s observed value of the given property must be greater than
the value in the matcher before it can be picked for resource placement.</li><li><code>Ge</code> (Greater than or equal to): a cluster&rsquo;s observed value of the given property must be
greater than or equal to the value in the matcher before it can be picked for resource placement.</li><li><code>Lt</code> (Less than): a cluster&rsquo;s observed value of the given property must be less than
the value in the matcher before it can be picked for resource placement.</li><li><code>Le</code> (Less than or equal to): a cluster&rsquo;s observed value of the given property must be
less than or equal to the value in the matcher before it can be picked for resource placement.</li><li><code>Eq</code> (Equal to): a cluster&rsquo;s observed value of the given property must be equal to
the value in the matcher before it can be picked for resource placement.</li><li><code>Ne</code> (Not equal to): a cluster&rsquo;s observed value of the given property must be
not equal to the value in the matcher before it can be picked for resource placement.</li></ul><p>Note that if you use the operator <code>Gt</code>, <code>Ge</code>, <code>Lt</code>, <code>Le</code>, <code>Eq</code>, or <code>Ne</code>, the list of values
in the matcher should have exactly one value.</p></li></ul><p>Fleet will evaluate each cluster, specifically their exposed properties, against the matchers;
failure to satisfy <strong>any</strong> matcher in the selector will exclude the cluster from resource
placement.</p><p>Note that if a cluster does not have the specified property for a matcher, it will automatically
fail the matcher.</p><p>Below is an example that uses a property selector to select only clusters with a node count of
at least 5 for resource placement:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>propertySelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;kubernetes-fleet.io/node-count&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Ge</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span>- <span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>You may use both label selector and property selector in a
<code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity term. Both selectors must be satisfied
before a cluster can be picked for resource placement:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>east</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>propertySelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;kubernetes-fleet.io/node-count&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Ge</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                      </span>- <span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In the example above, Fleet will only consider a cluster for resource placement if it has the
<code>region=east</code> label and a node count no less than 5.</p><h1 id=property-sorters-in-preferredduringschedulingignoredduringexecution-affinity-terms>Property sorters in <code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity terms</h1><p>A property sorter ranks all the clusters in the Fleet based on their values of a specified
property in ascending or descending order, then yields weights for the clusters in proportion
to their ranks. The proportional weights are calculated based on the weight value given in the
<code>preferredDuringSchedulingIgnoredDuringExecution</code> term.</p><p>A property sorter consists of:</p><ul><li><p>A name, which is the name of the property; see the format in the previous section for more
information.</p></li><li><p>A sort order, which is one of <code>Ascending</code> and <code>Descending</code>, for ranking in ascending and
descending order respectively.</p><p>As a rule of thumb, when the <code>Ascending</code> order is used, Fleet will prefer clusters with lower
observed values, and when the <code>Descending</code> order is used, clusters with higher observed values
will be preferred.</p></li></ul><p>When using the sort order <code>Descending</code>, the proportional weight is calculated using the formula:</p><pre tabindex=0><code>((Observed Value - Minimum observed value) / (Maximum observed value - Minimum observed value)) * Weight
</code></pre><p>For example, suppose that you would like to rank clusters based on the property of available CPU
capacity in descending order and currently, you have a fleet of 3 clusters with the available CPU
capacities as follows:</p><table><thead><tr><th>Cluster</th><th>Available CPU capacity</th></tr></thead><tbody><tr><td>bravelion</td><td>100</td></tr><tr><td>smartfish</td><td>20</td></tr><tr><td>jumpingcat</td><td>10</td></tr></tbody></table><p>The sorter would yield the weights below:</p><table><thead><tr><th>Cluster</th><th>Available CPU capacity</th><th>Weight</th></tr></thead><tbody><tr><td>bravelion</td><td>100</td><td>(100 - 10) / (100 - 10) = 100% of the weight</td></tr><tr><td>smartfish</td><td>20</td><td>(20 - 10) / (100 - 10) = 11.11% of the weight</td></tr><tr><td>jumpingcat</td><td>10</td><td>(10 - 10) / (100 - 10) = 0% of the weight</td></tr></tbody></table><p>And when using the sort order <code>Ascending</code>, the proportional weight is calculated using the formula:</p><pre tabindex=0><code>(1 - ((Observed Value - Minimum observed value) / (Maximum observed value - Minimum observed value))) * Weight
</code></pre><p>For example, suppose that you would like to rank clusters based on their per CPU core cost
in ascending order and currently across the fleet, you have a fleet of 3 clusters with the
per CPU core costs as follows:</p><table><thead><tr><th>Cluster</th><th>Per CPU core cost</th></tr></thead><tbody><tr><td>bravelion</td><td>1</td></tr><tr><td>smartfish</td><td>0.2</td></tr><tr><td>jumpingcat</td><td>0.1</td></tr></tbody></table><p>The sorter would yield the weights below:</p><table><thead><tr><th>Cluster</th><th>Per CPU core cost</th><th>Weight</th></tr></thead><tbody><tr><td>bravelion</td><td>1</td><td>1 - ((1 - 0.1) / (1 - 0.1)) = 0% of the weight</td></tr><tr><td>smartfish</td><td>0.2</td><td>1 - ((0.2 - 0.1) / (1 - 0.1)) = 88.89% of the weight</td></tr><tr><td>jumpingcat</td><td>0.1</td><td>1 - (0.1 - 0.1) / (1 - 0.1) = 100% of the weight</td></tr></tbody></table><p>The example below showcases a property sorter using the <code>Descending</code> order:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>preferredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>preference</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>metricSorter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubernetes-fleet.io/node-count</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>sortOrder</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Descending</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this example, Fleet will prefer clusters with higher node counts. The cluster with the highest
node count would receive a weight of 20, and the cluster with the lowest would receive 0. Other
clusters receive proportional weights calculated using the formulas above.</p><p>You may use both label selector and property sorter in a
<code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity term. A cluster that fails the label
selector would receive no weight, and clusters that pass the label selector receive proportional
weights under the property sorter.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>preferredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>preference</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>metricSorter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>resources.kubernetes-fleet.io/total-cpu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>sortOrder</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Descending</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In the example above, a cluster would only receive additional weight if it has the label
<code>env=prod</code>, and the more total CPU capacity it has, the more weight it will receive, up to the
limit of 20.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-06445baf57d9bbc7fde02bf249b4a0fa>3.6 - Using Taints and Tolerations</h1><div class=lead>How to use taints and tolerations to fine-tune scheduling decisions</div><p>This how-to guide discusses how to add/remove taints on <code>MemberCluster</code> and how to add tolerations on <code>ClusterResourcePlacement</code>.</p><h2 id=adding-taint-to-membercluster>Adding taint to MemberCluster</h2><p>In this example, we will add a taint to a <code>MemberCluster</code>. Then try to propagate resources to the <code>MemberCluster</code> using a <code>ClusterResourcePlacement</code>
with <strong>PickAll</strong> placement policy. The resources should not be propagated to the <code>MemberCluster</code> because of the taint.</p><p>We will first create a namespace that we will propagate to the member cluster,</p><pre tabindex=0><code>kubectl create ns test-ns
</code></pre><p>Then apply the <code>MemberCluster</code> with a taint,</p><p>Example <code>MemberCluster</code> with taint:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cluster.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MemberCluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>identity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fleet-member-agent-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fleet-system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>taints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-key1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-value1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>effect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSchedule</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>After applying the above <code>MemberCluster</code>, we will apply a <code>ClusterResourcePlacement</code> with the following spec:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1          </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> CR should not propagate the <code>test-ns</code> namespace to the member cluster because of the taint,
looking at the status of the CR should show the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T19:03:17Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>found all the clusters needed as specified by the scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SchedulingPolicyFulfilled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementScheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T19:03:17Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All 0 cluster(s) are synchronized to the latest resources on the hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SynchronizeSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T19:03:17Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>There are no clusters selected to place the resources</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApplySucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>observedResourceIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selectedResources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Looking at the <code>ClusterResourcePlacementSynchronized</code>, <code>ClusterResourcePlacementApplied</code> conditions and reading the message fields
we can see that no clusters were selected to place the resources.</p><h2 id=removing-taint-from-membercluster>Removing taint from MemberCluster</h2><p>In this example, we will remove the taint from the <code>MemberCluster</code> from the last section. This should automatically trigger the Fleet scheduler to propagate the resources to the <code>MemberCluster</code>.</p><p>After removing the taint from the <code>MemberCluster</code>. Let&rsquo;s take a look at the status of the <code>ClusterResourcePlacement</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:00:03Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>found all the clusters needed as specified by the scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SchedulingPolicyFulfilled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementScheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:02:57Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All 1 cluster(s) are synchronized to the latest resources on the hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SynchronizeSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:02:57Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Successfully applied resources to 1 member clusters</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApplySucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>observedResourceIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementStatuses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:02:52Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;Successfully scheduled resources for placement in kind-cluster-1 (affinity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        score: 0, topology spread score: 0): picked by scheduling policy&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ScheduleSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:02:57Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Successfully Synchronized work(s) for placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WorkSynchronizeSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:02:57Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Successfully applied resources</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApplySucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selectedResources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>From the status we can clearly see that the resources were propagated to the member cluster after removing the taint.</p><h2 id=adding-toleration-to-clusterresourceplacement>Adding toleration to ClusterResourcePlacement</h2><p>Adding a toleration to a <code>ClusterResourcePlacement</code> CR allows the Fleet scheduler to tolerate specific taints on the <code>MemberClusters</code>.</p><p>For this section we will start from scratch, we will first create a namespace that we will propagate to the <code>MemberCluster</code></p><pre tabindex=0><code>kubectl create ns test-ns
</code></pre><p>Then apply the <code>MemberCluster</code> with a taint,</p><p>Example <code>MemberCluster</code> with taint:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>heartbeatPeriodSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>60</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>identity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fleet-member-agent-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fleet-system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>taints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>effect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSchedule</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-key1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-value1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> CR will not propagate the <code>test-ns</code> namespace to the member cluster because of the taint.</p><p>Now we will add a toleration to a <code>ClusterResourcePlacement</code> CR as part of the placement policy, which will use the Exists operator to tolerate the taint.</p><p>Example <code>ClusterResourcePlacement</code> spec with tolerations after adding new toleration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>tolerations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-key1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>revisionHistoryLimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RollingUpdate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Let&rsquo;s take a look at the status of the <code>ClusterResourcePlacement</code> CR after adding the toleration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:16:10Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>found all the clusters needed as specified by the scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SchedulingPolicyFulfilled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementScheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:16:15Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All 1 cluster(s) are synchronized to the latest resources on the hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SynchronizeSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:16:15Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Successfully applied resources to 1 member clusters</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApplySucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>observedResourceIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementStatuses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:16:10Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;Successfully scheduled resources for placement in kind-cluster-1 (affinity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        score: 0, topology spread score: 0): picked by scheduling policy&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ScheduleSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:16:15Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Successfully Synchronized work(s) for placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WorkSynchronizeSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:16:15Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Successfully applied resources</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApplySucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selectedResources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>From the status we can see that the resources were propagated to the <code>MemberCluster</code> after adding the toleration.</p><p>Now let&rsquo;s try adding a new taint to the member cluster CR and see if the resources are still propagated to the <code>MemberCluster</code>,</p><p>Example <code>MemberCluster</code> CR with new taint:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>heartbeatPeriodSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>60</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>identity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>apiGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fleet-member-agent-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fleet-system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>taints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>effect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSchedule</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-key1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-value1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>effect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSchedule</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-key2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-value2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Let&rsquo;s take a look at the <code>ClusterResourcePlacement</code> CR status after adding the new taint:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:27:44Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>found all the clusters needed as specified by the scheduling policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SchedulingPolicyFulfilled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementScheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:27:49Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>All 1 cluster(s) are synchronized to the latest resources on the hub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SynchronizeSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:27:49Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Successfully applied resources to 1 member clusters</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApplySucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementApplied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>observedResourceIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementStatuses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:27:44Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;Successfully scheduled resources for placement in kind-cluster-1 (affinity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        score: 0, topology spread score: 0): picked by scheduling policy&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ScheduleSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Scheduled</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:27:49Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Successfully Synchronized work(s) for placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WorkSynchronizeSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WorkSynchronized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2024-04-16T20:27:49Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Successfully applied resources</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApplySucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Applied</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selectedResources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Nothing changes in the status because even if the new taint is not tolerated, the exising resources on the <code>MemberCluster</code>
will continue to run because the taint effect is <code>NoSchedule</code> and the cluster was already selected for resource propagation in a
previous scheduling cycle.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f53861fa149aba83d55219c600a493a6>3.7 - Using the ClusterResourceOverride API</h1><div class=lead>How to use the <code>ClusterResourceOverride</code> API to override cluster-scoped resources</div><p>This guide provides an overview of how to use the Fleet <code>ResourceOverride</code> API to override resources.</p><h2 id=overview>Overview</h2><p><code>ResourceOverride</code> is a Fleet API that allows you to modify or override specific attributes of
existing resources within your cluster. With ResourceOverride, you can define rules based on cluster
labels or other criteria, specifying changes to be applied to resources such as Deployments, StatefulSets, ConfigMaps, or Secrets.
These changes can include updates to container images, environment variables, resource limits, or any other configurable parameters.</p><h2 id=api-components>API Components</h2><p>The ResourceOverride API consists of the following components:</p><ul><li><strong>Placement</strong>: This specifies which placement the override is applied to.</li><li><strong>Resource Selectors</strong>: These specify the set of resources selected for overriding.</li><li><strong>Policy</strong>: This specifies the policy to be applied to the selected resources.</li></ul><p>The following sections discuss these components in depth.</p><h2 id=placement>Placement</h2><p>To configure which placement the override is applied to, you can use the name of <code>ClusterResourcePlacement</code>.</p><h2 id=resource-selectors>Resource Selectors</h2><p>A <code>ResourceOverride</code> object may feature one or more resource selectors, specifying which resources to select to be overridden.</p><p>The <code>ResourceSelector</code> object supports the following fields:</p><ul><li><code>group</code>: The API group of the resource</li><li><code>version</code>: The API version of the resource</li><li><code>kind</code>: The kind of the resource</li><li><code>name</code>: The name of the resource</li></ul><blockquote><p>Note: The resource can only be selected by name.</p></blockquote><p>To add a resource selector, edit the <code>resourceSelectors</code> field in the <code>ResourceOverride</code> spec:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceOverride</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-ro</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><blockquote><p>Note: The ResourceOverride needs to be in the same namespace as the resources it is overriding.</p></blockquote><p>The examples in the tutorial will pick a <code>Deployment</code> named <code>my-deployment</code> from the namespace <code>test-namespace</code>, as shown below, to be overridden.</p><pre tabindex=0><code>apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  name: my-deployment
  namespace: test-namespace
  ...
spec:
  progressDeadlineSeconds: 600
  replicas: 2
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: test-nginx
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: test-nginx
    spec:
      containers:
      - image: nginx:1.14.2
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
        - containerPort: 80
          protocol: TCP
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
status:
  ...
</code></pre><h2 id=policy>Policy</h2><p>The <code>Policy</code> is made up of a set of rules (<code>OverrideRules</code>) that specify the changes to be applied to the selected
resources on selected clusters.</p><p>Each <code>OverrideRule</code> supports the following fields:</p><ul><li><strong>Cluster Selector</strong>: This specifies the set of clusters to which the override applies.</li><li><strong>Override Type</strong>: This specifies the type of override to be applied. The default type is <code>JSONPatch</code>.<ul><li><code>JSONPatch</code>: applies the JSON patch to the selected resources using <a href=https://datatracker.ietf.org/doc/html/rfc6902>RFC 6902</a>.</li><li><code>Delete</code>: deletes the selected resources on the target cluster.</li></ul></li><li><strong>JSON Patch Override</strong>: This specifies the changes to be applied to the selected resources when the override type is <code>JSONPatch</code>.</li></ul><h3 id=cluster-selector>Cluster Selector</h3><p>To specify the clusters to which the override applies, you can use the <code>clusterSelector</code> field in the <code>OverrideRule</code> spec.
The <code>clusterSelector</code> field supports the following fields:</p><ul><li><code>clusterSelectorTerms</code>: A list of terms that are used to select clusters.<ul><li>Each term in the list is used to select clusters based on the label selector.</li></ul></li></ul><h3 id=override-type>Override Type</h3><p>To specify the type of override to be applied, you can use the overrideType field in the OverrideRule spec.
The default value is <code>JSONPatch</code>.</p><ul><li><code>JSONPatch</code>: applies the JSON patch to the selected resources using <a href=https://datatracker.ietf.org/doc/html/rfc6902>RFC 6902</a>.</li><li><code>Delete</code>: deletes the selected resources on the target cluster.</li></ul><h4 id=json-patch-override>JSON Patch Override</h4><p>To specify the changes to be applied to the selected resources, you can use the jsonPatchOverrides field in the OverrideRule spec.
The jsonPatchOverrides field supports the following fields:</p><blockquote><p>JSONPatchOverride applies a JSON patch on the selected resources following <a href=https://datatracker.ietf.org/doc/html/rfc6902>RFC 6902</a>.
All the fields defined follow this RFC.</p></blockquote><p>The <code>jsonPatchOverrides</code> field supports the following fields:</p><ul><li><p><code>op</code>: The operation to be performed. The supported operations are <code>add</code>, <code>remove</code>, and <code>replace</code>.</p><ul><li><code>add</code>: Adds a new value to the specified path.</li><li><code>remove</code>: Removes the value at the specified path.</li><li><code>replace</code>: Replaces the value at the specified path.</li></ul></li><li><p><code>path</code>: The path to the field to be modified.</p><ul><li>Some guidelines for the path are as follows:<ul><li>Must start with a <code>/</code> character.</li><li>Cannot be empty.</li><li>Cannot contain an empty string ("///").</li><li>Cannot be a TypeMeta Field ("/kind", &ldquo;/apiVersion&rdquo;).</li><li>Cannot be a Metadata Field ("/metadata/name", &ldquo;/metadata/namespace&rdquo;), except the fields &ldquo;/metadata/annotations&rdquo; and &ldquo;metadata/labels&rdquo;.</li><li>Cannot be any field in the status of the resource.</li></ul></li><li>Some examples of valid paths are:<ul><li><code>/metadata/labels/new-label</code></li><li><code>/metadata/annotations/new-annotation</code></li><li><code>/spec/template/spec/containers/0/resources/limits/cpu</code></li><li><code>/spec/template/spec/containers/0/resources/requests/memory</code></li></ul></li></ul></li><li><p><code>value</code>: The value to be set.</p><ul><li>If the <code>op</code> is <code>remove</code>, the value cannot be set.</li><li>There is a list of reserved variables that will be replaced by the actual values:<ul><li><code>${MEMBER-CLUSTER-NAME}</code>: this will be replaced by the name of the <code>memberCluster</code> that represents this cluster.</li></ul></li></ul></li></ul><h5 id=example-override-labels>Example: Override Labels</h5><p>To overwrite the existing labels on the <code>Deployment</code> named <code>my-deployment</code> on clusters with the label <code>env: prod</code>,
you can use the following configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceOverride</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-ro</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>overrideRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>jsonPatchOverrides</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>op</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>add</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/metadata/labels</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>{<span style=color:#4e9a06>&#34;cluster-name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;${MEMBER-CLUSTER-NAME}&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><blockquote><p>Note: To add a new label to the existing labels, please use the below configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span>- <span style=color:#204a87;font-weight:700>op</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>add</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/metadata/labels/new-label</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;new-value&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></blockquote><p>The <code>ResourceOverride</code> object above will add a label <code>cluster-name</code> with the value of the <code>memberCluster</code> name to the <code>Deployment</code> named <code>example-ro</code> on clusters with the label <code>env: prod</code>.</p><h5 id=example-override-image>Example: Override Image</h5><p>To override the image of the container in the <code>Deployment</code> named <code>my-deployment</code> on all clusters with the label <code>env: prod</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceOverride</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-ro</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>overrideRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>jsonPatchOverrides</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>op</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>replace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/spec/template/spec/containers/0/image</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;nginx:1.20.0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ResourceOverride</code> object above will replace the image of the container in the <code>Deployment</code> named <code>my-deployment</code>
with the image <code>nginx:1.20.0</code> on all clusters with the label <code>env: prod</code> selected by the clusterResourcePlacement <code>crp-example</code>.</p><blockquote><p>The ResourceOverride mentioned above utilizes the deployment displayed below:</p><pre tabindex=0><code>apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  name: my-deployment
  namespace: test-namespace
  ...
spec:
  ...
  template:
    ...
    spec:
      containers:
      - image: nginx:1.14.2
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
       ...
      ...
  ...
</code></pre></blockquote><h4 id=delete>Delete</h4><p>The <code>Delete</code> override type can be used to delete the selected resources on the target cluster.</p><h5 id=example-delete-selected-resource>Example: Delete Selected Resource</h5><p>To delete the <code>my-deployment</code> on the clusters with the label <code>env: test</code> selected by the clusterResourcePlacement <code>crp-example</code>,
you can use the <code>Delete</code> override type.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceOverride</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-ro</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>overrideRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>overrideType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Delete</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=multiple-override-rules>Multiple Override Rules</h3><p>You may add multiple <code>OverrideRules</code> to a <code>Policy</code> to apply multiple changes to the selected resources.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceOverride</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-ro</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>overrideRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>jsonPatchOverrides</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>op</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>replace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/spec/template/spec/containers/0/image</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;nginx:1.20.0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>jsonPatchOverrides</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>op</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>replace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/spec/template/spec/containers/0/image</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;nginx:latest&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ResourceOverride</code> object above will replace the image of the container in the <code>Deployment</code> named <code>my-deployment</code>
with the image <code>nginx:1.20.0</code> on all clusters with the label <code>env: prod</code> and the image <code>nginx:latest</code> on all clusters with the label <code>env: test</code>.</p><blockquote><p>The ResourceOverride mentioned above utilizes the deployment displayed below:</p><pre tabindex=0><code>apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  name: my-deployment
  namespace: test-namespace
  ...
spec:
  ...
  template:
    ...
    spec:
      containers:
      - image: nginx:1.14.2
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
       ...
      ...
  ...
</code></pre></blockquote><h2 id=applying-the-resourceoverride>Applying the ResourceOverride</h2><p>Create a ClusterResourcePlacement resource to specify the placement rules for distributing the resource overrides across
the cluster infrastructure. Ensure that you select the appropriate namespaces containing the matching resources.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> configuration outlined above will disperse resources within <code>test-namespace</code> across all
clusters labeled with <code>env: prod</code> and <code>env: test</code>. As the changes are implemented, the corresponding <code>ResourceOverride</code>
configurations will be applied to the designated clusters, triggered by the selection of matching deployment resource
<code>my-deployment</code>.</p><h2 id=verifying-the-cluster-resource-is-overridden>Verifying the Cluster Resource is Overridden</h2><p>To ensure that the <code>ResourceOverride</code> object is applied to the selected resources, verify the <code>ClusterResourcePlacement</code>
status by running <code>kubectl describe crp crp-example</code> command:</p><pre tabindex=0><code>Status:
  Conditions:
    ...
    Message:                The selected resources are successfully overridden in the 10 clusters
    Observed Generation:    1
    Reason:                 OverriddenSucceeded
    Status:                 True
    Type:                   ClusterResourcePlacementOverridden
    ...
  Observed Resource Index:  0
  Placement Statuses:
    Applicable Resource Overrides:
      Name:        example-ro-0
      Namespace:   test-namespace
    Cluster Name:  member-50
    Conditions:
      ...
      Last Transition Time:  2024-04-26T22:57:14Z
      Message:               Successfully applied the override rules on the resources
      Observed Generation:   1
      Reason:                OverriddenSucceeded
      Status:                True
      Type:                  Overridden
     ...
</code></pre><p>Each cluster maintains its own <code>Applicable Resource Overrides</code> which contain the resource override snapshot and
the resource override namespace if relevant. Additionally, individual status messages for each cluster indicates
whether the override rules have been effectively applied.</p><p>The <code>ClusterResourcePlacementOverridden</code> condition indicates whether the resource override has been successfully applied
to the selected resources in the selected clusters.</p><p>To verify that the <code>ResourceOverride</code> object has been successfully applied to the selected resources,
check resources in the selected clusters:</p><ol><li>Get cluster credentials:
<code>az aks get-credentials --resource-group &lt;resource-group> --name &lt;cluster-name></code></li><li>Get the <code>Deployment</code> object in the selected cluster:
<code>kubectl --context=&lt;member-cluster-context> get deployment my-deployment -n test-namespace -o yaml</code></li></ol><p>Upon inspecting the member cluster, it was found that the selected cluster had the label env: prod.
Consequently, the image on deployment <code>my-deployment</code> was modified to be <code>nginx:1.20.0</code> on selected cluster.</p><pre tabindex=0><code>apiVersion: apps/v1
 kind: Deployment
 metadata:
   ...
   name: my-deployment
   namespace: test-namespace
   ...
 spec:
   ...
   template:
     ...
     spec:
       containers:
       - image: nginx:1.20.0
         imagePullPolicy: IfNotPresent
         name: nginx
         ports:
        ...
       ...
 status:
     ...
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-4f07136e38cf9fb330102a16c2742234>3.8 - Using the ResourceOverride API</h1><div class=lead>How to use the <code>ResourceOverride</code> API to override namespace-scoped resources</div><p>This guide provides an overview of how to use the Fleet <code>ResourceOverride</code> API to override resources.</p><h2 id=overview>Overview</h2><p><code>ResourceOverride</code> is a Fleet API that allows you to modify or override specific attributes of
existing resources within your cluster. With ResourceOverride, you can define rules based on cluster
labels or other criteria, specifying changes to be applied to resources such as Deployments, StatefulSets, ConfigMaps, or Secrets.
These changes can include updates to container images, environment variables, resource limits, or any other configurable parameters.</p><h2 id=api-components>API Components</h2><p>The ResourceOverride API consists of the following components:</p><ul><li><strong>Resource Selectors</strong>: These specify the set of resources selected for overriding.</li><li><strong>Policy</strong>: This specifies the policy to be applied to the selected resources.</li></ul><p>The following sections discuss these components in depth.</p><h2 id=resource-selectors>Resource Selectors</h2><p>A <code>ResourceOverride</code> object may feature one or more resource selectors, specifying which resources to select to be overridden.</p><p>The <code>ResourceSelector</code> object supports the following fields:</p><ul><li><code>group</code>: The API group of the resource</li><li><code>version</code>: The API version of the resource</li><li><code>kind</code>: The kind of the resource</li><li><code>name</code>: The name of the resource</li></ul><blockquote><p>Note: The resource can only be selected by name.</p></blockquote><p>To add a resource selector, edit the <code>resourceSelectors</code> field in the <code>ResourceOverride</code> spec:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceOverride</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-ro</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><blockquote><p>Note: The ResourceOverride needs to be in the same namespace as the resources it is overriding.</p></blockquote><p>The example above will pick a <code>Deployment</code> named <code>my-deployment</code> from the namespace <code>test-namespace</code>, as shown below, to be overridden.</p><pre tabindex=0><code>apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  name: my-deployment
  namespace: test-namespace
  ...
spec:
  progressDeadlineSeconds: 600
  replicas: 2
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: test-nginx
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: test-nginx
    spec:
      containers:
      - image: nginx:1.14.2
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
        - containerPort: 80
          protocol: TCP
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
status:
  ...
</code></pre><h2 id=policy>Policy</h2><p>The <code>Policy</code> is made up of a set of rules (<code>OverrideRules</code>) that specify the changes to be applied to the selected
resources on selected clusters.</p><p>Each <code>OverrideRule</code> supports the following fields:</p><ul><li><strong>Cluster Selector</strong>: This specifies the set of clusters to which the override applies.</li><li><strong>JSON Patch Override</strong>: This specifies the changes to be applied to the selected resources.</li></ul><p>To add an override rule, edit the <code>policy</code> field in the <code>ResourceOverride</code> spec:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceOverride</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-ro</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>overrideRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>jsonPatchOverrides</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>op</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>replace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/spec/template/spec/containers/0/image</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;nginx:1.20.0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ResourceOverride</code> object above will replace the image of the container in the <code>Deployment</code> named <code>my-deployment</code>
with the image <code>nginx:1.20.0</code> on all clusters with the label <code>env: prod</code>.</p><blockquote><p>The ResourceOverride mentioned above utilizes the deployment displayed below:</p><pre tabindex=0><code>apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  name: my-deployment
  namespace: test-namespace
  ...
spec:
  ...
  template:
    ...
    spec:
      containers:
      - image: nginx:1.14.2
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
       ...
      ...
  ...
</code></pre></blockquote><h3 id=cluster-selector>Cluster Selector</h3><p>To specify the clusters to which the override applies, you can use the <code>clusterSelector</code> field in the <code>OverrideRule</code> spec.
The <code>clusterSelector</code> field supports the following fields:</p><ul><li><code>clusterSelectorTerms</code>: A list of terms that are used to select clusters.<ul><li>Each term in the list is used to select clusters based on the label selector.</li></ul></li></ul><h3 id=json-patch-override>JSON Patch Override</h3><p>To specify the changes to be applied to the selected resources, you can use the jsonPatchOverrides field in the OverrideRule spec.
The jsonPatchOverrides field supports the following fields:</p><blockquote><p>JSONPatchOverride applies a JSON patch on the selected resources following <a href=https://datatracker.ietf.org/doc/html/rfc6902>RFC 6902</a>.
All the fields defined follow this RFC.</p></blockquote><p>The <code>jsonPatchOverrides</code> field supports the following fields:</p><ul><li><p><code>op</code>: The operation to be performed. The supported operations are <code>add</code>, <code>remove</code>, and <code>replace</code>.</p><ul><li><code>add</code>: Adds a new value to the specified path.</li><li><code>remove</code>: Removes the value at the specified path.</li><li><code>replace</code>: Replaces the value at the specified path.</li></ul></li><li><p><code>path</code>: The path to the field to be modified.</p><ul><li>Some guidelines for the path are as follows:<ul><li>Must start with a <code>/</code> character.</li><li>Cannot be empty.</li><li>Cannot contain an empty string ("///").</li><li>Cannot be a TypeMeta Field ("/kind", &ldquo;/apiVersion&rdquo;).</li><li>Cannot be a Metadata Field ("/metadata/name", &ldquo;/metadata/namespace&rdquo;), except the fields &ldquo;/metadata/annotations&rdquo; and &ldquo;metadata/labels&rdquo;.</li><li>Cannot be any field in the status of the resource.</li></ul></li><li>Some examples of valid paths are:<ul><li><code>/metadata/labels/new-label</code></li><li><code>/metadata/annotations/new-annotation</code></li><li><code>/spec/template/spec/containers/0/resources/limits/cpu</code></li><li><code>/spec/template/spec/containers/0/resources/requests/memory</code></li></ul></li></ul></li><li><p><code>value</code>: The value to be set.</p><ul><li>If the <code>op</code> is <code>remove</code>, the value cannot be set.</li></ul></li></ul><h3 id=multiple-override-rules>Multiple Override Rules</h3><p>You may add multiple <code>OverrideRules</code> to a <code>Policy</code> to apply multiple changes to the selected resources.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceOverride</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-ro</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>overrideRules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>jsonPatchOverrides</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>op</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>replace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/spec/template/spec/containers/0/image</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;nginx:1.20.0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>clusterSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>jsonPatchOverrides</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>op</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>replace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/spec/template/spec/containers/0/image</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;nginx:latest&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ResourceOverride</code> object above will replace the image of the container in the <code>Deployment</code> named <code>my-deployment</code>
with the image <code>nginx:1.20.0</code> on all clusters with the label <code>env: prod</code> and the image <code>nginx:latest</code> on all clusters with the label <code>env: test</code>.</p><blockquote><p>The ResourceOverride mentioned above utilizes the deployment displayed below:</p><pre tabindex=0><code>apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  name: my-deployment
  namespace: test-namespace
  ...
spec:
  ...
  template:
    ...
    spec:
      containers:
      - image: nginx:1.14.2
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
       ...
      ...
  ...
</code></pre></blockquote><h2 id=applying-the-resourceoverride>Applying the ResourceOverride</h2><p>Create a ClusterResourcePlacement resource to specify the placement rules for distributing the resource overrides across
the cluster infrastructure. Ensure that you select the appropriate namespaces containing the matching resources.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>crp-example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>affinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clusterAffinity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>clusterSelectorTerms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prod</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> configuration outlined above will disperse resources within <code>test-namespace</code> across all
clusters labeled with <code>env: prod</code> and <code>env: test</code>. As the changes are implemented, the corresponding <code>ResourceOverride</code>
configurations will be applied to the designated clusters, triggered by the selection of matching deployment resource
<code>my-deployment</code>.</p><h2 id=verifying-the-cluster-resource-is-overridden>Verifying the Cluster Resource is Overridden</h2><p>To ensure that the <code>ResourceOverride</code> object is applied to the selected resources, verify the <code>ClusterResourcePlacement</code>
status by running <code>kubectl describe crp crp-example</code> command:</p><pre tabindex=0><code>Status:
  Conditions:
    ...
    Message:                The selected resources are successfully overridden in the 10 clusters
    Observed Generation:    1
    Reason:                 OverriddenSucceeded
    Status:                 True
    Type:                   ClusterResourcePlacementOverridden
    ...
  Observed Resource Index:  0
  Placement Statuses:
    Applicable Resource Overrides:
      Name:        example-ro-0
      Namespace:   test-namespace
    Cluster Name:  member-50
    Conditions:
      ...
      Last Transition Time:  2024-04-26T22:57:14Z
      Message:               Successfully applied the override rules on the resources
      Observed Generation:   1
      Reason:                OverriddenSucceeded
      Status:                True
      Type:                  Overridden
     ...
</code></pre><p>Each cluster maintains its own <code>Applicable Resource Overrides</code> which contain the resource override snapshot and
the resource override namespace if relevant. Additionally, individual status messages for each cluster indicates
whether the override rules have been effectively applied.</p><p>The <code>ClusterResourcePlacementOverridden</code> condition indicates whether the resource override has been successfully applied
to the selected resources in the selected clusters.</p><p>To verify that the <code>ResourceOverride</code> object has been successfully applied to the selected resources,
check resources in the selected clusters:</p><ol><li>Get cluster credentials:
<code>az aks get-credentials --resource-group &lt;resource-group> --name &lt;cluster-name></code></li><li>Get the <code>Deployment</code> object in the selected cluster:
<code>kubectl --context=&lt;member-cluster-context> get deployment my-deployment -n test-namespace -o yaml</code></li></ol><p>Upon inspecting the member cluster, it was found that the selected cluster had the label env: prod.
Consequently, the image on deployment <code>my-deployment</code> was modified to be <code>nginx:1.20.0</code> on selected cluster.</p><pre tabindex=0><code>apiVersion: apps/v1
 kind: Deployment
 metadata:
   ...
   name: my-deployment
   namespace: test-namespace
   ...
 spec:
   ...
   template:
     ...
     spec:
       containers:
       - image: nginx:1.20.0
         imagePullPolicy: IfNotPresent
         name: nginx
         ports:
        ...
       ...
 status:
     ...
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-b44fd8dfb69a651370335b35322594c6>3.9 - Using Envelope Objects to Place Resources</h1><div class=lead>How to use envelope objects with the ClusterResourcePlacement API</div><h2 id=propagating-resources-with-envelope-objects>Propagating Resources with Envelope Objects</h2><p>This guide provides instructions on propagating a set of resources from the hub cluster to joined member clusters within an envelope object.</p><h2 id=envelope-object-with-configmap>Envelope Object with ConfigMap</h2><p>Currently, we support using a <code>ConfigMap</code> as an envelope object by leveraging a fleet-reserved annotation.</p><p>To designate a <code>ConfigMap</code> as an envelope object, ensure that it contains the following annotation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/envelope-configmap</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=example-configmap-envelope-object>Example ConfigMap Envelope Object:</h3><pre tabindex=0><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: envelope-configmap
  namespace: app
  annotations:
    kubernetes-fleet.io/envelope-configmap: &#34;true&#34;
data:
  resourceQuota.yaml: |
    apiVersion: v1
    kind: ResourceQuota
    metadata:
      name: mem-cpu-demo
      namespace: app
    spec:
      hard:
        requests.cpu: &#34;1&#34;
        requests.memory: 1Gi
        limits.cpu: &#34;2&#34;
        limits.memory: 2Gi
  webhook.yaml: |
    apiVersion: admissionregistration.k8s.io/v1
    kind: MutatingWebhookConfiguration
    metadata:
      creationTimestamp: null
      labels:
        azure-workload-identity.io/system: &#34;true&#34;
      name: azure-wi-webhook-mutating-webhook-configuration
    webhooks:
    - admissionReviewVersions:
      - v1
      - v1beta1
      clientConfig:
        service:
          name: azure-wi-webhook-webhook-service
          namespace: app
          path: /mutate-v1-pod
      failurePolicy: Fail
      matchPolicy: Equivalent
      name: mutation.azure-workload-identity.io
      rules:
      - apiGroups:
        - &#34;&#34;
        apiVersions:
        - v1
        operations:
        - CREATE
        - UPDATE
        resources:
        - pods
      sideEffects: None
</code></pre><h2 id=propagating-an-envelope-configmap-from-hub-cluster-to-member-cluster>Propagating an Envelope ConfigMap from Hub cluster to Member cluster:</h2><p>We will now apply the example envelope object above on our hub cluster. Then we use a <code>ClusterResourcePlacement</code> object to propagate the resource from hub to a member cluster named <code>kind-cluster-1</code>.</p><h3 id=crp-spec>CRP spec:</h3><pre tabindex=0><code>spec:
  policy:
    clusterNames:
    - kind-cluster-1
    placementType: PickFixed
  resourceSelectors:
  - group: &#34;&#34;
    kind: Namespace
    name: app
    version: v1
  revisionHistoryLimit: 10
  strategy:
    type: RollingUpdate
</code></pre><h3 id=crp-status>CRP status:</h3><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2023-11-30T19:54:13Z&#34;
    message: found all the clusters needed as specified by the scheduling policy
    observedGeneration: 2
    reason: SchedulingPolicyFulfilled
    status: &#34;True&#34;
    type: ClusterResourcePlacementScheduled
  - lastTransitionTime: &#34;2023-11-30T19:54:18Z&#34;
    message: All 1 cluster(s) are synchronized to the latest resources on the hub
      cluster
    observedGeneration: 2
    reason: SynchronizeSucceeded
    status: &#34;True&#34;
    type: ClusterResourcePlacementSynchronized
  - lastTransitionTime: &#34;2023-11-30T19:54:18Z&#34;
    message: Successfully applied resources to 1 member clusters
    observedGeneration: 2
    reason: ApplySucceeded
    status: &#34;True&#34;
    type: ClusterResourcePlacementApplied
  placementStatuses:
  - clusterName: kind-cluster-1
    conditions:
    - lastTransitionTime: &#34;2023-11-30T19:54:13Z&#34;
      message: &#39;Successfully scheduled resources for placement in kind-cluster-1:
        picked by scheduling policy&#39;
      observedGeneration: 2
      reason: ScheduleSucceeded
      status: &#34;True&#34;
      type: ResourceScheduled
    - lastTransitionTime: &#34;2023-11-30T19:54:18Z&#34;
      message: Successfully Synchronized work(s) for placement
      observedGeneration: 2
      reason: WorkSynchronizeSucceeded
      status: &#34;True&#34;
      type: WorkSynchronized
    - lastTransitionTime: &#34;2023-11-30T19:54:18Z&#34;
      message: Successfully applied resources
      observedGeneration: 2
      reason: ApplySucceeded
      status: &#34;True&#34;
      type: ResourceApplied
  selectedResources:
  - kind: Namespace
    name: app
    version: v1
  - kind: ConfigMap
    name: envelope-configmap
    namespace: app
    version: v1
</code></pre><blockquote><blockquote><p>Note: In the <code>selectedResources</code> section, we specifically display the propagated envelope object. Please note that we do not individually list all the resources contained within the envelope object in the status.</p></blockquote></blockquote><p>Upon inspection of the <code>selectedResources</code>, it indicates that the namespace <code>app</code> and the configmap <code>envelope-configmap</code> have been successfully propagated. Users can further verify the successful propagation of resources mentioned within the <code>envelope-configmap</code> object by ensuring that the <code>failedPlacements</code> section in the <code>placementStatus</code> for <code>kind-cluster-1</code> does not appear in the status.</p><h2 id=example-crp-status-where-resource-within-an-envelope-object-failed-to-apply>Example CRP status where resource within an envelope object failed to apply:</h2><h3 id=crp-status-1>CRP status:</h3><p>In the example below, within the <code>placementStatus</code> section for <code>kind-cluster-1</code>, the <code>failedPlacements</code> section provides details on resource that failed to apply along with information about the <code>envelope object</code> which contained the resource.</p><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2023-12-06T00:09:53Z&#34;
    message: found all the clusters needed as specified by the scheduling policy
    observedGeneration: 2
    reason: SchedulingPolicyFulfilled
    status: &#34;True&#34;
    type: ClusterResourcePlacementScheduled
  - lastTransitionTime: &#34;2023-12-06T00:09:58Z&#34;
    message: All 1 cluster(s) are synchronized to the latest resources on the hub
      cluster
    observedGeneration: 2
    reason: SynchronizeSucceeded
    status: &#34;True&#34;
    type: ClusterResourcePlacementSynchronized
  - lastTransitionTime: &#34;2023-12-06T00:09:58Z&#34;
    message: Failed to apply manifests to 1 clusters, please check the `failedPlacements`
      status
    observedGeneration: 2
    reason: ApplyFailed
    status: &#34;False&#34;
    type: ClusterResourcePlacementApplied
  placementStatuses:
  - clusterName: kind-cluster-1
    conditions:
    - lastTransitionTime: &#34;2023-12-06T00:09:53Z&#34;
      message: &#39;Successfully scheduled resources for placement in kind-cluster-1:
        picked by scheduling policy&#39;
      observedGeneration: 2
      reason: ScheduleSucceeded
      status: &#34;True&#34;
      type: ResourceScheduled
    - lastTransitionTime: &#34;2023-12-06T00:09:58Z&#34;
      message: Successfully Synchronized work(s) for placement
      observedGeneration: 2
      reason: WorkSynchronizeSucceeded
      status: &#34;True&#34;
      type: WorkSynchronized
    - lastTransitionTime: &#34;2023-12-06T00:09:58Z&#34;
      message: Failed to apply manifests, please check the `failedPlacements` status
      observedGeneration: 2
      reason: ApplyFailed
      status: &#34;False&#34;
      type: ResourceApplied
    failedPlacements:
    - condition:
        lastTransitionTime: &#34;2023-12-06T00:09:53Z&#34;
        message: &#39;Failed to apply manifest: namespaces &#34;app&#34; not found&#39;
        reason: AppliedManifestFailedReason
        status: &#34;False&#34;
        type: Applied
      envelope:
        name: envelop-configmap
        namespace: test-ns
        type: ConfigMap
      kind: ResourceQuota
      name: mem-cpu-demo
      namespace: app
      version: v1
  selectedResources:
  - kind: Namespace
    name: test-ns
    version: v1
  - kind: ConfigMap
    name: envelop-configmap
    namespace: test-ns
    version: v1
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-9e6acaf2aaf7ab5737e91dce54ade3d3>3.10 - Controlling How Fleet Handles Pre-Existing Resources</h1><div class=lead>How to fine-tune the way Fleet handles pre-existing resources</div><p>This guide provides an overview on how to set up Fleet&rsquo;s takeover experience, which allows
developers and admins to choose what will happen when Fleet encounters a pre-existing resource.
This occurs most often in the Fleet adoption scenario, where a cluster just joins into a fleet and
the system finds out that the resources to place onto the new member cluster via the CRP API have
already been running there.</p><p>A concern commonly associated with this scenario is that the running (pre-existing) set of
resources might have configuration differences from their equivalents on the hub cluster,
for example: On the hub cluster one might have a namespace <code>work</code> where it hosts a deployment
<code>web-server</code> that runs the image <code>rpd-stars:latest</code>; while on the member cluster in the same
namespace lives a deployment of the same name but with the image <code>umbrella-biolab:latest</code>.
If Fleet applies the resource template from the hub cluster, unexpected service interruptions
might occur.</p><p>To address this concern, Fleet also introduces a new field, <code>whenToTakeOver</code>, in the apply
strategy. Three options are available:</p><ul><li><code>Always</code>: This is the default option 😑. With this setting, Fleet will take over a
pre-existing resource as soon as it encounters it. Fleet will apply the corresponding
resource template from the hub cluster, and any value differences in the managed fields
will be overwritten. This is consistent with the behavior before the new takeover experience is
added.</li><li><code>IfNoDiff</code>: This is the new option ✨ provided by the takeover mechanism. With this setting,
Fleet will check for configuration differences when it finds a pre-existing resource and
will only take over the resource (apply the resource template) if no configuration
differences are found. Consider using this option for a safer adoption journey.</li><li><code>Never</code>: This is another new option ✨ provided by the takeover mechanism. With this setting,
Fleet will ignore pre-existing resources and no apply op will be performed. This will be considered
as an apply error. Use this option if you would like to check for the presence of pre-existing
resources without taking any action.</li></ul><blockquote><p>Before you begin</p><p>The new takeover experience is currently in preview.</p><p>Note that the APIs for the new experience are only available in the Fleet v1beta1 API, not the v1 API. If you do not see the new APIs in command outputs, verify that you are explicitly requesting the v1beta1 API objects, as opposed to the v1 API objects (the default).</p></blockquote><h2 id=how-fleet-can-be-used-to-safely-take-over-pre-existing-resources>How Fleet can be used to safely take over pre-existing resources</h2><p>The steps below explain how the takeover experience functions. The code assumes that you have
a fleet of two clusters, <code>member-1</code> and <code>member-2</code>:</p><ul><li><p>Switch to the second member cluster, and create a namespace, <code>work-2</code>, with labels:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context member-2-admin
</span></span><span style=display:flex><span>kubectl create ns work-2
</span></span><span style=display:flex><span>kubectl label ns work-2 <span style=color:#000>app</span><span style=color:#ce5c00;font-weight:700>=</span>work-2
</span></span><span style=display:flex><span>kubectl label ns work-2 <span style=color:#000>owner</span><span style=color:#ce5c00;font-weight:700>=</span>wesker
</span></span></code></pre></div></li><li><p>Switch to the hub cluster, and create the same namespace, but with a slightly different set of labels:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context hub-admin
</span></span><span style=display:flex><span>kubectl create ns work-2
</span></span><span style=display:flex><span>kubectl label ns work-2 <span style=color:#000>app</span><span style=color:#ce5c00;font-weight:700>=</span>work-2
</span></span><span style=display:flex><span>kubectl label ns work-2 <span style=color:#000>owner</span><span style=color:#ce5c00;font-weight:700>=</span>redfield
</span></span></code></pre></div></li><li><p>Create a CRP object that places the namespace to all member clusters:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06># The YAML configuration of the CRP object.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterResourcePlacement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: work-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSelectors:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      # Select all namespaces with the label app=work. 
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          app: work-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  policy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    placementType: PickAll
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  strategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # For simplicity reasons, the CRP is configured to roll out changes to
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # all member clusters at once. This is not a setup recommended for production
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # use.      
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    type: RollingUpdate
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    rollingUpdate:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      maxUnavailable: 100%
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      unavailablePeriodSeconds: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    applyStrategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      whenToTakeOver: Never
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></li><li><p>Give Fleet a few seconds to handle the placement. Check the status of the CRP object; you should see a failure there that complains about an apply error on the cluster <code>member-2</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.placementStatuses}&#39;</span> <span style=color:#000;font-weight:700>|</span> jq
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The command above uses JSON paths to query the relevant status information</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># directly and uses the jq utility to pretty print the output JSON.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># jq might not be available in your environment. You may have to install it</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># separately, or omit it from the command.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># If the output is empty, the status might have not been populated properly</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># yet. Retry in a few seconds; you may also want to switch the output type</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># from jsonpath to yaml to see the full object.</span>
</span></span></code></pre></div><p>The output should look like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;clusterName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member-1&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;conditions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#a40000>...</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a40000>...</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;status&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Applied&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;clusterName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member-2&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;conditions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#a40000>...</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a40000>...</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;status&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Applied&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;failedPlacements&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li><li><p>You can take a look at the <code>failedPlacements</code> part in the placement status for error details:</p><p>The output should look like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;condition&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;lastTransitionTime&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;...&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;message&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Failed to apply the manifest (error: no ownership of the object in the member cluster; takeover is needed)&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;reason&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;NotTakenOver&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;status&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Applied&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;kind&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Namespace&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;work-2&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;v1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><p>Fleet finds out that the namespace <code>work-2</code> already exists on the member cluster, and
it is not owned by Fleet; since the takeover policy is set to <code>Never</code>, Fleet will not assume
ownership of the namespace; no apply will be performed and an apply error will be raised
instead.</p><p>The following <code>jq</code> query can help you better locate clusters with failed placements and their
failure details:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.placementStatuses}&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    <span style=color:#000;font-weight:700>|</span> jq <span style=color:#4e9a06>&#39;[.[] | select (.failedPlacements != null)] | map({clusterName, failedPlacements})&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The command above uses JSON paths to retrieve the relevant status information</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># directly and uses the jq utility to query the data.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># jq might not be available in your environment. You may have to install it</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># separately, or omit it from the command.</span>
</span></span></code></pre></div><p>It would filter out all the clusters that do not have failures and report only
the failed clusters with the failure details:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;clusterName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member-2&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;failedPlacements&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;condition&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;lastTransitionTime&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;...&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;message&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Failed to apply the manifest (error: no ownership of the object in the member cluster; takeover is needed)&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;reason&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;NotTakenOver&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;status&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Applied&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;kind&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Namespace&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;work-2&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;v1&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li><li><p>Next, update the CRP object and set the <code>whenToTakeOver</code> field to <code>IfNoDiff</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06># The YAML configuration of the CRP object.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterResourcePlacement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: work-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSelectors:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      # Select all namespaces with the label app=work. 
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          app: work-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  policy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    placementType: PickAll
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  strategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # For simplicity reasons, the CRP is configured to roll out changes to
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # all member clusters at once. This is not a setup recommended for production
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # use.      
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    type: RollingUpdate
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    rollingUpdate:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      maxUnavailable: 100%
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      unavailablePeriodSeconds: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    applyStrategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      whenToTakeOver: IfNoDiff
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></li><li><p>Give Fleet a few seconds to handle the placement. Check the status of the CRP object; you should see the apply op still fails.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work-2
</span></span></code></pre></div></li><li><p>Verify the error details reported in the <code>failedPlacements</code> field for another time:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.placementStatuses}&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    <span style=color:#000;font-weight:700>|</span> jq <span style=color:#4e9a06>&#39;[.[] | select (.failedPlacements != null)] | map({clusterName, failedPlacements})&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The command above uses JSON paths to retrieve the relevant status information</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># directly and uses the jq utility to query the data.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># jq might not be available in your environment. You may have to install it</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># separately, or omit it from the command.</span>
</span></span></code></pre></div><p>The output has changed:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;clusterName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member-2&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;failedPlacements&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;condition&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;lastTransitionTime&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;...&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;message&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Failed to apply the manifest (error: cannot take over object: configuration differences are found between the manifest object and the corresponding object in the member cluster)&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;reason&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;FailedToTakeOver&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;status&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Applied&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;kind&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Namespace&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;work-2&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;v1&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Now, with the takeover policy set to <code>IfNoDiff</code>, Fleet can assume ownership of pre-existing
resources; however, as a configuration difference has been found between the hub cluster
and the member cluster, takeover is blocked.</p></li><li><p>Similar to the drift detection mechanism, Fleet will report details about the found
configuration differences as well. You can learn about them in the <code>diffedPlacements</code> part
of the status.</p><p>Use the <code>jq</code> query below to list all clusters with the <code>diffedPlacements</code> status information
populated:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.placementStatuses}&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    <span style=color:#000;font-weight:700>|</span> jq <span style=color:#4e9a06>&#39;[.[] | select (.diffedPlacements != null)] | map({clusterName, diffedPlacements})&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The command above uses JSON paths to retrieve the relevant status information</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># directly and uses the jq utility to query the data.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># jq might not be available in your environment. You may have to install it</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># separately, or omit it from the command.</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;clusterName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member-2&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;diffedPlacements&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;firstDiffedObservedTime&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;...&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;group&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;v1&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;kind&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Namespace&#34;</span><span style=color:#000;font-weight:700>,</span>    
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;work-2&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;observationTime&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;...&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;observedDiffs&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&#34;path&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/metadata/labels/owner&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&#34;valueInHub&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;redfield&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&#34;valueInMember&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;wesker&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;targetClusterObservedGeneration&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span>    
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Fleet will report the following information about a configuration difference:</p><ul><li><code>group</code>, <code>kind</code>, <code>version</code>, <code>namespace</code>, and <code>name</code>: the resource that has configuration differences.</li><li><code>observationTime</code>: the timestamp where the current diff detail is collected.</li><li><code>firstDiffedObservedTime</code>: the timestamp where the current diff is first observed.</li><li><code>observedDiffs</code>: the diff details, specifically:<ul><li><code>path</code>: A JSON path (RFC 6901) that points to the diff&rsquo;d field;</li><li><code>valueInHub</code>: the value at the JSON path as seen from the hub cluster resource template
(the desired state). If this value is absent, the field does not exist in the resource template.</li><li><code>valueInMember</code>: the value at the JSON path as seen from the member cluster resource
(the current state). If this value is absent, the field does not exist in the current state.</li></ul></li><li><code>targetClusterObservedGeneration</code>: the generation of the member cluster resource.</li></ul></li><li><p>To fix the configuration difference, consider one of the following options:</p><ul><li>Switch the <code>whenToTakeOver</code> setting back to <code>Always</code>, which will instruct Fleet to take over the resource right away and overwrite all configuration differences; or</li><li>Edit the diff&rsquo;d field directly on the member cluster side, so that the value is consistent with that on the hub cluster; Fleet will periodically re-evaluate diffs and should take over the resource soon after.</li><li>Delete the resource from the member cluster. Fleet will then re-apply the resource template and re-create the resource.</li></ul><p>Here the guide will take the first option available, setting the <code>whenToTakeOver</code> field to
<code>Always</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06># The YAML configuration of the CRP object.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterResourcePlacement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: work-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSelectors:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      # Select all namespaces with the label app=work. 
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          app: work-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  policy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    placementType: PickAll
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  strategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # For simplicity reasons, the CRP is configured to roll out changes to
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # all member clusters at once. This is not a setup recommended for production
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # use.      
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    type: RollingUpdate
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    rollingUpdate:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      maxUnavailable: 100%
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      unavailablePeriodSeconds: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    applyStrategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      whenToTakeOver: Always
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></li><li><p>Check the CRP status; in a few seconds, Fleet will report that all objects have been applied.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work-2
</span></span></code></pre></div><p>If you switch to the member cluster <code>member-2</code> now, you should see that the object looks
exactly the same as the resource template kept on the hub cluster; the owner label has been
over-written.</p></li></ul><blockquote><p>Important</p><p>When Fleet fails to take over an object, the pre-existing resource will not be put under Fleet&rsquo;s management: any change made on the hub cluster side will have no effect on the pre-existing resource. If you choose to delete the resource template, or remove the CRP object, Fleet will not attempt to delete the pre-existing resource.</p></blockquote><h2 id=takeover-and-comparison-options>Takeover and comparison options</h2><p>Fleet provides a <code>comparisonOptions</code> setting that allows you to fine-tune how Fleet calculates configuration differences between a resource template created on the hub cluster and the corresponding pre-existing resource on a member cluster.</p><blockquote><p>Note</p><p>The <code>comparisonOptions</code> setting also controls how Fleet detects drifts. See the how-to guide on drift detection for more information.</p></blockquote><p>If <code>partialComparison</code> is used, Fleet will only report configuration differences in managed fields, i.e., fields that are explicitly specified in the resource template; the presence of additional fields on the member cluster side will not stop Fleet from taking over the pre-existing resource; on the contrary, with <code>fullComparison</code>, Fleet will only take over a pre-existing resource if it looks exactly the same as its hub cluster counterpart.</p><p>Below is a table that summarizes the combos of different options and their respective effects:</p><table><thead><tr><th><code>whenToTakeOver</code> setting</th><th><code>comparisonOption</code> setting</th><th>Configuration difference scenario</th><th>Outcome</th></tr></thead><tbody><tr><td><code>IfNoDiff</code></td><td><code>partialComparison</code></td><td>There exists a value difference in a managed field between a pre-existing resource on a member cluster and the hub cluster resource template.</td><td>Fleet will report an apply error in the status, plus the diff details.</td></tr><tr><td><code>IfNoDiff</code></td><td><code>partialComparison</code></td><td>The pre-existing resource has a field that is absent on the hub cluster resource template.</td><td>Fleet will take over the resource; the configuration difference in the unmanaged field will be left untouched.</td></tr><tr><td><code>IfNoDiff</code></td><td><code>fullComparison</code></td><td><strong>Difference has been found on a field, managed or not.</strong></td><td>Fleet will report an apply error in the status, plus the diff details.</td></tr><tr><td><code>Always</code></td><td>Any option</td><td>Difference has been found on a field, managed or not.</td><td>Fleet will take over the resource; configuration differences in unmanaged fields will be left untouched.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-934276b9448b25f33e6f2421e293bbf7>3.11 - Enabling Drift Detection in Fleet</h1><div class=lead>How to enable drift detection in Fleet</div><p>This guide provides an overview on how to enable drift detection in Fleet. This feature can help
developers and admins identify (and act upon) configuration drifts in their KubeFleet system,
which are often brought by temporary fixes, inadvertent changes, and failed automations.</p><blockquote><p>Before you begin</p><p>The new drift detection experience is currently in preview.</p><p>Note that the APIs for the new experience are only available in the Fleet v1beta1 API, not the v1 API. If you do not see the new APIs in command outputs, verify that you are explicitly requesting the v1beta1 API objects, as opposed to the v1 API objects (the default).</p></blockquote><h2 id=what-is-a-drift>What is a drift?</h2><p>A drift occurs when a non-Fleet agent (e.g., a developer or a controller) makes changes to
a field of a Fleet-managed resource directly on the member cluster side without modifying
the corresponding resource template created on the hub cluster.</p><p>See the steps below for an example; the code assumes that you have a Fleet of two clusters,
<code>member-1</code> and <code>member-2</code>.</p><ul><li><p>Switch to the hub cluster in the preview environment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context hub-admin
</span></span></code></pre></div></li><li><p>Create a namespace, <code>work</code>, on the hub cluster, with some labels:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create ns work
</span></span><span style=display:flex><span>kubectl label ns work <span style=color:#000>app</span><span style=color:#ce5c00;font-weight:700>=</span>work
</span></span><span style=display:flex><span>kubectl label ns work <span style=color:#000>owner</span><span style=color:#ce5c00;font-weight:700>=</span>redfield
</span></span></code></pre></div></li><li><p>Create a CRP object, which places the namespace on all member clusters:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06># The YAML configuration of the CRP object.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterResourcePlacement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: work
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSelectors:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      # Select all namespaces with the label app=work.      
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          app: work
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  policy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    placementType: PickAll
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  strategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # For simplicity reasons, the CRP is configured to roll out changes to
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # all member clusters at once. This is not a setup recommended for production
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # use.         
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    type: RollingUpdate
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    rollingUpdate:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      maxUnavailable: 100%
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      unavailablePeriodSeconds: 1            
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></li><li><p>Fleet should be able to finish the placement within seconds. To verify the progress, run the command below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work
</span></span></code></pre></div><p>Confirm that in the output, Fleet has reported that the placement is of the <code>Available</code> state.</p></li><li><p>Switch to the first member cluster, <code>member-1</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context member-1-admin
</span></span></code></pre></div></li><li><p>You should see the namespace, <code>work</code>, being placed in this member cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get ns work --show-labels
</span></span></code></pre></div><p>The output should look as follows; note that all the labels have been set
(the <code>kubernetes.io/metadata.name</code> label is added by the Kubernetes system automatically):</p><pre tabindex=0><code>NAME     STATUS   AGE   LABELS
work     Active   91m   app=work,owner=redfield,kubernetes.io/metadata.name=work
</code></pre></li><li><p>Anyone with proper access to the member cluster could modify the namespace as they want;
for example, one can set the <code>owner</code> label to a different value:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl label ns work <span style=color:#000>owner</span><span style=color:#ce5c00;font-weight:700>=</span>wesker --overwrite
</span></span><span style=display:flex><span>kubectl label ns work <span style=color:#000>use</span><span style=color:#ce5c00;font-weight:700>=</span>hack --overwrite
</span></span></code></pre></div><p><strong>Now the namespace has drifted from its intended state.</strong></p></li></ul><p>Note that drifts are not necessarily a bad thing: to ensure system availability, often developers
and admins would need to make ad-hoc changes to the system; for example, one might need to set a
Deployment on a member cluster to use a different image from its template (as kept on the hub
cluster) to test a fix. In the current version of Fleet, the system is not drift-aware, which
means that Fleet will simply re-apply the resource template periodically with or without drifts.</p><p>In the case above:</p><ul><li><p>Since the owner label has been set on the resource template, its value would be overwritten by
Fleet, from <code>wesker</code> to <code>redfield</code>, within minutes. This provides a great consistency guarantee
but also blocks out all possibilities of expedient fixes/changes, which can be an inconvenience at times.</p></li><li><p>The <code>use</code> label is not a part of the resource template, so it will not be affected by any
apply op performed by Fleet. Its prolonged presence might pose an issue, depending on the
nature of the setup.</p></li></ul><h2 id=how-fleet-can-be-used-to-handle-drifts-gracefully>How Fleet can be used to handle drifts gracefully</h2><p>Fleet aims to provide an experience that:</p><ul><li>✅ allows developers and admins to make changes on the member cluster side when necessary; and</li><li>✅ helps developers and admins to detect drifts, esp. long-living ones, in their systems,
so that they can be handled properly; and</li><li>✅ grants developers and admins great flexibility on when and how drifts should be handled.</li></ul><p>To enable the new experience, set proper apply strategies in the CRP object, as
illustrated by the steps below:</p><ul><li><p>Switch to the hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context hub-admin
</span></span></code></pre></div></li><li><p>Update the existing CRP (<code>work</code>), to use an apply strategy with the <code>whenToApply</code> field set to
<code>IfNotDrifted</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06># The YAML configuration of the CRP object.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterResourcePlacement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: work
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSelectors:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      # Select all namespaces with the label app=work. 
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          app: work
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  policy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    placementType: PickAll
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  strategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    applyStrategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      whenToApply: IfNotDrifted
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # For simplicity reasons, the CRP is configured to roll out changes to
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # all member clusters at once. This is not a setup recommended for production
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # use.      
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    type: RollingUpdate
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    rollingUpdate:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      maxUnavailable: 100%
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      unavailablePeriodSeconds: 1                
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>The <code>whenToApply</code> field features two options:</p><ul><li><code>Always</code>: this is the default option 😑. With this setting, Fleet will periodically apply
the resource templates from the hub cluster to member clusters, with or without drifts.
This is consistent with the behavior before the new drift detection and takeover experience.</li><li><code>IfNotDrifted</code>: this is the new option ✨ provided by the drift detection mechanism. With
this setting, Fleet will check for drifts periodically; if drifts are found, Fleet will stop
applying the resource templates and report in the CRP status.</li></ul></li><li><p>Switch to the first member cluster and edit the labels for a second time, effectively re-introducing
a drift in the system. After it&rsquo;s done, switch back to the hub cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context member-1-admin
</span></span><span style=display:flex><span>kubectl label ns work <span style=color:#000>owner</span><span style=color:#ce5c00;font-weight:700>=</span>wesker --overwrite
</span></span><span style=display:flex><span>kubectl label ns work <span style=color:#000>use</span><span style=color:#ce5c00;font-weight:700>=</span>hack --overwrite
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span>kubectl config use-context hub-admin
</span></span></code></pre></div></li><li><p>Fleet should be able to find the drifts swiftly (w/in a few seconds). Inspect the placement status Fleet
reports for each cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.placementStatuses}&#39;</span> <span style=color:#000;font-weight:700>|</span> jq
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The command above uses JSON paths to query the relevant status information</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># directly and uses the jq utility to pretty print the output JSON.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># jq might not be available in your environment. You may have to install it</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># separately, or omit it from the command.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># If the output is empty, the status might have not been populated properly</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># yet. Retry in a few seconds; you may also want to switch the output type</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># from jsonpath to yaml to see the full object.</span>
</span></span></code></pre></div><p>The output should look like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;clusterName&#34;: </span><span style=color:#4e9a06>&#34;member-1&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;conditions&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;status&#34;: </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;type&#34;: </span><span style=color:#4e9a06>&#34;Applied&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;driftedPlacements&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;firstDriftedObservedTime&#34;: </span><span style=color:#4e9a06>&#34;...&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;kind&#34;: </span><span style=color:#4e9a06>&#34;Namespace&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;name&#34;: </span><span style=color:#4e9a06>&#34;work&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;observationTime&#34;: </span><span style=color:#4e9a06>&#34;...&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;observedDrifts&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>&#34;path&#34;: </span><span style=color:#4e9a06>&#34;/metadata/labels/owner&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>&#34;valueInHub&#34;: </span><span style=color:#4e9a06>&#34;redfield&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>&#34;valueInMember&#34;: </span><span style=color:#4e9a06>&#34;wesker&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;targetClusterObservedGeneration&#34;: </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;version&#34;: </span><span style=color:#4e9a06>&#34;v1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;failedPlacements&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;condition&#34;: </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>&#34;lastTransitionTime&#34;: </span><span style=color:#4e9a06>&#34;...&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>&#34;message&#34;: </span><span style=color:#4e9a06>&#34;Failed to apply the manifest (error: cannot apply manifest: drifts are found between the manifest and the object from the member cluster)&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>&#34;reason&#34;: </span><span style=color:#4e9a06>&#34;FoundDrifts&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>&#34;status&#34;: </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>&#34;type&#34;: </span><span style=color:#4e9a06>&#34;Applied&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;kind&#34;: </span><span style=color:#4e9a06>&#34;Namespace&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;name&#34;: </span><span style=color:#4e9a06>&#34;work&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;version&#34;: </span><span style=color:#4e9a06>&#34;v1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;clusterName&#34;: </span><span style=color:#4e9a06>&#34;member-2&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;conditions&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>...]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>You should see that cluster <code>member-1</code> has encountered an apply failure. The
<code>failedPlacements</code> part explains exactly which manifests have failed on <code>member-1</code>
and its reason; in this case, the apply op fails as Fleet finds out that the namespace
<code>work</code> has drifted from its intended state. The <code>driftedPlacements</code> part specifies in
detail which fields have drifted and the value differences between the hub
cluster and the member cluster.</p><p>Fleet will report the following information about a drift:</p><ul><li><code>group</code>, <code>kind</code>, <code>version</code>, <code>namespace</code>, and <code>name</code>: the resource that has drifted from its desired state.</li><li><code>observationTime</code>: the timestamp where the current drift detail is collected.</li><li><code>firstDriftedObservedTime</code>: the timestamp where the current drift is first observed.</li><li><code>observedDrifts</code>: the drift details, specifically:<ul><li><code>path</code>: A JSON path (RFC 6901) that points to the drifted field;</li><li><code>valueInHub</code>: the value at the JSON path as seen from the hub cluster resource template
(the desired state). If this value is absent, the field does not exist in the resource template.</li><li><code>valueInMember</code>: the value at the JSON path as seen from the member cluster resource
(the current state). If this value is absent, the field does not exist in the current state.</li></ul></li><li><code>targetClusterObservedGeneration</code>: the generation of the member cluster resource.</li></ul><p>The following <code>jq</code> query can help you better extract the drifted clusters and the drift
details from the CRP status output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.placementStatuses}&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    <span style=color:#000;font-weight:700>|</span> jq <span style=color:#4e9a06>&#39;[.[] | select (.driftedPlacements != null)] | map({clusterName, driftedPlacements})&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The command above uses JSON paths to query the relevant status information</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># directly and uses the jq utility to pretty print the output JSON.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># jq might not be available in your environment. You may have to install it</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># separately, or omit it from the command.</span>
</span></span></code></pre></div><p>This query would filter out all the clusters that do not have drifts and report only
the drifted clusters with the drift details:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;clusterName&#34;: </span><span style=color:#4e9a06>&#34;member-1&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;driftedPlacements&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;firstDriftedObservedTime&#34;: </span><span style=color:#4e9a06>&#34;...&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;kind&#34;: </span><span style=color:#4e9a06>&#34;Namespace&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;name&#34;: </span><span style=color:#4e9a06>&#34;work&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;observationTime&#34;: </span><span style=color:#4e9a06>&#34;...&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;observedDrifts&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>&#34;path&#34;: </span><span style=color:#4e9a06>&#34;/metadata/labels/owner&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>&#34;valueInHub&#34;: </span><span style=color:#4e9a06>&#34;redfield&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#204a87;font-weight:700>&#34;valueInMember&#34;: </span><span style=color:#4e9a06>&#34;wesker&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;targetClusterObservedGeneration&#34;: </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;version&#34;: </span><span style=color:#4e9a06>&#34;v1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>To fix the drift, consider one of the following options:</p><ul><li>Switch the <code>whenToApply</code> setting back to <code>Always</code>, which will instruct Fleet to overwrite
the drifts using values from the hub cluster resource template; or</li><li>Edit the drifted field directly on the member cluster side, so that the value is
consistent with that on the hub cluster; Fleet will periodically re-evaluate drifts
and should report that no drifts are found soon after.</li><li>Delete the resource from the member cluster. Fleet will then re-apply the resource
template and re-create the resource.</li></ul><blockquote><p>Important:</p><p>The presence of drifts will <strong>NOT</strong> stop Fleet from rolling out newer resource versions. If you choose to edit the resource template on the hub cluster, Fleet will always apply the new resource template in the rollout process, which may also resolve the drift.</p></blockquote></li></ul><h2 id=comparison-options>Comparison options</h2><p>One may have found out that the namespace on the member cluster has another drift, the
label <code>use=hack</code>, which is not reported in the CRP status by Fleet. This is because by default
Fleet compares only managed fields, i.e., fields that are explicitly specified in the resource
template. If a field is not populated on the hub cluster side, Fleet will not recognize its
presence on the member cluster side as a drift. This allows controllers on the member cluster
side to manage some fields automatically without Fleet&rsquo;s involvement; for example, one might would
like to use an HPA solution to auto-scale Deployments as appropriate and consequently decide not
to include the <code>.spec.replicas</code> field in the resource template.</p><p>Fleet recognizes that there might be cases where developers and admins would like to have their
resources look exactly the same across their fleet. If this scenario applies, one might set up
the <code>comparisonOptions</code> field in the apply strategy from the <code>partialComparison</code> value
(the default) to <code>fullComparison</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>work</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>applyStrategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>whenToApply</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>IfNotDrifted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>comparisonOption</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fullComparison</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>With this setting, Fleet will recognize the presence of any unmanaged fields (i.e., fields that
are present on the member cluster side, but not set on the hub cluster side) as drifts as well.
If anyone adds a field to a Fleet-managed object directly on the member cluster, it would trigger
an apply error, which you can find out about the details the same way as illustrated in the
section above.</p><h2 id=summary>Summary</h2><p>Below is a summary of the synergy between the <code>whenToApply</code> and <code>comparisonOption</code> settings:</p><table><thead><tr><th><code>whenToApply</code> setting</th><th><code>comparisonOption</code> setting</th><th>Drift scenario</th><th>Outcome</th></tr></thead><tbody><tr><td><code>IfNotDrifted</code></td><td><code>partialComparison</code></td><td>A managed field (i.e., a field that has been explicitly set in the hub cluster resource template) is edited.</td><td>Fleet will report an apply error in the status, plus the drift details.</td></tr><tr><td><code>IfNotDrifted</code></td><td><code>partialComparison</code></td><td>An unmanaged field (i.e., a field that has not been explicitly set in the hub cluster resource template) is edited/added.</td><td>N/A; the change is left untouched, and Fleet will ignore it.</td></tr><tr><td><code>IfNotDrifted</code></td><td><code>fullComparison</code></td><td>Any field is edited/added.</td><td>Fleet will report an apply error in the status, plus the drift details.</td></tr><tr><td><code>Always</code></td><td><code>partialComparison</code></td><td>A managed field (i.e., a field that has been explicitly set in the hub cluster resource template) is edited.</td><td>N/A; the change is overwritten shortly.</td></tr><tr><td><code>Always</code></td><td><code>partialComparison</code></td><td>An unmanaged field (i.e., a field that has not been explicitly set in the hub cluster resource template) is edited/added.</td><td>N/A; the change is left untouched, and Fleet will ignore it.</td></tr><tr><td><code>Always</code></td><td><code>fullComparison</code></td><td>Any field is edited/added.</td><td>The change on managed fields will be overwritten shortly; Fleet will report drift details about changes on unmanaged fields, but this is not considered as an apply error.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-305fa8c74ee8f62995ad9a0d77561184>3.12 - Using the ReportDiff Apply Mode</h1><div class=lead>How to use the ReportDiff apply mode</div><p>This guide provides an overview on how to use the <code>ReportDiff</code> apply mode, which allows one to
easily evaluate how things will change in the system without the risk of incurring unexpected
changes. In this mode, Fleet will check for configuration differences between the hub cluster
resource templates and their corresponding resources on the member clusters, but will not
perform any apply op. This is most helpful in cases of experimentation and drift/diff analysis.</p><h1 id=how-the-reportdiff-mode-can-help>How the <code>ReportDiff</code> mode can help</h1><p>To use this mode, simply set the <code>type</code> field in the apply strategy part of the CRP API
from <code>ClientSideApply</code> (the default) or <code>ServerSideApply</code> to <code>ReportDiff</code>. Configuration
differences are checked per <code>comparisonOption</code> setting, in consistency with the behavior
documented in the drift detection how-to guide; see the document for more information.</p><p>The steps below might help explain the workflow better; it assumes that you have a fleet
of two member clusters, <code>member-1</code> and <code>member-2</code>:</p><ul><li><p>Switch to the hub cluster and create a namespace, <code>work-3</code>, with some labels.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context hub-admin
</span></span><span style=display:flex><span>kubectl create ns work-3
</span></span><span style=display:flex><span>kubectl label ns work-3 <span style=color:#000>app</span><span style=color:#ce5c00;font-weight:700>=</span>work-3
</span></span><span style=display:flex><span>kubectl label ns work-3 <span style=color:#000>owner</span><span style=color:#ce5c00;font-weight:700>=</span>leon
</span></span></code></pre></div></li><li><p>Create a CRP object that places the namespace to all member clusters:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06># The YAML configuration of the CRP object.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterResourcePlacement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: work-3
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSelectors:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      # Select all namespaces with the label app=work-3. 
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          app: work-3
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  policy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    placementType: PickAll
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  strategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # For simplicity reasons, the CRP is configured to roll out changes to
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # all member clusters at once. This is not a setup recommended for production
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # use.      
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    type: RollingUpdate
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    rollingUpdate:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      maxUnavailable: 100%
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      unavailablePeriodSeconds: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></li><li><p>In a few seconds, Fleet will complete the placement. Verify that the CRP is available by checking its status.</p></li><li><p>After the CRP becomes available, edit its apply strategy and set it to use the ReportDiff mode:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06># The YAML configuration of the CRP object.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterResourcePlacement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: work-3
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSelectors:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      # Select all namespaces with the label app=work-3. 
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          app: work-3
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  policy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    placementType: PickAll
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  strategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # For simplicity reasons, the CRP is configured to roll out changes to
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # all member clusters at once. This is not a setup recommended for production
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    # use.      
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    type: RollingUpdate
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    rollingUpdate:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      maxUnavailable: 100%
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      unavailablePeriodSeconds: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    applyStrategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      type: ReportDiff   
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></li><li><p>The CRP should remain available, as currently there is no configuration difference at all.
Check the <code>ClusterResourcePlacementDiffReported</code> condition in the status; it should report no error:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work-3 -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.conditions[?(@.type==&#34;ClusterResourcePlacementDiffReported&#34;)]}&#39;</span> <span style=color:#000;font-weight:700>|</span> jq
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The command above uses JSON paths to query the drift details directly and</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># uses the jq utility to pretty print the output JSON.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># jq might not be available in your environment. You may have to install it</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># separately, or omit it from the command.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># If the output is empty, the status might have not been populated properly</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># yet. You can switch the output type from jsonpath to yaml to see the full</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># object.</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;lastTransitionTime&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;2025-03-19T06:45:58Z&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;message&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Diff reporting in 2 cluster(s) has been completed&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;observedGeneration&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>...</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;reason&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;DiffReportingCompleted&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;status&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ClusterResourcePlacementDiffReported&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li><li><p>Now, switch to the second member cluster and make a label change on the applied namespace.
After the change is done, switch back to the hub cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl config use-context member-2-admin
</span></span><span style=display:flex><span>kubectl label ns work-3 <span style=color:#000>owner</span><span style=color:#ce5c00;font-weight:700>=</span>krauser --overwrite
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span>kubectl config use-context hub-admin
</span></span></code></pre></div></li><li><p>Fleet will detect this configuration difference shortly (w/in 15 seconds).
Verify that the diff details have been added to the CRP status, specifically reported
in the <code>diffedPlacements</code> part of the status; the <code>jq</code> query below
will list all the clusters with the <code>diffedPlacements</code> status information populated:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get clusterresourceplacement.v1beta1.placement.kubernetes-fleet.io work-3 -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.placementStatuses}&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    <span style=color:#000;font-weight:700>|</span> jq <span style=color:#4e9a06>&#39;[.[] | select (.diffedPlacements != null)] | map({clusterName, diffedPlacements})&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The command above uses JSON paths to retrieve the relevant status information</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># directly and uses the jq utility to query the data.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># jq might not be available in your environment. You may have to install it</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># separately, or omit it from the command.</span>
</span></span></code></pre></div><p>The output should be as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;clusterName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;member-2&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;diffedPlacements&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;firstDiffedObservedTime&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;2025-03-19T06:49:54Z&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;kind&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Namespace&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;work-3&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;observationTime&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;2025-03-19T06:50:25Z&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;observedDiffs&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&#34;path&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/metadata/labels/owner&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&#34;valueInHub&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;leon&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&#34;valueInMember&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;krauser&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;targetClusterObservedGeneration&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;v1&#34;</span> 
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Fleet will report the following information about a configuration difference:</p><ul><li><code>group</code>, <code>kind</code>, <code>version</code>, <code>namespace</code>, and <code>name</code>: the resource that has configuration differences.</li><li><code>observationTime</code>: the timestamp where the current diff detail is collected.</li><li><code>firstDiffedObservedTime</code>: the timestamp where the current diff is first observed.</li><li><code>observedDiffs</code>: the diff details, specifically:<ul><li><code>path</code>: A JSON path (RFC 6901) that points to the diff&rsquo;d field;</li><li><code>valueInHub</code>: the value at the JSON path as seen from the hub cluster resource template
(the desired state). If this value is absent, the field does not exist in the resource template.</li><li><code>valueInMember</code>: the value at the JSON path as seen from the member cluster resource
(the current state). If this value is absent, the field does not exist in the current state.</li></ul></li><li><code>targetClusterObservedGeneration</code>: the generation of the member cluster resource.</li></ul></li></ul><h2 id=more-information-on-the-reportdiff-mode>More information on the ReportDiff mode</h2><ul><li>As mentioned earlier, with this mode no apply op will be run at all; it is up to the user to
decide the best way to handle found configuration differences (if any).</li><li>Diff reporting becomes successful and complete as soon as Fleet finishes checking all the resources;
whether configuration differences are found or not has no effect on the diff reporting success status.<ul><li>When a resource change has been applied on the hub cluster side, for CRPs of the ReportDiff mode,
the change will be immediately rolled out to all member clusters (when the rollout strategy is set to
RollingUpdate, the default type), as soon as they have completed diff reporting earlier.</li></ul></li><li>It is worth noting that Fleet will only report differences on resources that have corresponding manifests
on the hub cluster. If, for example, a namespace-scoped object has been created on the member cluster but
not on the hub cluster, Fleet will ignore the object, even if its owner namespace has been selected for placement.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-dcd05a852eca01d185729a33f973f1ea>3.13 - How to Roll Out and Roll Back Changes in Stage</h1><div class=lead>How to roll out and roll back changes with the <code>ClusterStagedUpdateRun</code> API</div><p>This how-to guide demonstrates how to use <code>ClusterStagedUpdateRun</code> to rollout resources to member clusters in a staged manner and rollback resources to a previous version.</p><h2 id=prerequisite>Prerequisite</h2><p><code>ClusterStagedUpdateRun</code> CR is used to deploy resources from hub cluster to member clusters with <code>ClusterResourcePlacement</code> (or CRP) in a stage by stage manner. This tutorial is based on a demo fleet environment with 3 member clusters:</p><table><thead><tr><th>cluster name</th><th>labels</th></tr></thead><tbody><tr><td>member1</td><td>environment=canary, order=2</td></tr><tr><td>member2</td><td>environment=staging</td></tr><tr><td>member3</td><td>environment=canary, order=1</td></tr></tbody></table><p>To demonstrate the rollout and rollback behavior, we create a demo namespace and a sample configmap with very simple data on the hub cluster. The namespace with configmap will be deployed to the member clusters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create ns test-namespace
</span></span><span style=display:flex><span>kubectl create cm test-cm --from-literal<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>key</span><span style=color:#ce5c00;font-weight:700>=</span>value1 -n test-namespace
</span></span></code></pre></div><p>Now we create a <code>ClusterResourcePlacement</code> to deploy the resources:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f - <span style=color:#4e9a06>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterResourcePlacement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: example-placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSelectors:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: test-namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  policy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    placementType: PickAll
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  strategy:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    type: External
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p><strong>Note that <code>spec.strategy.type</code> is set to <code>External</code> to allow rollout triggered with a ClusterStagedUpdateRun.</strong>
Both clusters should be scheduled since we use the <code>PickAll</code> policy but at the moment no resource should be deployed on the member clusters because we haven&rsquo;t created a <code>ClusterStagedUpdateRun</code> yet. The CRP is not AVAILABLE yet.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get crp example-placement
</span></span><span style=display:flex><span>NAME                GEN   SCHEDULED   SCHEDULED-GEN   AVAILABLE   AVAILABLE-GEN   AGE
</span></span><span style=display:flex><span>example-placement   <span style=color:#0000cf;font-weight:700>1</span>     True        <span style=color:#0000cf;font-weight:700>1</span>                                           8s
</span></span></code></pre></div><h2 id=check-resource-snapshot-versions>Check resource snapshot versions</h2><p>Fleet keeps a list of resource snapshots for version control and audit, (for more details, please refer to <a href=../api-references.md>api-references</a>).</p><p>To check current resource snapshots:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get clusterresourcesnapshots --show-labels
</span></span><span style=display:flex><span>NAME                           GEN   AGE     LABELS
</span></span><span style=display:flex><span>example-placement-0-snapshot   <span style=color:#0000cf;font-weight:700>1</span>     7m31s   kubernetes-fleet.io/is-latest-snapshot<span style=color:#ce5c00;font-weight:700>=</span>true,kubernetes-fleet.io/parent-CRP<span style=color:#ce5c00;font-weight:700>=</span>example-placement,kubernetes-fleet.io/resource-index<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>
</span></span></code></pre></div><p>We only have one version of the snapshot. It is the current latest (<code>kubernetes-fleet.io/is-latest-snapshot=true</code>) and has resource-index 0 (<code>kubernetes-fleet.io/resource-index=0</code>).</p><p>Now we modify the our configmap with a new value <code>value2</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl edit cm test-cm -n test-namespace
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get configmap test-cm -n test-namespace -o yaml
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  key: value2     <span style=color:#8f5902;font-style:italic># value updated here, old value: value1</span>
</span></span><span style=display:flex><span>kind: ConfigMap
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  creationTimestamp: ...
</span></span><span style=display:flex><span>  name: test-cm
</span></span><span style=display:flex><span>  namespace: test-namespace
</span></span><span style=display:flex><span>  resourceVersion: ...
</span></span><span style=display:flex><span>  uid: ...
</span></span></code></pre></div><p>It now shows 2 versions of resource snapshots with index 0 and 1 respectively:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get clusterresourcesnapshots --show-labels
</span></span><span style=display:flex><span>NAME                           GEN   AGE    LABELS
</span></span><span style=display:flex><span>example-placement-0-snapshot   <span style=color:#0000cf;font-weight:700>1</span>     17m    kubernetes-fleet.io/is-latest-snapshot<span style=color:#ce5c00;font-weight:700>=</span>false,kubernetes-fleet.io/parent-CRP<span style=color:#ce5c00;font-weight:700>=</span>example-placement,kubernetes-fleet.io/resource-index<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>example-placement-1-snapshot   <span style=color:#0000cf;font-weight:700>1</span>     2m2s   kubernetes-fleet.io/is-latest-snapshot<span style=color:#ce5c00;font-weight:700>=</span>true,kubernetes-fleet.io/parent-CRP<span style=color:#ce5c00;font-weight:700>=</span>example-placement,kubernetes-fleet.io/resource-index<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span></code></pre></div><p>The <code>latest</code> label set to <code>example-placement-1-snapshot</code> which contains the latest configmap data:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get clusterresourcesnapshots example-placement-1-snapshot -o yaml
</span></span><span style=display:flex><span>apiVersion: placement.kubernetes-fleet.io/v1
</span></span><span style=display:flex><span>kind: ClusterResourceSnapshot
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    kubernetes-fleet.io/is-latest-snapshot: <span style=color:#4e9a06>&#34;true&#34;</span>
</span></span><span style=display:flex><span>    kubernetes-fleet.io/parent-CRP: example-placement
</span></span><span style=display:flex><span>    kubernetes-fleet.io/resource-index: <span style=color:#4e9a06>&#34;1&#34;</span>
</span></span><span style=display:flex><span>  name: example-placement-1-snapshot
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  selectedResources:
</span></span><span style=display:flex><span>  - apiVersion: v1
</span></span><span style=display:flex><span>    kind: Namespace
</span></span><span style=display:flex><span>    metadata:
</span></span><span style=display:flex><span>      labels:
</span></span><span style=display:flex><span>        kubernetes.io/metadata.name: test-namespace
</span></span><span style=display:flex><span>      name: test-namespace
</span></span><span style=display:flex><span>    spec:
</span></span><span style=display:flex><span>      finalizers:
</span></span><span style=display:flex><span>      - kubernetes
</span></span><span style=display:flex><span>  - apiVersion: v1
</span></span><span style=display:flex><span>    data:
</span></span><span style=display:flex><span>      key: value2 <span style=color:#8f5902;font-style:italic># latest value: value2, old value: value1</span>
</span></span><span style=display:flex><span>    kind: ConfigMap
</span></span><span style=display:flex><span>    metadata:
</span></span><span style=display:flex><span>      name: test-cm
</span></span><span style=display:flex><span>      namespace: test-namespace
</span></span></code></pre></div><h2 id=deploy-a-clusterstagedupdatestrategy>Deploy a ClusterStagedUpdateStrategy</h2><p>A <code>ClusterStagedUpdateStrategy</code> defines the orchestration pattern that groups clusters into stages and specifies the rollout sequence.
It selects member clusters by labels. For our demonstration, we create one with two stages:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f - <span style=color:#4e9a06>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterStagedUpdateStrategy
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: example-strategy
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  stages:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - name: staging
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          environment: staging
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      afterStageTasks:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - type: TimedWait
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          waitTime: 1m
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - name: canary
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labelSelector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          environment: canary
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      sortingLabelKey: order
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      afterStageTasks:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - type: Approval
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><h2 id=deploy-a-clusterstagedupdaterun-to-rollout-latest-change>Deploy a ClusterStagedUpdateRun to rollout latest change</h2><p>A <code>ClusterStagedUpdateRun</code> executes the rollout of a <code>ClusterResourcePlacement</code> following a <code>ClusterStagedUpdateStrategy</code>. To trigger the staged update run for our CRP, we create a <code>ClusterStagedUpdateRun</code> specifying the CRP name, updateRun strategy name, and the latest resource snapshot index (&ldquo;1&rdquo;):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f - <span style=color:#4e9a06>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterStagedUpdateRun
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: example-run
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  placementName: example-placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSnapshotIndex: &#34;1&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  stagedRolloutStrategyName: example-strategy
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>The staged update run is initialized and running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get crsur example-run
</span></span><span style=display:flex><span>NAME          PLACEMENT           RESOURCE-SNAPSHOT   POLICY-SNAPSHOT   INITIALIZED   SUCCEEDED   AGE
</span></span><span style=display:flex><span>example-run   example-placement   <span style=color:#0000cf;font-weight:700>1</span>                   <span style=color:#0000cf;font-weight:700>0</span>                 True                      44s
</span></span></code></pre></div><p>A more detailed look at the status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterStagedUpdateRun</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSnapshotIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stagedRolloutStrategyName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-strategy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterStagedUpdateRun initialized successfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>UpdateRunInitializedSuccessfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># the updateRun is initialized successfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Initialized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>UpdateRunStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># the updateRun is still running</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>deletionStageStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># no clusters need to be cleaned up</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>stageName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubernetes-fleet.io/deleteStage</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policyObservedClusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># number of clusters to be updated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policySnapshotIndexUsed</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stagedUpdateStrategySnapshot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># snapshot of the strategy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>stages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>afterStageTasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TimedWait</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>waitTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1m0s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>staging</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>staging</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>afterStageTasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Approval</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>sortingLabelKey</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>order</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stagesStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># detailed status for each stage</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>afterStageTaskStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AfterStageTaskWaitTimeElapsed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># the wait after-stage task has completed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WaitTimeElapsed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TimedWait</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>member2</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># stage staging contains member2 cluster only</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Started</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># member2 is updated successfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Succeeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StageUpdatingWaiting</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StageUpdatingSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># stage staging has completed successfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Succeeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>endTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>stageName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>staging</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>startTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>afterStageTaskStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>approvalRequestName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run-canary</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># ClusterApprovalRequest name for this stage</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Approval</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>member3</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># according the labelSelector and sortingLabelKey, member3 is selected first in this stage</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Started</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># member3 update is completed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Succeeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>member1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># member1 is selected after member3 because of order=2 label</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># member1 update has not finished yet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Started</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StageUpdatingStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># stage canary is still executing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>stageName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>startTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Wait a little bit more, and we can see stage <code>canary</code> finishes cluster update and is waiting for the Approval task.
We can check the <code>ClusterApprovalRequest</code> generated and not approved yet:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get clusterapprovalrequest
</span></span><span style=display:flex><span>NAME                 UPDATE-RUN    STAGE    APPROVED   APPROVALACCEPTED   AGE
</span></span><span style=display:flex><span>example-run-canary   example-run   canary                                 2m2s
</span></span></code></pre></div><p>We can approve the <code>ClusterApprovalRequest</code> by patching its status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl patch clusterapprovalrequests example-run-canary --type<span style=color:#ce5c00;font-weight:700>=</span>merge -p <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;status&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;conditions&#34;</span>:<span style=color:#ce5c00;font-weight:700>[{</span><span style=color:#4e9a06>&#34;type&#34;</span>:<span style=color:#4e9a06>&#34;Approved&#34;</span>,<span style=color:#4e9a06>&#34;status&#34;</span>:<span style=color:#4e9a06>&#34;True&#34;</span>,<span style=color:#4e9a06>&#34;reason&#34;</span>:<span style=color:#4e9a06>&#34;lgtm&#34;</span>,<span style=color:#4e9a06>&#34;message&#34;</span>:<span style=color:#4e9a06>&#34;lgtm&#34;</span>,<span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>:<span style=color:#4e9a06>&#34;&#39;</span><span style=color:#204a87;font-weight:700>$(</span>date -u +%Y-%m-%dT%H:%M:%SZ<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#39;&#34;</span>,<span style=color:#4e9a06>&#34;observedGeneration&#34;</span>:1<span style=color:#ce5c00;font-weight:700>}]}}</span> --subresource<span style=color:#ce5c00;font-weight:700>=</span>status
</span></span><span style=display:flex><span>clusterapprovalrequest.placement.kubernetes-fleet.io/example-run-canary patched
</span></span></code></pre></div><p>This can be done equivalently by creating a json patch file and applying it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt; EOF &gt; approval.json
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;status&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &#34;conditions&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &#34;lastTransitionTime&#34;: &#34;$(date -u +%Y-%m-%dT%H:%M:%SZ)&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &#34;message&#34;: &#34;lgtm&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &#34;observedGeneration&#34;: 1,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &#34;reason&#34;: &#34;lgtm&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &#34;status&#34;: &#34;True&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &#34;type&#34;: &#34;Approved&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        }
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    ]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>kubectl patch clusterapprovalrequests example-run-canary --type<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;merge&#39;</span> --subresource<span style=color:#ce5c00;font-weight:700>=</span>status --patch-file approval.json
</span></span></code></pre></div><p>Then verify it&rsquo;s approved:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get clusterapprovalrequest
</span></span><span style=display:flex><span>NAME                 UPDATE-RUN    STAGE    APPROVED   APPROVALACCEPTED   AGE
</span></span><span style=display:flex><span>example-run-canary   example-run   canary   True       True               2m30s
</span></span></code></pre></div><p>The updateRun now is able to proceed and complete:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get crsur example-run
</span></span><span style=display:flex><span>NAME          PLACEMENT           RESOURCE-SNAPSHOT   POLICY-SNAPSHOT   INITIALIZED   SUCCEEDED   AGE
</span></span><span style=display:flex><span>example-run   example-placement   <span style=color:#0000cf;font-weight:700>1</span>                   <span style=color:#0000cf;font-weight:700>0</span>                 True          True        4m22s
</span></span></code></pre></div><p>The CRP also shows rollout has completed and resources are available on all member clusters:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get crp example-placement
</span></span><span style=display:flex><span>NAME                GEN   SCHEDULED   SCHEDULED-GEN   AVAILABLE   AVAILABLE-GEN   AGE
</span></span><span style=display:flex><span>example-placement   <span style=color:#0000cf;font-weight:700>1</span>     True        <span style=color:#0000cf;font-weight:700>1</span>               True        <span style=color:#0000cf;font-weight:700>1</span>               134m
</span></span></code></pre></div><p>The configmap <code>test-cm</code> should be deployed on all 3 member clusters, with latest data:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=deploy-a-second-clusterstagedupdaterun-to-rollback-to-a-previous-version>Deploy a second ClusterStagedUpdateRun to rollback to a previous version</h2><p>Now suppose the workload admin wants to rollback the configmap change, reverting the value <code>value2</code> back to <code>value1</code>.
Instead of manually updating the configmap from hub, they can create a new <code>ClusterStagedUpdateRun</code> with a previous resource snapshot index, &ldquo;0&rdquo; in our context and they can reuse the same strategy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f - <span style=color:#4e9a06>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ClusterStagedUpdateRun
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: example-run-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  placementName: example-placement
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  resourceSnapshotIndex: &#34;0&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  stagedRolloutStrategyName: example-strategy
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>Following the same step as <a href=/website/docs/how-tos/staged-update/#deploy-a-clusterstagedupdaterun-to-rollout-latest-change>deploying the first updateRun</a>, the second updateRun should succeed also. Complete status shown as below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterStagedUpdateRun</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run-2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSnapshotIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stagedRolloutStrategyName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-strategy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterStagedUpdateRun initialized successfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>UpdateRunInitializedSuccessfully</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Initialized</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>UpdateRunStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>UpdateRunSucceeded</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># updateRun succeeded </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Succeeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>deletionStageStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StageUpdatingStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StageUpdatingSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># no clusters in the deletion stage, it completes directly</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Succeeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>endTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>stageName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubernetes-fleet.io/deleteStage</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>startTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policyObservedClusterCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policySnapshotIndexUsed</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stagedUpdateStrategySnapshot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>stages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>afterStageTasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TimedWait</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>waitTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1m0s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>staging</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>staging</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>afterStageTasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Approval</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>sortingLabelKey</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>order</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stagesStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>afterStageTaskStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AfterStageTaskWaitTimeElapsed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WaitTimeElapsed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TimedWait</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>member2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Started</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Succeeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StageUpdatingWaiting</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StageUpdatingSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Succeeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>endTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>stageName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>staging</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>startTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>afterStageTaskStatus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>approvalRequestName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run-2-canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AfterStageTaskApprovalRequestCreated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApprovalRequestCreated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AfterStageTaskApprovalRequestApproved</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApprovalRequestApproved</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Approval</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>member3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Started</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Succeeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>member1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingStarted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Started</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterUpdatingSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Succeeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StageUpdatingWaiting</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Progressing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StageUpdatingSucceeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Succeeded</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>endTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>stageName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>startTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The configmap <code>test-cm</code> should be updated on all 3 member clusters, with old data:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-3d9472b6f83afdc50046a1c5ab64a789>3.14 - Evicting Resources and Setting up Disruption Budgets</h1><div class=lead>How to evict resources from a cluster and set up disruption budgets to protect against untimely evictions</div><p>This how-to guide discusses how to create <code>ClusterResourcePlacementEviction</code> objects and <code>ClusterResourcePlacementDisruptionBudget</code> objects to evict resources from member clusters and protect resources on member clusters from voluntary disruption, respectively.</p><h2 id=evicting-resources-from-member-clusters-using-clusterresourceplacementeviction>Evicting Resources from Member Clusters using ClusterResourcePlacementEviction</h2><p>The <code>ClusterResourcePlacementEviction</code> object is used to remove resources from a member cluster once the resources have already been propagated from the hub cluster.</p><p>To successfully evict resources from a cluster, the user needs to specify:</p><ul><li>The name of the <code>ClusterResourcePlacement</code> object which propagated resources to the target cluster.</li><li>The name of the target cluster from which we need to evict resources.</li></ul><p>In this example, we will create a <code>ClusterResourcePlacement</code> object with PickAll placement policy to propagate resources to an existing <code>MemberCluster</code>, add a taint to the member cluster
resource and then create a <code>ClusterResourcePlacementEviction</code> object to evict resources from the <code>MemberCluster</code>.</p><p>We will first create a namespace that we will propagate to the member cluster.</p><pre tabindex=0><code>kubectl create ns test-ns
</code></pre><p>Then we will apply a <code>ClusterResourcePlacement</code> with the following spec:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>CRP</code> status after applying should look something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>kubectl get crp test-crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>NAME       GEN   SCHEDULED   SCHEDULED-GEN   AVAILABLE   AVAILABLE-GEN   AGE</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>test-crp   2     True        2               True        2               5m49s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>let&rsquo;s now add a taint to the member cluster to ensure this cluster is not picked again by the scheduler once we evict resources from it.</p><p>Modify the cluster object to add a taint:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>heartbeatPeriodSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>60</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>identity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceAccount</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fleet-member-agent-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fleet-system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>taints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>effect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSchedule</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-key</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-value</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Now we will create a <code>ClusterResourcePlacementEviction</code> object to evict resources from the member cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementEviction</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-eviction</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>the eviction object should look like this, if the eviction was successful:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>kubectl get crpe test-eviction</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>NAME            VALID   EXECUTED</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>test-eviction   True    True</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>since the eviction is successful, the resources should be removed from the cluster, let&rsquo;s take a look at the <code>CRP</code> object status to verify:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>kubectl get crp test-crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>NAME       GEN   SCHEDULED   SCHEDULED-GEN   AVAILABLE   AVAILABLE-GEN   AGE</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>test-crp   2     True        2                                           15m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>from the object we can clearly tell that the resources were evicted since the <code>AVAILABLE</code> column is empty. If the user needs more information <code>ClusterResourcePlacement</code> object&rsquo;s status can be checked.</p><h2 id=protecting-resources-from-voluntary-disruptions-using-clusterresourceplacementdisruptionbudget>Protecting resources from voluntary disruptions using ClusterResourcePlacementDisruptionBudget</h2><p>In this example, we will create a <code>ClusterResourcePlacement</code> object with PickN placement policy to propagate resources to an existing MemberCluster,
then create a <code>ClusterResourcePlacementDisruptionBudget</code> object to protect resources on the MemberCluster from voluntary disruption and
then try to evict resources from the MemberCluster using <code>ClusterResourcePlacementEviction</code>.</p><p>We will first create a namespace that we will propagate to the member cluster.</p><pre tabindex=0><code>kubectl create ns test-ns
</code></pre><p>Then we will apply a <code>ClusterResourcePlacement</code> with the following spec:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickN</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>numberOfClusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The <code>CRP</code> object after applying should look something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>kubectl get crp test-crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>NAME       GEN   SCHEDULED   SCHEDULED-GEN   AVAILABLE   AVAILABLE-GEN   AGE</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>test-crp   2     True        2               True        2               8s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Now we will create a <code>ClusterResourcePlacementDisruptionBudget</code> object to protect resources on the member cluster from voluntary disruption:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementDisruptionBudget</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>minAvailable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><blockquote><p><strong>Note:</strong> An eviction object is only reconciled once, after which it reaches a terminal state, if the user desires to create/apply the same eviction object again they need to delete the existing eviction object and re-create the object for the eviction to occur again.</p></blockquote><p>Now we will create a <code>ClusterResourcePlacementEviction</code> object to evict resources from the member cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementEviction</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-eviction</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-crp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind-cluster-1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><blockquote><p><strong>Note:</strong> The eviction controller will try to get the corresponding <code>ClusterResourcePlacementDisruptionBudget</code> object when a <code>ClusterResourcePlacementEviction</code> object is reconciled to check if the specified MaxAvailable or MinAvailable allows the eviction to be executed.</p></blockquote><p>let&rsquo;s take a look at the eviction object to see if the eviction was executed,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>kubectl get crpe test-eviction</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>NAME            VALID   EXECUTED</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>test-eviction   True    False</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>from the eviction object we can see the eviction was not executed.</p><p>let&rsquo;s take a look at the <code>ClusterResourcePlacementEviction</code> object status to verify why the eviction was not executed:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>conditions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2025-01-21T15:52:29Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Eviction is valid</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementEvictionValid</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;True&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Valid</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>lastTransitionTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2025-01-21T15:52:29Z&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>message</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;Eviction is blocked by specified ClusterResourcePlacementDisruptionBudget,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      availablePlacements: 1, totalPlacements: 1&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>observedGeneration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>reason</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacementEvictionNotExecuted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;False&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Executed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>the eviction status clearly mentions that the eviction was blocked by the specified <code>ClusterResourcePlacementDisruptionBudget</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4588103fb9a692533044ee756a5f863f>4 - Frequently Asked Questions</h1><div class=lead>Frequently Asked Questions about Fleet</div><h2 id=what-are-fleet-owned-resources-on-the-hub-and-member-clusters-can-these-fleet-owned-resources-be-modified-by-the-user>What are fleet-owned resources on the hub and member clusters? Can these fleet-owned resources be modified by the user?</h2><p>Majority of the <code>internal</code> resources and fleet reserved namespaces described below are safeguarded by a series of validating webhooks, serving as a preventive measure to restrict users from making modifications to them.</p><p>The fleet reserved namespace are <code>fleet-system</code> and <code>fleet-member-{clusterName}</code> where clusterName is the name of each member cluster that has joined the fleet.</p><ul><li><p>Fleet hub cluster internal resources:</p><table><thead><tr><th>Resource</th></tr></thead><tbody><tr><td><code>InternalMemberCluster</code></td></tr><tr><td><code>Work</code></td></tr><tr><td><code>ClusterResourceSnapshot</code></td></tr><tr><td><code>ClusterSchedulingPolicySnapshot</code></td></tr><tr><td><code>ClusterResourceBinding</code></td></tr></tbody></table></li><li><p>Fleet member cluster internal resources:</p><table><thead><tr><th>Resource</th></tr></thead><tbody><tr><td><code>InternalMemberCluster</code></td></tr><tr><td><code>AppliedWork</code></td></tr></tbody></table></li></ul><p><strong>Fleet APIs</strong> are defined <a href=https://github.com/Azure/fleet/tree/main/apis>here</a>, <strong>Fleet CRDs</strong> are defined <a href=https://github.com/Azure/fleet/tree/main/config/crd/bases>here</a>.</p><ul><li>Fleet Networking hub cluster internal resources:<table><thead><tr><th>Resource</th></tr></thead><tbody><tr><td><code>EndpointSliceExport</code></td></tr><tr><td><code>EndpointSliceImport</code></td></tr><tr><td><code>InternalServiceExport</code></td></tr><tr><td><code>InternalServiceImport</code></td></tr><tr><td><code>ServiceImport</code></td></tr></tbody></table></li></ul><p><strong>Fleet Networking APIs</strong> are defined <a href=https://github.com/Azure/fleet-networking/tree/main/api/v1alpha1>here</a>, <strong>Fleet Networking CRDs</strong> are defined <a href=https://github.com/Azure/fleet-networking/tree/main/config/crd/bases>here</a>.</p><h2 id=what-kind-of-the-resources-are-allowed-to-be-propagated-from-the-hub-cluster-to-the-member-clusters-how-can-i-control-the-list>What kind of the resources are allowed to be propagated from the hub cluster to the member clusters? How can I control the list?</h2><p>The resources to be propagated from the hub cluster to the member clusters can be controlled by either an exclude/skip list or an include/allow list which are mutually exclusive.</p><p><code>ClusterResourcePlacement</code> excludes certain groups/resources when propagating the resources by default. They are defined <a href=https://github.com/Azure/fleet/blob/main/pkg/utils/apiresources.go>here</a>.</p><ul><li><code>k8s.io/api/events/v1</code> (group)</li><li><code>k8s.io/api/coordination/v1</code> (group)</li><li><code>k8s.io/metrics/pkg/apis/metrics/v1beta1</code> (group)</li><li><code>k8s.io/api/core/v1</code> (pod, node)</li><li><code>networking.fleet.azure.com</code> (service import resource)</li><li>any resources in the &ldquo;default&rdquo; namespace</li></ul><p>You can use <code>skipped-propagating-apis</code> and <code>skipped-propagating-namespaces</code> flag when installing the hub-agent to skip resources from being propagated by specifying their group/group-version/group-version-kind and namespaces.</p><p>You can use <code>allowed-propagating-apis</code> flag on the hub-agent to only allow propagation of desired set of resources specified in the form of group/group-version/group-version-kind. This flag is mutually exclusive with <code>skipped-propagating-apis</code>.</p><h2 id=what-happens-to-existing-resources-in-member-clusters-when-their-definitions-conflict-with-the-desired-resources-in-the-hub-cluster>What happens to existing resources in member clusters when their definitions conflict with the desired resources in the hub cluster?</h2><p>In case of a conflict, where a resource already exists on the member cluster, the apply operation fails when trying to propagate the same resource from the hub cluster.</p><h2 id=what-happens-if-modifies-resources-that-were-placed-from-hub-to-member-clusters>What happens if modifies resources that were placed from hub to member clusters?</h2><p>Possible scenarios:</p><ul><li>If the user <code>updates</code> the resource on the hub cluster, the update is propagated to all member clusters where the resource exists.</li><li>If the user <code>deletes</code> the resource on the hub cluster, the resource is deleted on all clusters to which it was propagated.</li><li>If the user <code>updates</code> the resource on the member cluster, no automatic action occurs as it&rsquo;s a user-made modification.</li><li>If the user <code>deletes</code> the resource on the member cluster, the resource is automatically created again on the member cluster after reconciliation.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b5568d681972077a2a3f45e40a59d61a>5 - API Reference</h1><div class=lead>Reference for Fleet APIs</div><h2 id=packages>Packages</h2><ul><li><a href=/website/docs/api-reference/#clusterkubernetes-fleetiov1>cluster.kubernetes-fleet.io/v1</a></li><li><a href=/website/docs/api-reference/#clusterkubernetes-fleetiov1beta1>cluster.kubernetes-fleet.io/v1beta1</a></li><li><a href=/website/docs/api-reference/#placementkubernetes-fleetiov1>placement.kubernetes-fleet.io/v1</a></li><li><a href=/website/docs/api-reference/#placementkubernetes-fleetiov1alpha1>placement.kubernetes-fleet.io/v1alpha1</a></li><li><a href=/website/docs/api-reference/#placementkubernetes-fleetiov1beta1>placement.kubernetes-fleet.io/v1beta1</a></li></ul><h2 id=clusterkubernetes-fleetiov1>cluster.kubernetes-fleet.io/v1</h2><h3 id=resource-types>Resource Types</h3><ul><li><a href=/website/docs/api-reference/#internalmembercluster>InternalMemberCluster</a></li><li><a href=/website/docs/api-reference/#internalmemberclusterlist>InternalMemberClusterList</a></li><li><a href=/website/docs/api-reference/#membercluster>MemberCluster</a></li><li><a href=/website/docs/api-reference/#memberclusterlist>MemberClusterList</a></li></ul><h4 id=agentstatus>AgentStatus</h4><p>AgentStatus defines the observed status of the member agent of the given type.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterstatus>InternalMemberClusterStatus</a></li><li><a href=/website/docs/api-reference/#memberclusterstatus>MemberClusterStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#agenttype>AgentType</a></em></td><td>Type of the member agent.</td><td></td><td></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for the member agent.</td><td></td><td></td></tr><tr><td><code>lastReceivedHeartbeat</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>Last time we received a heartbeat from the member agent.</td><td></td><td></td></tr></tbody></table><h4 id=agenttype>AgentType</h4><p><em>Underlying type:</em> <em>string</em></p><p>AgentType defines a type of agent/binary running in a member cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#agentstatus>AgentStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>MemberAgent</code></td><td>MemberAgent (core) handles member cluster joining/leaving as well as k8s object placement from hub to member clusters.<br></td></tr><tr><td><code>MultiClusterServiceAgent</code></td><td>MultiClusterServiceAgent (networking) is responsible for exposing multi-cluster services via L4 load<br>balancer.<br></td></tr><tr><td><code>ServiceExportImportAgent</code></td><td>ServiceExportImportAgent (networking) is responsible for export or import services across multi-clusters.<br></td></tr></tbody></table><h4 id=clusterstate>ClusterState</h4><p><em>Underlying type:</em> <em>string</em></p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterspec>InternalMemberClusterSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>Join</code></td><td></td></tr><tr><td><code>Leave</code></td><td></td></tr></tbody></table><h4 id=internalmembercluster>InternalMemberCluster</h4><p>InternalMemberCluster is used by hub agent to notify the member agents about the member cluster state changes, and is used by the member agents to report their status.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterlist>InternalMemberClusterList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>cluster.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>InternalMemberCluster</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#internalmemberclusterspec>InternalMemberClusterSpec</a></em></td><td>The desired state of InternalMemberCluster.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#internalmemberclusterstatus>InternalMemberClusterStatus</a></em></td><td>The observed status of InternalMemberCluster.</td><td></td><td></td></tr></tbody></table><h4 id=internalmemberclusterlist>InternalMemberClusterList</h4><p>InternalMemberClusterList contains a list of InternalMemberCluster.</p><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>cluster.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>InternalMemberClusterList</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#listmeta-v1-meta>ListMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>items</code> <em><a href=/website/docs/api-reference/#internalmembercluster>InternalMemberCluster</a> array</em></td><td></td><td></td><td></td></tr></tbody></table><h4 id=internalmemberclusterspec>InternalMemberClusterSpec</h4><p>InternalMemberClusterSpec defines the desired state of InternalMemberCluster. Set by the hub agent.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmembercluster>InternalMemberCluster</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>state</code> <em><a href=/website/docs/api-reference/#clusterstate>ClusterState</a></em></td><td>The desired state of the member cluster. Possible values: Join, Leave.</td><td></td><td></td></tr><tr><td><code>heartbeatPeriodSeconds</code> <em>integer</em></td><td>How often (in seconds) for the member cluster to send a heartbeat to the hub cluster. Default: 60 seconds. Min: 1 second. Max: 10 minutes.</td><td>60</td><td>Maximum: 600<br>Minimum: 1<br></td></tr></tbody></table><h4 id=internalmemberclusterstatus>InternalMemberClusterStatus</h4><p>InternalMemberClusterStatus defines the observed state of InternalMemberCluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmembercluster>InternalMemberCluster</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for the member cluster.</td><td></td><td></td></tr><tr><td><code>properties</code> <em>object (keys:<a href=/website/docs/api-reference/#propertyname>PropertyName</a>, values:<a href=/website/docs/api-reference/#propertyvalue>PropertyValue</a>)</em></td><td>Properties is an array of properties observed for the member cluster.<br><br>This field is beta-level; it is for the property-based scheduling feature and is only<br>populated when a property provider is enabled in the deployment.</td><td></td><td></td></tr><tr><td><code>resourceUsage</code> <em><a href=/website/docs/api-reference/#resourceusage>ResourceUsage</a></em></td><td>The current observed resource usage of the member cluster. It is populated by the member agent.</td><td></td><td></td></tr><tr><td><code>agentStatus</code> <em><a href=/website/docs/api-reference/#agentstatus>AgentStatus</a> array</em></td><td>AgentStatus is an array of current observed status, each corresponding to one member agent running in the member cluster.</td><td></td><td></td></tr></tbody></table><h4 id=membercluster>MemberCluster</h4><p>MemberCluster is a resource created in the hub cluster to represent a member cluster within a fleet.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#memberclusterlist>MemberClusterList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>cluster.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>MemberCluster</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#memberclusterspec>MemberClusterSpec</a></em></td><td>The desired state of MemberCluster.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#memberclusterstatus>MemberClusterStatus</a></em></td><td>The observed status of MemberCluster.</td><td></td><td></td></tr></tbody></table><h4 id=memberclusterlist>MemberClusterList</h4><p>MemberClusterList contains a list of MemberCluster.</p><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>cluster.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>MemberClusterList</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#listmeta-v1-meta>ListMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>items</code> <em><a href=/website/docs/api-reference/#membercluster>MemberCluster</a> array</em></td><td></td><td></td><td></td></tr></tbody></table><h4 id=memberclusterspec>MemberClusterSpec</h4><p>MemberClusterSpec defines the desired state of MemberCluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#membercluster>MemberCluster</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>identity</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#subject-v1-rbac>Subject</a></em></td><td>The identity used by the member cluster to access the hub cluster.<br>The hub agents deployed on the hub cluster will automatically grant the minimal required permissions to this identity for the member agents deployed on the member cluster to access the hub cluster.</td><td></td><td></td></tr><tr><td><code>heartbeatPeriodSeconds</code> <em>integer</em></td><td>How often (in seconds) for the member cluster to send a heartbeat to the hub cluster. Default: 60 seconds. Min: 1 second. Max: 10 minutes.</td><td>60</td><td>Maximum: 600<br>Minimum: 1<br></td></tr><tr><td><code>taints</code> <em><a href=/website/docs/api-reference/#taint>Taint</a> array</em></td><td>If specified, the MemberCluster&rsquo;s taints.<br><br>This field is beta-level and is for the taints and tolerations feature.</td><td></td><td>MaxItems: 100<br></td></tr></tbody></table><h4 id=memberclusterstatus>MemberClusterStatus</h4><p>MemberClusterStatus defines the observed status of MemberCluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#membercluster>MemberCluster</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for the member cluster.</td><td></td><td></td></tr><tr><td><code>properties</code> <em>object (keys:<a href=/website/docs/api-reference/#propertyname>PropertyName</a>, values:<a href=/website/docs/api-reference/#propertyvalue>PropertyValue</a>)</em></td><td>Properties is an array of properties observed for the member cluster.<br><br>This field is beta-level; it is for the property-based scheduling feature and is only<br>populated when a property provider is enabled in the deployment.</td><td></td><td></td></tr><tr><td><code>resourceUsage</code> <em><a href=/website/docs/api-reference/#resourceusage>ResourceUsage</a></em></td><td>The current observed resource usage of the member cluster. It is copied from the corresponding InternalMemberCluster object.</td><td></td><td></td></tr><tr><td><code>agentStatus</code> <em><a href=/website/docs/api-reference/#agentstatus>AgentStatus</a> array</em></td><td>AgentStatus is an array of current observed status, each corresponding to one member agent running in the member cluster.</td><td></td><td></td></tr></tbody></table><h4 id=propertyname>PropertyName</h4><p><em>Underlying type:</em> <em>string</em></p><p>PropertyName is the name of a cluster property; it should be a Kubernetes label name.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterstatus>InternalMemberClusterStatus</a></li><li><a href=/website/docs/api-reference/#memberclusterstatus>MemberClusterStatus</a></li></ul><h4 id=propertyvalue>PropertyValue</h4><p>PropertyValue is the value of a cluster property.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterstatus>InternalMemberClusterStatus</a></li><li><a href=/website/docs/api-reference/#memberclusterstatus>MemberClusterStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>value</code> <em>string</em></td><td>Value is the value of the cluster property.<br><br>Currently, it should be a valid Kubernetes quantity.<br>For more information, see<br><a href=https://pkg.go.dev/k8s.io/apimachinery/pkg/api/resource#Quantity>https://pkg.go.dev/k8s.io/apimachinery/pkg/api/resource#Quantity</a>.</td><td></td><td></td></tr><tr><td><code>observationTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>ObservationTime is when the cluster property is observed.</td><td></td><td></td></tr></tbody></table><h4 id=resourceusage>ResourceUsage</h4><p>ResourceUsage contains the observed resource usage of a member cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterstatus>InternalMemberClusterStatus</a></li><li><a href=/website/docs/api-reference/#memberclusterstatus>MemberClusterStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>capacity</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#resourcelist-v1-core>ResourceList</a></em></td><td>Capacity represents the total resource capacity of all the nodes on a member cluster.<br><br>A node&rsquo;s total capacity is the amount of resource installed on the node.</td><td></td><td></td></tr><tr><td><code>allocatable</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#resourcelist-v1-core>ResourceList</a></em></td><td>Allocatable represents the total allocatable resources of all the nodes on a member cluster.<br><br>A node&rsquo;s allocatable capacity is the amount of resource that can actually be used<br>for user workloads, i.e.,<br>allocatable capacity = total capacity - capacities reserved for the OS, kubelet, etc.<br><br>For more information, see<br><a href=https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/>https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/</a>.</td><td></td><td></td></tr><tr><td><code>available</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#resourcelist-v1-core>ResourceList</a></em></td><td>Available represents the total available resources of all the nodes on a member cluster.<br><br>A node&rsquo;s available capacity is the amount of resource that has not been used yet, i.e.,<br>available capacity = allocatable capacity - capacity that has been requested by workloads.<br><br>This field is beta-level; it is for the property-based scheduling feature and is only<br>populated when a property provider is enabled in the deployment.</td><td></td><td></td></tr><tr><td><code>observationTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>When the resource usage is observed.</td><td></td><td></td></tr></tbody></table><h4 id=taint>Taint</h4><p>Taint attached to MemberCluster has the &ldquo;effect&rdquo; on
any ClusterResourcePlacement that does not tolerate the Taint.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#memberclusterspec>MemberClusterSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>key</code> <em>string</em></td><td>The taint key to be applied to a MemberCluster.</td><td></td><td></td></tr><tr><td><code>value</code> <em>string</em></td><td>The taint value corresponding to the taint key.</td><td></td><td></td></tr><tr><td><code>effect</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#tainteffect-v1-core>TaintEffect</a></em></td><td>The effect of the taint on ClusterResourcePlacements that do not tolerate the taint.<br>Only NoSchedule is supported.</td><td></td><td>Enum: [NoSchedule]<br></td></tr></tbody></table><h2 id=clusterkubernetes-fleetiov1beta1>cluster.kubernetes-fleet.io/v1beta1</h2><h3 id=resource-types-1>Resource Types</h3><ul><li><a href=/website/docs/api-reference/#internalmembercluster>InternalMemberCluster</a></li><li><a href=/website/docs/api-reference/#internalmemberclusterlist>InternalMemberClusterList</a></li><li><a href=/website/docs/api-reference/#membercluster>MemberCluster</a></li><li><a href=/website/docs/api-reference/#memberclusterlist>MemberClusterList</a></li></ul><h4 id=agentstatus-1>AgentStatus</h4><p>AgentStatus defines the observed status of the member agent of the given type.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterstatus>InternalMemberClusterStatus</a></li><li><a href=/website/docs/api-reference/#memberclusterstatus>MemberClusterStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#agenttype>AgentType</a></em></td><td>Type of the member agent.</td><td></td><td></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for the member agent.</td><td></td><td></td></tr><tr><td><code>lastReceivedHeartbeat</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>Last time we received a heartbeat from the member agent.</td><td></td><td></td></tr></tbody></table><h4 id=agenttype-1>AgentType</h4><p><em>Underlying type:</em> <em>string</em></p><p>AgentType defines a type of agent/binary running in a member cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#agentstatus>AgentStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>MemberAgent</code></td><td>MemberAgent (core) handles member cluster joining/leaving as well as k8s object placement from hub to member clusters.<br></td></tr><tr><td><code>MultiClusterServiceAgent</code></td><td>MultiClusterServiceAgent (networking) is responsible for exposing multi-cluster services via L4 load<br>balancer.<br></td></tr><tr><td><code>ServiceExportImportAgent</code></td><td>ServiceExportImportAgent (networking) is responsible for export or import services across multi-clusters.<br></td></tr></tbody></table><h4 id=clusterstate-1>ClusterState</h4><p><em>Underlying type:</em> <em>string</em></p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterspec>InternalMemberClusterSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>Join</code></td><td></td></tr><tr><td><code>Leave</code></td><td></td></tr></tbody></table><h4 id=internalmembercluster-1>InternalMemberCluster</h4><p>InternalMemberCluster is used by hub agent to notify the member agents about the member cluster state changes, and is used by the member agents to report their status.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterlist>InternalMemberClusterList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>cluster.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>InternalMemberCluster</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#internalmemberclusterspec>InternalMemberClusterSpec</a></em></td><td>The desired state of InternalMemberCluster.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#internalmemberclusterstatus>InternalMemberClusterStatus</a></em></td><td>The observed status of InternalMemberCluster.</td><td></td><td></td></tr></tbody></table><h4 id=internalmemberclusterlist-1>InternalMemberClusterList</h4><p>InternalMemberClusterList contains a list of InternalMemberCluster.</p><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>cluster.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>InternalMemberClusterList</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#listmeta-v1-meta>ListMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>items</code> <em><a href=/website/docs/api-reference/#internalmembercluster>InternalMemberCluster</a> array</em></td><td></td><td></td><td></td></tr></tbody></table><h4 id=internalmemberclusterspec-1>InternalMemberClusterSpec</h4><p>InternalMemberClusterSpec defines the desired state of InternalMemberCluster. Set by the hub agent.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmembercluster>InternalMemberCluster</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>state</code> <em><a href=/website/docs/api-reference/#clusterstate>ClusterState</a></em></td><td>The desired state of the member cluster. Possible values: Join, Leave.</td><td></td><td></td></tr><tr><td><code>heartbeatPeriodSeconds</code> <em>integer</em></td><td>How often (in seconds) for the member cluster to send a heartbeat to the hub cluster. Default: 60 seconds. Min: 1 second. Max: 10 minutes.</td><td>60</td><td>Maximum: 600<br>Minimum: 1<br></td></tr></tbody></table><h4 id=internalmemberclusterstatus-1>InternalMemberClusterStatus</h4><p>InternalMemberClusterStatus defines the observed state of InternalMemberCluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmembercluster>InternalMemberCluster</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for the member cluster.</td><td></td><td></td></tr><tr><td><code>properties</code> <em>object (keys:<a href=/website/docs/api-reference/#propertyname>PropertyName</a>, values:<a href=/website/docs/api-reference/#propertyvalue>PropertyValue</a>)</em></td><td>Properties is an array of properties observed for the member cluster.<br><br>This field is beta-level; it is for the property-based scheduling feature and is only<br>populated when a property provider is enabled in the deployment.</td><td></td><td></td></tr><tr><td><code>resourceUsage</code> <em><a href=/website/docs/api-reference/#resourceusage>ResourceUsage</a></em></td><td>The current observed resource usage of the member cluster. It is populated by the member agent.</td><td></td><td></td></tr><tr><td><code>agentStatus</code> <em><a href=/website/docs/api-reference/#agentstatus>AgentStatus</a> array</em></td><td>AgentStatus is an array of current observed status, each corresponding to one member agent running in the member cluster.</td><td></td><td></td></tr></tbody></table><h4 id=membercluster-1>MemberCluster</h4><p>MemberCluster is a resource created in the hub cluster to represent a member cluster within a fleet.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#memberclusterlist>MemberClusterList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>cluster.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>MemberCluster</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#memberclusterspec>MemberClusterSpec</a></em></td><td>The desired state of MemberCluster.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#memberclusterstatus>MemberClusterStatus</a></em></td><td>The observed status of MemberCluster.</td><td></td><td></td></tr></tbody></table><h4 id=memberclusterlist-1>MemberClusterList</h4><p>MemberClusterList contains a list of MemberCluster.</p><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>cluster.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>MemberClusterList</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#listmeta-v1-meta>ListMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>items</code> <em><a href=/website/docs/api-reference/#membercluster>MemberCluster</a> array</em></td><td></td><td></td><td></td></tr></tbody></table><h4 id=memberclusterspec-1>MemberClusterSpec</h4><p>MemberClusterSpec defines the desired state of MemberCluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#membercluster>MemberCluster</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>identity</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#subject-v1-rbac>Subject</a></em></td><td>The identity used by the member cluster to access the hub cluster.<br>The hub agents deployed on the hub cluster will automatically grant the minimal required permissions to this identity for the member agents deployed on the member cluster to access the hub cluster.</td><td></td><td></td></tr><tr><td><code>heartbeatPeriodSeconds</code> <em>integer</em></td><td>How often (in seconds) for the member cluster to send a heartbeat to the hub cluster. Default: 60 seconds. Min: 1 second. Max: 10 minutes.</td><td>60</td><td>Maximum: 600<br>Minimum: 1<br></td></tr><tr><td><code>taints</code> <em><a href=/website/docs/api-reference/#taint>Taint</a> array</em></td><td>If specified, the MemberCluster&rsquo;s taints.<br><br>This field is beta-level and is for the taints and tolerations feature.</td><td></td><td>MaxItems: 100<br></td></tr></tbody></table><h4 id=memberclusterstatus-1>MemberClusterStatus</h4><p>MemberClusterStatus defines the observed status of MemberCluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#membercluster>MemberCluster</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for the member cluster.</td><td></td><td></td></tr><tr><td><code>properties</code> <em>object (keys:<a href=/website/docs/api-reference/#propertyname>PropertyName</a>, values:<a href=/website/docs/api-reference/#propertyvalue>PropertyValue</a>)</em></td><td>Properties is an array of properties observed for the member cluster.<br><br>This field is beta-level; it is for the property-based scheduling feature and is only<br>populated when a property provider is enabled in the deployment.</td><td></td><td></td></tr><tr><td><code>resourceUsage</code> <em><a href=/website/docs/api-reference/#resourceusage>ResourceUsage</a></em></td><td>The current observed resource usage of the member cluster. It is copied from the corresponding InternalMemberCluster object.</td><td></td><td></td></tr><tr><td><code>agentStatus</code> <em><a href=/website/docs/api-reference/#agentstatus>AgentStatus</a> array</em></td><td>AgentStatus is an array of current observed status, each corresponding to one member agent running in the member cluster.</td><td></td><td></td></tr></tbody></table><h4 id=propertyname-1>PropertyName</h4><p><em>Underlying type:</em> <em>string</em></p><p>PropertyName is the name of a cluster property; it should be a Kubernetes label name.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterstatus>InternalMemberClusterStatus</a></li><li><a href=/website/docs/api-reference/#memberclusterstatus>MemberClusterStatus</a></li></ul><h4 id=propertyvalue-1>PropertyValue</h4><p>PropertyValue is the value of a cluster property.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterstatus>InternalMemberClusterStatus</a></li><li><a href=/website/docs/api-reference/#memberclusterstatus>MemberClusterStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>value</code> <em>string</em></td><td>Value is the value of the cluster property.<br><br>Currently, it should be a valid Kubernetes quantity.<br>For more information, see<br><a href=https://pkg.go.dev/k8s.io/apimachinery/pkg/api/resource#Quantity>https://pkg.go.dev/k8s.io/apimachinery/pkg/api/resource#Quantity</a>.</td><td></td><td></td></tr><tr><td><code>observationTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>ObservationTime is when the cluster property is observed.</td><td></td><td></td></tr></tbody></table><h4 id=resourceusage-1>ResourceUsage</h4><p>ResourceUsage contains the observed resource usage of a member cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#internalmemberclusterstatus>InternalMemberClusterStatus</a></li><li><a href=/website/docs/api-reference/#memberclusterstatus>MemberClusterStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>capacity</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#resourcelist-v1-core>ResourceList</a></em></td><td>Capacity represents the total resource capacity of all the nodes on a member cluster.<br><br>A node&rsquo;s total capacity is the amount of resource installed on the node.</td><td></td><td></td></tr><tr><td><code>allocatable</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#resourcelist-v1-core>ResourceList</a></em></td><td>Allocatable represents the total allocatable resources of all the nodes on a member cluster.<br><br>A node&rsquo;s allocatable capacity is the amount of resource that can actually be used<br>for user workloads, i.e.,<br>allocatable capacity = total capacity - capacities reserved for the OS, kubelet, etc.<br><br>For more information, see<br><a href=https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/>https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/</a>.</td><td></td><td></td></tr><tr><td><code>available</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#resourcelist-v1-core>ResourceList</a></em></td><td>Available represents the total available resources of all the nodes on a member cluster.<br><br>A node&rsquo;s available capacity is the amount of resource that has not been used yet, i.e.,<br>available capacity = allocatable capacity - capacity that has been requested by workloads.<br><br>This field is beta-level; it is for the property-based scheduling feature and is only<br>populated when a property provider is enabled in the deployment.</td><td></td><td></td></tr><tr><td><code>observationTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>When the resource usage is observed.</td><td></td><td></td></tr></tbody></table><h4 id=taint-1>Taint</h4><p>Taint attached to MemberCluster has the &ldquo;effect&rdquo; on
any ClusterResourcePlacement that does not tolerate the Taint.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#memberclusterspec>MemberClusterSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>key</code> <em>string</em></td><td>The taint key to be applied to a MemberCluster.</td><td></td><td></td></tr><tr><td><code>value</code> <em>string</em></td><td>The taint value corresponding to the taint key.</td><td></td><td></td></tr><tr><td><code>effect</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#tainteffect-v1-core>TaintEffect</a></em></td><td>The effect of the taint on ClusterResourcePlacements that do not tolerate the taint.<br>Only NoSchedule is supported.</td><td></td><td>Enum: [NoSchedule]<br></td></tr></tbody></table><h2 id=placementkubernetes-fleetiov1>placement.kubernetes-fleet.io/v1</h2><h3 id=resource-types-2>Resource Types</h3><ul><li><a href=/website/docs/api-reference/#appliedwork>AppliedWork</a></li><li><a href=/website/docs/api-reference/#appliedworklist>AppliedWorkList</a></li><li><a href=/website/docs/api-reference/#clusterresourcebinding>ClusterResourceBinding</a></li><li><a href=/website/docs/api-reference/#clusterresourceplacement>ClusterResourcePlacement</a></li><li><a href=/website/docs/api-reference/#clusterresourcesnapshot>ClusterResourceSnapshot</a></li><li><a href=/website/docs/api-reference/#clusterschedulingpolicysnapshot>ClusterSchedulingPolicySnapshot</a></li><li><a href=/website/docs/api-reference/#work>Work</a></li><li><a href=/website/docs/api-reference/#worklist>WorkList</a></li></ul><h4 id=affinity>Affinity</h4><p>Affinity is a group of cluster affinity scheduling rules. More to be added.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterAffinity</code> <em><a href=/website/docs/api-reference/#clusteraffinity>ClusterAffinity</a></em></td><td>ClusterAffinity contains cluster affinity scheduling rules for the selected resources.</td><td></td><td></td></tr></tbody></table><h4 id=appliedresourcemeta>AppliedResourceMeta</h4><p>AppliedResourceMeta represents the group, version, resource, name and namespace of a resource.
Since these resources have been created, they must have valid group, version, resource, namespace, and name.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#appliedworkstatus>AppliedWorkStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>ordinal</code> <em>integer</em></td><td>Ordinal represents an index in manifests list, so the condition can still be linked<br>to a manifest even though manifest cannot be parsed successfully.</td><td></td><td></td></tr><tr><td><code>group</code> <em>string</em></td><td>Group is the group of the resource.</td><td></td><td></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version is the version of the resource.</td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind is the kind of the resource.</td><td></td><td></td></tr><tr><td><code>resource</code> <em>string</em></td><td>Resource is the resource type of the resource</td><td></td><td></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the resource, the resource is cluster scoped if the value<br>is empty</td><td></td><td></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name is the name of the resource</td><td></td><td></td></tr><tr><td><code>uid</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#uid-types-pkg>UID</a></em></td><td>UID is set on successful deletion of the Kubernetes resource by controller. The<br>resource might be still visible on the managed cluster after this field is set.<br>It is not directly settable by a client.</td><td></td><td></td></tr></tbody></table><h4 id=appliedwork>AppliedWork</h4><p>AppliedWork represents an applied work on managed cluster that is placed
on a managed cluster. An appliedwork links to a work on a hub recording resources
deployed in the managed cluster.
When the agent is removed from managed cluster, cluster-admin on managed cluster
can delete appliedwork to remove resources deployed by the agent.
The name of the appliedwork must be the same as {work name}
The namespace of the appliedwork should be the same as the resource applied on
the managed cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#appliedworklist>AppliedWorkList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>AppliedWork</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#appliedworkspec>AppliedWorkSpec</a></em></td><td>Spec represents the desired configuration of AppliedWork.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#appliedworkstatus>AppliedWorkStatus</a></em></td><td>Status represents the current status of AppliedWork.</td><td></td><td></td></tr></tbody></table><h4 id=appliedworklist>AppliedWorkList</h4><p>AppliedWorkList contains a list of AppliedWork.</p><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>AppliedWorkList</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#listmeta-v1-meta>ListMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>items</code> <em><a href=/website/docs/api-reference/#appliedwork>AppliedWork</a> array</em></td><td>List of works.</td><td></td><td></td></tr></tbody></table><h4 id=appliedworkspec>AppliedWorkSpec</h4><p>AppliedWorkSpec represents the desired configuration of AppliedWork.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#appliedwork>AppliedWork</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>workName</code> <em>string</em></td><td>WorkName represents the name of the related work on the hub.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>workNamespace</code> <em>string</em></td><td>WorkNamespace represents the namespace of the related work on the hub.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=appliedworkstatus>AppliedWorkStatus</h4><p>AppliedWorkStatus represents the current status of AppliedWork.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#appliedwork>AppliedWork</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>appliedResources</code> <em><a href=/website/docs/api-reference/#appliedresourcemeta>AppliedResourceMeta</a> array</em></td><td>AppliedResources represents a list of resources defined within the Work that are applied.<br>Only resources with valid GroupVersionResource, namespace, and name are suitable.<br>An item in this slice is deleted when there is no mapped manifest in Work.Spec or by finalizer.<br>The resource relating to the item will also be removed from managed cluster.<br>The deleted resource may still be present until the finalizers for that resource are finished.<br>However, the resource will not be undeleted, so it can be removed from this list and eventual consistency is preserved.</td><td></td><td></td></tr></tbody></table><h4 id=applystrategy>ApplyStrategy</h4><p>ApplyStrategy describes how to resolve the conflict if the resource to be placed already exists in the target cluster
and whether it&rsquo;s allowed to be co-owned by other non-fleet appliers.
Note: If multiple CRPs try to place the same resource with different apply strategy, the later ones will fail with the
reason ApplyConflictBetweenPlacements.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingspec>ResourceBindingSpec</a></li><li><a href=/website/docs/api-reference/#rolloutstrategy>RolloutStrategy</a></li><li><a href=/website/docs/api-reference/#workspec>WorkSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#applystrategytype>ApplyStrategyType</a></em></td><td>Type defines the type of strategy to use. Default to ClientSideApply.<br>Server-side apply is a safer choice. Read more about the differences between server-side apply and client-side<br>apply: <a href=https://kubernetes.io/docs/reference/using-api/server-side-apply/#comparison-with-client-side-apply>https://kubernetes.io/docs/reference/using-api/server-side-apply/#comparison-with-client-side-apply</a>.</td><td>ClientSideApply</td><td>Enum: [ClientSideApply ServerSideApply]<br></td></tr><tr><td><code>allowCoOwnership</code> <em>boolean</em></td><td>AllowCoOwnership defines whether to apply the resource if it already exists in the target cluster and is not<br>solely owned by fleet (i.e., metadata.ownerReferences contains only fleet custom resources).<br>If true, apply the resource and add fleet as a co-owner.<br>If false, leave the resource unchanged and fail the apply.</td><td></td><td></td></tr><tr><td><code>serverSideApplyConfig</code> <em><a href=/website/docs/api-reference/#serversideapplyconfig>ServerSideApplyConfig</a></em></td><td>ServerSideApplyConfig defines the configuration for server side apply. It is honored only when type is ServerSideApply.</td><td></td><td></td></tr></tbody></table><h4 id=applystrategytype>ApplyStrategyType</h4><p><em>Underlying type:</em> <em>string</em></p><p>ApplyStrategyType describes the type of the strategy used to resolve the conflict if the resource to be placed already
exists in the target cluster and is owned by other appliers.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>ClientSideApply</code></td><td>ApplyStrategyTypeClientSideApply will use three-way merge patch similar to how <code>kubectl apply</code> does by storing<br>last applied state in the <code>last-applied-configuration</code> annotation.<br>When the <code>last-applied-configuration</code> annotation size is greater than 256kB, it falls back to the server-side apply.<br></td></tr><tr><td><code>ServerSideApply</code></td><td>ApplyStrategyTypeServerSideApply will use server-side apply to resolve conflicts between the resource to be placed<br>and the existing resource in the target cluster.<br>Details: <a href=https://kubernetes.io/docs/reference/using-api/server-side-apply>https://kubernetes.io/docs/reference/using-api/server-side-apply</a><br></td></tr></tbody></table><h4 id=bindingstate>BindingState</h4><p><em>Underlying type:</em> <em>string</em></p><p>BindingState is the state of the binding.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingspec>ResourceBindingSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>Scheduled</code></td><td>BindingStateScheduled means the binding is scheduled but need to be bound to the target cluster.<br></td></tr><tr><td><code>Bound</code></td><td>BindingStateBound means the binding is bound to the target cluster.<br></td></tr><tr><td><code>Unscheduled</code></td><td>BindingStateUnscheduled means the binding is not scheduled on to the target cluster anymore.<br>This is a state that rollout controller cares about.<br>The work generator still treat this as bound until rollout controller deletes the binding.<br></td></tr></tbody></table><h4 id=clusteraffinity>ClusterAffinity</h4><p>ClusterAffinity contains cluster affinity scheduling rules for the selected resources.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#affinity>Affinity</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>requiredDuringSchedulingIgnoredDuringExecution</code> <em><a href=/website/docs/api-reference/#clusterselector>ClusterSelector</a></em></td><td>If the affinity requirements specified by this field are not met at<br>scheduling time, the resource will not be scheduled onto the cluster.<br>If the affinity requirements specified by this field cease to be met<br>at some point after the placement (e.g. due to an update), the system<br>may or may not try to eventually remove the resource from the cluster.</td><td></td><td></td></tr><tr><td><code>preferredDuringSchedulingIgnoredDuringExecution</code> <em><a href=/website/docs/api-reference/#preferredclusterselector>PreferredClusterSelector</a> array</em></td><td>The scheduler computes a score for each cluster at schedule time by iterating<br>through the elements of this field and adding &ldquo;weight&rdquo; to the sum if the cluster<br>matches the corresponding matchExpression. The scheduler then chooses the first<br><code>N</code> clusters with the highest sum to satisfy the placement.<br>This field is ignored if the placement type is &ldquo;PickAll&rdquo;.<br>If the cluster score changes at some point after the placement (e.g. due to an update),<br>the system may or may not try to eventually move the resource from a cluster with a lower score<br>to a cluster with higher score.</td><td></td><td></td></tr></tbody></table><h4 id=clusterdecision>ClusterDecision</h4><p>ClusterDecision represents a decision from a placement
An empty ClusterDecision indicates it is not scheduled yet.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingspec>ResourceBindingSpec</a></li><li><a href=/website/docs/api-reference/#schedulingpolicysnapshotstatus>SchedulingPolicySnapshotStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterName</code> <em>string</em></td><td>ClusterName is the name of the ManagedCluster. If it is not empty, its value should be unique cross all<br>placement decisions for the Placement.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>selected</code> <em>boolean</em></td><td>Selected indicates if this cluster is selected by the scheduler.</td><td></td><td></td></tr><tr><td><code>clusterScore</code> <em><a href=/website/docs/api-reference/#clusterscore>ClusterScore</a></em></td><td>ClusterScore represents the score of the cluster calculated by the scheduler.</td><td></td><td></td></tr><tr><td><code>reason</code> <em>string</em></td><td>Reason represents the reason why the cluster is selected or not.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourcebinding>ClusterResourceBinding</h4><p>ClusterResourceBinding represents a scheduling decision that binds a group of resources to a cluster.
It MUST have a label named <code>CRPTrackingLabel</code> that points to the cluster resource policy that creates it.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcebindinglist>ClusterResourceBindingList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourceBinding</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#resourcebindingspec>ResourceBindingSpec</a></em></td><td>The desired state of ClusterResourceBinding.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#resourcebindingstatus>ResourceBindingStatus</a></em></td><td>The observed status of ClusterResourceBinding.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceplacement>ClusterResourcePlacement</h4><p>ClusterResourcePlacement is used to select cluster scoped resources, including built-in resources and custom resources,
and placement them onto selected member clusters in a fleet.</p><p>If a namespace is selected, ALL the resources under the namespace are placed to the target clusters.
Note that you can&rsquo;t select the following resources:</p><ul><li>reserved namespaces including: default, kube-* (reserved for Kubernetes system namespaces),
fleet-* (reserved for fleet system namespaces).</li><li>reserved fleet resource types including: MemberCluster, InternalMemberCluster, ClusterResourcePlacement,
ClusterSchedulingPolicySnapshot, ClusterResourceSnapshot, ClusterResourceBinding, etc.</li></ul><p><code>ClusterSchedulingPolicySnapshot</code> and <code>ClusterResourceSnapshot</code> objects are created when there are changes in the
system to keep the history of the changes affecting a <code>ClusterResourcePlacement</code>.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementlist>ClusterResourcePlacementList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourcePlacement</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#clusterresourceplacementspec>ClusterResourcePlacementSpec</a></em></td><td>The desired state of ClusterResourcePlacement.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#clusterresourceplacementstatus>ClusterResourcePlacementStatus</a></em></td><td>The observed status of ClusterResourcePlacement.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceplacementspec>ClusterResourcePlacementSpec</h4><p>ClusterResourcePlacementSpec defines the desired state of ClusterResourcePlacement.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacement>ClusterResourcePlacement</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>resourceSelectors</code> <em><a href=/website/docs/api-reference/#clusterresourceselector>ClusterResourceSelector</a> array</em></td><td>ResourceSelectors is an array of selectors used to select cluster scoped resources. The selectors are <code>ORed</code>.<br>You can have 1-100 selectors.</td><td></td><td>MaxItems: 100<br>MinItems: 1<br></td></tr><tr><td><code>policy</code> <em><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></em></td><td>Policy defines how to select member clusters to place the selected resources.<br>If unspecified, all the joined member clusters are selected.</td><td></td><td></td></tr><tr><td><code>strategy</code> <em><a href=/website/docs/api-reference/#rolloutstrategy>RolloutStrategy</a></em></td><td>The rollout strategy to use to replace existing placement with new ones.</td><td></td><td></td></tr><tr><td><code>revisionHistoryLimit</code> <em>integer</em></td><td>The number of old ClusterSchedulingPolicySnapshot or ClusterResourceSnapshot resources to retain to allow rollback.<br>This is a pointer to distinguish between explicit zero and not specified.<br>Defaults to 10.</td><td>10</td><td>Maximum: 1000<br>Minimum: 1<br></td></tr></tbody></table><h4 id=clusterresourceplacementstatus>ClusterResourcePlacementStatus</h4><p>ClusterResourcePlacementStatus defines the observed state of the ClusterResourcePlacement object.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacement>ClusterResourcePlacement</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>selectedResources</code> <em><a href=/website/docs/api-reference/#resourceidentifier>ResourceIdentifier</a> array</em></td><td>SelectedResources contains a list of resources selected by ResourceSelectors.</td><td></td><td></td></tr><tr><td><code>observedResourceIndex</code> <em>string</em></td><td>Resource index logically represents the generation of the selected resources.<br>We take a new snapshot of the selected resources whenever the selection or their content change.<br>Each snapshot has a different resource index.<br>One resource snapshot can contain multiple clusterResourceSnapshots CRs in order to store large amount of resources.<br>To get clusterResourceSnapshot of a given resource index, use the following command:<br><code>kubectl get ClusterResourceSnapshot --selector=kubernetes-fleet.io/resource-index=$ObservedResourceIndex</code><br>ObservedResourceIndex is the resource index that the conditions in the ClusterResourcePlacementStatus observe.<br>For example, a condition of <code>ClusterResourcePlacementWorkSynchronized</code> type<br>is observing the synchronization status of the resource snapshot with the resource index $ObservedResourceIndex.</td><td></td><td></td></tr><tr><td><code>placementStatuses</code> <em><a href=/website/docs/api-reference/#resourceplacementstatus>ResourcePlacementStatus</a> array</em></td><td>PlacementStatuses contains a list of placement status on the clusters that are selected by PlacementPolicy.<br>Each selected cluster according to the latest resource placement is guaranteed to have a corresponding placementStatuses.<br>In the pickN case, there are N placement statuses where N = NumberOfClusters; Or in the pickFixed case, there are<br>N placement statuses where N = ClusterNames.<br>In these cases, some of them may not have assigned clusters when we cannot fill the required number of clusters.<br>TODO, For pickAll type, considering providing unselected clusters info.</td><td></td><td></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for ClusterResourcePlacement.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceselector>ClusterResourceSelector</h4><p>ClusterResourceSelector is used to select cluster scoped resources as the target resources to be placed.
If a namespace is selected, ALL the resources under the namespace are selected automatically.
All the fields are <code>ANDed</code>. In other words, a resource must match all the fields to be selected.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementspec>ClusterResourcePlacementSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>group</code> <em>string</em></td><td>Group name of the cluster-scoped resource.<br>Use an empty string to select resources under the core API group (e.g., namespaces).</td><td></td><td></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version of the cluster-scoped resource.</td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind of the cluster-scoped resource.<br>Note: When <code>Kind</code> is <code>namespace</code>, ALL the resources under the selected namespaces are selected.</td><td></td><td></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name of the cluster-scoped resource.</td><td></td><td></td></tr><tr><td><code>labelSelector</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#labelselector-v1-meta>LabelSelector</a></em></td><td>A label query over all the cluster-scoped resources. Resources matching the query are selected.<br>Note that namespace-scoped resources can&rsquo;t be selected even if they match the query.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourcesnapshot>ClusterResourceSnapshot</h4><p>ClusterResourceSnapshot is used to store a snapshot of selected resources by a resource placement policy.
Its spec is immutable.
We may need to produce more than one resourceSnapshot for all the resources a ResourcePlacement selected to get around the 1MB size limit of k8s objects.
We assign an ever-increasing index for each such group of resourceSnapshots.
The naming convention of a clusterResourceSnapshot is {CRPName}-{resourceIndex}-{subindex}
where the name of the first snapshot of a group has no subindex part so its name is {CRPName}-{resourceIndex}-snapshot.
resourceIndex will begin with 0.
Each snapshot MUST have the following labels:</p><ul><li><code>CRPTrackingLabel</code> which points to its owner CRP.</li><li><code>ResourceIndexLabel</code> which is the index of the snapshot group.</li><li><code>IsLatestSnapshotLabel</code> which indicates whether the snapshot is the latest one.</li></ul><p>All the snapshots within the same index group must have the same ResourceIndexLabel.</p><p>The first snapshot of the index group MUST have the following annotations:</p><ul><li><code>NumberOfResourceSnapshotsAnnotation</code> to store the total number of resource snapshots in the index group.</li><li><code>ResourceGroupHashAnnotation</code> whose value is the sha-256 hash of all the snapshots belong to the same snapshot index.</li></ul><p>Each snapshot (excluding the first snapshot) MUST have the following annotations:</p><ul><li><code>SubindexOfResourceSnapshotAnnotation</code> to store the subindex of resource snapshot in the group.</li></ul><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcesnapshotlist>ClusterResourceSnapshotList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourceSnapshot</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#resourcesnapshotspec>ResourceSnapshotSpec</a></em></td><td>The desired state of ResourceSnapshot.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#resourcesnapshotstatus>ResourceSnapshotStatus</a></em></td><td>The observed status of ResourceSnapshot.</td><td></td><td></td></tr></tbody></table><h4 id=clusterschedulingpolicysnapshot>ClusterSchedulingPolicySnapshot</h4><p>ClusterSchedulingPolicySnapshot is used to store a snapshot of cluster placement policy.
Its spec is immutable.
The naming convention of a ClusterSchedulingPolicySnapshot is {CRPName}-{PolicySnapshotIndex}.
PolicySnapshotIndex will begin with 0.
Each snapshot must have the following labels:</p><ul><li><code>CRPTrackingLabel</code> which points to its owner CRP.</li><li><code>PolicyIndexLabel</code> which is the index of the policy snapshot.</li><li><code>IsLatestSnapshotLabel</code> which indicates whether the snapshot is the latest one.</li></ul><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterschedulingpolicysnapshotlist>ClusterSchedulingPolicySnapshotList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterSchedulingPolicySnapshot</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#schedulingpolicysnapshotspec>SchedulingPolicySnapshotSpec</a></em></td><td>The desired state of SchedulingPolicySnapshot.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#schedulingpolicysnapshotstatus>SchedulingPolicySnapshotStatus</a></em></td><td>The observed status of SchedulingPolicySnapshot.</td><td></td><td></td></tr></tbody></table><h4 id=clusterscore>ClusterScore</h4><p>ClusterScore represents the score of the cluster calculated by the scheduler.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterdecision>ClusterDecision</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>affinityScore</code> <em>integer</em></td><td>AffinityScore represents the affinity score of the cluster calculated by the last<br>scheduling decision based on the preferred affinity selector.<br>An affinity score may not present if the cluster does not meet the required affinity.</td><td></td><td></td></tr><tr><td><code>priorityScore</code> <em>integer</em></td><td>TopologySpreadScore represents the priority score of the cluster calculated by the last<br>scheduling decision based on the topology spread applied to the cluster.<br>A priority score may not present if the cluster does not meet the topology spread.</td><td></td><td></td></tr></tbody></table><h4 id=clusterselector>ClusterSelector</h4><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusteraffinity>ClusterAffinity</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterSelectorTerms</code> <em><a href=/website/docs/api-reference/#clusterselectorterm>ClusterSelectorTerm</a> array</em></td><td>ClusterSelectorTerms is a list of cluster selector terms. The terms are <code>ORed</code>.</td><td></td><td>MaxItems: 10<br></td></tr></tbody></table><h4 id=clusterselectorterm>ClusterSelectorTerm</h4><p><em>Underlying type:</em> <em><a href=/website/docs/api-reference/#struct%7blabelselector-*k8sioapimachinerypkgapismetav1labelselector-%22json:%5c%22labelselector,omitempty%5c%22%22;-propertyselector-*propertyselector-%22json:%5c%22propertyselector,omitempty%5c%22%22;-propertysorter-*propertysorter-%22json:%5c%22propertysorter,omitempty%5c%22%22%7d>struct{LabelSelector *k8s.io/apimachinery/pkg/apis/meta/v1.LabelSelector &ldquo;json:"labelSelector,omitempty"&rdquo;; PropertySelector *PropertySelector &ldquo;json:"propertySelector,omitempty"&rdquo;; PropertySorter *PropertySorter &ldquo;json:"propertySorter,omitempty"&rdquo;}</a></em></p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#preferredclusterselector>PreferredClusterSelector</a></li></ul><h4 id=envelopeidentifier>EnvelopeIdentifier</h4><p>EnvelopeIdentifier identifies the envelope object that contains the selected resource.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#failedresourceplacement>FailedResourcePlacement</a></li><li><a href=/website/docs/api-reference/#resourceidentifier>ResourceIdentifier</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>name</code> <em>string</em></td><td>Name of the envelope object.</td><td></td><td></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the envelope object. Empty if the envelope object is cluster scoped.</td><td></td><td></td></tr><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#envelopetype>EnvelopeType</a></em></td><td>Type of the envelope object.</td><td>ConfigMap</td><td>Enum: [ConfigMap]<br></td></tr></tbody></table><h4 id=envelopetype>EnvelopeType</h4><p><em>Underlying type:</em> <em>string</em></p><p>EnvelopeType defines the type of the envelope object.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#envelopeidentifier>EnvelopeIdentifier</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>ConfigMap</code></td><td>ConfigMapEnvelopeType means the envelope object is of type <code>ConfigMap</code>.<br></td></tr></tbody></table><h4 id=failedresourceplacement>FailedResourcePlacement</h4><p>FailedResourcePlacement contains the failure details of a failed resource placement.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingstatus>ResourceBindingStatus</a></li><li><a href=/website/docs/api-reference/#resourceplacementstatus>ResourcePlacementStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>group</code> <em>string</em></td><td>Group is the group name of the selected resource.</td><td></td><td></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version is the version of the selected resource.</td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind represents the Kind of the selected resources.</td><td></td><td></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name of the target resource.</td><td></td><td></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the resource. Empty if the resource is cluster scoped.</td><td></td><td></td></tr><tr><td><code>envelope</code> <em><a href=/website/docs/api-reference/#envelopeidentifier>EnvelopeIdentifier</a></em></td><td>Envelope identifies the envelope object that contains this resource.</td><td></td><td></td></tr><tr><td><code>condition</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a></em></td><td>The failed condition status.</td><td></td><td></td></tr></tbody></table><h4 id=manifest>Manifest</h4><p>Manifest represents a resource to be deployed on spoke cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#workloadtemplate>WorkloadTemplate</a></li></ul><h4 id=manifestcondition>ManifestCondition</h4><p>ManifestCondition represents the conditions of the resources deployed on
spoke cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#workstatus>WorkStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>identifier</code> <em><a href=/website/docs/api-reference/#workresourceidentifier>WorkResourceIdentifier</a></em></td><td>resourceId represents a identity of a resource linking to manifests in spec.</td><td></td><td></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions represents the conditions of this resource on spoke cluster</td><td></td><td></td></tr></tbody></table><h4 id=namespacedname>NamespacedName</h4><p>NamespacedName comprises a resource name, with a mandatory namespace.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingspec>ResourceBindingSpec</a></li><li><a href=/website/docs/api-reference/#resourceplacementstatus>ResourcePlacementStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>name</code> <em>string</em></td><td>Name is the name of the namespaced scope resource.</td><td></td><td></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is namespace of the namespaced scope resource.</td><td></td><td></td></tr></tbody></table><h4 id=placementpolicy>PlacementPolicy</h4><p>PlacementPolicy contains the rules to select target member clusters to place the selected resources.
Note that only clusters that are both joined and satisfying the rules will be selected.</p><p>You can only specify at most one of the two fields: ClusterNames and Affinity.
If none is specified, all the joined clusters are selected.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementspec>ClusterResourcePlacementSpec</a></li><li><a href=/website/docs/api-reference/#schedulingpolicysnapshotspec>SchedulingPolicySnapshotSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>placementType</code> <em><a href=/website/docs/api-reference/#placementtype>PlacementType</a></em></td><td>Type of placement. Can be &ldquo;PickAll&rdquo;, &ldquo;PickN&rdquo; or &ldquo;PickFixed&rdquo;. Default is PickAll.</td><td>PickAll</td><td>Enum: [PickAll PickN PickFixed]<br></td></tr><tr><td><code>clusterNames</code> <em>string array</em></td><td>ClusterNames contains a list of names of MemberCluster to place the selected resources.<br>Only valid if the placement type is &ldquo;PickFixed&rdquo;</td><td></td><td>MaxItems: 100<br></td></tr><tr><td><code>numberOfClusters</code> <em>integer</em></td><td>NumberOfClusters of placement. Only valid if the placement type is &ldquo;PickN&rdquo;.</td><td></td><td>Minimum: 0<br></td></tr><tr><td><code>affinity</code> <em><a href=/website/docs/api-reference/#affinity>Affinity</a></em></td><td>Affinity contains cluster affinity scheduling rules. Defines which member clusters to place the selected resources.<br>Only valid if the placement type is &ldquo;PickAll&rdquo; or &ldquo;PickN&rdquo;.</td><td></td><td></td></tr><tr><td><code>topologySpreadConstraints</code> <em><a href=/website/docs/api-reference/#topologyspreadconstraint>TopologySpreadConstraint</a> array</em></td><td>TopologySpreadConstraints describes how a group of resources ought to spread across multiple topology<br>domains. Scheduler will schedule resources in a way which abides by the constraints.<br>All topologySpreadConstraints are ANDed.<br>Only valid if the placement type is &ldquo;PickN&rdquo;.</td><td></td><td></td></tr><tr><td><code>tolerations</code> <em><a href=/website/docs/api-reference/#toleration>Toleration</a> array</em></td><td>If specified, the ClusterResourcePlacement&rsquo;s Tolerations.<br>Tolerations cannot be updated or deleted.<br><br>This field is beta-level and is for the taints and tolerations feature.</td><td></td><td>MaxItems: 100<br></td></tr></tbody></table><h4 id=placementtype>PlacementType</h4><p><em>Underlying type:</em> <em>string</em></p><p>PlacementType identifies the type of placement.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>PickAll</code></td><td>PickAllPlacementType picks all clusters that satisfy the rules.<br></td></tr><tr><td><code>PickN</code></td><td>PickNPlacementType picks N clusters that satisfy the rules.<br></td></tr><tr><td><code>PickFixed</code></td><td>PickFixedPlacementType picks a fixed set of clusters.<br></td></tr></tbody></table><h4 id=preferredclusterselector>PreferredClusterSelector</h4><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusteraffinity>ClusterAffinity</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>weight</code> <em>integer</em></td><td>Weight associated with matching the corresponding clusterSelectorTerm, in the range [-100, 100].</td><td></td><td>Maximum: 100<br>Minimum: -100<br></td></tr><tr><td><code>preference</code> <em><a href=/website/docs/api-reference/#clusterselectorterm>ClusterSelectorTerm</a></em></td><td>A cluster selector term, associated with the corresponding weight.</td><td></td><td></td></tr></tbody></table><h4 id=propertyselectoroperator>PropertySelectorOperator</h4><p><em>Underlying type:</em> <em>string</em></p><p>PropertySelectorOperator is the operator that can be used with PropertySelectorRequirements.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#propertyselectorrequirement>PropertySelectorRequirement</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>Gt</code></td><td>PropertySelectorGreaterThan dictates Fleet to select cluster if its observed value of a given<br>property is greater than the value specified in the requirement.<br></td></tr><tr><td><code>Ge</code></td><td>PropertySelectorGreaterThanOrEqualTo dictates Fleet to select cluster if its observed value<br>of a given property is greater than or equal to the value specified in the requirement.<br></td></tr><tr><td><code>Eq</code></td><td>PropertySelectorEqualTo dictates Fleet to select cluster if its observed value of a given<br>property is equal to the values specified in the requirement.<br></td></tr><tr><td><code>Ne</code></td><td>PropertySelectorNotEqualTo dictates Fleet to select cluster if its observed value of a given<br>property is not equal to the values specified in the requirement.<br></td></tr><tr><td><code>Lt</code></td><td>PropertySelectorLessThan dictates Fleet to select cluster if its observed value of a given<br>property is less than the value specified in the requirement.<br></td></tr><tr><td><code>Le</code></td><td>PropertySelectorLessThanOrEqualTo dictates Fleet to select cluster if its observed value of a<br>given property is less than or equal to the value specified in the requirement.<br></td></tr></tbody></table><h4 id=propertyselectorrequirement>PropertySelectorRequirement</h4><p>PropertySelectorRequirement is a specific property requirement when picking clusters for
resource placement.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#propertyselector>PropertySelector</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>name</code> <em>string</em></td><td>Name is the name of the property; it should be a Kubernetes label name.</td><td></td><td></td></tr><tr><td><code>operator</code> <em><a href=/website/docs/api-reference/#propertyselectoroperator>PropertySelectorOperator</a></em></td><td>Operator specifies the relationship between a cluster&rsquo;s observed value of the specified<br>property and the values given in the requirement.</td><td></td><td></td></tr><tr><td><code>values</code> <em>string array</em></td><td>Values are a list of values of the specified property which Fleet will compare against<br>the observed values of individual member clusters in accordance with the given<br>operator.<br><br>At this moment, each value should be a Kubernetes quantity. For more information, see<br><a href=https://pkg.go.dev/k8s.io/apimachinery/pkg/api/resource#Quantity>https://pkg.go.dev/k8s.io/apimachinery/pkg/api/resource#Quantity</a>.<br><br>If the operator is Gt (greater than), Ge (greater than or equal to), Lt (less than),<br>or <code>Le</code> (less than or equal to), Eq (equal to), or Ne (ne), exactly one value must be<br>specified in the list.</td><td></td><td>MaxItems: 1<br></td></tr></tbody></table><h4 id=propertysortorder>PropertySortOrder</h4><p><em>Underlying type:</em> <em>string</em></p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#propertysorter>PropertySorter</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>Descending</code></td><td>Descending instructs Fleet to sort in descending order, that is, the clusters with higher<br>observed values of a property are most preferred and should have higher weights. We will<br>use linear scaling to calculate the weight for each cluster based on the observed values.<br>For example, with this order, if Fleet sorts all clusters by a specific property where the<br>observed values are in the range [10, 100], and a weight of 100 is specified;<br>Fleet will assign:<br>* a weight of 100 to the cluster with the maximum observed value (100); and<br>* a weight of 0 to the cluster with the minimum observed value (10); and<br>* a weight of 11 to the cluster with an observed value of 20.<br>It is calculated using the formula below:<br>((20 - 10)) / (100 - 10)) * 100 = 11<br></td></tr><tr><td><code>Ascending</code></td><td>Ascending instructs Fleet to sort in ascending order, that is, the clusters with lower<br>observed values are most preferred and should have higher weights. We will use linear scaling<br>to calculate the weight for each cluster based on the observed values.<br>For example, with this order, if Fleet sorts all clusters by a specific property where<br>the observed values are in the range [10, 100], and a weight of 100 is specified;<br>Fleet will assign:<br>* a weight of 0 to the cluster with the maximum observed value (100); and<br>* a weight of 100 to the cluster with the minimum observed value (10); and<br>* a weight of 89 to the cluster with an observed value of 20.<br>It is calculated using the formula below:<br>(1 - ((20 - 10) / (100 - 10))) * 100 = 89<br></td></tr></tbody></table><h4 id=resourcebindingspec>ResourceBindingSpec</h4><p>ResourceBindingSpec defines the desired state of ClusterResourceBinding.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcebinding>ClusterResourceBinding</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>state</code> <em><a href=/website/docs/api-reference/#bindingstate>BindingState</a></em></td><td>The desired state of the binding. Possible values: Scheduled, Bound, Unscheduled.</td><td></td><td></td></tr><tr><td><code>resourceSnapshotName</code> <em>string</em></td><td>ResourceSnapshotName is the name of the resource snapshot that this resource binding points to.<br>If the resources are divided into multiple snapshots because of the resource size limit,<br>it points to the name of the leading snapshot of the index group.</td><td></td><td></td></tr><tr><td><code>resourceOverrideSnapshots</code> <em><a href=/website/docs/api-reference/#namespacedname>NamespacedName</a> array</em></td><td>ResourceOverrideSnapshots is a list of ResourceOverride snapshots associated with the selected resources.</td><td></td><td></td></tr><tr><td><code>clusterResourceOverrideSnapshots</code> <em>string array</em></td><td>ClusterResourceOverrides contains a list of applicable ClusterResourceOverride snapshot names associated with the<br>selected resources.</td><td></td><td></td></tr><tr><td><code>schedulingPolicySnapshotName</code> <em>string</em></td><td>SchedulingPolicySnapshotName is the name of the scheduling policy snapshot that this resource binding<br>points to; more specifically, the scheduler creates this bindings in accordance with this<br>scheduling policy snapshot.</td><td></td><td></td></tr><tr><td><code>targetCluster</code> <em>string</em></td><td>TargetCluster is the name of the cluster that the scheduler assigns the resources to.</td><td></td><td></td></tr><tr><td><code>clusterDecision</code> <em><a href=/website/docs/api-reference/#clusterdecision>ClusterDecision</a></em></td><td>ClusterDecision explains why the scheduler selected this cluster.</td><td></td><td></td></tr><tr><td><code>applyStrategy</code> <em><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></em></td><td>ApplyStrategy describes how to resolve the conflict if the resource to be placed already exists in the target cluster<br>and is owned by other appliers.<br>This field is a beta-level feature.</td><td></td><td></td></tr></tbody></table><h4 id=resourcebindingstatus>ResourceBindingStatus</h4><p>ResourceBindingStatus represents the current status of a ClusterResourceBinding.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcebinding>ClusterResourceBinding</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>failedPlacements</code> <em><a href=/website/docs/api-reference/#failedresourceplacement>FailedResourcePlacement</a> array</em></td><td>FailedPlacements is a list of all the resources failed to be placed to the given cluster or the resource is unavailable.<br>Note that we only include 100 failed resource placements even if there are more than 100.</td><td></td><td>MaxItems: 100<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for ClusterResourceBinding.</td><td></td><td></td></tr></tbody></table><h4 id=resourcecontent>ResourceContent</h4><p>ResourceContent contains the content of a resource</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcesnapshotspec>ResourceSnapshotSpec</a></li></ul><h4 id=resourceidentifier>ResourceIdentifier</h4><p>ResourceIdentifier identifies one Kubernetes resource.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementstatus>ClusterResourcePlacementStatus</a></li><li><a href=/website/docs/api-reference/#failedresourceplacement>FailedResourcePlacement</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>group</code> <em>string</em></td><td>Group is the group name of the selected resource.</td><td></td><td></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version is the version of the selected resource.</td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind represents the Kind of the selected resources.</td><td></td><td></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name of the target resource.</td><td></td><td></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the resource. Empty if the resource is cluster scoped.</td><td></td><td></td></tr><tr><td><code>envelope</code> <em><a href=/website/docs/api-reference/#envelopeidentifier>EnvelopeIdentifier</a></em></td><td>Envelope identifies the envelope object that contains this resource.</td><td></td><td></td></tr></tbody></table><h4 id=resourceplacementstatus>ResourcePlacementStatus</h4><p>ResourcePlacementStatus represents the placement status of selected resources for one target cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementstatus>ClusterResourcePlacementStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterName</code> <em>string</em></td><td>ClusterName is the name of the cluster this resource is assigned to.<br>If it is not empty, its value should be unique cross all placement decisions for the Placement.</td><td></td><td></td></tr><tr><td><code>applicableResourceOverrides</code> <em><a href=/website/docs/api-reference/#namespacedname>NamespacedName</a> array</em></td><td>ApplicableResourceOverrides contains a list of applicable ResourceOverride snapshots associated with the selected<br>resources.<br><br>This field is alpha-level and is for the override policy feature.</td><td></td><td></td></tr><tr><td><code>applicableClusterResourceOverrides</code> <em>string array</em></td><td>ApplicableClusterResourceOverrides contains a list of applicable ClusterResourceOverride snapshots associated with<br>the selected resources.<br><br>This field is alpha-level and is for the override policy feature.</td><td></td><td></td></tr><tr><td><code>failedPlacements</code> <em><a href=/website/docs/api-reference/#failedresourceplacement>FailedResourcePlacement</a> array</em></td><td>FailedPlacements is a list of all the resources failed to be placed to the given cluster or the resource is unavailable.<br>Note that we only include 100 failed resource placements even if there are more than 100.<br>This field is only meaningful if the <code>ClusterName</code> is not empty.</td><td></td><td>MaxItems: 100<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for ResourcePlacementStatus.</td><td></td><td></td></tr></tbody></table><h4 id=resourcesnapshotspec>ResourceSnapshotSpec</h4><p>ResourceSnapshotSpec defines the desired state of ResourceSnapshot.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcesnapshot>ClusterResourceSnapshot</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>selectedResources</code> <em><a href=/website/docs/api-reference/#resourcecontent>ResourceContent</a> array</em></td><td>SelectedResources contains a list of resources selected by ResourceSelectors.</td><td></td><td></td></tr></tbody></table><h4 id=resourcesnapshotstatus>ResourceSnapshotStatus</h4><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcesnapshot>ClusterResourceSnapshot</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for ResourceSnapshot.</td><td></td><td></td></tr></tbody></table><h4 id=rollingupdateconfig>RollingUpdateConfig</h4><p>RollingUpdateConfig contains the config to control the desired behavior of rolling update.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#rolloutstrategy>RolloutStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>maxUnavailable</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#intorstring-intstr-util>IntOrString</a></em></td><td>The maximum number of clusters that can be unavailable during the rolling update<br>comparing to the desired number of clusters.<br>The desired number equals to the <code>NumberOfClusters</code> field when the placement type is <code>PickN</code>.<br>The desired number equals to the number of clusters scheduler selected when the placement type is <code>PickAll</code>.<br>Value can be an absolute number (ex: 5) or a percentage of the desired number of clusters (ex: 10%).<br>Absolute number is calculated from percentage by rounding up.<br>We consider a resource unavailable when we either remove it from a cluster or in-place<br>upgrade the resources content on the same cluster.<br>The minimum of MaxUnavailable is 0 to allow no downtime moving a placement from one cluster to another.<br>Please set it to be greater than 0 to avoid rolling out stuck during in-place resource update.<br>Defaults to 25%.</td><td>25%</td><td>Pattern: <code>^((100|[0-9]\{1,2\})%|[0-9]+)$</code><br>XIntOrString: {}<br></td></tr><tr><td><code>maxSurge</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#intorstring-intstr-util>IntOrString</a></em></td><td>The maximum number of clusters that can be scheduled above the desired number of clusters.<br>The desired number equals to the <code>NumberOfClusters</code> field when the placement type is <code>PickN</code>.<br>The desired number equals to the number of clusters scheduler selected when the placement type is <code>PickAll</code>.<br>Value can be an absolute number (ex: 5) or a percentage of desire (ex: 10%).<br>Absolute number is calculated from percentage by rounding up.<br>This does not apply to the case that we do in-place update of resources on the same cluster.<br>This can not be 0 if MaxUnavailable is 0.<br>Defaults to 25%.</td><td>25%</td><td>Pattern: <code>^((100|[0-9]\{1,2\})%|[0-9]+)$</code><br>XIntOrString: {}<br></td></tr><tr><td><code>unavailablePeriodSeconds</code> <em>integer</em></td><td>UnavailablePeriodSeconds is used to configure the waiting time between rollout phases when we<br>cannot determine if the resources have rolled out successfully or not.<br>We have a built-in resource state detector to determine the availability status of following well-known Kubernetes<br>native resources: Deployment, StatefulSet, DaemonSet, Service, Namespace, ConfigMap, Secret,<br>ClusterRole, ClusterRoleBinding, Role, RoleBinding.<br>Please see <a href=https://github.com/Azure/fleet/tree/main/docs/concepts/SafeRollout/README.md>SafeRollout</a> for more details.<br>For other types of resources, we consider them as available after <code>UnavailablePeriodSeconds</code> seconds<br>have passed since they were successfully applied to the target cluster.<br>Default is 60.</td><td>60</td><td></td></tr></tbody></table><h4 id=rolloutstrategy>RolloutStrategy</h4><p>RolloutStrategy describes how to roll out a new change in selected resources to target clusters.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementspec>ClusterResourcePlacementSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#rolloutstrategytype>RolloutStrategyType</a></em></td><td>Type of rollout. The only supported type is &ldquo;RollingUpdate&rdquo;. Default is &ldquo;RollingUpdate&rdquo;.</td><td>RollingUpdate</td><td>Enum: [RollingUpdate]<br></td></tr><tr><td><code>rollingUpdate</code> <em><a href=/website/docs/api-reference/#rollingupdateconfig>RollingUpdateConfig</a></em></td><td>Rolling update config params. Present only if RolloutStrategyType = RollingUpdate.</td><td></td><td></td></tr><tr><td><code>applyStrategy</code> <em><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></em></td><td>ApplyStrategy describes how to resolve the conflict if the resource to be placed already exists in the target cluster<br>and is owned by other appliers.<br>This field is a beta-level feature.</td><td></td><td></td></tr></tbody></table><h4 id=rolloutstrategytype>RolloutStrategyType</h4><p><em>Underlying type:</em> <em>string</em></p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#rolloutstrategy>RolloutStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>RollingUpdate</code></td><td>RollingUpdateRolloutStrategyType replaces the old placed resource using rolling update<br>i.e. gradually create the new one while replace the old ones.<br></td></tr></tbody></table><h4 id=schedulingpolicysnapshotspec>SchedulingPolicySnapshotSpec</h4><p>SchedulingPolicySnapshotSpec defines the desired state of SchedulingPolicySnapshot.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterschedulingpolicysnapshot>ClusterSchedulingPolicySnapshot</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>policy</code> <em><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></em></td><td>Policy defines how to select member clusters to place the selected resources.<br>If unspecified, all the joined member clusters are selected.</td><td></td><td></td></tr><tr><td><code>policyHash</code> <em>integer array</em></td><td>PolicyHash is the sha-256 hash value of the Policy field.</td><td></td><td></td></tr></tbody></table><h4 id=schedulingpolicysnapshotstatus>SchedulingPolicySnapshotStatus</h4><p>SchedulingPolicySnapshotStatus defines the observed state of SchedulingPolicySnapshot.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterschedulingpolicysnapshot>ClusterSchedulingPolicySnapshot</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>observedCRPGeneration</code> <em>integer</em></td><td>ObservedCRPGeneration is the generation of the CRP which the scheduler uses to perform<br>the scheduling cycle and prepare the scheduling status.</td><td></td><td></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for SchedulingPolicySnapshot.</td><td></td><td></td></tr><tr><td><code>targetClusters</code> <em><a href=/website/docs/api-reference/#clusterdecision>ClusterDecision</a> array</em></td><td>ClusterDecisions contains a list of names of member clusters considered by the scheduler.<br>Note that all the selected clusters must present in the list while not all the<br>member clusters are guaranteed to be listed due to the size limit. We will try to<br>add the clusters that can provide the most insight to the list first.</td><td></td><td>MaxItems: 1000<br></td></tr></tbody></table><h4 id=serversideapplyconfig>ServerSideApplyConfig</h4><p>ServerSideApplyConfig defines the configuration for server side apply.
Details: <a href=https://kubernetes.io/docs/reference/using-api/server-side-apply/#conflicts>https://kubernetes.io/docs/reference/using-api/server-side-apply/#conflicts</a></p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>force</code> <em>boolean</em></td><td>Force represents to force apply to succeed when resolving the conflicts<br>For any conflicting fields,<br>- If true, use the values from the resource to be applied to overwrite the values of the existing resource in the<br>target cluster, as well as take over ownership of such fields.<br>- If false, apply will fail with the reason ApplyConflictWithOtherApplier.<br><br>For non-conflicting fields, values stay unchanged and ownership are shared between appliers.</td><td></td><td></td></tr></tbody></table><h4 id=toleration>Toleration</h4><p>Toleration allows ClusterResourcePlacement to tolerate any taint that matches
the triple &lt;key,value,effect> using the matching operator <operator>.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>key</code> <em>string</em></td><td>Key is the taint key that the toleration applies to. Empty means match all taint keys.<br>If the key is empty, operator must be Exists; this combination means to match all values and all keys.</td><td></td><td></td></tr><tr><td><code>operator</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#tolerationoperator-v1-core>TolerationOperator</a></em></td><td>Operator represents a key&rsquo;s relationship to the value.<br>Valid operators are Exists and Equal. Defaults to Equal.<br>Exists is equivalent to wildcard for value, so that a<br>ClusterResourcePlacement can tolerate all taints of a particular category.</td><td>Equal</td><td>Enum: [Equal Exists]<br></td></tr><tr><td><code>value</code> <em>string</em></td><td>Value is the taint value the toleration matches to.<br>If the operator is Exists, the value should be empty, otherwise just a regular string.</td><td></td><td></td></tr><tr><td><code>effect</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#tainteffect-v1-core>TaintEffect</a></em></td><td>Effect indicates the taint effect to match. Empty means match all taint effects.<br>When specified, only allowed value is NoSchedule.</td><td></td><td>Enum: [NoSchedule]<br></td></tr></tbody></table><h4 id=topologyspreadconstraint>TopologySpreadConstraint</h4><p>TopologySpreadConstraint specifies how to spread resources among the given cluster topology.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>maxSkew</code> <em>integer</em></td><td>MaxSkew describes the degree to which resources may be unevenly distributed.<br>When <code>whenUnsatisfiable=DoNotSchedule</code>, it is the maximum permitted difference<br>between the number of resource copies in the target topology and the global minimum.<br>The global minimum is the minimum number of resource copies in a domain.<br>When <code>whenUnsatisfiable=ScheduleAnyway</code>, it is used to give higher precedence<br>to topologies that satisfy it.<br>It&rsquo;s an optional field. Default value is 1 and 0 is not allowed.</td><td>1</td><td>Minimum: 1<br></td></tr><tr><td><code>topologyKey</code> <em>string</em></td><td>TopologyKey is the key of cluster labels. Clusters that have a label with this key<br>and identical values are considered to be in the same topology.<br>We consider each &lt;key, value> as a &ldquo;bucket&rdquo;, and try to put balanced number<br>of replicas of the resource into each bucket honor the <code>MaxSkew</code> value.<br>It&rsquo;s a required field.</td><td></td><td></td></tr><tr><td><code>whenUnsatisfiable</code> <em><a href=/website/docs/api-reference/#unsatisfiableconstraintaction>UnsatisfiableConstraintAction</a></em></td><td>WhenUnsatisfiable indicates how to deal with the resource if it doesn&rsquo;t satisfy<br>the spread constraint.<br>- DoNotSchedule (default) tells the scheduler not to schedule it.<br>- ScheduleAnyway tells the scheduler to schedule the resource in any cluster,<br>but giving higher precedence to topologies that would help reduce the skew.<br>It&rsquo;s an optional field.</td><td></td><td></td></tr></tbody></table><h4 id=unsatisfiableconstraintaction>UnsatisfiableConstraintAction</h4><p><em>Underlying type:</em> <em>string</em></p><p>UnsatisfiableConstraintAction defines the type of actions that can be taken if a constraint is not satisfied.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#topologyspreadconstraint>TopologySpreadConstraint</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>DoNotSchedule</code></td><td>DoNotSchedule instructs the scheduler not to schedule the resource<br>onto the cluster when constraints are not satisfied.<br></td></tr><tr><td><code>ScheduleAnyway</code></td><td>ScheduleAnyway instructs the scheduler to schedule the resource<br>even if constraints are not satisfied.<br></td></tr></tbody></table><h4 id=work>Work</h4><p>Work is the Schema for the works API.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#worklist>WorkList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>Work</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#workspec>WorkSpec</a></em></td><td>spec defines the workload of a work.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#workstatus>WorkStatus</a></em></td><td>status defines the status of each applied manifest on the spoke cluster.</td><td></td><td></td></tr></tbody></table><h4 id=worklist>WorkList</h4><p>WorkList contains a list of Work.</p><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>WorkList</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#listmeta-v1-meta>ListMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>items</code> <em><a href=/website/docs/api-reference/#work>Work</a> array</em></td><td>List of works.</td><td></td><td></td></tr></tbody></table><h4 id=workresourceidentifier>WorkResourceIdentifier</h4><p>WorkResourceIdentifier provides the identifiers needed to interact with any arbitrary object.
Renamed original &ldquo;ResourceIdentifier&rdquo; so that it won&rsquo;t conflict with ResourceIdentifier defined in the clusterresourceplacement_types.go.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#appliedresourcemeta>AppliedResourceMeta</a></li><li><a href=/website/docs/api-reference/#manifestcondition>ManifestCondition</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>ordinal</code> <em>integer</em></td><td>Ordinal represents an index in manifests list, so the condition can still be linked<br>to a manifest even though manifest cannot be parsed successfully.</td><td></td><td></td></tr><tr><td><code>group</code> <em>string</em></td><td>Group is the group of the resource.</td><td></td><td></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version is the version of the resource.</td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind is the kind of the resource.</td><td></td><td></td></tr><tr><td><code>resource</code> <em>string</em></td><td>Resource is the resource type of the resource</td><td></td><td></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the resource, the resource is cluster scoped if the value<br>is empty</td><td></td><td></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name is the name of the resource</td><td></td><td></td></tr></tbody></table><h4 id=workspec>WorkSpec</h4><p>WorkSpec defines the desired state of Work.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#work>Work</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>workload</code> <em><a href=/website/docs/api-reference/#workloadtemplate>WorkloadTemplate</a></em></td><td>Workload represents the manifest workload to be deployed on spoke cluster</td><td></td><td></td></tr><tr><td><code>applyStrategy</code> <em><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></em></td><td>ApplyStrategy describes how to resolve the conflict if the resource to be placed already exists in the target cluster<br>and is owned by other appliers.<br>This field is a beta-level feature.</td><td></td><td></td></tr></tbody></table><h4 id=workstatus>WorkStatus</h4><p>WorkStatus defines the observed state of Work.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#work>Work</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions contains the different condition statuses for this work.<br>Valid condition types are:<br>1. Applied represents workload in Work is applied successfully on the spoke cluster.<br>2. Progressing represents workload in Work in the transitioning from one state to another the on the spoke cluster.<br>3. Available represents workload in Work exists on the spoke cluster.<br>4. Degraded represents the current state of workload does not match the desired<br>state for a certain period.</td><td></td><td></td></tr><tr><td><code>manifestConditions</code> <em><a href=/website/docs/api-reference/#manifestcondition>ManifestCondition</a> array</em></td><td>ManifestConditions represents the conditions of each resource in work deployed on<br>spoke cluster.</td><td></td><td></td></tr></tbody></table><h4 id=workloadtemplate>WorkloadTemplate</h4><p>WorkloadTemplate represents the manifest workload to be deployed on spoke cluster</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#workspec>WorkSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>manifests</code> <em><a href=/website/docs/api-reference/#manifest>Manifest</a> array</em></td><td>Manifests represents a list of kubernetes resources to be deployed on the spoke cluster.</td><td></td><td></td></tr></tbody></table><h2 id=placementkubernetes-fleetiov1alpha1>placement.kubernetes-fleet.io/v1alpha1</h2><h3 id=resource-types-3>Resource Types</h3><ul><li><a href=/website/docs/api-reference/#clusterapprovalrequest>ClusterApprovalRequest</a></li><li><a href=/website/docs/api-reference/#clusterresourceoverride>ClusterResourceOverride</a></li><li><a href=/website/docs/api-reference/#clusterresourceoverridesnapshot>ClusterResourceOverrideSnapshot</a></li><li><a href=/website/docs/api-reference/#clusterresourceplacementdisruptionbudget>ClusterResourcePlacementDisruptionBudget</a></li><li><a href=/website/docs/api-reference/#clusterresourceplacementeviction>ClusterResourcePlacementEviction</a></li><li><a href=/website/docs/api-reference/#clusterstagedupdaterun>ClusterStagedUpdateRun</a></li><li><a href=/website/docs/api-reference/#clusterstagedupdatestrategy>ClusterStagedUpdateStrategy</a></li><li><a href=/website/docs/api-reference/#resourceoverride>ResourceOverride</a></li><li><a href=/website/docs/api-reference/#resourceoverridesnapshot>ResourceOverrideSnapshot</a></li></ul><h4 id=afterstagetask>AfterStageTask</h4><p>AfterStageTask is the collection of post-stage tasks that ALL need to be completed before moving to the next stage.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#stageconfig>StageConfig</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#afterstagetasktype>AfterStageTaskType</a></em></td><td>The type of the after-stage task.</td><td></td><td>Enum: [TimedWait Approval]<br>Required: {}<br></td></tr><tr><td><code>waitTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#duration-v1-meta>Duration</a></em></td><td>The time to wait after all the clusters in the current stage complete the update before moving to the next stage.</td><td></td><td>Optional: {}<br>Pattern: <code>^0|([0-9]+(\.[0-9]+)?(s|m|h))+$</code><br>Type: string<br></td></tr></tbody></table><h4 id=afterstagetaskstatus>AfterStageTaskStatus</h4><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#stageupdatingstatus>StageUpdatingStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#afterstagetasktype>AfterStageTaskType</a></em></td><td>The type of the post-update task.</td><td></td><td>Enum: [TimedWait Approval]<br>Required: {}<br></td></tr><tr><td><code>approvalRequestName</code> <em>string</em></td><td>The name of the approval request object that is created for this stage.<br>Only valid if the AfterStageTaskType is Approval.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for the specific type of post-update task.<br>Known conditions are &ldquo;ApprovalRequestCreated&rdquo;, &ldquo;WaitTimeElapsed&rdquo;, and &ldquo;ApprovalRequestApproved&rdquo;.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=afterstagetasktype>AfterStageTaskType</h4><p><em>Underlying type:</em> <em>string</em></p><p>AfterStageTaskType identifies a specific type of the AfterStageTask.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#afterstagetask>AfterStageTask</a></li><li><a href=/website/docs/api-reference/#afterstagetaskstatus>AfterStageTaskStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>TimedWait</code></td><td>AfterStageTaskTypeTimedWait indicates the post-stage task is a timed wait.<br></td></tr><tr><td><code>Approval</code></td><td>AfterStageTaskTypeApproval indicates the post-stage task is an approval.<br></td></tr></tbody></table><h4 id=approvalrequestspec>ApprovalRequestSpec</h4><p>ApprovalRequestSpec defines the desired state of the update run approval request.
The entire spec is immutable.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterapprovalrequest>ClusterApprovalRequest</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>parentStageRollout</code> <em>string</em></td><td>The name of the staged update run that this approval request is for.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>targetStage</code> <em>string</em></td><td>The name of the update stage that this approval request is for.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=approvalrequeststatus>ApprovalRequestStatus</h4><p>ApprovalRequestStatus defines the observed state of the ClusterApprovalRequest.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterapprovalrequest>ClusterApprovalRequest</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for the specific type of post-update task.<br>Known conditions are &ldquo;Approved&rdquo; and &ldquo;ApprovalAccepted&rdquo;.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=clusterapprovalrequest>ClusterApprovalRequest</h4><p>ClusterApprovalRequest defines a request for user approval for cluster staged update run.
The request object MUST have the following labels:</p><ul><li><code>TargetUpdateRun</code>: Points to the cluster staged update run that this approval request is for.</li><li><code>TargetStage</code>: The name of the stage that this approval request is for.</li><li><code>IsLatestUpdateRunApproval</code>: Indicates whether this approval request is the latest one related to this update run.</li></ul><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterapprovalrequestlist>ClusterApprovalRequestList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1alpha1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterApprovalRequest</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#approvalrequestspec>ApprovalRequestSpec</a></em></td><td>The desired state of ClusterApprovalRequest.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#approvalrequeststatus>ApprovalRequestStatus</a></em></td><td>The observed state of ClusterApprovalRequest.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=clusterresourceoverride>ClusterResourceOverride</h4><p>ClusterResourceOverride defines a group of override policies about how to override the selected cluster scope resources
to target clusters.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceoverridelist>ClusterResourceOverrideList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1alpha1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourceOverride</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#clusterresourceoverridespec>ClusterResourceOverrideSpec</a></em></td><td>The desired state of ClusterResourceOverrideSpec.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceoverridesnapshot>ClusterResourceOverrideSnapshot</h4><p>ClusterResourceOverrideSnapshot is used to store a snapshot of ClusterResourceOverride.
Its spec is immutable.
We assign an ever-increasing index for snapshots.
The naming convention of a ClusterResourceOverrideSnapshot is {ClusterResourceOverride}-{resourceIndex}.
resourceIndex will begin with 0.
Each snapshot MUST have the following labels:</p><ul><li><code>OverrideTrackingLabel</code> which points to its owner ClusterResourceOverride.</li><li><code>IsLatestSnapshotLabel</code> which indicates whether the snapshot is the latest one.</li></ul><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceoverridesnapshotlist>ClusterResourceOverrideSnapshotList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1alpha1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourceOverrideSnapshot</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#clusterresourceoverridesnapshotspec>ClusterResourceOverrideSnapshotSpec</a></em></td><td>The desired state of ClusterResourceOverrideSnapshotSpec.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceoverridesnapshotspec>ClusterResourceOverrideSnapshotSpec</h4><p>ClusterResourceOverrideSnapshotSpec defines the desired state of ClusterResourceOverride.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceoverridesnapshot>ClusterResourceOverrideSnapshot</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>overrideSpec</code> <em><a href=/website/docs/api-reference/#clusterresourceoverridespec>ClusterResourceOverrideSpec</a></em></td><td>OverrideSpec stores the spec of ClusterResourceOverride.</td><td></td><td></td></tr><tr><td><code>overrideHash</code> <em>integer array</em></td><td>OverrideHash is the sha-256 hash value of the OverrideSpec field.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceoverridespec>ClusterResourceOverrideSpec</h4><p>ClusterResourceOverrideSpec defines the desired state of the Override.
The ClusterResourceOverride create or update will fail when the resource has been selected by the existing ClusterResourceOverride.
If the resource is selected by both ClusterResourceOverride and ResourceOverride, ResourceOverride will win when resolving
conflicts.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceoverride>ClusterResourceOverride</a></li><li><a href=/website/docs/api-reference/#clusterresourceoverridesnapshotspec>ClusterResourceOverrideSnapshotSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>placement</code> <em><a href=/website/docs/api-reference/#placementref>PlacementRef</a></em></td><td>Placement defines whether the override is applied to a specific placement or not.<br>If set, the override will trigger the placement rollout immediately when the rollout strategy type is RollingUpdate.<br>Otherwise, it will be applied to the next rollout.<br>The recommended way is to set the placement so that the override can be rolled out immediately.</td><td></td><td></td></tr><tr><td><code>clusterResourceSelectors</code> <em><a href=/website/docs/api-reference/#clusterresourceselector>ClusterResourceSelector</a> array</em></td><td>ClusterResourceSelectors is an array of selectors used to select cluster scoped resources. The selectors are <code>ORed</code>.<br>If a namespace is selected, ALL the resources under the namespace are selected automatically.<br>LabelSelector is not supported.<br>You can have 1-20 selectors.<br>We only support Name selector for now.</td><td></td><td>MaxItems: 20<br>MinItems: 1<br>Required: {}<br></td></tr><tr><td><code>policy</code> <em><a href=/website/docs/api-reference/#overridepolicy>OverridePolicy</a></em></td><td>Policy defines how to override the selected resources on the target clusters.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceplacementdisruptionbudget>ClusterResourcePlacementDisruptionBudget</h4><p>ClusterResourcePlacementDisruptionBudget is the policy applied to a ClusterResourcePlacement
object that specifies its disruption budget, i.e., how many placements (clusters) can be
down at the same time due to voluntary disruptions (e.g., evictions). Involuntary
disruptions are not subject to this budget, but will still count against it.</p><p>To apply a ClusterResourcePlacementDisruptionBudget to a ClusterResourcePlacement, use the
same name for the ClusterResourcePlacementDisruptionBudget object as the ClusterResourcePlacement
object. This guarantees a 1:1 link between the two objects.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementdisruptionbudgetlist>ClusterResourcePlacementDisruptionBudgetList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1alpha1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourcePlacementDisruptionBudget</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#placementdisruptionbudgetspec>PlacementDisruptionBudgetSpec</a></em></td><td>Spec is the desired state of the ClusterResourcePlacementDisruptionBudget.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceplacementeviction>ClusterResourcePlacementEviction</h4><p>ClusterResourcePlacementEviction is an eviction attempt on a specific placement from
a ClusterResourcePlacement object; one may use this API to force the removal of specific
resources from a cluster.</p><p>An eviction is a voluntary disruption; its execution is subject to the disruption budget
linked with the target ClusterResourcePlacement object (if present).</p><p>Beware that an eviction alone does not guarantee that a placement will not re-appear; i.e.,
after an eviction, the Fleet scheduler might still pick the previous target cluster for
placement. To prevent this, considering adding proper taints to the target cluster before running
an eviction that will exclude it from future placements; this is especially true in scenarios
where one would like to perform a cluster replacement.</p><p>For safety reasons, Fleet will only execute an eviction once; the spec in this object is immutable,
and once executed, the object will be ignored after. To trigger another eviction attempt on the
same placement from the same ClusterResourcePlacement object, one must re-create (delete and
create) the same Eviction object. Note also that an Eviction object will be
ignored once it is deemed invalid (e.g., such an object might be targeting a CRP object or
a placement that does not exist yet), even if it does become valid later
(e.g., the CRP object or the placement appears later). To fix the situation, re-create the
Eviction object.</p><p>Note: Eviction of resources from a cluster propagated by a PickFixed CRP is not allowed.
If the user wants to remove resources from a cluster propagated by a PickFixed CRP simply
remove the cluster name from cluster names field from the CRP spec.</p><p>Executed evictions might be kept around for a while for auditing purposes; the Fleet controllers might
have a TTL set up for such objects and will garbage collect them automatically. For further
information, see the Fleet documentation.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementevictionlist>ClusterResourcePlacementEvictionList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1alpha1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourcePlacementEviction</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#placementevictionspec>PlacementEvictionSpec</a></em></td><td>Spec is the desired state of the ClusterResourcePlacementEviction.<br><br>Note that all fields in the spec are immutable.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#placementevictionstatus>PlacementEvictionStatus</a></em></td><td>Status is the observed state of the ClusterResourcePlacementEviction.</td><td></td><td></td></tr></tbody></table><h4 id=clusterstagedupdaterun>ClusterStagedUpdateRun</h4><p>ClusterStagedUpdateRun represents a stage by stage update process that applies ClusterResourcePlacement
selected resources to specified clusters.
Resources from unselected clusters are removed after all stages in the update strategy are completed.
Each ClusterStagedUpdateRun object corresponds to a single release of a specific resource version.
The release is abandoned if the ClusterStagedUpdateRun object is deleted or the scheduling decision changes.
The name of the ClusterStagedUpdateRun must conform to RFC 1123.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterstagedupdaterunlist>ClusterStagedUpdateRunList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1alpha1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterStagedUpdateRun</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#stagedupdaterunspec>StagedUpdateRunSpec</a></em></td><td>The desired state of ClusterStagedUpdateRun. The spec is immutable.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#stagedupdaterunstatus>StagedUpdateRunStatus</a></em></td><td>The observed status of ClusterStagedUpdateRun.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=clusterstagedupdatestrategy>ClusterStagedUpdateStrategy</h4><p>ClusterStagedUpdateStrategy defines a reusable strategy that specifies the stages and the sequence
in which the selected cluster resources will be updated on the member clusters.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterstagedupdatestrategylist>ClusterStagedUpdateStrategyList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1alpha1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterStagedUpdateStrategy</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#stagedupdatestrategyspec>StagedUpdateStrategySpec</a></em></td><td>The desired state of ClusterStagedUpdateStrategy.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=clusterupdatingstatus>ClusterUpdatingStatus</h4><p>ClusterUpdatingStatus defines the status of the update run on a cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#stageupdatingstatus>StageUpdatingStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterName</code> <em>string</em></td><td>The name of the cluster.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>resourceOverrideSnapshots</code> <em><a href=/website/docs/api-reference/#namespacedname>NamespacedName</a> array</em></td><td>ResourceOverrideSnapshots is a list of ResourceOverride snapshots associated with the cluster.<br>The list is computed at the beginning of the update run and not updated during the update run.<br>The list is empty if there are no resource overrides associated with the cluster.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>clusterResourceOverrideSnapshots</code> <em>string array</em></td><td>ClusterResourceOverrides contains a list of applicable ClusterResourceOverride snapshot names<br>associated with the cluster.<br>The list is computed at the beginning of the update run and not updated during the update run.<br>The list is empty if there are no cluster overrides associated with the cluster.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for clusters. Empty if the cluster has not started updating.<br>Known conditions are &ldquo;Started&rdquo;, &ldquo;Succeeded&rdquo;.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=jsonpatchoverride>JSONPatchOverride</h4><p>JSONPatchOverride applies a JSON patch on the selected resources following <a href=https://datatracker.ietf.org/doc/html/rfc6902>RFC 6902</a>.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#overriderule>OverrideRule</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>op</code> <em><a href=/website/docs/api-reference/#jsonpatchoverrideoperator>JSONPatchOverrideOperator</a></em></td><td>Operator defines the operation on the target field.</td><td></td><td>Enum: [add remove replace]<br></td></tr><tr><td><code>path</code> <em>string</em></td><td>Path defines the target location.<br>Note: override will fail if the resource path does not exist.</td><td></td><td></td></tr><tr><td><code>value</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#json-v1-apiextensions-k8s-io>JSON</a></em></td><td>Value defines the content to be applied on the target location.<br>Value should be empty when operator is <code>remove</code>.<br>We have reserved a few variables in this field that will be replaced by the actual values.<br>Those variables all start with <code>$</code> and are case sensitive.<br>Here is the list of currently supported variables:<br><code>$\{MEMBER-CLUSTER-NAME\}</code>: this will be replaced by the name of the memberCluster CR that represents this cluster.</td><td></td><td></td></tr></tbody></table><h4 id=jsonpatchoverrideoperator>JSONPatchOverrideOperator</h4><p><em>Underlying type:</em> <em>string</em></p><p>JSONPatchOverrideOperator defines the supported JSON patch operator.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#jsonpatchoverride>JSONPatchOverride</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>add</code></td><td>JSONPatchOverrideOpAdd adds the value to the target location.<br>An example target JSON document:<br>{ &ldquo;foo&rdquo;: [ &ldquo;bar&rdquo;, &ldquo;baz&rdquo; ] }<br>A JSON Patch override:<br>[<br>{ &ldquo;op&rdquo;: &ldquo;add&rdquo;, &ldquo;path&rdquo;: &ldquo;/foo/1&rdquo;, &ldquo;value&rdquo;: &ldquo;qux&rdquo; }<br>]<br>The resulting JSON document:<br>{ &ldquo;foo&rdquo;: [ &ldquo;bar&rdquo;, &ldquo;qux&rdquo;, &ldquo;baz&rdquo; ] }<br></td></tr><tr><td><code>remove</code></td><td>JSONPatchOverrideOpRemove removes the value from the target location.<br>An example target JSON document:<br>{<br>&ldquo;baz&rdquo;: &ldquo;qux&rdquo;,<br>&ldquo;foo&rdquo;: &ldquo;bar&rdquo;<br>}<br>A JSON Patch override:<br>[<br>{ &ldquo;op&rdquo;: &ldquo;remove&rdquo;, &ldquo;path&rdquo;: &ldquo;/baz&rdquo; }<br>]<br>The resulting JSON document:<br>{ &ldquo;foo&rdquo;: &ldquo;bar&rdquo; }<br></td></tr><tr><td><code>replace</code></td><td>JSONPatchOverrideOpReplace replaces the value at the target location with a new value.<br>An example target JSON document:<br>{<br>&ldquo;baz&rdquo;: &ldquo;qux&rdquo;,<br>&ldquo;foo&rdquo;: &ldquo;bar&rdquo;<br>}<br>A JSON Patch override:<br>[<br>{ &ldquo;op&rdquo;: &ldquo;replace&rdquo;, &ldquo;path&rdquo;: &ldquo;/baz&rdquo;, &ldquo;value&rdquo;: &ldquo;boo&rdquo; }<br>]<br>The resulting JSON document:<br>{<br>&ldquo;baz&rdquo;: &ldquo;boo&rdquo;,<br>&ldquo;foo&rdquo;: &ldquo;bar&rdquo;<br>}<br></td></tr></tbody></table><h4 id=overridepolicy>OverridePolicy</h4><p>OverridePolicy defines how to override the selected resources on the target clusters.
More is to be added.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceoverridespec>ClusterResourceOverrideSpec</a></li><li><a href=/website/docs/api-reference/#resourceoverridespec>ResourceOverrideSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>overrideRules</code> <em><a href=/website/docs/api-reference/#overriderule>OverrideRule</a> array</em></td><td>OverrideRules defines an array of override rules to be applied on the selected resources.<br>The order of the rules determines the override order.<br>When there are two rules selecting the same fields on the target cluster, the last one will win.<br>You can have 1-20 rules.</td><td></td><td>MaxItems: 20<br>MinItems: 1<br>Required: {}<br></td></tr></tbody></table><h4 id=overriderule>OverrideRule</h4><p>OverrideRule defines how to override the selected resources on the target clusters.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#overridepolicy>OverridePolicy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterSelector</code> <em><a href=/website/docs/api-reference/#clusterselector>ClusterSelector</a></em></td><td>ClusterSelectors selects the target clusters.<br>The resources will be overridden before applying to the matching clusters.<br>An empty clusterSelector selects ALL the member clusters.<br>A nil clusterSelector selects NO member clusters.<br>For now, only labelSelector is supported.</td><td></td><td></td></tr><tr><td><code>overrideType</code> <em><a href=/website/docs/api-reference/#overridetype>OverrideType</a></em></td><td>OverrideType defines the type of the override rules.</td><td>JSONPatch</td><td>Enum: [JSONPatch Delete]<br></td></tr><tr><td><code>jsonPatchOverrides</code> <em><a href=/website/docs/api-reference/#jsonpatchoverride>JSONPatchOverride</a> array</em></td><td>JSONPatchOverrides defines a list of JSON patch override rules.<br>This field is only allowed when OverrideType is JSONPatch.</td><td></td><td>MaxItems: 20<br>MinItems: 1<br></td></tr></tbody></table><h4 id=overridetype>OverrideType</h4><p><em>Underlying type:</em> <em>string</em></p><p>OverrideType defines the type of Override</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#overriderule>OverrideRule</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>JSONPatch</code></td><td>JSONPatchOverrideType applies a JSON patch on the selected resources following <a href=https://datatracker.ietf.org/doc/html/rfc6902>RFC 6902</a>.<br></td></tr><tr><td><code>Delete</code></td><td>DeleteOverrideType deletes the selected resources on the target clusters.<br></td></tr></tbody></table><h4 id=placementdisruptionbudgetspec>PlacementDisruptionBudgetSpec</h4><p>PlacementDisruptionBudgetSpec is the desired state of the PlacementDisruptionBudget.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementdisruptionbudget>ClusterResourcePlacementDisruptionBudget</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>maxUnavailable</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#intorstring-intstr-util>IntOrString</a></em></td><td>MaxUnavailable is the maximum number of placements (clusters) that can be down at the<br>same time due to voluntary disruptions. For example, a setting of 1 would imply that<br>a voluntary disruption (e.g., an eviction) can only happen if all placements (clusters)<br>from the linked Placement object are applied and available.<br><br>This can be either an absolute value (e.g., 1) or a percentage (e.g., 10%).<br><br>If a percentage is specified, Fleet will calculate the corresponding absolute values<br>as follows:<br>* if the linked Placement object is of the PickFixed placement type,<br>we don&rsquo;t perform any calculation because eviction is not allowed for PickFixed CRP.<br>* if the linked Placement object is of the PickAll placement type, MaxUnavailable cannot<br>be specified since we cannot derive the total number of clusters selected.<br>* if the linked Placement object is of the PickN placement type,<br>the percentage is against the number of clusters specified in the placement (i.e., the<br>value of the NumberOfClusters fields in the placement policy).<br>The end result will be rounded up to the nearest integer if applicable.<br><br>One may use a value of 0 for this field; in this case, no voluntary disruption would be<br>allowed.<br><br>This field is mutually exclusive with the MinAvailable field in the spec; exactly one<br>of them can be set at a time.</td><td></td><td>XIntOrString: {}<br></td></tr><tr><td><code>minAvailable</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#intorstring-intstr-util>IntOrString</a></em></td><td>MinAvailable is the minimum number of placements (clusters) that must be available at any<br>time despite voluntary disruptions. For example, a setting of 10 would imply that<br>a voluntary disruption (e.g., an eviction) can only happen if there are at least 11<br>placements (clusters) from the linked Placement object are applied and available.<br><br>This can be either an absolute value (e.g., 1) or a percentage (e.g., 10%).<br><br>If a percentage is specified, Fleet will calculate the corresponding absolute values<br>as follows:<br>* if the linked Placement object is of the PickFixed placement type,<br>we don&rsquo;t perform any calculation because eviction is not allowed for PickFixed CRP.<br>* if the linked Placement object is of the PickAll placement type, MinAvailable can be<br>specified but only as an integer since we cannot derive the total number of clusters selected.<br>* if the linked Placement object is of the PickN placement type,<br>the percentage is against the number of clusters specified in the placement (i.e., the<br>value of the NumberOfClusters fields in the placement policy).<br>The end result will be rounded up to the nearest integer if applicable.<br><br>One may use a value of 0 for this field; in this case, voluntary disruption would be<br>allowed at any time.<br><br>This field is mutually exclusive with the MaxUnavailable field in the spec; exactly one<br>of them can be set at a time.</td><td></td><td>XIntOrString: {}<br></td></tr></tbody></table><h4 id=placementevictionspec>PlacementEvictionSpec</h4><p>PlacementEvictionSpec is the desired state of the parent PlacementEviction.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementeviction>ClusterResourcePlacementEviction</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>placementName</code> <em>string</em></td><td>PlacementName is the name of the Placement object which<br>the Eviction object targets.</td><td></td><td>MaxLength: 255<br>Required: {}<br></td></tr><tr><td><code>clusterName</code> <em>string</em></td><td>ClusterName is the name of the cluster that the Eviction object targets.</td><td></td><td>MaxLength: 255<br>Required: {}<br></td></tr></tbody></table><h4 id=placementevictionstatus>PlacementEvictionStatus</h4><p>PlacementEvictionStatus is the observed state of the parent PlacementEviction.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementeviction>ClusterResourcePlacementEviction</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is the list of currently observed conditions for the<br>PlacementEviction object.<br><br>Available condition types include:<br>* Valid: whether the Eviction object is valid, i.e., it targets at a valid placement.<br>* Executed: whether the Eviction object has been executed.</td><td></td><td></td></tr></tbody></table><h4 id=placementref>PlacementRef</h4><p>PlacementRef is the reference to a placement.
For now, we only support ClusterResourcePlacement.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceoverridespec>ClusterResourceOverrideSpec</a></li><li><a href=/website/docs/api-reference/#resourceoverridespec>ResourceOverrideSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>name</code> <em>string</em></td><td>Name is the reference to the name of placement.</td><td></td><td></td></tr></tbody></table><h4 id=resourceoverride>ResourceOverride</h4><p>ResourceOverride defines a group of override policies about how to override the selected namespaced scope resources
to target clusters.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourceoverridelist>ResourceOverrideList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1alpha1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ResourceOverride</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#resourceoverridespec>ResourceOverrideSpec</a></em></td><td>The desired state of ResourceOverrideSpec.</td><td></td><td></td></tr></tbody></table><h4 id=resourceoverridesnapshot>ResourceOverrideSnapshot</h4><p>ResourceOverrideSnapshot is used to store a snapshot of ResourceOverride.
Its spec is immutable.
We assign an ever-increasing index for snapshots.
The naming convention of a ResourceOverrideSnapshot is {ResourceOverride}-{resourceIndex}.
resourceIndex will begin with 0.
Each snapshot MUST have the following labels:</p><ul><li><code>OverrideTrackingLabel</code> which points to its owner ResourceOverride.</li><li><code>IsLatestSnapshotLabel</code> which indicates whether the snapshot is the latest one.</li></ul><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourceoverridesnapshotlist>ResourceOverrideSnapshotList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1alpha1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ResourceOverrideSnapshot</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#resourceoverridesnapshotspec>ResourceOverrideSnapshotSpec</a></em></td><td>The desired state of ResourceOverrideSnapshot.</td><td></td><td></td></tr></tbody></table><h4 id=resourceoverridesnapshotspec>ResourceOverrideSnapshotSpec</h4><p>ResourceOverrideSnapshotSpec defines the desired state of ResourceOverride.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourceoverridesnapshot>ResourceOverrideSnapshot</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>overrideSpec</code> <em><a href=/website/docs/api-reference/#resourceoverridespec>ResourceOverrideSpec</a></em></td><td>OverrideSpec stores the spec of ResourceOverride.</td><td></td><td></td></tr><tr><td><code>overrideHash</code> <em>integer array</em></td><td>OverrideHash is the sha-256 hash value of the OverrideSpec field.</td><td></td><td></td></tr></tbody></table><h4 id=resourceoverridespec>ResourceOverrideSpec</h4><p>ResourceOverrideSpec defines the desired state of the Override.
The ResourceOverride create or update will fail when the resource has been selected by the existing ResourceOverride.
If the resource is selected by both ClusterResourceOverride and ResourceOverride, ResourceOverride will win when resolving
conflicts.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourceoverride>ResourceOverride</a></li><li><a href=/website/docs/api-reference/#resourceoverridesnapshotspec>ResourceOverrideSnapshotSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>placement</code> <em><a href=/website/docs/api-reference/#placementref>PlacementRef</a></em></td><td>Placement defines whether the override is applied to a specific placement or not.<br>If set, the override will trigger the placement rollout immediately when the rollout strategy type is RollingUpdate.<br>Otherwise, it will be applied to the next rollout.<br>The recommended way is to set the placement so that the override can be rolled out immediately.</td><td></td><td></td></tr><tr><td><code>resourceSelectors</code> <em><a href=/website/docs/api-reference/#resourceselector>ResourceSelector</a> array</em></td><td>ResourceSelectors is an array of selectors used to select namespace scoped resources. The selectors are <code>ORed</code>.<br>You can have 1-20 selectors.</td><td></td><td>MaxItems: 20<br>MinItems: 1<br>Required: {}<br></td></tr><tr><td><code>policy</code> <em><a href=/website/docs/api-reference/#overridepolicy>OverridePolicy</a></em></td><td>Policy defines how to override the selected resources on the target clusters.</td><td></td><td></td></tr></tbody></table><h4 id=resourceselector>ResourceSelector</h4><p>ResourceSelector is used to select namespace scoped resources as the target resources to be placed.
All the fields are <code>ANDed</code>. In other words, a resource must match all the fields to be selected.
The resource namespace will inherit from the parent object scope.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourceoverridespec>ResourceOverrideSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>group</code> <em>string</em></td><td>Group name of the namespace-scoped resource.<br>Use an empty string to select resources under the core API group (e.g., services).</td><td></td><td></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version of the namespace-scoped resource.</td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind of the namespace-scoped resource.</td><td></td><td></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name of the namespace-scoped resource.</td><td></td><td></td></tr></tbody></table><h4 id=stageconfig>StageConfig</h4><p>StageConfig describes a single update stage.
The clusters in each stage are updated sequentially.
The update stops if any of the updates fail.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#stagedupdatestrategyspec>StagedUpdateStrategySpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>name</code> <em>string</em></td><td>The name of the stage. This MUST be unique within the same StagedUpdateStrategy.</td><td></td><td>MaxLength: 63<br>Pattern: <code>^[a-z0-9]+$</code><br>Required: {}<br></td></tr><tr><td><code>labelSelector</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#labelselector-v1-meta>LabelSelector</a></em></td><td>LabelSelector is a label query over all the joined member clusters. Clusters matching the query are selected<br>for this stage. There cannot be overlapping clusters between stages when the stagedUpdateRun is created.<br>If the label selector is absent, the stage includes all the selected clusters.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>sortingLabelKey</code> <em>string</em></td><td>The label key used to sort the selected clusters.<br>The clusters within the stage are updated sequentially following the rule below:<br>- primary: Ascending order based on the value of the label key, interpreted as integers if present.<br>- secondary: Ascending order based on the name of the cluster if the label key is absent or the label value is the same.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>afterStageTasks</code> <em><a href=/website/docs/api-reference/#afterstagetask>AfterStageTask</a> array</em></td><td>The collection of tasks that each stage needs to complete successfully before moving to the next stage.<br>Each task is executed in parallel and there cannot be more than one task of the same type.</td><td></td><td>MaxItems: 2<br>Optional: {}<br></td></tr></tbody></table><h4 id=stageupdatingstatus>StageUpdatingStatus</h4><p>StageUpdatingStatus defines the status of the update run in a stage.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#stagedupdaterunstatus>StagedUpdateRunStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>stageName</code> <em>string</em></td><td>The name of the stage.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>clusters</code> <em><a href=/website/docs/api-reference/#clusterupdatingstatus>ClusterUpdatingStatus</a> array</em></td><td>The list of each cluster&rsquo;s updating status in this stage.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>afterStageTaskStatus</code> <em><a href=/website/docs/api-reference/#afterstagetaskstatus>AfterStageTaskStatus</a> array</em></td><td>The status of the post-update tasks associated with the current stage.<br>Empty if the stage has not finished updating all the clusters.</td><td></td><td>MaxItems: 2<br>Optional: {}<br></td></tr><tr><td><code>startTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>The time when the update started on the stage. Empty if the stage has not started updating.</td><td></td><td>Format: date-time<br>Optional: {}<br>Type: string<br></td></tr><tr><td><code>endTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>The time when the update finished on the stage. Empty if the stage has not started updating.</td><td></td><td>Format: date-time<br>Optional: {}<br>Type: string<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed updating conditions for the stage. Empty if the stage has not started updating.<br>Known conditions are &ldquo;Progressing&rdquo;, &ldquo;Succeeded&rdquo;.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=stagedupdaterunspec>StagedUpdateRunSpec</h4><p>StagedUpdateRunSpec defines the desired rollout strategy and the snapshot indices of the resources to be updated.
It specifies a stage-by-stage update process across selected clusters for the given ResourcePlacement object.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterstagedupdaterun>ClusterStagedUpdateRun</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>placementName</code> <em>string</em></td><td>PlacementName is the name of placement that this update run is applied to.<br>There can be multiple active update runs for each placement, but<br>it&rsquo;s up to the DevOps team to ensure they don&rsquo;t conflict with each other.</td><td></td><td>MaxLength: 255<br>Required: {}<br></td></tr><tr><td><code>resourceSnapshotIndex</code> <em>string</em></td><td>The resource snapshot index of the selected resources to be updated across clusters.<br>The index represents a group of resource snapshots that includes all the resources a ResourcePlacement selected.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>stagedRolloutStrategyName</code> <em>string</em></td><td>The name of the update strategy that specifies the stages and the sequence<br>in which the selected resources will be updated on the member clusters. The stages<br>are computed according to the referenced strategy when the update run starts<br>and recorded in the status field.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=stagedupdaterunstatus>StagedUpdateRunStatus</h4><p>StagedUpdateRunStatus defines the observed state of the ClusterStagedUpdateRun.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterstagedupdaterun>ClusterStagedUpdateRun</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>policySnapshotIndexUsed</code> <em>string</em></td><td>PolicySnapShotIndexUsed records the policy snapshot index of the ClusterResourcePlacement (CRP) that<br>the update run is based on. The index represents the latest policy snapshot at the start of the update run.<br>If a newer policy snapshot is detected after the run starts, the staged update run is abandoned.<br>The scheduler must identify all clusters that meet the current policy before the update run begins.<br>All clusters involved in the update run are selected from the list of clusters scheduled by the CRP according<br>to the current policy.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>policyObservedClusterCount</code> <em>integer</em></td><td>PolicyObservedClusterCount records the number of observed clusters in the policy snapshot.<br>It is recorded at the beginning of the update run from the policy snapshot object.<br>If the <code>ObservedClusterCount</code> value is updated during the update run, the update run is abandoned.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>appliedStrategy</code> <em><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></em></td><td>ApplyStrategy is the apply strategy that the stagedUpdateRun is using.<br>It is the same as the apply strategy in the CRP when the staged update run starts.<br>The apply strategy is not updated during the update run even if it changes in the CRP.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>stagedUpdateStrategySnapshot</code> <em><a href=/website/docs/api-reference/#stagedupdatestrategyspec>StagedUpdateStrategySpec</a></em></td><td>StagedUpdateStrategySnapshot is the snapshot of the StagedUpdateStrategy used for the update run.<br>The snapshot is immutable during the update run.<br>The strategy is applied to the list of clusters scheduled by the CRP according to the current policy.<br>The update run fails to initialize if the strategy fails to produce a valid list of stages where each selected<br>cluster is included in exactly one stage.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>stagesStatus</code> <em><a href=/website/docs/api-reference/#stageupdatingstatus>StageUpdatingStatus</a> array</em></td><td>StagesStatus lists the current updating status of each stage.<br>The list is empty if the update run is not started or failed to initialize.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>deletionStageStatus</code> <em><a href=/website/docs/api-reference/#stageupdatingstatus>StageUpdatingStatus</a></em></td><td>DeletionStageStatus lists the current status of the deletion stage. The deletion stage<br>removes all the resources from the clusters that are not selected by the<br>current policy after all the update stages are completed.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for StagedUpdateRun.<br>Known conditions are &ldquo;Initialized&rdquo;, &ldquo;Progressing&rdquo;, &ldquo;Succeeded&rdquo;.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=stagedupdatestrategyspec>StagedUpdateStrategySpec</h4><p>StagedUpdateStrategySpec defines the desired state of the StagedUpdateStrategy.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterstagedupdatestrategy>ClusterStagedUpdateStrategy</a></li><li><a href=/website/docs/api-reference/#stagedupdaterunstatus>StagedUpdateRunStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>stages</code> <em><a href=/website/docs/api-reference/#stageconfig>StageConfig</a> array</em></td><td>Stage specifies the configuration for each update stage.</td><td></td><td>MaxItems: 31<br>Required: {}<br></td></tr></tbody></table><h2 id=placementkubernetes-fleetiov1beta1>placement.kubernetes-fleet.io/v1beta1</h2><h3 id=resource-types-4>Resource Types</h3><ul><li><a href=/website/docs/api-reference/#appliedwork>AppliedWork</a></li><li><a href=/website/docs/api-reference/#appliedworklist>AppliedWorkList</a></li><li><a href=/website/docs/api-reference/#clusterapprovalrequest>ClusterApprovalRequest</a></li><li><a href=/website/docs/api-reference/#clusterresourcebinding>ClusterResourceBinding</a></li><li><a href=/website/docs/api-reference/#clusterresourceplacement>ClusterResourcePlacement</a></li><li><a href=/website/docs/api-reference/#clusterresourceplacementdisruptionbudget>ClusterResourcePlacementDisruptionBudget</a></li><li><a href=/website/docs/api-reference/#clusterresourceplacementeviction>ClusterResourcePlacementEviction</a></li><li><a href=/website/docs/api-reference/#clusterresourcesnapshot>ClusterResourceSnapshot</a></li><li><a href=/website/docs/api-reference/#clusterschedulingpolicysnapshot>ClusterSchedulingPolicySnapshot</a></li><li><a href=/website/docs/api-reference/#clusterstagedupdaterun>ClusterStagedUpdateRun</a></li><li><a href=/website/docs/api-reference/#clusterstagedupdatestrategy>ClusterStagedUpdateStrategy</a></li><li><a href=/website/docs/api-reference/#work>Work</a></li><li><a href=/website/docs/api-reference/#worklist>WorkList</a></li></ul><h4 id=affinity-1>Affinity</h4><p>Affinity is a group of cluster affinity scheduling rules. More to be added.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterAffinity</code> <em><a href=/website/docs/api-reference/#clusteraffinity>ClusterAffinity</a></em></td><td>ClusterAffinity contains cluster affinity scheduling rules for the selected resources.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=afterstagetask-1>AfterStageTask</h4><p>AfterStageTask is the collection of post-stage tasks that ALL need to be completed before moving to the next stage.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#stageconfig>StageConfig</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#afterstagetasktype>AfterStageTaskType</a></em></td><td>The type of the after-stage task.</td><td></td><td>Enum: [TimedWait Approval]<br>Required: {}<br></td></tr><tr><td><code>waitTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#duration-v1-meta>Duration</a></em></td><td>The time to wait after all the clusters in the current stage complete the update before moving to the next stage.</td><td></td><td>Optional: {}<br>Pattern: <code>^0|([0-9]+(\.[0-9]+)?(s|m|h))+$</code><br>Type: string<br></td></tr></tbody></table><h4 id=afterstagetaskstatus-1>AfterStageTaskStatus</h4><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#stageupdatingstatus>StageUpdatingStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#afterstagetasktype>AfterStageTaskType</a></em></td><td>The type of the post-update task.</td><td></td><td>Enum: [TimedWait Approval]<br>Required: {}<br></td></tr><tr><td><code>approvalRequestName</code> <em>string</em></td><td>The name of the approval request object that is created for this stage.<br>Only valid if the AfterStageTaskType is Approval.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for the specific type of post-update task.<br>Known conditions are &ldquo;ApprovalRequestCreated&rdquo;, &ldquo;WaitTimeElapsed&rdquo;, and &ldquo;ApprovalRequestApproved&rdquo;.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=afterstagetasktype-1>AfterStageTaskType</h4><p><em>Underlying type:</em> <em>string</em></p><p>AfterStageTaskType identifies a specific type of the AfterStageTask.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#afterstagetask>AfterStageTask</a></li><li><a href=/website/docs/api-reference/#afterstagetaskstatus>AfterStageTaskStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>TimedWait</code></td><td>AfterStageTaskTypeTimedWait indicates the post-stage task is a timed wait.<br></td></tr><tr><td><code>Approval</code></td><td>AfterStageTaskTypeApproval indicates the post-stage task is an approval.<br></td></tr></tbody></table><h4 id=appliedresourcemeta-1>AppliedResourceMeta</h4><p>AppliedResourceMeta represents the group, version, resource, name and namespace of a resource.
Since these resources have been created, they must have valid group, version, resource, namespace, and name.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#appliedworkstatus>AppliedWorkStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>ordinal</code> <em>integer</em></td><td>Ordinal represents an index in manifests list, so the condition can still be linked<br>to a manifest even though manifest cannot be parsed successfully.</td><td></td><td></td></tr><tr><td><code>group</code> <em>string</em></td><td>Group is the group of the resource.</td><td></td><td></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version is the version of the resource.</td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind is the kind of the resource.</td><td></td><td></td></tr><tr><td><code>resource</code> <em>string</em></td><td>Resource is the resource type of the resource.</td><td></td><td></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the resource, the resource is cluster scoped if the value<br>is empty.</td><td></td><td></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name is the name of the resource.</td><td></td><td></td></tr><tr><td><code>uid</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#uid-types-pkg>UID</a></em></td><td>UID is set on successful deletion of the Kubernetes resource by controller. The<br>resource might be still visible on the managed cluster after this field is set.<br>It is not directly settable by a client.</td><td></td><td></td></tr></tbody></table><h4 id=appliedwork-1>AppliedWork</h4><p>AppliedWork represents an applied work on managed cluster that is placed
on a managed cluster. An appliedwork links to a work on a hub recording resources
deployed in the managed cluster.
When the agent is removed from managed cluster, cluster-admin on managed cluster
can delete appliedwork to remove resources deployed by the agent.
The name of the appliedwork must be the same as {work name}
The namespace of the appliedwork should be the same as the resource applied on
the managed cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#appliedworklist>AppliedWorkList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>AppliedWork</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#appliedworkspec>AppliedWorkSpec</a></em></td><td>Spec represents the desired configuration of AppliedWork.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#appliedworkstatus>AppliedWorkStatus</a></em></td><td>Status represents the current status of AppliedWork.</td><td></td><td></td></tr></tbody></table><h4 id=appliedworklist-1>AppliedWorkList</h4><p>AppliedWorkList contains a list of AppliedWork.</p><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>AppliedWorkList</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#listmeta-v1-meta>ListMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>items</code> <em><a href=/website/docs/api-reference/#appliedwork>AppliedWork</a> array</em></td><td>List of works.</td><td></td><td></td></tr></tbody></table><h4 id=appliedworkspec-1>AppliedWorkSpec</h4><p>AppliedWorkSpec represents the desired configuration of AppliedWork.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#appliedwork>AppliedWork</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>workName</code> <em>string</em></td><td>WorkName represents the name of the related work on the hub.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>workNamespace</code> <em>string</em></td><td>WorkNamespace represents the namespace of the related work on the hub.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=appliedworkstatus-1>AppliedWorkStatus</h4><p>AppliedWorkStatus represents the current status of AppliedWork.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#appliedwork>AppliedWork</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>appliedResources</code> <em><a href=/website/docs/api-reference/#appliedresourcemeta>AppliedResourceMeta</a> array</em></td><td>AppliedResources represents a list of resources defined within the Work that are applied.<br>Only resources with valid GroupVersionResource, namespace, and name are suitable.<br>An item in this slice is deleted when there is no mapped manifest in Work.Spec or by finalizer.<br>The resource relating to the item will also be removed from managed cluster.<br>The deleted resource may still be present until the finalizers for that resource are finished.<br>However, the resource will not be undeleted, so it can be removed from this list and eventual consistency is preserved.</td><td></td><td></td></tr></tbody></table><h4 id=applystrategy-1>ApplyStrategy</h4><p>ApplyStrategy describes when and how to apply the selected resource to the target cluster.
Note: If multiple CRPs try to place the same resource with different apply strategy, the later ones will fail with the
reason ApplyConflictBetweenPlacements.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingspec>ResourceBindingSpec</a></li><li><a href=/website/docs/api-reference/#rolloutstrategy>RolloutStrategy</a></li><li><a href=/website/docs/api-reference/#stagedupdaterunstatus>StagedUpdateRunStatus</a></li><li><a href=/website/docs/api-reference/#stagedupdaterunstatus>StagedUpdateRunStatus</a></li><li><a href=/website/docs/api-reference/#workspec>WorkSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>comparisonOption</code> <em><a href=/website/docs/api-reference/#comparisonoptiontype>ComparisonOptionType</a></em></td><td>ComparisonOption controls how Fleet compares the desired state of a resource, as kept in<br>a hub cluster manifest, with the current state of the resource (if applicable) in the<br>member cluster.<br><br>Available options are:<br><br>* PartialComparison: with this option, Fleet will compare only fields that are managed by<br>Fleet, i.e., the fields that are specified explicitly in the hub cluster manifest.<br>Unmanaged fields are ignored. This is the default option.<br><br>* FullComparison: with this option, Fleet will compare all fields of the resource,<br>even if the fields are absent from the hub cluster manifest.<br><br>Consider using the PartialComparison option if you would like to:<br><br>* use the default values for certain fields; or<br>* let another agent, e.g., HPAs, VPAs, etc., on the member cluster side manage some fields; or<br>* allow ad-hoc or cluster-specific settings on the member cluster side.<br><br>To use the FullComparison option, it is recommended that you:<br><br>* specify all fields as appropriate in the hub cluster, even if you are OK with using default<br>values;<br>* make sure that no fields are managed by agents other than Fleet on the member cluster<br>side, such as HPAs, VPAs, or other controllers.<br><br>See the Fleet documentation for further explanations and usage examples.</td><td>PartialComparison</td><td>Enum: [PartialComparison FullComparison]<br>Optional: {}<br></td></tr><tr><td><code>whenToApply</code> <em><a href=/website/docs/api-reference/#whentoapplytype>WhenToApplyType</a></em></td><td>WhenToApply controls when Fleet would apply the manifests on the hub cluster to the member<br>clusters.<br><br>Available options are:<br><br>* Always: with this option, Fleet will periodically apply hub cluster manifests<br>on the member cluster side; this will effectively overwrite any change in the fields<br>managed by Fleet (i.e., specified in the hub cluster manifest). This is the default<br>option.<br><br>Note that this option would revert any ad-hoc changes made on the member cluster side in<br>the managed fields; if you would like to make temporary edits on the member cluster side<br>in the managed fields, switch to IfNotDrifted option. Note that changes in unmanaged<br>fields will be left alone; if you use the FullDiff compare option, such changes will<br>be reported as drifts.<br><br>* IfNotDrifted: with this option, Fleet will stop applying hub cluster manifests on<br>clusters that have drifted from the desired state; apply ops would still continue on<br>the rest of the clusters. Drifts are calculated using the ComparisonOption,<br>as explained in the corresponding field.<br><br>Use this option if you would like Fleet to detect drifts in your multi-cluster setup.<br>A drift occurs when an agent makes an ad-hoc change on the member cluster side that<br>makes affected resources deviate from its desired state as kept in the hub cluster;<br>and this option grants you an opportunity to view the drift details and take actions<br>accordingly. The drift details will be reported in the CRP status.<br><br>To fix a drift, you may:<br><br>* revert the changes manually on the member cluster side<br>* update the hub cluster manifest; this will trigger Fleet to apply the latest revision<br>of the manifests, which will overwrite the drifted fields<br>(if they are managed by Fleet)<br>* switch to the Always option; this will trigger Fleet to apply the current revision<br>of the manifests, which will overwrite the drifted fields (if they are managed by Fleet).<br>* if applicable and necessary, delete the drifted resources on the member cluster side; Fleet<br>will attempt to re-create them using the hub cluster manifests</td><td>Always</td><td>Enum: [Always IfNotDrifted]<br>Optional: {}<br></td></tr><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#applystrategytype>ApplyStrategyType</a></em></td><td>Type is the apply strategy to use; it determines how Fleet applies manifests from the<br>hub cluster to a member cluster.<br><br>Available options are:<br><br>* ClientSideApply: Fleet uses three-way merge to apply manifests, similar to how kubectl<br>performs a client-side apply. This is the default option.<br><br>Note that this strategy requires that Fleet keep the last applied configuration in the<br>annotation of an applied resource. If the object gets so large that apply ops can no longer<br>be executed, Fleet will switch to server-side apply.<br><br>Use ComparisonOption and WhenToApply settings to control when an apply op can be executed.<br><br>* ServerSideApply: Fleet uses server-side apply to apply manifests; Fleet itself will<br>become the field manager for specified fields in the manifests. Specify<br>ServerSideApplyConfig as appropriate if you would like Fleet to take over field<br>ownership upon conflicts. This is the recommended option for most scenarios; it might<br>help reduce object size and safely resolve conflicts between field values. For more<br>information, please refer to the Kubernetes documentation<br>(<a href=https://kubernetes.io/docs/reference/using-api/server-side-apply/#comparison-with-client-side-apply%29>https://kubernetes.io/docs/reference/using-api/server-side-apply/#comparison-with-client-side-apply)</a>.<br><br>Use ComparisonOption and WhenToApply settings to control when an apply op can be executed.<br><br>* ReportDiff: Fleet will compare the desired state of a resource as kept in the hub cluster<br>with its current state (if applicable) on the member cluster side, and report any<br>differences. No actual apply ops would be executed, and resources will be left alone as they<br>are on the member clusters.<br><br>If configuration differences are found on a resource, Fleet will consider this as an apply<br>error, which might block rollout depending on the specified rollout strategy.<br><br>Use ComparisonOption setting to control how the difference is calculated.<br><br>ClientSideApply and ServerSideApply apply strategies only work when Fleet can assume<br>ownership of a resource (e.g., the resource is created by Fleet, or Fleet has taken over<br>the resource). See the comments on the WhenToTakeOver field for more information.<br>ReportDiff apply strategy, however, will function regardless of Fleet&rsquo;s ownership<br>status. One may set up a CRP with the ReportDiff strategy and the Never takeover option,<br>and this will turn Fleet into a detection tool that reports only configuration differences<br>but do not touch any resources on the member cluster side.<br><br>For a comparison between the different strategies and usage examples, refer to the<br>Fleet documentation.</td><td>ClientSideApply</td><td>Enum: [ClientSideApply ServerSideApply ReportDiff]<br>Optional: {}<br></td></tr><tr><td><code>allowCoOwnership</code> <em>boolean</em></td><td>AllowCoOwnership controls whether co-ownership between Fleet and other agents are allowed<br>on a Fleet-managed resource. If set to false, Fleet will refuse to apply manifests to<br>a resource that has been owned by one or more non-Fleet agents.<br><br>Note that Fleet does not support the case where one resource is being placed multiple<br>times by different CRPs on the same member cluster. An apply error will be returned if<br>Fleet finds that a resource has been owned by another placement attempt by Fleet, even<br>with the AllowCoOwnership setting set to true.</td><td></td><td></td></tr><tr><td><code>serverSideApplyConfig</code> <em><a href=/website/docs/api-reference/#serversideapplyconfig>ServerSideApplyConfig</a></em></td><td>ServerSideApplyConfig defines the configuration for server side apply. It is honored only when type is ServerSideApply.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>whenToTakeOver</code> <em><a href=/website/docs/api-reference/#whentotakeovertype>WhenToTakeOverType</a></em></td><td>WhenToTakeOver determines the action to take when Fleet applies resources to a member<br>cluster for the first time and finds out that the resource already exists in the cluster.<br><br>This setting is most relevant in cases where you would like Fleet to manage pre-existing<br>resources on a member cluster.<br><br>Available options include:<br><br>* Always: with this action, Fleet will apply the hub cluster manifests to the member<br>clusters even if the affected resources already exist. This is the default action.<br><br>Note that this might lead to fields being overwritten on the member clusters, if they<br>are specified in the hub cluster manifests.<br><br>* IfNoDiff: with this action, Fleet will apply the hub cluster manifests to the member<br>clusters if (and only if) pre-existing resources look the same as the hub cluster manifests.<br><br>This is a safer option as pre-existing resources that are inconsistent with the hub cluster<br>manifests will not be overwritten; Fleet will ignore them until the inconsistencies<br>are resolved properly: any change you make to the hub cluster manifests would not be<br>applied, and if you delete the manifests or even the ClusterResourcePlacement itself<br>from the hub cluster, these pre-existing resources would not be taken away.<br><br>Fleet will check for inconsistencies in accordance with the ComparisonOption setting. See also<br>the comments on the ComparisonOption field for more information.<br><br>If a diff has been found in a field that is <strong>managed</strong> by Fleet (i.e., the field<br>*<em>is specified ** in the hub cluster manifest), consider one of the following actions:<br>* set the field in the member cluster to be of the same value as that in the hub cluster<br>manifest.<br>* update the hub cluster manifest so that its field value matches with that in the member<br>cluster.<br>* switch to the Always action, which will allow Fleet to overwrite the field with the<br>value in the hub cluster manifest.<br><br>If a diff has been found in a field that is <strong>not managed</strong> by Fleet (i.e., the field<br><strong>is not specified</strong> in the hub cluster manifest), consider one of the following actions:<br>* remove the field from the member cluster.<br>* update the hub cluster manifest so that the field is included in the hub cluster manifest.<br><br>If appropriate, you may also delete the object from the member cluster; Fleet will recreate<br>it using the hub cluster manifest.<br><br></em>Never: with this action, Fleet will not apply a hub cluster manifest to the member<br>clusters if there is a corresponding pre-existing resource. However, if a manifest<br>has never been applied yet; or it has a corresponding resource which Fleet has assumed<br>ownership, apply op will still be executed.<br><br>This is the safest option; one will have to remove the pre-existing resources (so that<br>Fleet can re-create them) or switch to a different<br>WhenToTakeOver option before Fleet starts processing the corresponding hub cluster<br>manifests.<br><br>If you prefer Fleet stop processing all manifests, use this option along with the<br>ReportDiff apply strategy type. This setup would instruct Fleet to touch nothing<br>on the member cluster side but still report configuration differences between the<br>hub cluster and member clusters. Fleet will not give up ownership<br>that it has already assumed though.</td><td>Always</td><td>Enum: [Always IfNoDiff Never]<br>Optional: {}<br></td></tr></tbody></table><h4 id=applystrategytype-1>ApplyStrategyType</h4><p><em>Underlying type:</em> <em>string</em></p><p>ApplyStrategyType describes the type of the strategy used to apply the resource to the target cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>ClientSideApply</code></td><td>ApplyStrategyTypeClientSideApply will use three-way merge patch similar to how <code>kubectl apply</code> does by storing<br>last applied state in the <code>last-applied-configuration</code> annotation.<br>When the <code>last-applied-configuration</code> annotation size is greater than 256kB, it falls back to the server-side apply.<br></td></tr><tr><td><code>ServerSideApply</code></td><td>ApplyStrategyTypeServerSideApply will use server-side apply to resolve conflicts between the resource to be placed<br>and the existing resource in the target cluster.<br>Details: <a href=https://kubernetes.io/docs/reference/using-api/server-side-apply>https://kubernetes.io/docs/reference/using-api/server-side-apply</a><br></td></tr><tr><td><code>ReportDiff</code></td><td>ApplyStrategyTypeReportDiff will report differences between the desired state of a<br>resource as kept in the hub cluster and its current state (if applicable) on the member<br>cluster side. No actual apply ops would be executed.<br></td></tr></tbody></table><h4 id=approvalrequestspec-1>ApprovalRequestSpec</h4><p>ApprovalRequestSpec defines the desired state of the update run approval request.
The entire spec is immutable.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterapprovalrequest>ClusterApprovalRequest</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>parentStageRollout</code> <em>string</em></td><td>The name of the staged update run that this approval request is for.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>targetStage</code> <em>string</em></td><td>The name of the update stage that this approval request is for.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=approvalrequeststatus-1>ApprovalRequestStatus</h4><p>ApprovalRequestStatus defines the observed state of the ClusterApprovalRequest.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterapprovalrequest>ClusterApprovalRequest</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for the specific type of post-update task.<br>Known conditions are &ldquo;Approved&rdquo; and &ldquo;ApprovalAccepted&rdquo;.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=bindingstate-1>BindingState</h4><p><em>Underlying type:</em> <em>string</em></p><p>BindingState is the state of the binding.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingspec>ResourceBindingSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>Scheduled</code></td><td>BindingStateScheduled means the binding is scheduled but need to be bound to the target cluster.<br></td></tr><tr><td><code>Bound</code></td><td>BindingStateBound means the binding is bound to the target cluster.<br></td></tr><tr><td><code>Unscheduled</code></td><td>BindingStateUnscheduled means the binding is not scheduled on to the target cluster anymore.<br>This is a state that rollout controller cares about.<br>The work generator still treat this as bound until rollout controller deletes the binding.<br></td></tr></tbody></table><h4 id=clusteraffinity-1>ClusterAffinity</h4><p>ClusterAffinity contains cluster affinity scheduling rules for the selected resources.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#affinity>Affinity</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>requiredDuringSchedulingIgnoredDuringExecution</code> <em><a href=/website/docs/api-reference/#clusterselector>ClusterSelector</a></em></td><td>If the affinity requirements specified by this field are not met at<br>scheduling time, the resource will not be scheduled onto the cluster.<br>If the affinity requirements specified by this field cease to be met<br>at some point after the placement (e.g. due to an update), the system<br>may or may not try to eventually remove the resource from the cluster.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>preferredDuringSchedulingIgnoredDuringExecution</code> <em><a href=/website/docs/api-reference/#preferredclusterselector>PreferredClusterSelector</a> array</em></td><td>The scheduler computes a score for each cluster at schedule time by iterating<br>through the elements of this field and adding &ldquo;weight&rdquo; to the sum if the cluster<br>matches the corresponding matchExpression. The scheduler then chooses the first<br><code>N</code> clusters with the highest sum to satisfy the placement.<br>This field is ignored if the placement type is &ldquo;PickAll&rdquo;.<br>If the cluster score changes at some point after the placement (e.g. due to an update),<br>the system may or may not try to eventually move the resource from a cluster with a lower score<br>to a cluster with higher score.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=clusterapprovalrequest-1>ClusterApprovalRequest</h4><p>ClusterApprovalRequest defines a request for user approval for cluster staged update run.
The request object MUST have the following labels:</p><ul><li><code>TargetUpdateRun</code>: Points to the cluster staged update run that this approval request is for.</li><li><code>TargetStage</code>: The name of the stage that this approval request is for.</li><li><code>IsLatestUpdateRunApproval</code>: Indicates whether this approval request is the latest one related to this update run.</li></ul><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterapprovalrequestlist>ClusterApprovalRequestList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterApprovalRequest</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#approvalrequestspec>ApprovalRequestSpec</a></em></td><td>The desired state of ClusterApprovalRequest.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#approvalrequeststatus>ApprovalRequestStatus</a></em></td><td>The observed state of ClusterApprovalRequest.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=clusterdecision-1>ClusterDecision</h4><p>ClusterDecision represents a decision from a placement
An empty ClusterDecision indicates it is not scheduled yet.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingspec>ResourceBindingSpec</a></li><li><a href=/website/docs/api-reference/#schedulingpolicysnapshotstatus>SchedulingPolicySnapshotStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterName</code> <em>string</em></td><td>ClusterName is the name of the ManagedCluster. If it is not empty, its value should be unique cross all<br>placement decisions for the Placement.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>selected</code> <em>boolean</em></td><td>Selected indicates if this cluster is selected by the scheduler.</td><td></td><td></td></tr><tr><td><code>clusterScore</code> <em><a href=/website/docs/api-reference/#clusterscore>ClusterScore</a></em></td><td>ClusterScore represents the score of the cluster calculated by the scheduler.</td><td></td><td></td></tr><tr><td><code>reason</code> <em>string</em></td><td>Reason represents the reason why the cluster is selected or not.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourcebinding-1>ClusterResourceBinding</h4><p>ClusterResourceBinding represents a scheduling decision that binds a group of resources to a cluster.
It MUST have a label named <code>CRPTrackingLabel</code> that points to the cluster resource policy that creates it.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcebindinglist>ClusterResourceBindingList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourceBinding</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#resourcebindingspec>ResourceBindingSpec</a></em></td><td>The desired state of ClusterResourceBinding.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#resourcebindingstatus>ResourceBindingStatus</a></em></td><td>The observed status of ClusterResourceBinding.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceplacement-1>ClusterResourcePlacement</h4><p>ClusterResourcePlacement is used to select cluster scoped resources, including built-in resources and custom resources,
and placement them onto selected member clusters in a fleet.</p><p>If a namespace is selected, ALL the resources under the namespace are placed to the target clusters.
Note that you can&rsquo;t select the following resources:</p><ul><li>reserved namespaces including: default, kube-* (reserved for Kubernetes system namespaces),
fleet-* (reserved for fleet system namespaces).</li><li>reserved fleet resource types including: MemberCluster, InternalMemberCluster, ClusterResourcePlacement,
ClusterSchedulingPolicySnapshot, ClusterResourceSnapshot, ClusterResourceBinding, etc.</li></ul><p><code>ClusterSchedulingPolicySnapshot</code> and <code>ClusterResourceSnapshot</code> objects are created when there are changes in the
system to keep the history of the changes affecting a <code>ClusterResourcePlacement</code>.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementlist>ClusterResourcePlacementList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourcePlacement</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#clusterresourceplacementspec>ClusterResourcePlacementSpec</a></em></td><td>The desired state of ClusterResourcePlacement.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#clusterresourceplacementstatus>ClusterResourcePlacementStatus</a></em></td><td>The observed status of ClusterResourcePlacement.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=clusterresourceplacementdisruptionbudget-1>ClusterResourcePlacementDisruptionBudget</h4><p>ClusterResourcePlacementDisruptionBudget is the policy applied to a ClusterResourcePlacement
object that specifies its disruption budget, i.e., how many placements (clusters) can be
down at the same time due to voluntary disruptions (e.g., evictions). Involuntary
disruptions are not subject to this budget, but will still count against it.</p><p>To apply a ClusterResourcePlacementDisruptionBudget to a ClusterResourcePlacement, use the
same name for the ClusterResourcePlacementDisruptionBudget object as the ClusterResourcePlacement
object. This guarantees a 1:1 link between the two objects.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementdisruptionbudgetlist>ClusterResourcePlacementDisruptionBudgetList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourcePlacementDisruptionBudget</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#placementdisruptionbudgetspec>PlacementDisruptionBudgetSpec</a></em></td><td>Spec is the desired state of the ClusterResourcePlacementDisruptionBudget.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceplacementeviction-1>ClusterResourcePlacementEviction</h4><p>ClusterResourcePlacementEviction is an eviction attempt on a specific placement from
a ClusterResourcePlacement object; one may use this API to force the removal of specific
resources from a cluster.</p><p>An eviction is a voluntary disruption; its execution is subject to the disruption budget
linked with the target ClusterResourcePlacement object (if present).</p><p>Beware that an eviction alone does not guarantee that a placement will not re-appear; i.e.,
after an eviction, the Fleet scheduler might still pick the previous target cluster for
placement. To prevent this, considering adding proper taints to the target cluster before running
an eviction that will exclude it from future placements; this is especially true in scenarios
where one would like to perform a cluster replacement.</p><p>For safety reasons, Fleet will only execute an eviction once; the spec in this object is immutable,
and once executed, the object will be ignored after. To trigger another eviction attempt on the
same placement from the same ClusterResourcePlacement object, one must re-create (delete and
create) the same Eviction object. Note also that an Eviction object will be
ignored once it is deemed invalid (e.g., such an object might be targeting a CRP object or
a placement that does not exist yet), even if it does become valid later
(e.g., the CRP object or the placement appears later). To fix the situation, re-create the
Eviction object.</p><p>Note: Eviction of resources from a cluster propagated by a PickFixed CRP is not allowed.
If the user wants to remove resources from a cluster propagated by a PickFixed CRP simply
remove the cluster name from cluster names field from the CRP spec.</p><p>Executed evictions might be kept around for a while for auditing purposes; the Fleet controllers might
have a TTL set up for such objects and will garbage collect them automatically. For further
information, see the Fleet documentation.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementevictionlist>ClusterResourcePlacementEvictionList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourcePlacementEviction</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#placementevictionspec>PlacementEvictionSpec</a></em></td><td>Spec is the desired state of the ClusterResourcePlacementEviction.<br><br>Note that all fields in the spec are immutable.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#placementevictionstatus>PlacementEvictionStatus</a></em></td><td>Status is the observed state of the ClusterResourcePlacementEviction.</td><td></td><td></td></tr></tbody></table><h4 id=clusterresourceplacementspec-1>ClusterResourcePlacementSpec</h4><p>ClusterResourcePlacementSpec defines the desired state of ClusterResourcePlacement.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacement>ClusterResourcePlacement</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>resourceSelectors</code> <em><a href=/website/docs/api-reference/#clusterresourceselector>ClusterResourceSelector</a> array</em></td><td>ResourceSelectors is an array of selectors used to select cluster scoped resources. The selectors are <code>ORed</code>.<br>You can have 1-100 selectors.</td><td></td><td>MaxItems: 100<br>MinItems: 1<br>Required: {}<br></td></tr><tr><td><code>policy</code> <em><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></em></td><td>Policy defines how to select member clusters to place the selected resources.<br>If unspecified, all the joined member clusters are selected.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>strategy</code> <em><a href=/website/docs/api-reference/#rolloutstrategy>RolloutStrategy</a></em></td><td>The rollout strategy to use to replace existing placement with new ones.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>revisionHistoryLimit</code> <em>integer</em></td><td>The number of old ClusterSchedulingPolicySnapshot or ClusterResourceSnapshot resources to retain to allow rollback.<br>This is a pointer to distinguish between explicit zero and not specified.<br>Defaults to 10.</td><td>10</td><td>Maximum: 1000<br>Minimum: 1<br>Optional: {}<br></td></tr></tbody></table><h4 id=clusterresourceplacementstatus-1>ClusterResourcePlacementStatus</h4><p>ClusterResourcePlacementStatus defines the observed state of the ClusterResourcePlacement object.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacement>ClusterResourcePlacement</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>selectedResources</code> <em><a href=/website/docs/api-reference/#resourceidentifier>ResourceIdentifier</a> array</em></td><td>SelectedResources contains a list of resources selected by ResourceSelectors.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>observedResourceIndex</code> <em>string</em></td><td>Resource index logically represents the generation of the selected resources.<br>We take a new snapshot of the selected resources whenever the selection or their content change.<br>Each snapshot has a different resource index.<br>One resource snapshot can contain multiple clusterResourceSnapshots CRs in order to store large amount of resources.<br>To get clusterResourceSnapshot of a given resource index, use the following command:<br><code>kubectl get ClusterResourceSnapshot --selector=kubernetes-fleet.io/resource-index=$ObservedResourceIndex</code><br>ObservedResourceIndex is the resource index that the conditions in the ClusterResourcePlacementStatus observe.<br>For example, a condition of <code>ClusterResourcePlacementWorkSynchronized</code> type<br>is observing the synchronization status of the resource snapshot with the resource index $ObservedResourceIndex.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>placementStatuses</code> <em><a href=/website/docs/api-reference/#resourceplacementstatus>ResourcePlacementStatus</a> array</em></td><td>PlacementStatuses contains a list of placement status on the clusters that are selected by PlacementPolicy.<br>Each selected cluster according to the latest resource placement is guaranteed to have a corresponding placementStatuses.<br>In the pickN case, there are N placement statuses where N = NumberOfClusters; Or in the pickFixed case, there are<br>N placement statuses where N = ClusterNames.<br>In these cases, some of them may not have assigned clusters when we cannot fill the required number of clusters.<br>TODO, For pickAll type, considering providing unselected clusters info.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for ClusterResourcePlacement.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=clusterresourceselector-1>ClusterResourceSelector</h4><p>ClusterResourceSelector is used to select cluster scoped resources as the target resources to be placed.
If a namespace is selected, ALL the resources under the namespace are selected automatically.
All the fields are <code>ANDed</code>. In other words, a resource must match all the fields to be selected.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceoverridespec>ClusterResourceOverrideSpec</a></li><li><a href=/website/docs/api-reference/#clusterresourceplacementspec>ClusterResourcePlacementSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>group</code> <em>string</em></td><td>Group name of the cluster-scoped resource.<br>Use an empty string to select resources under the core API group (e.g., namespaces).</td><td></td><td>Required: {}<br></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version of the cluster-scoped resource.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind of the cluster-scoped resource.<br>Note: When <code>Kind</code> is <code>namespace</code>, ALL the resources under the selected namespaces are selected.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name of the cluster-scoped resource.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>labelSelector</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#labelselector-v1-meta>LabelSelector</a></em></td><td>A label query over all the cluster-scoped resources. Resources matching the query are selected.<br>Note that namespace-scoped resources can&rsquo;t be selected even if they match the query.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=clusterresourcesnapshot-1>ClusterResourceSnapshot</h4><p>ClusterResourceSnapshot is used to store a snapshot of selected resources by a resource placement policy.
Its spec is immutable.
We may need to produce more than one resourceSnapshot for all the resources a ResourcePlacement selected to get around the 1MB size limit of k8s objects.
We assign an ever-increasing index for each such group of resourceSnapshots.
The naming convention of a clusterResourceSnapshot is {CRPName}-{resourceIndex}-{subindex}
where the name of the first snapshot of a group has no subindex part so its name is {CRPName}-{resourceIndex}-snapshot.
resourceIndex will begin with 0.
Each snapshot MUST have the following labels:</p><ul><li><code>CRPTrackingLabel</code> which points to its owner CRP.</li><li><code>ResourceIndexLabel</code> which is the index of the snapshot group.</li><li><code>IsLatestSnapshotLabel</code> which indicates whether the snapshot is the latest one.</li></ul><p>All the snapshots within the same index group must have the same ResourceIndexLabel.</p><p>The first snapshot of the index group MUST have the following annotations:</p><ul><li><code>NumberOfResourceSnapshotsAnnotation</code> to store the total number of resource snapshots in the index group.</li><li><code>ResourceGroupHashAnnotation</code> whose value is the sha-256 hash of all the snapshots belong to the same snapshot index.</li></ul><p>Each snapshot (excluding the first snapshot) MUST have the following annotations:</p><ul><li><code>SubindexOfResourceSnapshotAnnotation</code> to store the subindex of resource snapshot in the group.</li></ul><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcesnapshotlist>ClusterResourceSnapshotList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterResourceSnapshot</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#resourcesnapshotspec>ResourceSnapshotSpec</a></em></td><td>The desired state of ResourceSnapshot.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#resourcesnapshotstatus>ResourceSnapshotStatus</a></em></td><td>The observed status of ResourceSnapshot.</td><td></td><td></td></tr></tbody></table><h4 id=clusterschedulingpolicysnapshot-1>ClusterSchedulingPolicySnapshot</h4><p>ClusterSchedulingPolicySnapshot is used to store a snapshot of cluster placement policy.
Its spec is immutable.
The naming convention of a ClusterSchedulingPolicySnapshot is {CRPName}-{PolicySnapshotIndex}.
PolicySnapshotIndex will begin with 0.
Each snapshot must have the following labels:</p><ul><li><code>CRPTrackingLabel</code> which points to its owner CRP.</li><li><code>PolicyIndexLabel</code> which is the index of the policy snapshot.</li><li><code>IsLatestSnapshotLabel</code> which indicates whether the snapshot is the latest one.</li></ul><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterschedulingpolicysnapshotlist>ClusterSchedulingPolicySnapshotList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterSchedulingPolicySnapshot</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#schedulingpolicysnapshotspec>SchedulingPolicySnapshotSpec</a></em></td><td>The desired state of SchedulingPolicySnapshot.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#schedulingpolicysnapshotstatus>SchedulingPolicySnapshotStatus</a></em></td><td>The observed status of SchedulingPolicySnapshot.</td><td></td><td></td></tr></tbody></table><h4 id=clusterscore-1>ClusterScore</h4><p>ClusterScore represents the score of the cluster calculated by the scheduler.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterdecision>ClusterDecision</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>affinityScore</code> <em>integer</em></td><td>AffinityScore represents the affinity score of the cluster calculated by the last<br>scheduling decision based on the preferred affinity selector.<br>An affinity score may not present if the cluster does not meet the required affinity.</td><td></td><td></td></tr><tr><td><code>priorityScore</code> <em>integer</em></td><td>TopologySpreadScore represents the priority score of the cluster calculated by the last<br>scheduling decision based on the topology spread applied to the cluster.<br>A priority score may not present if the cluster does not meet the topology spread.</td><td></td><td></td></tr></tbody></table><h4 id=clusterselector-1>ClusterSelector</h4><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusteraffinity>ClusterAffinity</a></li><li><a href=/website/docs/api-reference/#overriderule>OverrideRule</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterSelectorTerms</code> <em><a href=/website/docs/api-reference/#clusterselectorterm>ClusterSelectorTerm</a> array</em></td><td>ClusterSelectorTerms is a list of cluster selector terms. The terms are <code>ORed</code>.</td><td></td><td>MaxItems: 10<br>Required: {}<br></td></tr></tbody></table><h4 id=clusterselectorterm-1>ClusterSelectorTerm</h4><p><em>Underlying type:</em> <em><a href=/website/docs/api-reference/#struct%7blabelselector-*k8sioapimachinerypkgapismetav1labelselector-%22json:%5c%22labelselector,omitempty%5c%22%22;-propertyselector-*propertyselector-%22json:%5c%22propertyselector,omitempty%5c%22%22;-propertysorter-*propertysorter-%22json:%5c%22propertysorter,omitempty%5c%22%22%7d>struct{LabelSelector *k8s.io/apimachinery/pkg/apis/meta/v1.LabelSelector &ldquo;json:"labelSelector,omitempty"&rdquo;; PropertySelector *PropertySelector &ldquo;json:"propertySelector,omitempty"&rdquo;; PropertySorter *PropertySorter &ldquo;json:"propertySorter,omitempty"&rdquo;}</a></em></p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#preferredclusterselector>PreferredClusterSelector</a></li></ul><h4 id=clusterstagedupdaterun-1>ClusterStagedUpdateRun</h4><p>ClusterStagedUpdateRun represents a stage by stage update process that applies ClusterResourcePlacement
selected resources to specified clusters.
Resources from unselected clusters are removed after all stages in the update strategy are completed.
Each ClusterStagedUpdateRun object corresponds to a single release of a specific resource version.
The release is abandoned if the ClusterStagedUpdateRun object is deleted or the scheduling decision changes.
The name of the ClusterStagedUpdateRun must conform to RFC 1123.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterstagedupdaterunlist>ClusterStagedUpdateRunList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterStagedUpdateRun</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#stagedupdaterunspec>StagedUpdateRunSpec</a></em></td><td>The desired state of ClusterStagedUpdateRun. The spec is immutable.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#stagedupdaterunstatus>StagedUpdateRunStatus</a></em></td><td>The observed status of ClusterStagedUpdateRun.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=clusterstagedupdatestrategy-1>ClusterStagedUpdateStrategy</h4><p>ClusterStagedUpdateStrategy defines a reusable strategy that specifies the stages and the sequence
in which the selected cluster resources will be updated on the member clusters.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterstagedupdatestrategylist>ClusterStagedUpdateStrategyList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>ClusterStagedUpdateStrategy</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#stagedupdatestrategyspec>StagedUpdateStrategySpec</a></em></td><td>The desired state of ClusterStagedUpdateStrategy.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=clusterupdatingstatus-1>ClusterUpdatingStatus</h4><p>ClusterUpdatingStatus defines the status of the update run on a cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#stageupdatingstatus>StageUpdatingStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterName</code> <em>string</em></td><td>The name of the cluster.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>resourceOverrideSnapshots</code> <em><a href=/website/docs/api-reference/#namespacedname>NamespacedName</a> array</em></td><td>ResourceOverrideSnapshots is a list of ResourceOverride snapshots associated with the cluster.<br>The list is computed at the beginning of the update run and not updated during the update run.<br>The list is empty if there are no resource overrides associated with the cluster.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>clusterResourceOverrideSnapshots</code> <em>string array</em></td><td>ClusterResourceOverrides contains a list of applicable ClusterResourceOverride snapshot names<br>associated with the cluster.<br>The list is computed at the beginning of the update run and not updated during the update run.<br>The list is empty if there are no cluster overrides associated with the cluster.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for clusters. Empty if the cluster has not started updating.<br>Known conditions are &ldquo;Started&rdquo;, &ldquo;Succeeded&rdquo;.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=comparisonoptiontype>ComparisonOptionType</h4><p><em>Underlying type:</em> <em>string</em></p><p>ComparisonOptionType describes the compare option that Fleet uses to detect drifts and/or
calculate differences.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>PartialComparison</code></td><td>ComparisonOptionTypePartialComparison will compare only fields that are managed by Fleet, i.e.,<br>fields that are specified explicitly in the hub cluster manifest. Unmanaged fields<br>are ignored.<br></td></tr><tr><td><code>FullComparison</code></td><td>ComparisonOptionTypeFullDiff will compare all fields of the resource, even if the fields<br>are absent from the hub cluster manifest.<br></td></tr></tbody></table><h4 id=diffdetails>DiffDetails</h4><p>DiffDetails describes the observed configuration differences.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#manifestcondition>ManifestCondition</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>observationTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>ObservationTime is the timestamp when the configuration difference was last detected.</td><td></td><td>Format: date-time<br>Required: {}<br>Type: string<br></td></tr><tr><td><code>observedInMemberClusterGeneration</code> <em>integer</em></td><td>ObservedInMemberClusterGeneration is the generation of the applied manifest on the member<br>cluster side.<br><br>This might be nil if the resource has not been created yet in the member cluster.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>firstDiffedObservedTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>FirsftDiffedObservedTime is the timestamp when the configuration difference<br>was first detected.</td><td></td><td>Format: date-time<br>Required: {}<br>Type: string<br></td></tr><tr><td><code>observedDiffs</code> <em><a href=/website/docs/api-reference/#patchdetail>PatchDetail</a> array</em></td><td>ObservedDiffs describes each field with configuration difference as found from the<br>member cluster side.<br><br>Fleet might truncate the details as appropriate to control object size.<br><br>Each entry specifies how the live state (the state on the member cluster side) compares<br>against the desired state (the state kept in the hub cluster manifest).</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=diffedresourceplacement>DiffedResourcePlacement</h4><p>DiffedResourcePlacement contains the details of a resource with configuration differences.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingstatus>ResourceBindingStatus</a></li><li><a href=/website/docs/api-reference/#resourceplacementstatus>ResourcePlacementStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>group</code> <em>string</em></td><td>Group is the group name of the selected resource.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version is the version of the selected resource.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind represents the Kind of the selected resources.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name of the target resource.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the resource. Empty if the resource is cluster scoped.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>envelope</code> <em><a href=/website/docs/api-reference/#envelopeidentifier>EnvelopeIdentifier</a></em></td><td>Envelope identifies the envelope object that contains this resource.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>observationTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>ObservationTime is the time when we observe the configuration differences for the resource.</td><td></td><td>Format: date-time<br>Required: {}<br>Type: string<br></td></tr><tr><td><code>targetClusterObservedGeneration</code> <em>integer</em></td><td>TargetClusterObservedGeneration is the generation of the resource on the target cluster<br>that contains the configuration differences.<br><br>This might be nil if the resource has not been created yet on the target cluster.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>firstDiffedObservedTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>FirstDiffedObservedTime is the first time the resource on the target cluster is<br>observed to have configuration differences.</td><td></td><td>Format: date-time<br>Required: {}<br>Type: string<br></td></tr><tr><td><code>observedDiffs</code> <em><a href=/website/docs/api-reference/#patchdetail>PatchDetail</a> array</em></td><td>ObservedDiffs are the details about the found configuration differences. Note that<br>Fleet might truncate the details as appropriate to control the object size.<br><br>Each detail entry specifies how the live state (the state on the member<br>cluster side) compares against the desired state (the state kept in the hub cluster manifest).<br><br>An event about the details will be emitted as well.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=driftdetails>DriftDetails</h4><p>DriftDetails describes the observed configuration drifts.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#manifestcondition>ManifestCondition</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>observationTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>ObservationTime is the timestamp when the drift was last detected.</td><td></td><td>Format: date-time<br>Required: {}<br>Type: string<br></td></tr><tr><td><code>observedInMemberClusterGeneration</code> <em>integer</em></td><td>ObservedInMemberClusterGeneration is the generation of the applied manifest on the member<br>cluster side.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>firstDriftedObservedTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>FirsftDriftedObservedTime is the timestamp when the drift was first detected.</td><td></td><td>Format: date-time<br>Required: {}<br>Type: string<br></td></tr><tr><td><code>observedDrifts</code> <em><a href=/website/docs/api-reference/#patchdetail>PatchDetail</a> array</em></td><td>ObservedDrifts describes each drifted field found from the applied manifest.<br>Fleet might truncate the details as appropriate to control object size.<br><br>Each entry specifies how the live state (the state on the member cluster side) compares<br>against the desired state (the state kept in the hub cluster manifest).</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=driftedresourceplacement>DriftedResourcePlacement</h4><p>DriftedResourcePlacement contains the details of a resource with configuration drifts.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingstatus>ResourceBindingStatus</a></li><li><a href=/website/docs/api-reference/#resourceplacementstatus>ResourcePlacementStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>group</code> <em>string</em></td><td>Group is the group name of the selected resource.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version is the version of the selected resource.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind represents the Kind of the selected resources.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name of the target resource.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the resource. Empty if the resource is cluster scoped.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>envelope</code> <em><a href=/website/docs/api-reference/#envelopeidentifier>EnvelopeIdentifier</a></em></td><td>Envelope identifies the envelope object that contains this resource.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>observationTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>ObservationTime is the time when we observe the configuration drifts for the resource.</td><td></td><td>Format: date-time<br>Required: {}<br>Type: string<br></td></tr><tr><td><code>targetClusterObservedGeneration</code> <em>integer</em></td><td>TargetClusterObservedGeneration is the generation of the resource on the target cluster<br>that contains the configuration drifts.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>firstDriftedObservedTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>FirstDriftedObservedTime is the first time the resource on the target cluster is<br>observed to have configuration drifts.</td><td></td><td>Format: date-time<br>Required: {}<br>Type: string<br></td></tr><tr><td><code>observedDrifts</code> <em><a href=/website/docs/api-reference/#patchdetail>PatchDetail</a> array</em></td><td>ObservedDrifts are the details about the found configuration drifts. Note that<br>Fleet might truncate the details as appropriate to control the object size.<br><br>Each detail entry specifies how the live state (the state on the member<br>cluster side) compares against the desired state (the state kept in the hub cluster manifest).<br><br>An event about the details will be emitted as well.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=envelopeidentifier-1>EnvelopeIdentifier</h4><p>EnvelopeIdentifier identifies the envelope object that contains the selected resource.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#diffedresourceplacement>DiffedResourcePlacement</a></li><li><a href=/website/docs/api-reference/#driftedresourceplacement>DriftedResourcePlacement</a></li><li><a href=/website/docs/api-reference/#failedresourceplacement>FailedResourcePlacement</a></li><li><a href=/website/docs/api-reference/#resourceidentifier>ResourceIdentifier</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>name</code> <em>string</em></td><td>Name of the envelope object.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the envelope object. Empty if the envelope object is cluster scoped.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#envelopetype>EnvelopeType</a></em></td><td>Type of the envelope object.</td><td>ConfigMap</td><td>Enum: [ConfigMap]<br>Optional: {}<br></td></tr></tbody></table><h4 id=envelopetype-1>EnvelopeType</h4><p><em>Underlying type:</em> <em>string</em></p><p>EnvelopeType defines the type of the envelope object.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#envelopeidentifier>EnvelopeIdentifier</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>ConfigMap</code></td><td>ConfigMapEnvelopeType means the envelope object is of type <code>ConfigMap</code>.<br></td></tr></tbody></table><h4 id=failedresourceplacement-1>FailedResourcePlacement</h4><p>FailedResourcePlacement contains the failure details of a failed resource placement.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcebindingstatus>ResourceBindingStatus</a></li><li><a href=/website/docs/api-reference/#resourceplacementstatus>ResourcePlacementStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>group</code> <em>string</em></td><td>Group is the group name of the selected resource.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version is the version of the selected resource.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind represents the Kind of the selected resources.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name of the target resource.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the resource. Empty if the resource is cluster scoped.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>envelope</code> <em><a href=/website/docs/api-reference/#envelopeidentifier>EnvelopeIdentifier</a></em></td><td>Envelope identifies the envelope object that contains this resource.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>condition</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a></em></td><td>The failed condition status.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=manifest-1>Manifest</h4><p>Manifest represents a resource to be deployed on spoke cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#workloadtemplate>WorkloadTemplate</a></li></ul><h4 id=manifestcondition-1>ManifestCondition</h4><p>ManifestCondition represents the conditions of the resources deployed on
spoke cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#workstatus>WorkStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>identifier</code> <em><a href=/website/docs/api-reference/#workresourceidentifier>WorkResourceIdentifier</a></em></td><td>resourceId represents a identity of a resource linking to manifests in spec.</td><td></td><td></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions represents the conditions of this resource on spoke cluster</td><td></td><td></td></tr><tr><td><code>driftDetails</code> <em><a href=/website/docs/api-reference/#driftdetails>DriftDetails</a></em></td><td>DriftDetails explains about the observed configuration drifts.<br>Fleet might truncate the details as appropriate to control object size.<br><br>Note that configuration drifts can only occur on a resource if it is currently owned by<br>Fleet and its corresponding placement is set to use the ClientSideApply or ServerSideApply<br>apply strategy. In other words, DriftDetails and DiffDetails will not be populated<br>at the same time.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>diffDetails</code> <em><a href=/website/docs/api-reference/#diffdetails>DiffDetails</a></em></td><td>DiffDetails explains the details about the observed configuration differences.<br>Fleet might truncate the details as appropriate to control object size.<br><br>Note that configuration differences can only occur on a resource if it is not currently owned<br>by Fleet (i.e., it is a pre-existing resource that needs to be taken over), or if its<br>corresponding placement is set to use the ReportDiff apply strategy. In other words,<br>DiffDetails and DriftDetails will not be populated at the same time.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=namespacedname-1>NamespacedName</h4><p>NamespacedName comprises a resource name, with a mandatory namespace.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterupdatingstatus>ClusterUpdatingStatus</a></li><li><a href=/website/docs/api-reference/#clusterupdatingstatus>ClusterUpdatingStatus</a></li><li><a href=/website/docs/api-reference/#resourcebindingspec>ResourceBindingSpec</a></li><li><a href=/website/docs/api-reference/#resourceplacementstatus>ResourcePlacementStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>name</code> <em>string</em></td><td>Name is the name of the namespaced scope resource.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is namespace of the namespaced scope resource.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=patchdetail>PatchDetail</h4><p>PatchDetail describes a patch that explains an observed configuration drift or
difference.</p><p>A patch detail can be transcribed as a JSON patch operation, as specified in RFC 6902.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#diffdetails>DiffDetails</a></li><li><a href=/website/docs/api-reference/#diffedresourceplacement>DiffedResourcePlacement</a></li><li><a href=/website/docs/api-reference/#driftdetails>DriftDetails</a></li><li><a href=/website/docs/api-reference/#driftedresourceplacement>DriftedResourcePlacement</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>path</code> <em>string</em></td><td>The JSON path that points to a field that has drifted or has configuration differences.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>valueInMember</code> <em>string</em></td><td>The value at the JSON path from the member cluster side.<br><br>This field can be empty if the JSON path does not exist on the member cluster side; i.e.,<br>applying the manifest from the hub cluster side would add a new field.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>valueInHub</code> <em>string</em></td><td>The value at the JSON path from the hub cluster side.<br><br>This field can be empty if the JSON path does not exist on the hub cluster side; i.e.,<br>applying the manifest from the hub cluster side would remove the field.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=placementdisruptionbudgetspec-1>PlacementDisruptionBudgetSpec</h4><p>PlacementDisruptionBudgetSpec is the desired state of the PlacementDisruptionBudget.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementdisruptionbudget>ClusterResourcePlacementDisruptionBudget</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>maxUnavailable</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#intorstring-intstr-util>IntOrString</a></em></td><td>MaxUnavailable is the maximum number of placements (clusters) that can be down at the<br>same time due to voluntary disruptions. For example, a setting of 1 would imply that<br>a voluntary disruption (e.g., an eviction) can only happen if all placements (clusters)<br>from the linked Placement object are applied and available.<br><br>This can be either an absolute value (e.g., 1) or a percentage (e.g., 10%).<br><br>If a percentage is specified, Fleet will calculate the corresponding absolute values<br>as follows:<br>* if the linked Placement object is of the PickFixed placement type,<br>we don&rsquo;t perform any calculation because eviction is not allowed for PickFixed CRP.<br>* if the linked Placement object is of the PickAll placement type, MaxUnavailable cannot<br>be specified since we cannot derive the total number of clusters selected.<br>* if the linked Placement object is of the PickN placement type,<br>the percentage is against the number of clusters specified in the placement (i.e., the<br>value of the NumberOfClusters fields in the placement policy).<br>The end result will be rounded up to the nearest integer if applicable.<br><br>One may use a value of 0 for this field; in this case, no voluntary disruption would be<br>allowed.<br><br>This field is mutually exclusive with the MinAvailable field in the spec; exactly one<br>of them can be set at a time.</td><td></td><td>XIntOrString: {}<br></td></tr><tr><td><code>minAvailable</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#intorstring-intstr-util>IntOrString</a></em></td><td>MinAvailable is the minimum number of placements (clusters) that must be available at any<br>time despite voluntary disruptions. For example, a setting of 10 would imply that<br>a voluntary disruption (e.g., an eviction) can only happen if there are at least 11<br>placements (clusters) from the linked Placement object are applied and available.<br><br>This can be either an absolute value (e.g., 1) or a percentage (e.g., 10%).<br><br>If a percentage is specified, Fleet will calculate the corresponding absolute values<br>as follows:<br>* if the linked Placement object is of the PickFixed placement type,<br>we don&rsquo;t perform any calculation because eviction is not allowed for PickFixed CRP.<br>* if the linked Placement object is of the PickAll placement type, MinAvailable can be<br>specified but only as an integer since we cannot derive the total number of clusters selected.<br>* if the linked Placement object is of the PickN placement type,<br>the percentage is against the number of clusters specified in the placement (i.e., the<br>value of the NumberOfClusters fields in the placement policy).<br>The end result will be rounded up to the nearest integer if applicable.<br><br>One may use a value of 0 for this field; in this case, voluntary disruption would be<br>allowed at any time.<br><br>This field is mutually exclusive with the MaxUnavailable field in the spec; exactly one<br>of them can be set at a time.</td><td></td><td>XIntOrString: {}<br></td></tr></tbody></table><h4 id=placementevictionspec-1>PlacementEvictionSpec</h4><p>PlacementEvictionSpec is the desired state of the parent PlacementEviction.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementeviction>ClusterResourcePlacementEviction</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>placementName</code> <em>string</em></td><td>PlacementName is the name of the Placement object which<br>the Eviction object targets.</td><td></td><td>MaxLength: 255<br>Required: {}<br></td></tr><tr><td><code>clusterName</code> <em>string</em></td><td>ClusterName is the name of the cluster that the Eviction object targets.</td><td></td><td>MaxLength: 255<br>Required: {}<br></td></tr></tbody></table><h4 id=placementevictionstatus-1>PlacementEvictionStatus</h4><p>PlacementEvictionStatus is the observed state of the parent PlacementEviction.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementeviction>ClusterResourcePlacementEviction</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is the list of currently observed conditions for the<br>PlacementEviction object.<br><br>Available condition types include:<br>* Valid: whether the Eviction object is valid, i.e., it targets at a valid placement.<br>* Executed: whether the Eviction object has been executed.</td><td></td><td></td></tr></tbody></table><h4 id=placementpolicy-1>PlacementPolicy</h4><p>PlacementPolicy contains the rules to select target member clusters to place the selected resources.
Note that only clusters that are both joined and satisfying the rules will be selected.</p><p>You can only specify at most one of the two fields: ClusterNames and Affinity.
If none is specified, all the joined clusters are selected.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementspec>ClusterResourcePlacementSpec</a></li><li><a href=/website/docs/api-reference/#schedulingpolicysnapshotspec>SchedulingPolicySnapshotSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>placementType</code> <em><a href=/website/docs/api-reference/#placementtype>PlacementType</a></em></td><td>Type of placement. Can be &ldquo;PickAll&rdquo;, &ldquo;PickN&rdquo; or &ldquo;PickFixed&rdquo;. Default is PickAll.</td><td>PickAll</td><td>Enum: [PickAll PickN PickFixed]<br>Optional: {}<br></td></tr><tr><td><code>clusterNames</code> <em>string array</em></td><td>ClusterNames contains a list of names of MemberCluster to place the selected resources.<br>Only valid if the placement type is &ldquo;PickFixed&rdquo;</td><td></td><td>MaxItems: 100<br>Optional: {}<br></td></tr><tr><td><code>numberOfClusters</code> <em>integer</em></td><td>NumberOfClusters of placement. Only valid if the placement type is &ldquo;PickN&rdquo;.</td><td></td><td>Minimum: 0<br>Optional: {}<br></td></tr><tr><td><code>affinity</code> <em><a href=/website/docs/api-reference/#affinity>Affinity</a></em></td><td>Affinity contains cluster affinity scheduling rules. Defines which member clusters to place the selected resources.<br>Only valid if the placement type is &ldquo;PickAll&rdquo; or &ldquo;PickN&rdquo;.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>topologySpreadConstraints</code> <em><a href=/website/docs/api-reference/#topologyspreadconstraint>TopologySpreadConstraint</a> array</em></td><td>TopologySpreadConstraints describes how a group of resources ought to spread across multiple topology<br>domains. Scheduler will schedule resources in a way which abides by the constraints.<br>All topologySpreadConstraints are ANDed.<br>Only valid if the placement type is &ldquo;PickN&rdquo;.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>tolerations</code> <em><a href=/website/docs/api-reference/#toleration>Toleration</a> array</em></td><td>If specified, the ClusterResourcePlacement&rsquo;s Tolerations.<br>Tolerations cannot be updated or deleted.<br><br>This field is beta-level and is for the taints and tolerations feature.</td><td></td><td>MaxItems: 100<br>Optional: {}<br></td></tr></tbody></table><h4 id=placementtype-1>PlacementType</h4><p><em>Underlying type:</em> <em>string</em></p><p>PlacementType identifies the type of placement.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>PickAll</code></td><td>PickAllPlacementType picks all clusters that satisfy the rules.<br></td></tr><tr><td><code>PickN</code></td><td>PickNPlacementType picks N clusters that satisfy the rules.<br></td></tr><tr><td><code>PickFixed</code></td><td>PickFixedPlacementType picks a fixed set of clusters.<br></td></tr></tbody></table><h4 id=preferredclusterselector-1>PreferredClusterSelector</h4><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusteraffinity>ClusterAffinity</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>weight</code> <em>integer</em></td><td>Weight associated with matching the corresponding clusterSelectorTerm, in the range [-100, 100].</td><td></td><td>Maximum: 100<br>Minimum: -100<br>Required: {}<br></td></tr><tr><td><code>preference</code> <em><a href=/website/docs/api-reference/#clusterselectorterm>ClusterSelectorTerm</a></em></td><td>A cluster selector term, associated with the corresponding weight.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=propertyselectoroperator-1>PropertySelectorOperator</h4><p><em>Underlying type:</em> <em>string</em></p><p>PropertySelectorOperator is the operator that can be used with PropertySelectorRequirements.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#propertyselectorrequirement>PropertySelectorRequirement</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>Gt</code></td><td>PropertySelectorGreaterThan dictates Fleet to select cluster if its observed value of a given<br>property is greater than the value specified in the requirement.<br></td></tr><tr><td><code>Ge</code></td><td>PropertySelectorGreaterThanOrEqualTo dictates Fleet to select cluster if its observed value<br>of a given property is greater than or equal to the value specified in the requirement.<br></td></tr><tr><td><code>Eq</code></td><td>PropertySelectorEqualTo dictates Fleet to select cluster if its observed value of a given<br>property is equal to the values specified in the requirement.<br></td></tr><tr><td><code>Ne</code></td><td>PropertySelectorNotEqualTo dictates Fleet to select cluster if its observed value of a given<br>property is not equal to the values specified in the requirement.<br></td></tr><tr><td><code>Lt</code></td><td>PropertySelectorLessThan dictates Fleet to select cluster if its observed value of a given<br>property is less than the value specified in the requirement.<br></td></tr><tr><td><code>Le</code></td><td>PropertySelectorLessThanOrEqualTo dictates Fleet to select cluster if its observed value of a<br>given property is less than or equal to the value specified in the requirement.<br></td></tr></tbody></table><h4 id=propertyselectorrequirement-1>PropertySelectorRequirement</h4><p>PropertySelectorRequirement is a specific property requirement when picking clusters for
resource placement.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#propertyselector>PropertySelector</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>name</code> <em>string</em></td><td>Name is the name of the property; it should be a Kubernetes label name.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>operator</code> <em><a href=/website/docs/api-reference/#propertyselectoroperator>PropertySelectorOperator</a></em></td><td>Operator specifies the relationship between a cluster&rsquo;s observed value of the specified<br>property and the values given in the requirement.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>values</code> <em>string array</em></td><td>Values are a list of values of the specified property which Fleet will compare against<br>the observed values of individual member clusters in accordance with the given<br>operator.<br><br>At this moment, each value should be a Kubernetes quantity. For more information, see<br><a href=https://pkg.go.dev/k8s.io/apimachinery/pkg/api/resource#Quantity>https://pkg.go.dev/k8s.io/apimachinery/pkg/api/resource#Quantity</a>.<br><br>If the operator is Gt (greater than), Ge (greater than or equal to), Lt (less than),<br>or <code>Le</code> (less than or equal to), Eq (equal to), or Ne (ne), exactly one value must be<br>specified in the list.</td><td></td><td>MaxItems: 1<br>Required: {}<br></td></tr></tbody></table><h4 id=propertysortorder-1>PropertySortOrder</h4><p><em>Underlying type:</em> <em>string</em></p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#propertysorter>PropertySorter</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>Descending</code></td><td>Descending instructs Fleet to sort in descending order, that is, the clusters with higher<br>observed values of a property are most preferred and should have higher weights. We will<br>use linear scaling to calculate the weight for each cluster based on the observed values.<br>For example, with this order, if Fleet sorts all clusters by a specific property where the<br>observed values are in the range [10, 100], and a weight of 100 is specified;<br>Fleet will assign:<br>* a weight of 100 to the cluster with the maximum observed value (100); and<br>* a weight of 0 to the cluster with the minimum observed value (10); and<br>* a weight of 11 to the cluster with an observed value of 20.<br>It is calculated using the formula below:<br>((20 - 10)) / (100 - 10)) * 100 = 11<br></td></tr><tr><td><code>Ascending</code></td><td>Ascending instructs Fleet to sort in ascending order, that is, the clusters with lower<br>observed values are most preferred and should have higher weights. We will use linear scaling<br>to calculate the weight for each cluster based on the observed values.<br>For example, with this order, if Fleet sorts all clusters by a specific property where<br>the observed values are in the range [10, 100], and a weight of 100 is specified;<br>Fleet will assign:<br>* a weight of 0 to the cluster with the maximum observed value (100); and<br>* a weight of 100 to the cluster with the minimum observed value (10); and<br>* a weight of 89 to the cluster with an observed value of 20.<br>It is calculated using the formula below:<br>(1 - ((20 - 10) / (100 - 10))) * 100 = 89<br></td></tr></tbody></table><h4 id=resourcebindingspec-1>ResourceBindingSpec</h4><p>ResourceBindingSpec defines the desired state of ClusterResourceBinding.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcebinding>ClusterResourceBinding</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>state</code> <em><a href=/website/docs/api-reference/#bindingstate>BindingState</a></em></td><td>The desired state of the binding. Possible values: Scheduled, Bound, Unscheduled.</td><td></td><td></td></tr><tr><td><code>resourceSnapshotName</code> <em>string</em></td><td>ResourceSnapshotName is the name of the resource snapshot that this resource binding points to.<br>If the resources are divided into multiple snapshots because of the resource size limit,<br>it points to the name of the leading snapshot of the index group.</td><td></td><td></td></tr><tr><td><code>resourceOverrideSnapshots</code> <em><a href=/website/docs/api-reference/#namespacedname>NamespacedName</a> array</em></td><td>ResourceOverrideSnapshots is a list of ResourceOverride snapshots associated with the selected resources.</td><td></td><td></td></tr><tr><td><code>clusterResourceOverrideSnapshots</code> <em>string array</em></td><td>ClusterResourceOverrides contains a list of applicable ClusterResourceOverride snapshot names associated with the<br>selected resources.</td><td></td><td></td></tr><tr><td><code>schedulingPolicySnapshotName</code> <em>string</em></td><td>SchedulingPolicySnapshotName is the name of the scheduling policy snapshot that this resource binding<br>points to; more specifically, the scheduler creates this bindings in accordance with this<br>scheduling policy snapshot.</td><td></td><td></td></tr><tr><td><code>targetCluster</code> <em>string</em></td><td>TargetCluster is the name of the cluster that the scheduler assigns the resources to.</td><td></td><td></td></tr><tr><td><code>clusterDecision</code> <em><a href=/website/docs/api-reference/#clusterdecision>ClusterDecision</a></em></td><td>ClusterDecision explains why the scheduler selected this cluster.</td><td></td><td></td></tr><tr><td><code>applyStrategy</code> <em><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></em></td><td>ApplyStrategy describes how to resolve the conflict if the resource to be placed already exists in the target cluster<br>and is owned by other appliers.</td><td></td><td></td></tr></tbody></table><h4 id=resourcebindingstatus-1>ResourceBindingStatus</h4><p>ResourceBindingStatus represents the current status of a ClusterResourceBinding.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcebinding>ClusterResourceBinding</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>failedPlacements</code> <em><a href=/website/docs/api-reference/#failedresourceplacement>FailedResourcePlacement</a> array</em></td><td>FailedPlacements is a list of all the resources failed to be placed to the given cluster or the resource is unavailable.<br>Note that we only include 100 failed resource placements even if there are more than 100.</td><td></td><td>MaxItems: 100<br></td></tr><tr><td><code>driftedPlacements</code> <em><a href=/website/docs/api-reference/#driftedresourceplacement>DriftedResourcePlacement</a> array</em></td><td>DriftedPlacements is a list of resources that have drifted from their desired states<br>kept in the hub cluster, as found by Fleet using the drift detection mechanism.<br><br>To control the object size, only the first 100 drifted resources will be included.<br>This field is only meaningful if the <code>ClusterName</code> is not empty.</td><td></td><td>MaxItems: 100<br>Optional: {}<br></td></tr><tr><td><code>diffedPlacements</code> <em><a href=/website/docs/api-reference/#diffedresourceplacement>DiffedResourcePlacement</a> array</em></td><td>DiffedPlacements is a list of resources that have configuration differences from their<br>corresponding hub cluster manifests. Fleet will report such differences when:<br><br>* The CRP uses the ReportDiff apply strategy, which instructs Fleet to compare the hub<br>cluster manifests against the live resources without actually performing any apply op; or<br>* Fleet finds a pre-existing resource on the member cluster side that does not match its<br>hub cluster counterpart, and the CRP has been configured to only take over a resource if<br>no configuration differences are found.<br><br>To control the object size, only the first 100 diffed resources will be included.<br>This field is only meaningful if the <code>ClusterName</code> is not empty.</td><td></td><td>MaxItems: 100<br>Optional: {}<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for ClusterResourceBinding.</td><td></td><td></td></tr></tbody></table><h4 id=resourcecontent-1>ResourceContent</h4><p>ResourceContent contains the content of a resource</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#resourcesnapshotspec>ResourceSnapshotSpec</a></li></ul><h4 id=resourceidentifier-1>ResourceIdentifier</h4><p>ResourceIdentifier identifies one Kubernetes resource.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementstatus>ClusterResourcePlacementStatus</a></li><li><a href=/website/docs/api-reference/#diffedresourceplacement>DiffedResourcePlacement</a></li><li><a href=/website/docs/api-reference/#driftedresourceplacement>DriftedResourcePlacement</a></li><li><a href=/website/docs/api-reference/#failedresourceplacement>FailedResourcePlacement</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>group</code> <em>string</em></td><td>Group is the group name of the selected resource.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version is the version of the selected resource.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind represents the Kind of the selected resources.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name of the target resource.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the resource. Empty if the resource is cluster scoped.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>envelope</code> <em><a href=/website/docs/api-reference/#envelopeidentifier>EnvelopeIdentifier</a></em></td><td>Envelope identifies the envelope object that contains this resource.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=resourceplacementstatus-1>ResourcePlacementStatus</h4><p>ResourcePlacementStatus represents the placement status of selected resources for one target cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementstatus>ClusterResourcePlacementStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>clusterName</code> <em>string</em></td><td>ClusterName is the name of the cluster this resource is assigned to.<br>If it is not empty, its value should be unique cross all placement decisions for the Placement.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>applicableResourceOverrides</code> <em><a href=/website/docs/api-reference/#namespacedname>NamespacedName</a> array</em></td><td>ApplicableResourceOverrides contains a list of applicable ResourceOverride snapshots associated with the selected<br>resources.<br><br>This field is alpha-level and is for the override policy feature.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>applicableClusterResourceOverrides</code> <em>string array</em></td><td>ApplicableClusterResourceOverrides contains a list of applicable ClusterResourceOverride snapshots associated with<br>the selected resources.<br><br>This field is alpha-level and is for the override policy feature.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>failedPlacements</code> <em><a href=/website/docs/api-reference/#failedresourceplacement>FailedResourcePlacement</a> array</em></td><td>FailedPlacements is a list of all the resources failed to be placed to the given cluster or the resource is unavailable.<br>Note that we only include 100 failed resource placements even if there are more than 100.<br>This field is only meaningful if the <code>ClusterName</code> is not empty.</td><td></td><td>MaxItems: 100<br>Optional: {}<br></td></tr><tr><td><code>driftedPlacements</code> <em><a href=/website/docs/api-reference/#driftedresourceplacement>DriftedResourcePlacement</a> array</em></td><td>DriftedPlacements is a list of resources that have drifted from their desired states<br>kept in the hub cluster, as found by Fleet using the drift detection mechanism.<br><br>To control the object size, only the first 100 drifted resources will be included.<br>This field is only meaningful if the <code>ClusterName</code> is not empty.</td><td></td><td>MaxItems: 100<br>Optional: {}<br></td></tr><tr><td><code>diffedPlacements</code> <em><a href=/website/docs/api-reference/#diffedresourceplacement>DiffedResourcePlacement</a> array</em></td><td>DiffedPlacements is a list of resources that have configuration differences from their<br>corresponding hub cluster manifests. Fleet will report such differences when:<br><br>* The CRP uses the ReportDiff apply strategy, which instructs Fleet to compare the hub<br>cluster manifests against the live resources without actually performing any apply op; or<br>* Fleet finds a pre-existing resource on the member cluster side that does not match its<br>hub cluster counterpart, and the CRP has been configured to only take over a resource if<br>no configuration differences are found.<br><br>To control the object size, only the first 100 diffed resources will be included.<br>This field is only meaningful if the <code>ClusterName</code> is not empty.</td><td></td><td>MaxItems: 100<br>Optional: {}<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for ResourcePlacementStatus.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=resourcesnapshotspec-1>ResourceSnapshotSpec</h4><p>ResourceSnapshotSpec defines the desired state of ResourceSnapshot.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcesnapshot>ClusterResourceSnapshot</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>selectedResources</code> <em><a href=/website/docs/api-reference/#resourcecontent>ResourceContent</a> array</em></td><td>SelectedResources contains a list of resources selected by ResourceSelectors.</td><td></td><td></td></tr></tbody></table><h4 id=resourcesnapshotstatus-1>ResourceSnapshotStatus</h4><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourcesnapshot>ClusterResourceSnapshot</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for ResourceSnapshot.</td><td></td><td></td></tr></tbody></table><h4 id=rollingupdateconfig-1>RollingUpdateConfig</h4><p>RollingUpdateConfig contains the config to control the desired behavior of rolling update.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#rolloutstrategy>RolloutStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>maxUnavailable</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#intorstring-intstr-util>IntOrString</a></em></td><td>The maximum number of clusters that can be unavailable during the rolling update<br>comparing to the desired number of clusters.<br>The desired number equals to the <code>NumberOfClusters</code> field when the placement type is <code>PickN</code>.<br>The desired number equals to the number of clusters scheduler selected when the placement type is <code>PickAll</code>.<br>Value can be an absolute number (ex: 5) or a percentage of the desired number of clusters (ex: 10%).<br>Absolute number is calculated from percentage by rounding up.<br>We consider a resource unavailable when we either remove it from a cluster or in-place<br>upgrade the resources content on the same cluster.<br>The minimum of MaxUnavailable is 0 to allow no downtime moving a placement from one cluster to another.<br>Please set it to be greater than 0 to avoid rolling out stuck during in-place resource update.<br>Defaults to 25%.</td><td>25%</td><td>Optional: {}<br>Pattern: <code>^((100|[0-9]\{1,2\})%|[0-9]+)$</code><br>XIntOrString: {}<br></td></tr><tr><td><code>maxSurge</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#intorstring-intstr-util>IntOrString</a></em></td><td>The maximum number of clusters that can be scheduled above the desired number of clusters.<br>The desired number equals to the <code>NumberOfClusters</code> field when the placement type is <code>PickN</code>.<br>The desired number equals to the number of clusters scheduler selected when the placement type is <code>PickAll</code>.<br>Value can be an absolute number (ex: 5) or a percentage of desire (ex: 10%).<br>Absolute number is calculated from percentage by rounding up.<br>This does not apply to the case that we do in-place update of resources on the same cluster.<br>This can not be 0 if MaxUnavailable is 0.<br>Defaults to 25%.</td><td>25%</td><td>Optional: {}<br>Pattern: <code>^((100|[0-9]\{1,2\})%|[0-9]+)$</code><br>XIntOrString: {}<br></td></tr><tr><td><code>unavailablePeriodSeconds</code> <em>integer</em></td><td>UnavailablePeriodSeconds is used to configure the waiting time between rollout phases when we<br>cannot determine if the resources have rolled out successfully or not.<br>We have a built-in resource state detector to determine the availability status of following well-known Kubernetes<br>native resources: Deployment, StatefulSet, DaemonSet, Service, Namespace, ConfigMap, Secret,<br>ClusterRole, ClusterRoleBinding, Role, RoleBinding.<br>Please see <a href=https://github.com/Azure/fleet/tree/main/docs/concepts/SafeRollout/README.md>SafeRollout</a> for more details.<br>For other types of resources, we consider them as available after <code>UnavailablePeriodSeconds</code> seconds<br>have passed since they were successfully applied to the target cluster.<br>Default is 60.</td><td>60</td><td>Optional: {}<br></td></tr></tbody></table><h4 id=rolloutstrategy-1>RolloutStrategy</h4><p>RolloutStrategy describes how to roll out a new change in selected resources to target clusters.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterresourceplacementspec>ClusterResourcePlacementSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>type</code> <em><a href=/website/docs/api-reference/#rolloutstrategytype>RolloutStrategyType</a></em></td><td>Type of rollout. The only supported types are &ldquo;RollingUpdate&rdquo; and &ldquo;External&rdquo;.<br>Default is &ldquo;RollingUpdate&rdquo;.</td><td>RollingUpdate</td><td>Enum: [RollingUpdate External]<br>Optional: {}<br></td></tr><tr><td><code>rollingUpdate</code> <em><a href=/website/docs/api-reference/#rollingupdateconfig>RollingUpdateConfig</a></em></td><td>Rolling update config params. Present only if RolloutStrategyType = RollingUpdate.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>applyStrategy</code> <em><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></em></td><td>ApplyStrategy describes when and how to apply the selected resources to the target cluster.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=rolloutstrategytype-1>RolloutStrategyType</h4><p><em>Underlying type:</em> <em>string</em></p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#rolloutstrategy>RolloutStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>RollingUpdate</code></td><td>RollingUpdateRolloutStrategyType replaces the old placed resource using rolling update<br>i.e. gradually create the new one while replace the old ones.<br></td></tr><tr><td><code>External</code></td><td>ExternalRolloutStrategyType means there is an external rollout controller that will<br>handle the rollout of the resources.<br></td></tr></tbody></table><h4 id=schedulingpolicysnapshotspec-1>SchedulingPolicySnapshotSpec</h4><p>SchedulingPolicySnapshotSpec defines the desired state of SchedulingPolicySnapshot.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterschedulingpolicysnapshot>ClusterSchedulingPolicySnapshot</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>policy</code> <em><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></em></td><td>Policy defines how to select member clusters to place the selected resources.<br>If unspecified, all the joined member clusters are selected.</td><td></td><td></td></tr><tr><td><code>policyHash</code> <em>integer array</em></td><td>PolicyHash is the sha-256 hash value of the Policy field.</td><td></td><td></td></tr></tbody></table><h4 id=schedulingpolicysnapshotstatus-1>SchedulingPolicySnapshotStatus</h4><p>SchedulingPolicySnapshotStatus defines the observed state of SchedulingPolicySnapshot.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterschedulingpolicysnapshot>ClusterSchedulingPolicySnapshot</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>observedCRPGeneration</code> <em>integer</em></td><td>ObservedCRPGeneration is the generation of the CRP which the scheduler uses to perform<br>the scheduling cycle and prepare the scheduling status.</td><td></td><td></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for SchedulingPolicySnapshot.</td><td></td><td></td></tr><tr><td><code>targetClusters</code> <em><a href=/website/docs/api-reference/#clusterdecision>ClusterDecision</a> array</em></td><td>ClusterDecisions contains a list of names of member clusters considered by the scheduler.<br>Note that all the selected clusters must present in the list while not all the<br>member clusters are guaranteed to be listed due to the size limit. We will try to<br>add the clusters that can provide the most insight to the list first.</td><td></td><td>MaxItems: 1000<br></td></tr></tbody></table><h4 id=serversideapplyconfig-1>ServerSideApplyConfig</h4><p>ServerSideApplyConfig defines the configuration for server side apply.
Details: <a href=https://kubernetes.io/docs/reference/using-api/server-side-apply/#conflicts>https://kubernetes.io/docs/reference/using-api/server-side-apply/#conflicts</a></p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>force</code> <em>boolean</em></td><td>Force represents to force apply to succeed when resolving the conflicts<br>For any conflicting fields,<br>- If true, use the values from the resource to be applied to overwrite the values of the existing resource in the<br>target cluster, as well as take over ownership of such fields.<br>- If false, apply will fail with the reason ApplyConflictWithOtherApplier.<br><br>For non-conflicting fields, values stay unchanged and ownership are shared between appliers.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=stageconfig-1>StageConfig</h4><p>StageConfig describes a single update stage.
The clusters in each stage are updated sequentially.
The update stops if any of the updates fail.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#stagedupdatestrategyspec>StagedUpdateStrategySpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>name</code> <em>string</em></td><td>The name of the stage. This MUST be unique within the same StagedUpdateStrategy.</td><td></td><td>MaxLength: 63<br>Pattern: <code>^[a-z0-9]+$</code><br>Required: {}<br></td></tr><tr><td><code>labelSelector</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#labelselector-v1-meta>LabelSelector</a></em></td><td>LabelSelector is a label query over all the joined member clusters. Clusters matching the query are selected<br>for this stage. There cannot be overlapping clusters between stages when the stagedUpdateRun is created.<br>If the label selector is absent, the stage includes all the selected clusters.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>sortingLabelKey</code> <em>string</em></td><td>The label key used to sort the selected clusters.<br>The clusters within the stage are updated sequentially following the rule below:<br>- primary: Ascending order based on the value of the label key, interpreted as integers if present.<br>- secondary: Ascending order based on the name of the cluster if the label key is absent or the label value is the same.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>afterStageTasks</code> <em><a href=/website/docs/api-reference/#afterstagetask>AfterStageTask</a> array</em></td><td>The collection of tasks that each stage needs to complete successfully before moving to the next stage.<br>Each task is executed in parallel and there cannot be more than one task of the same type.</td><td></td><td>MaxItems: 2<br>Optional: {}<br></td></tr></tbody></table><h4 id=stageupdatingstatus-1>StageUpdatingStatus</h4><p>StageUpdatingStatus defines the status of the update run in a stage.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#stagedupdaterunstatus>StagedUpdateRunStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>stageName</code> <em>string</em></td><td>The name of the stage.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>clusters</code> <em><a href=/website/docs/api-reference/#clusterupdatingstatus>ClusterUpdatingStatus</a> array</em></td><td>The list of each cluster&rsquo;s updating status in this stage.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>afterStageTaskStatus</code> <em><a href=/website/docs/api-reference/#afterstagetaskstatus>AfterStageTaskStatus</a> array</em></td><td>The status of the post-update tasks associated with the current stage.<br>Empty if the stage has not finished updating all the clusters.</td><td></td><td>MaxItems: 2<br>Optional: {}<br></td></tr><tr><td><code>startTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>The time when the update started on the stage. Empty if the stage has not started updating.</td><td></td><td>Format: date-time<br>Optional: {}<br>Type: string<br></td></tr><tr><td><code>endTime</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#time-v1-meta>Time</a></em></td><td>The time when the update finished on the stage. Empty if the stage has not started updating.</td><td></td><td>Format: date-time<br>Optional: {}<br>Type: string<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed updating conditions for the stage. Empty if the stage has not started updating.<br>Known conditions are &ldquo;Progressing&rdquo;, &ldquo;Succeeded&rdquo;.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=stagedupdaterunspec-1>StagedUpdateRunSpec</h4><p>StagedUpdateRunSpec defines the desired rollout strategy and the snapshot indices of the resources to be updated.
It specifies a stage-by-stage update process across selected clusters for the given ResourcePlacement object.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterstagedupdaterun>ClusterStagedUpdateRun</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>placementName</code> <em>string</em></td><td>PlacementName is the name of placement that this update run is applied to.<br>There can be multiple active update runs for each placement, but<br>it&rsquo;s up to the DevOps team to ensure they don&rsquo;t conflict with each other.</td><td></td><td>MaxLength: 255<br>Required: {}<br></td></tr><tr><td><code>resourceSnapshotIndex</code> <em>string</em></td><td>The resource snapshot index of the selected resources to be updated across clusters.<br>The index represents a group of resource snapshots that includes all the resources a ResourcePlacement selected.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>stagedRolloutStrategyName</code> <em>string</em></td><td>The name of the update strategy that specifies the stages and the sequence<br>in which the selected resources will be updated on the member clusters. The stages<br>are computed according to the referenced strategy when the update run starts<br>and recorded in the status field.</td><td></td><td>Required: {}<br></td></tr></tbody></table><h4 id=stagedupdaterunstatus-1>StagedUpdateRunStatus</h4><p>StagedUpdateRunStatus defines the observed state of the ClusterStagedUpdateRun.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterstagedupdaterun>ClusterStagedUpdateRun</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>policySnapshotIndexUsed</code> <em>string</em></td><td>PolicySnapShotIndexUsed records the policy snapshot index of the ClusterResourcePlacement (CRP) that<br>the update run is based on. The index represents the latest policy snapshot at the start of the update run.<br>If a newer policy snapshot is detected after the run starts, the staged update run is abandoned.<br>The scheduler must identify all clusters that meet the current policy before the update run begins.<br>All clusters involved in the update run are selected from the list of clusters scheduled by the CRP according<br>to the current policy.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>policyObservedClusterCount</code> <em>integer</em></td><td>PolicyObservedClusterCount records the number of observed clusters in the policy snapshot.<br>It is recorded at the beginning of the update run from the policy snapshot object.<br>If the <code>ObservedClusterCount</code> value is updated during the update run, the update run is abandoned.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>appliedStrategy</code> <em><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></em></td><td>ApplyStrategy is the apply strategy that the stagedUpdateRun is using.<br>It is the same as the apply strategy in the CRP when the staged update run starts.<br>The apply strategy is not updated during the update run even if it changes in the CRP.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>stagedUpdateStrategySnapshot</code> <em><a href=/website/docs/api-reference/#stagedupdatestrategyspec>StagedUpdateStrategySpec</a></em></td><td>StagedUpdateStrategySnapshot is the snapshot of the StagedUpdateStrategy used for the update run.<br>The snapshot is immutable during the update run.<br>The strategy is applied to the list of clusters scheduled by the CRP according to the current policy.<br>The update run fails to initialize if the strategy fails to produce a valid list of stages where each selected<br>cluster is included in exactly one stage.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>stagesStatus</code> <em><a href=/website/docs/api-reference/#stageupdatingstatus>StageUpdatingStatus</a> array</em></td><td>StagesStatus lists the current updating status of each stage.<br>The list is empty if the update run is not started or failed to initialize.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>deletionStageStatus</code> <em><a href=/website/docs/api-reference/#stageupdatingstatus>StageUpdatingStatus</a></em></td><td>DeletionStageStatus lists the current status of the deletion stage. The deletion stage<br>removes all the resources from the clusters that are not selected by the<br>current policy after all the update stages are completed.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions is an array of current observed conditions for StagedUpdateRun.<br>Known conditions are &ldquo;Initialized&rdquo;, &ldquo;Progressing&rdquo;, &ldquo;Succeeded&rdquo;.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=stagedupdatestrategyspec-1>StagedUpdateStrategySpec</h4><p>StagedUpdateStrategySpec defines the desired state of the StagedUpdateStrategy.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#clusterstagedupdatestrategy>ClusterStagedUpdateStrategy</a></li><li><a href=/website/docs/api-reference/#stagedupdaterunstatus>StagedUpdateRunStatus</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>stages</code> <em><a href=/website/docs/api-reference/#stageconfig>StageConfig</a> array</em></td><td>Stage specifies the configuration for each update stage.</td><td></td><td>MaxItems: 31<br>Required: {}<br></td></tr></tbody></table><h4 id=toleration-1>Toleration</h4><p>Toleration allows ClusterResourcePlacement to tolerate any taint that matches
the triple &lt;key,value,effect> using the matching operator <operator>.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>key</code> <em>string</em></td><td>Key is the taint key that the toleration applies to. Empty means match all taint keys.<br>If the key is empty, operator must be Exists; this combination means to match all values and all keys.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>operator</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#tolerationoperator-v1-core>TolerationOperator</a></em></td><td>Operator represents a key&rsquo;s relationship to the value.<br>Valid operators are Exists and Equal. Defaults to Equal.<br>Exists is equivalent to wildcard for value, so that a<br>ClusterResourcePlacement can tolerate all taints of a particular category.</td><td>Equal</td><td>Enum: [Equal Exists]<br>Optional: {}<br></td></tr><tr><td><code>value</code> <em>string</em></td><td>Value is the taint value the toleration matches to.<br>If the operator is Exists, the value should be empty, otherwise just a regular string.</td><td></td><td>Optional: {}<br></td></tr><tr><td><code>effect</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#tainteffect-v1-core>TaintEffect</a></em></td><td>Effect indicates the taint effect to match. Empty means match all taint effects.<br>When specified, only allowed value is NoSchedule.</td><td></td><td>Enum: [NoSchedule]<br>Optional: {}<br></td></tr></tbody></table><h4 id=topologyspreadconstraint-1>TopologySpreadConstraint</h4><p>TopologySpreadConstraint specifies how to spread resources among the given cluster topology.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#placementpolicy>PlacementPolicy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>maxSkew</code> <em>integer</em></td><td>MaxSkew describes the degree to which resources may be unevenly distributed.<br>When <code>whenUnsatisfiable=DoNotSchedule</code>, it is the maximum permitted difference<br>between the number of resource copies in the target topology and the global minimum.<br>The global minimum is the minimum number of resource copies in a domain.<br>When <code>whenUnsatisfiable=ScheduleAnyway</code>, it is used to give higher precedence<br>to topologies that satisfy it.<br>It&rsquo;s an optional field. Default value is 1 and 0 is not allowed.</td><td>1</td><td>Minimum: 1<br>Optional: {}<br></td></tr><tr><td><code>topologyKey</code> <em>string</em></td><td>TopologyKey is the key of cluster labels. Clusters that have a label with this key<br>and identical values are considered to be in the same topology.<br>We consider each &lt;key, value> as a &ldquo;bucket&rdquo;, and try to put balanced number<br>of replicas of the resource into each bucket honor the <code>MaxSkew</code> value.<br>It&rsquo;s a required field.</td><td></td><td>Required: {}<br></td></tr><tr><td><code>whenUnsatisfiable</code> <em><a href=/website/docs/api-reference/#unsatisfiableconstraintaction>UnsatisfiableConstraintAction</a></em></td><td>WhenUnsatisfiable indicates how to deal with the resource if it doesn&rsquo;t satisfy<br>the spread constraint.<br>- DoNotSchedule (default) tells the scheduler not to schedule it.<br>- ScheduleAnyway tells the scheduler to schedule the resource in any cluster,<br>but giving higher precedence to topologies that would help reduce the skew.<br>It&rsquo;s an optional field.</td><td></td><td>Optional: {}<br></td></tr></tbody></table><h4 id=unsatisfiableconstraintaction-1>UnsatisfiableConstraintAction</h4><p><em>Underlying type:</em> <em>string</em></p><p>UnsatisfiableConstraintAction defines the type of actions that can be taken if a constraint is not satisfied.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#topologyspreadconstraint>TopologySpreadConstraint</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>DoNotSchedule</code></td><td>DoNotSchedule instructs the scheduler not to schedule the resource<br>onto the cluster when constraints are not satisfied.<br></td></tr><tr><td><code>ScheduleAnyway</code></td><td>ScheduleAnyway instructs the scheduler to schedule the resource<br>even if constraints are not satisfied.<br></td></tr></tbody></table><h4 id=whentoapplytype>WhenToApplyType</h4><p><em>Underlying type:</em> <em>string</em></p><p>WhenToApplyType describes when Fleet would apply the manifests on the hub cluster to
the member clusters.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>Always</code></td><td>WhenToApplyTypeAlways instructs Fleet to periodically apply hub cluster manifests<br>on the member cluster side; this will effectively overwrite any change in the fields<br>managed by Fleet (i.e., specified in the hub cluster manifest).<br></td></tr><tr><td><code>IfNotDrifted</code></td><td>WhenToApplyTypeIfNotDrifted instructs Fleet to stop applying hub cluster manifests on<br>clusters that have drifted from the desired state; apply ops would still continue on<br>the rest of the clusters.<br></td></tr></tbody></table><h4 id=whentotakeovertype>WhenToTakeOverType</h4><p><em>Underlying type:</em> <em>string</em></p><p>WhenToTakeOverType describes the type of the action to take when we first apply the
resources to the member cluster.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></li></ul><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><code>IfNoDiff</code></td><td>WhenToTakeOverTypeIfNoDiff instructs Fleet to apply a manifest with a corresponding<br>pre-existing resource on a member cluster if and only if the pre-existing resource<br>looks the same as the manifest. Should there be any inconsistency, Fleet will skip<br>the apply op; no change will be made on the resource and Fleet will not claim<br>ownership on it.<br>Note that this will not stop Fleet from processing other manifests in the same<br>placement that do not concern the takeover process (e.g., the manifests that have<br>not been created yet, or that are already under the management of Fleet).<br></td></tr><tr><td><code>Always</code></td><td>WhenToTakeOverTypeAlways instructs Fleet to always apply manifests to a member cluster,<br>even if there are some corresponding pre-existing resources. Some fields on these<br>resources might be overwritten, and Fleet will claim ownership on them.<br></td></tr><tr><td><code>Never</code></td><td>WhenToTakeOverTypeNever instructs Fleet to never apply a manifest to a member cluster<br>if there is a corresponding pre-existing resource.<br>Note that this will not stop Fleet from processing other manifests in the same placement<br>that do not concern the takeover process (e.g., the manifests that have not been created<br>yet, or that are already under the management of Fleet).<br>If you would like Fleet to stop processing manifests all together and do not assume<br>ownership on any pre-existing resources, use this option along with the ReportDiff<br>apply strategy type. This setup would instruct Fleet to touch nothing on the member<br>cluster side but still report configuration differences between the hub cluster<br>and member clusters. Fleet will not give up ownership that it has already assumed, though.<br></td></tr></tbody></table><h4 id=work-1>Work</h4><p>Work is the Schema for the works API.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#worklist>WorkList</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>Work</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#objectmeta-v1-meta>ObjectMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>spec</code> <em><a href=/website/docs/api-reference/#workspec>WorkSpec</a></em></td><td>spec defines the workload of a work.</td><td></td><td></td></tr><tr><td><code>status</code> <em><a href=/website/docs/api-reference/#workstatus>WorkStatus</a></em></td><td>status defines the status of each applied manifest on the spoke cluster.</td><td></td><td></td></tr></tbody></table><h4 id=worklist-1>WorkList</h4><p>WorkList contains a list of Work.</p><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>apiVersion</code> <em>string</em></td><td><code>placement.kubernetes-fleet.io/v1beta1</code></td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td><code>WorkList</code></td><td></td><td></td></tr><tr><td><code>metadata</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#listmeta-v1-meta>ListMeta</a></em></td><td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td><td></td><td></td></tr><tr><td><code>items</code> <em><a href=/website/docs/api-reference/#work>Work</a> array</em></td><td>List of works.</td><td></td><td></td></tr></tbody></table><h4 id=workresourceidentifier-1>WorkResourceIdentifier</h4><p>WorkResourceIdentifier provides the identifiers needed to interact with any arbitrary object.
Renamed original &ldquo;ResourceIdentifier&rdquo; so that it won&rsquo;t conflict with ResourceIdentifier defined in the clusterresourceplacement_types.go.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#appliedresourcemeta>AppliedResourceMeta</a></li><li><a href=/website/docs/api-reference/#manifestcondition>ManifestCondition</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>ordinal</code> <em>integer</em></td><td>Ordinal represents an index in manifests list, so the condition can still be linked<br>to a manifest even though manifest cannot be parsed successfully.</td><td></td><td></td></tr><tr><td><code>group</code> <em>string</em></td><td>Group is the group of the resource.</td><td></td><td></td></tr><tr><td><code>version</code> <em>string</em></td><td>Version is the version of the resource.</td><td></td><td></td></tr><tr><td><code>kind</code> <em>string</em></td><td>Kind is the kind of the resource.</td><td></td><td></td></tr><tr><td><code>resource</code> <em>string</em></td><td>Resource is the resource type of the resource.</td><td></td><td></td></tr><tr><td><code>namespace</code> <em>string</em></td><td>Namespace is the namespace of the resource, the resource is cluster scoped if the value<br>is empty.</td><td></td><td></td></tr><tr><td><code>name</code> <em>string</em></td><td>Name is the name of the resource.</td><td></td><td></td></tr></tbody></table><h4 id=workspec-1>WorkSpec</h4><p>WorkSpec defines the desired state of Work.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#work>Work</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>workload</code> <em><a href=/website/docs/api-reference/#workloadtemplate>WorkloadTemplate</a></em></td><td>Workload represents the manifest workload to be deployed on spoke cluster</td><td></td><td></td></tr><tr><td><code>applyStrategy</code> <em><a href=/website/docs/api-reference/#applystrategy>ApplyStrategy</a></em></td><td>ApplyStrategy describes how to resolve the conflict if the resource to be placed already exists in the target cluster<br>and is owned by other appliers.</td><td></td><td></td></tr></tbody></table><h4 id=workstatus-1>WorkStatus</h4><p>WorkStatus defines the observed state of Work.</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#work>Work</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>conditions</code> <em><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.31/#condition-v1-meta>Condition</a> array</em></td><td>Conditions contains the different condition statuses for this work.<br>Valid condition types are:<br>1. Applied represents workload in Work is applied successfully on the spoke cluster.<br>2. Progressing represents workload in Work in the transitioning from one state to another the on the spoke cluster.<br>3. Available represents workload in Work exists on the spoke cluster.<br>4. Degraded represents the current state of workload does not match the desired<br>state for a certain period.</td><td></td><td></td></tr><tr><td><code>manifestConditions</code> <em><a href=/website/docs/api-reference/#manifestcondition>ManifestCondition</a> array</em></td><td>ManifestConditions represents the conditions of each resource in work deployed on<br>spoke cluster.</td><td></td><td></td></tr></tbody></table><h4 id=workloadtemplate-1>WorkloadTemplate</h4><p>WorkloadTemplate represents the manifest workload to be deployed on spoke cluster</p><p><em>Appears in:</em></p><ul><li><a href=/website/docs/api-reference/#workspec>WorkSpec</a></li></ul><table><thead><tr><th>Field</th><th>Description</th><th>Default</th><th>Validation</th></tr></thead><tbody><tr><td><code>manifests</code> <em><a href=/website/docs/api-reference/#manifest>Manifest</a> array</em></td><td>Manifests represents a list of kubernetes resources to be deployed on the spoke cluster.</td><td></td><td></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-d9ce62896f60f2efcc2db9da011ba5cf>6 -</h1><h1 id=placement-eviction--placement-disruption-budget-troubleshooting-guide>Placement Eviction & Placement Disruption Budget Troubleshooting Guide</h1><p>This guide provides troubleshooting steps for issues related to placement eviction.</p><p>An eviction object when created is ideally only reconciled once and reaches a terminal state. List of terminal states
for eviction are:</p><ul><li>Eviction is Invalid</li><li>Eviction is Valid, Eviction failed to Execute</li><li>Eviction is Valid, Eviction executed successfully</li></ul><blockquote><p><strong>Note:</strong> If an eviction object doesn&rsquo;t reach a terminal state i.e. neither valid condition nor executed condition is
set it is likely due to a failure in the reconciliation process where the controller is unable to reach the api server.</p></blockquote><p>The first step in troubleshooting is to check the status of the eviction object to understand if the eviction reached
a terminal state or not.</p><h2 id=invalid-eviction>Invalid eviction</h2><h3 id=missingdeleting-crp-object>Missing/Deleting CRP object</h3><p>Example status with missing <code>CRP</code> object:</p><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2025-04-17T22:16:59Z&#34;
    message: Failed to find ClusterResourcePlacement targeted by eviction
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionInvalid
    status: &#34;False&#34;
    type: Valid
</code></pre><p>Example status with deleting <code>CRP</code> object:</p><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2025-04-21T19:53:42Z&#34;
    message: Found deleting ClusterResourcePlacement targeted by eviction
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionInvalid
    status: &#34;False&#34;
    type: Valid
</code></pre><p>In both cases the Eviction object reached a terminal state, its status has <code>Valid</code> condition set to <code>False</code>.
The user should verify if the <code>ClusterResourcePlacement</code> object is missing or if it is being deleted and recreate the
<code>ClusterResourcePlacement</code> object if needed and retry eviction.</p><h3 id=missing-crb-object>Missing CRB object</h3><p>Example status with missing <code>CRB</code> object:</p><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2025-04-17T22:21:51Z&#34;
    message: Failed to find scheduler decision for placement in cluster targeted by
      eviction
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionInvalid
    status: &#34;False&#34;
    type: Valid
</code></pre><blockquote><p><strong>Note:</strong> The user can find the corresponding <code>ClusterResourceBinding</code> object by listing all <code>ClusterResourceBinding</code>
objects for the <code>ClusterResourcePlacement</code> object</p><pre tabindex=0><code>kubectl get rb -l kubernetes-fleet.io/parent-CRP=&lt;CRPName&gt;
</code></pre><p>The <code>ClusterResourceBinding</code> object name is formatted as <code>&lt;CRPName>-&lt;ClusterName>-randomsuffix</code></p></blockquote><p>In this case the Eviction object reached a terminal state, its status has <code>Valid</code> condition set to <code>False</code>, because the
<code>ClusterResourceBinding</code> object or Placement for target cluster is not found. The user should verify to see if the
<code>ClusterResourcePlacement</code> object is propagating resources to the target cluster,</p><ul><li>If yes, the next step is to check if the <code>ClusterResourceBinding</code> object is present for the target cluster or why it
was not created and try to create an eviction object once <code>ClusterResourceBinding</code> is created.</li><li>If no, the cluster is not picked by the scheduler and hence no need to retry eviction.</li></ul><h3 id=multiple-crb-is-present>Multiple CRB is present</h3><p>Example status with multiple <code>CRB</code> objects:</p><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2025-04-17T23:48:08Z&#34;
    message: Found more than one scheduler decision for placement in cluster targeted
      by eviction
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionInvalid
    status: &#34;False&#34;
    type: Valid
</code></pre><p>In this case the Eviction object reached a terminal state, its status has <code>Valid</code> condition set to <code>False</code>, because
there is more than one <code>ClusterResourceBinding</code> object or Placement present for the <code>ClusterResourcePlacement</code> object
targeting the member cluster. This is a rare scenario, it&rsquo;s an in-between state where bindings are being-recreated due
to the member cluster being selected again, and it will normally resolve quickly.</p><h3 id=pickfixed-crp-is-targeted-by-crp-eviction>PickFixed CRP is targeted by CRP Eviction</h3><p>Example status for <code>ClusterResourcePlacementEviction</code> object targeting a PickFixed <code>ClusterResourcePlacement</code> object:</p><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2025-04-21T23:19:06Z&#34;
    message: Found ClusterResourcePlacement with PickFixed placement type targeted
      by eviction
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionInvalid
    status: &#34;False&#34;
    type: Valid
</code></pre><p>In this case the Eviction object reached a terminal state, its status has <code>Valid</code> condition set to <code>False</code>, because
the <code>ClusterResourcePlacement</code> object is of type <code>PickFixed</code>. Users cannot use <code>ClusterResourcePlacementEviction</code>
objects to evict resources propagated by <code>ClusterResourcePlacement</code> objects of type <code>PickFixed</code>. The user can instead
remove the member cluster name from the <code>clusterNames</code> field in the policy of the <code>ClusterResourcePlacement</code> object.</p><h2 id=failed-to-execute-eviction>Failed to execute eviction</h2><h3 id=eviction-blocked-because-placement-is-missing>Eviction blocked because placement is missing</h3><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2025-04-23T23:54:03Z&#34;
    message: Eviction is valid
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionValid
    status: &#34;True&#34;
    type: Valid
  - lastTransitionTime: &#34;2025-04-23T23:54:03Z&#34;
    message: Eviction is blocked, placement has not propagated resources to target
      cluster yet
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionNotExecuted
    status: &#34;False&#34;
    type: Executed
</code></pre><p>In this case the Eviction object reached a terminal state, its status has <code>Executed</code> condition set to <code>False</code>, because
for the targeted <code>ClusterResourcePlacement</code> the corresponding <code>ClusterResourceBinding</code> object&rsquo;s spec is set to
<code>Scheduled</code> meaning the rollout of resources is not started yet.</p><blockquote><p><strong>Note:</strong> The user can find the corresponding <code>ClusterResourceBinding</code> object by listing all <code>ClusterResourceBinding</code>
objects for the <code>ClusterResourcePlacement</code> object</p><pre tabindex=0><code>kubectl get rb -l kubernetes-fleet.io/parent-CRP=&lt;CRPName&gt;
</code></pre><p>The <code>ClusterResourceBinding</code> object name is formatted as <code>&lt;CRPName>-&lt;ClusterName>-randomsuffix</code>.</p></blockquote><pre tabindex=0><code>spec:
  applyStrategy:
    type: ClientSideApply
  clusterDecision:
    clusterName: kind-cluster-3
    clusterScore:
      affinityScore: 0
      priorityScore: 0
    reason: &#39;Successfully scheduled resources for placement in &#34;kind-cluster-3&#34; (affinity
      score: 0, topology spread score: 0): picked by scheduling policy&#39;
    selected: true
  resourceSnapshotName: &#34;&#34;
  schedulingPolicySnapshotName: test-crp-1
  state: Scheduled
  targetCluster: kind-cluster-3
</code></pre><p>Here the user can wait for the <code>ClusterResourceBinding</code> object to be updated to <code>Bound</code> state which means that
resources have been propagated to the target cluster and then retry eviction. In some cases this can take a while or not
happen at all, in that case the user should verify if rollout is stuck for <code>ClusterResourcePlacement</code> object.</p><h3 id=eviction-blocked-by-invalid-crpdb>Eviction blocked by Invalid CRPDB</h3><p>Example status for <code>ClusterResourcePlacementEviction</code> object with invalid <code>ClusterResourcePlacementDisruptionBudget</code>,</p><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2025-04-21T23:39:42Z&#34;
    message: Eviction is valid
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionValid
    status: &#34;True&#34;
    type: Valid
  - lastTransitionTime: &#34;2025-04-21T23:39:42Z&#34;
    message: Eviction is blocked by misconfigured ClusterResourcePlacementDisruptionBudget,
      either MaxUnavailable is specified or MinAvailable is specified as a percentage
      for PickAll ClusterResourcePlacement
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionNotExecuted
    status: &#34;False&#34;
    type: Executed
</code></pre><p>In this cae the Eviction object reached a terminal state, its status has <code>Executed</code> condition set to <code>False</code>, because
the <code>ClusterResourcePlacementDisruptionBudget</code> object is invalid. For <code>ClusterResourcePlacement</code> objects of type
<code>PickAll</code>, when specifying a <code>ClusterResourcePlacementDisruptionBudget</code> the <code>minAvailable</code> field should be set to an
absolute number and not a percentage and the <code>maxUnavailable</code> field should not be set since the total number of
placements is non-deterministic.</p><h3 id=eviction-blocked-by-specified-crpdb>Eviction blocked by specified CRPDB</h3><p>Example status for <code>ClusterResourcePlacementEviction</code> object blocked by a <code>ClusterResourcePlacementDisruptionBudget</code>
object,</p><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2025-04-24T18:54:30Z&#34;
    message: Eviction is valid
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionValid
    status: &#34;True&#34;
    type: Valid
  - lastTransitionTime: &#34;2025-04-24T18:54:30Z&#34;
    message: &#39;Eviction is blocked by specified ClusterResourcePlacementDisruptionBudget,
      availablePlacements: 2, totalPlacements: 2&#39;
    observedGeneration: 1
    reason: ClusterResourcePlacementEvictionNotExecuted
    status: &#34;False&#34;
    type: Executed
</code></pre><p>In this cae the Eviction object reached a terminal state, its status has <code>Executed</code> condition set to <code>False</code>, because
the <code>ClusterResourcePlacementDisruptionBudget</code> object is blocking the eviction. The message from <code>Executed</code> condition
reads available placements is 2 and total placements is 2, which means that the <code>ClusterResourcePlacementDisruptionBudget</code>
is protecting all placements propagated by the <code>ClusterResourcePlacement</code> object.</p><p>Taking a look at the <code>ClusterResourcePlacementDisruptionBudget</code> object,</p><pre tabindex=0><code>apiVersion: placement.kubernetes-fleet.io/v1beta1
kind: ClusterResourcePlacementDisruptionBudget
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {&#34;apiVersion&#34;:&#34;placement.kubernetes-fleet.io/v1beta1&#34;,&#34;kind&#34;:&#34;ClusterResourcePlacementDisruptionBudget&#34;,&#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;pick-all-crp&#34;},&#34;spec&#34;:{&#34;minAvailable&#34;:2}}
  creationTimestamp: &#34;2025-04-24T18:47:22Z&#34;
  generation: 1
  name: pick-all-crp
  resourceVersion: &#34;1749&#34;
  uid: 7d3a0ac5-0225-4fb6-b5e9-fc28d58cefdc
spec:
  minAvailable: 2
</code></pre><p>We can see that the <code>minAvailable</code> is set to <code>2</code>, which means that at least 2 placements should be available for the
<code>ClusterResourcePlacement</code> object.</p><p>Let&rsquo;s take a look at the <code>ClusterResourcePlacement</code> object&rsquo;s status to verify the list of available placements,</p><pre tabindex=0><code>status:
  conditions:
  - lastTransitionTime: &#34;2025-04-24T18:46:38Z&#34;
    message: found all cluster needed as specified by the scheduling policy, found
      2 cluster(s)
    observedGeneration: 1
    reason: SchedulingPolicyFulfilled
    status: &#34;True&#34;
    type: ClusterResourcePlacementScheduled
  - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
    message: All 2 cluster(s) start rolling out the latest resource
    observedGeneration: 1
    reason: RolloutStarted
    status: &#34;True&#34;
    type: ClusterResourcePlacementRolloutStarted
  - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
    message: No override rules are configured for the selected resources
    observedGeneration: 1
    reason: NoOverrideSpecified
    status: &#34;True&#34;
    type: ClusterResourcePlacementOverridden
  - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
    message: Works(s) are succcesfully created or updated in 2 target cluster(s)&#39;
      namespaces
    observedGeneration: 1
    reason: WorkSynchronized
    status: &#34;True&#34;
    type: ClusterResourcePlacementWorkSynchronized
  - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
    message: The selected resources are successfully applied to 2 cluster(s)
    observedGeneration: 1
    reason: ApplySucceeded
    status: &#34;True&#34;
    type: ClusterResourcePlacementApplied
  - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
    message: The selected resources in 2 cluster(s) are available now
    observedGeneration: 1
    reason: ResourceAvailable
    status: &#34;True&#34;
    type: ClusterResourcePlacementAvailable
  observedResourceIndex: &#34;0&#34;
  placementStatuses:
  - clusterName: kind-cluster-1
    conditions:
    - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
      message: &#39;Successfully scheduled resources for placement in &#34;kind-cluster-1&#34;
        (affinity score: 0, topology spread score: 0): picked by scheduling policy&#39;
      observedGeneration: 1
      reason: Scheduled
      status: &#34;True&#34;
      type: Scheduled
    - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
      message: Detected the new changes on the resources and started the rollout process
      observedGeneration: 1
      reason: RolloutStarted
      status: &#34;True&#34;
      type: RolloutStarted
    - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
      message: No override rules are configured for the selected resources
      observedGeneration: 1
      reason: NoOverrideSpecified
      status: &#34;True&#34;
      type: Overridden
    - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
      message: All of the works are synchronized to the latest
      observedGeneration: 1
      reason: AllWorkSynced
      status: &#34;True&#34;
      type: WorkSynchronized
    - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
      message: All corresponding work objects are applied
      observedGeneration: 1
      reason: AllWorkHaveBeenApplied
      status: &#34;True&#34;
      type: Applied
    - lastTransitionTime: &#34;2025-04-24T18:50:19Z&#34;
      message: All corresponding work objects are available
      observedGeneration: 1
      reason: AllWorkAreAvailable
      status: &#34;True&#34;
      type: Available
  - clusterName: kind-cluster-2
    conditions:
    - lastTransitionTime: &#34;2025-04-24T18:46:38Z&#34;
      message: &#39;Successfully scheduled resources for placement in &#34;kind-cluster-2&#34;
        (affinity score: 0, topology spread score: 0): picked by scheduling policy&#39;
      observedGeneration: 1
      reason: Scheduled
      status: &#34;True&#34;
      type: Scheduled
    - lastTransitionTime: &#34;2025-04-24T18:46:38Z&#34;
      message: Detected the new changes on the resources and started the rollout process
      observedGeneration: 1
      reason: RolloutStarted
      status: &#34;True&#34;
      type: RolloutStarted
    - lastTransitionTime: &#34;2025-04-24T18:46:38Z&#34;
      message: No override rules are configured for the selected resources
      observedGeneration: 1
      reason: NoOverrideSpecified
      status: &#34;True&#34;
      type: Overridden
    - lastTransitionTime: &#34;2025-04-24T18:46:38Z&#34;
      message: All of the works are synchronized to the latest
      observedGeneration: 1
      reason: AllWorkSynced
      status: &#34;True&#34;
      type: WorkSynchronized
    - lastTransitionTime: &#34;2025-04-24T18:46:38Z&#34;
      message: All corresponding work objects are applied
      observedGeneration: 1
      reason: AllWorkHaveBeenApplied
      status: &#34;True&#34;
      type: Applied
    - lastTransitionTime: &#34;2025-04-24T18:46:38Z&#34;
      message: All corresponding work objects are available
      observedGeneration: 1
      reason: AllWorkAreAvailable
      status: &#34;True&#34;
      type: Available
  selectedResources:
  - kind: Namespace
    name: test-ns
    version: v1
</code></pre><p>from the status we can see that the <code>ClusterResourcePlacement</code> object has 2 placements available, where resources have
been successfully applied and are available in kind-cluster-1 and kind-cluster-2. The users can check the individual
member clusters to verify the resources are available but the users are recommended to check the<code>ClusterResourcePlacement</code>
object status to verify placement availability since the status is aggregated and updated by the controller.</p><p>Here the user can either remove the <code>ClusterResourcePlacementDisruptionBudget</code> object or update the <code>minAvailable</code> to
<code>1</code> to allow <code>ClusterResourcePlacementEviction</code> object to execute successfully. In general the user should carefully
check the availability of placements and act accordingly when changing the <code>ClusterResourcePlacementDisruptionBudget</code>
object.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/kubefleet-dev/kubefleet aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025&ndash;2025
<span class=td-footer__authors>KubeFleet Contributors | The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage</a> | <a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://github.com/kubefleet-dev/website/blob/main/PRIVACY_POLICY.md target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/website/js/main.min.032ba2ecbd3ce89b96bffcfec71c5da352125ee752e9873c3e0098f7c32a6497.js integrity="sha256-Ayui7L086JuWv/z+xxxdo1ISXudS6Yc8PgCY98MqZJc=" crossorigin=anonymous></script><script defer src=/website/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/website/js/tabpane-persist.js></script></body></html>