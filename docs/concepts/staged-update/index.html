<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/website/favicons/favicon.ico><link rel=apple-touch-icon href=/website/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/website/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/website/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/website/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/website/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/website/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/website/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/website/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/website/favicons/android-192x192.png sizes=192x192><title>Staged Update | KubeFleet</title>
<meta name=description content="Concept about Staged Update"><meta property="og:url" content="https://kubefleet-dev.github.io/website/docs/concepts/staged-update/"><meta property="og:site_name" content="KubeFleet"><meta property="og:title" content="Staged Update"><meta property="og:description" content="Concept about Staged Update"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta itemprop=name content="Staged Update"><meta itemprop=description content="Concept about Staged Update"><meta itemprop=wordCount content="2842"><meta name=twitter:card content="summary"><meta name=twitter:title content="Staged Update"><meta name=twitter:description content="Concept about Staged Update"><link rel=preload href=/website/scss/main.min.879d78706ddc3417bab47ec223b501bf207298e24a447bada63812f126e3e760.css as=style><link href=/website/scss/main.min.879d78706ddc3417bab47ec223b501bf207298e24a447bada63812f126e3e760.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/website/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>KubeFleet</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/website/docs/><span>Docs</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/website/zh-cn/>中文（简体）</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/website/offline-search-index.3462c77180604ebb39dffa597e85cc8e.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/website/offline-search-index.3462c77180604ebb39dffa597e85cc8e.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><div class="td-sidebar-nav__section nav-item dropdown d-block d-lg-none"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/website/zh-cn/>中文（简体）</a></li></ul></div></div><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-websitedocs-li><a href=/website/docs/ title="Welcome to KubeFleet Documentation" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-websitedocs><span>Docs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-websitedocsconcepts-li><a href=/website/docs/concepts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-websitedocsconcepts><span>Concepts</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsconceptscomponents-li><a href=/website/docs/concepts/components/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsconceptscomponents><span>Fleet components</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsconceptsmembercluster-li><a href=/website/docs/concepts/membercluster/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsconceptsmembercluster><span>MemberCluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsconceptscrp-li><a href=/website/docs/concepts/crp/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsconceptscrp><span>ClusterResourcePlacement</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsconceptsscheduler-li><a href=/website/docs/concepts/scheduler/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsconceptsscheduler><span>Scheduler</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsconceptsscheduling-framework-li><a href=/website/docs/concepts/scheduling-framework/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsconceptsscheduling-framework><span>Scheduling Framework</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsconceptsproperties-li><a href=/website/docs/concepts/properties/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsconceptsproperties><span>Properties and Property Provides</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsconceptssafe-rollout-li><a href=/website/docs/concepts/safe-rollout/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsconceptssafe-rollout><span>Safe Rollout</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsconceptsoverride-li><a href=/website/docs/concepts/override/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsconceptsoverride><span>Override</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-websitedocsconceptsstaged-update-li><a href=/website/docs/concepts/staged-update/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-websitedocsconceptsstaged-update><span class=td-sidebar-nav-active-item>Staged Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsconceptseviction-pdb-li><a href=/website/docs/concepts/eviction-pdb/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsconceptseviction-pdb><span>Eviction and Placement Disruption Budget</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-websitedocsgetting-started-li><a href=/website/docs/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-websitedocsgetting-started><span>Getting Started</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsgetting-startedkind-li><a href=/website/docs/getting-started/kind/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsgetting-startedkind><span>Getting started with Fleet using KinD clusters</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsgetting-startedon-prem-li><a href=/website/docs/getting-started/on-prem/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocsgetting-startedon-prem><span>Getting started with Fleet using on-premises clusters</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-websitedocshow-tos-li><a href=/website/docs/how-tos/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-websitedocshow-tos><span>How-To Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tosclusters-li><a href=/website/docs/how-tos/clusters/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tosclusters><span>Managing clusters</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-toscrp-li><a href=/website/docs/how-tos/crp/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-toscrp><span>Using the ClusterResourcePlacement API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tosaffinities-li><a href=/website/docs/how-tos/affinities/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tosaffinities><span>Using Affinity to Pick Clusters</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tostopology-spread-constraints-li><a href=/website/docs/how-tos/topology-spread-constraints/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tostopology-spread-constraints><span>Using Topology Spread Constraints to Spread Resources</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tosproperty-based-scheduling-li><a href=/website/docs/how-tos/property-based-scheduling/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tosproperty-based-scheduling><span>Using Property-Based Scheduling</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tostaints-tolerations-li><a href=/website/docs/how-tos/taints-tolerations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tostaints-tolerations><span>Using Taints and Tolerations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-toscluster-resource-override-li><a href=/website/docs/how-tos/cluster-resource-override/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-toscluster-resource-override><span>Using the ClusterResourceOverride API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tosresource-override-li><a href=/website/docs/how-tos/resource-override/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tosresource-override><span>Using the ResourceOverride API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tosenvelope-object-li><a href=/website/docs/how-tos/envelope-object/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tosenvelope-object><span>Using Envelope Objects to Place Resources</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tostakeover-li><a href=/website/docs/how-tos/takeover/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tostakeover><span>Controlling How Fleet Handles Pre-Existing Resources</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tosdrift-detection-li><a href=/website/docs/how-tos/drift-detection/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tosdrift-detection><span>Enabling Drift Detection in Fleet</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tosreportdiff-li><a href=/website/docs/how-tos/reportdiff/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tosreportdiff><span>Using the ReportDiff Apply Mode</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-tosstaged-update-li><a href=/website/docs/how-tos/staged-update/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-tosstaged-update><span>How to Roll Out and Roll Back Changes in Stage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocshow-toseviction-disruption-budget-li><a href=/website/docs/how-tos/eviction-disruption-budget/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocshow-toseviction-disruption-budget><span>Evicting Resources and Setting up Disruption Budgets</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsfaq-li><a href=/website/docs/faq/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-websitedocsfaq><span>Frequently Asked Questions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocsapi-reference-li><a href=/website/docs/api-reference/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-websitedocsapi-reference><span>API Reference</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-websitedocstroubleshootingclusterresourceplacementeviction-li><a href=/website/docs/troubleshooting/clusterresourceplacementeviction/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-websitedocstroubleshootingclusterresourceplacementeviction><span></span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/kubefleet-dev/website/tree/main/content/en/docs/concepts/staged-update.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/kubefleet-dev/website/edit/main/content/en/docs/concepts/staged-update.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/kubefleet-dev/website/new/main/content/en/docs/concepts?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/kubefleet-dev/website/issues/new?title=Staged%20Update" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/kubefleet-dev/kubefleet/issues/new class="td-page-meta--project td-page-meta__project-issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
<a id=print href=/website/docs/concepts/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#specify-rollout-strategy-for-clusterresourceplacement>Specify Rollout Strategy for ClusterResourcePlacement</a></li><li><a href=#deploy-a-clusterstagedupdatestrategy>Deploy a ClusterStagedUpdateStrategy</a></li><li><a href=#trigger-rollout-with-clusterstagedupdaterun>Trigger rollout with ClusterStagedUpdateRun</a></li><li><a href=#understand-clusterstagedupdaterun-status>Understand ClusterStagedUpdateRun status</a><ul><li><a href=#updaterun-overall-status>UpdateRun overall status</a></li><li><a href=#fields-recorded-in-the-updaterun-status-during-initialization>Fields recorded in the updateRun status during initialization</a></li><li><a href=#stages-and-clusters-status>Stages and clusters status</a></li></ul></li><li><a href=#relationship-between-clusterstagedupdaterun-and-clusterresourceplacement>Relationship between ClusterStagedUpdateRun and ClusterResourcePlacement</a></li><li><a href=#concurrent-updateruns>Concurrent updateRuns</a></li><li><a href=#next-steps>Next Steps</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/website/docs/>Docs</a></li><li class=breadcrumb-item><a href=/website/docs/concepts/>Concepts</a></li><li class="breadcrumb-item active" aria-current=page>Staged Update</li></ol></nav><div class=td-content><h1>Staged Update</h1><div class=lead>Concept about Staged Update</div><header class=article-meta></header><p>While users rely on the <code>RollingUpdate</code> rollout strategy to safely roll out their workloads,
there is also a requirement for a staged rollout mechanism at the cluster level to enable more controlled and systematic continuous delivery (CD) across the fleet.
Introducing a staged update run feature would address this need by enabling gradual deployments, reducing risk, and ensuring greater reliability and consistency in workload updates across clusters.</p><p><img src=/website/images/en/docs/concepts/staged-update/updaterun.jpg alt></p><h2 id=overview>Overview</h2><p>We introduce two new Custom Resources, <code>ClusterStagedUpdateStrategy</code> and <code>ClusterStagedUpdateRun</code>.</p><p><code>ClusterStagedUpdateStrategy</code> defines a reusable orchestration pattern that organizes member clusters into distinct stages, controlling both the rollout sequence within each stage and incorporating post-stage validation tasks that must succeed before proceeding to subsequent stages. For brevity, we&rsquo;ll refer to <code>ClusterStagedUpdateStrategy</code> as <em>updateRun strategy</em> throughout this document.</p><p><code>ClusterStagedUpdateRun</code> orchestrates resource deployment across clusters by executing a <code>ClusterStagedUpdateStrategy</code>. It requires three key inputs: the target <code>ClusterResourcePlacement</code> name, a resource snapshot index specifying the version to deploy, and the strategy name that defines the rollout rules. The term <em>updateRun</em> will be used to represent <code>ClusterStagedUpdateRun</code> in this document.</p><h2 id=specify-rollout-strategy-for-clusterresourceplacement>Specify Rollout Strategy for ClusterResourcePlacement</h2><p>While <code>ClusterResourcePlacement</code> uses <code>RollingUpdate</code> as its default strategy, switching to staged updates requires setting the rollout strategy to <code>External</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterResourcePlacement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSelectors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>placementType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PickAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>tolerations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gpu-workload</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>External</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># specify External here to use the stagedUpdateRun strategy.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=deploy-a-clusterstagedupdatestrategy>Deploy a ClusterStagedUpdateStrategy</h2><p>The <code>ClusterStagedUpdateStrategy</code> custom resource enables users to organize member clusters into stages and define their rollout sequence. This strategy is reusable across multiple updateRuns, with each updateRun creating an immutable snapshot of the strategy at startup. This ensures that modifications to the strategy do not impact any in-progress updateRun executions.</p><p>An example <code>ClusterStagedUpdateStrategy</code> looks like below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterStagedUpdateStrategy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-strategy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>staging</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>staging</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>afterStageTasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TimedWait</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>waitTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1h</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>afterStageTasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Approval</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>production</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labelSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>production</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>sortingLabelKey</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>order</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>afterStageTasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Approval</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TimedWait</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>waitTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1h</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><code>ClusterStagedUpdateStrategy</code> is cluster-scoped resource. Its spec contains a list of <code>stageConfig</code> entries defining the configuration for each stage.
Stages execute sequentially in the order specified. Each stage must have a unique name and uses a labelSelector to identify member clusters for update. In above example, we define 3 stages: <code>staging</code> selecting member clusters labeled with <code>environment: staging</code>, <code>canary</code> selecting member clusters labeled with <code>environment: canary</code> and <code>production</code> selecting member clusters labeled with <code>environment: production</code>.</p><p>Each stage can optionally specify <code>sortingLabelKey</code> and <code>afterStageTasks</code>. <code>sortingLabelKey</code> is used to define a label whose integer value determines update sequence within a stage. With above example, assuming there are 3 clusters selected in the <code>production</code> (all 3 clusters have <code>environment: production</code> label), then the fleet admin can label them with <code>order: 1</code>, <code>order: 2</code>, and <code>order: 3</code> respectively to control the rollout sequence. Without <code>sortingLabelKey</code>, clusters are updated in alphabetical order by name.</p><p>By default, the next stage begins immediately after the current stage completes. A user can control this cross-stage behavior by specifying the <code>afterStageTasks</code> in each stage. These tasks execute after all clusters in a stage update successfully. We currently support two types of tasks: <code>Approval</code> and <code>Timedwait</code>. Each stage can include one task of each type (maximum of two tasks). Both tasks must be satisfied before advancing to the next stage.</p><p><code>Timedwait</code> task requires a specified waitTime duration. The updateRun waits for the duration to pass before executing the next stage. For <code>Approval</code> task, the controller generates a <code>ClusterApprovalRequest</code> object automatically named as <code>&lt;updateRun name>-&lt;stage name></code>. The name is also shown in the updateRun status. The <code>ClusterApprovalRequest</code> object is pretty simple:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterApprovalRequest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run-canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/targetupdaterun</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/targetUpdatingStage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kubernetes-fleet.io/isLatestUpdateRunApproval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>parentStageRollout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>targetStage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>canary</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The user then need to manually approve the task by patching its status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl patch clusterapprovalrequests example-run-canary --type<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;merge&#39;</span> -p <span style=color:#4e9a06>&#39;{&#34;status&#34;:{&#34;conditions&#34;:[{&#34;type&#34;:&#34;Approved&#34;,&#34;status&#34;:&#34;True&#34;,&#34;reason&#34;:&#34;lgtm&#34;,&#34;message&#34;:&#34;lgtm&#34;,&#34;lastTransitionTime&#34;:&#34;&#39;</span><span style=color:#204a87;font-weight:700>$(</span>date -u +%Y-%m-%dT%H:%M:%SZ<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#39;&#34;,&#34;observedGeneration&#34;:1}]}}&#39;</span> --subresource<span style=color:#ce5c00;font-weight:700>=</span>status
</span></span></code></pre></div><p>The updateRun will only continue to next stage after the <code>ClusterApprovalRequest</code> is approved.</p><h2 id=trigger-rollout-with-clusterstagedupdaterun>Trigger rollout with ClusterStagedUpdateRun</h2><p>When using <code>External</code> rollout strategy, a <code>ClusterResourcePlacement</code> begins deployment only when triggered by a <code>ClusterStagedUpdateRun</code>. An example <code>ClusterStagedUpdateRun</code> is shown below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>placement.kubernetes-fleet.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterStagedUpdateRun</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-run</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>placementName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-placement</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resourceSnapshotIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stagedRolloutStrategyName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-strategy</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>This cluster-scoped resource requires three key parameters: the <code>placementName</code> specifying the target <code>ClusterResourcePlacement</code>, the <code>resourceSnapshotIndex</code> identifying which version of resources to deploy (learn how to find resourceSnapshotIndex <a href=../howtos/updaterun.md>here</a>), and the <code>stagedRolloutStrategyName</code> indicating the <code>ClusterStagedUpdateStrategy</code> to follow.</p><p>An updateRun executes in two phases. During the initialization phase, the controller performs a one-time setup where it captures a snapshot of the updateRun strategy, collects scheduled and to-be-deleted <code>ClusterResourceBindings</code>, generates the cluster update sequence, and records all this information in the updateRun status.</p><p>In the execution phase, the controller processes each stage sequentially, updates clusters within each stage one at a time, and enforces completion of after-stage tasks. It then executes a final delete stage to clean up resources from unscheduled clusters. The updateRun succeeds when all stages complete successfully. However, it will fail if any execution-affecting events occur, for example, the target ClusterResourcePlacement being deleted, and member cluster changes triggering new scheduling. In such cases, error details are recorded in the updateRun status. Remember that once initialized, an updateRun operates on its strategy snapshot, making it immune to subsequent strategy modifications.</p><h2 id=understand-clusterstagedupdaterun-status>Understand ClusterStagedUpdateRun status</h2><p>Let&rsquo;s take a deep look into the status of a completed <code>ClusterStagedUpdateRun</code>. It displays details about the rollout status for every clusters and stages.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe crsur run example-run
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Conditions:
</span></span><span style=display:flex><span>    Last Transition Time:  2025-03-12T23:21:39Z
</span></span><span style=display:flex><span>    Message:               ClusterStagedUpdateRun initialized successfully
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                UpdateRunInitializedSuccessfully
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Initialized
</span></span><span style=display:flex><span>    Last Transition Time:  2025-03-12T23:21:39Z
</span></span><span style=display:flex><span>    Message:               
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                UpdateRunStarted
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Progressing
</span></span><span style=display:flex><span>    Last Transition Time:  2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>    Message:               
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                UpdateRunSucceeded
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Succeeded
</span></span><span style=display:flex><span>  Deletion Stage Status:
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:       2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>      Message:                    
</span></span><span style=display:flex><span>      Observed Generation:        <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                     StageUpdatingStarted
</span></span><span style=display:flex><span>      Status:                     True
</span></span><span style=display:flex><span>      Type:                       Progressing
</span></span><span style=display:flex><span>      Last Transition Time:       2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>      Message:                    
</span></span><span style=display:flex><span>      Observed Generation:        <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                     StageUpdatingSucceeded
</span></span><span style=display:flex><span>      Status:                     True
</span></span><span style=display:flex><span>      Type:                       Succeeded
</span></span><span style=display:flex><span>    End Time:                     2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>    Stage Name:                   kubernetes-fleet.io/deleteStage
</span></span><span style=display:flex><span>    Start Time:                   2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>  Policy Observed Cluster Count:  <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>  Policy Snapshot Index Used:     <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>  Staged Update Strategy Snapshot:
</span></span><span style=display:flex><span>    Stages:
</span></span><span style=display:flex><span>      After Stage Tasks:
</span></span><span style=display:flex><span>        Type:       Approval
</span></span><span style=display:flex><span>        Wait Time:  0s
</span></span><span style=display:flex><span>        Type:       TimedWait
</span></span><span style=display:flex><span>        Wait Time:  1m0s
</span></span><span style=display:flex><span>      Label Selector:
</span></span><span style=display:flex><span>        Match Labels:
</span></span><span style=display:flex><span>          Environment:  staging
</span></span><span style=display:flex><span>      Name:             staging
</span></span><span style=display:flex><span>      After Stage Tasks:
</span></span><span style=display:flex><span>        Type:       Approval
</span></span><span style=display:flex><span>        Wait Time:  0s
</span></span><span style=display:flex><span>      Label Selector:
</span></span><span style=display:flex><span>        Match Labels:
</span></span><span style=display:flex><span>          Environment:    canary
</span></span><span style=display:flex><span>      Name:               canary
</span></span><span style=display:flex><span>      Sorting Label Key:  name
</span></span><span style=display:flex><span>      After Stage Tasks:
</span></span><span style=display:flex><span>        Type:       TimedWait
</span></span><span style=display:flex><span>        Wait Time:  1m0s
</span></span><span style=display:flex><span>        Type:       Approval
</span></span><span style=display:flex><span>        Wait Time:  0s
</span></span><span style=display:flex><span>      Label Selector:
</span></span><span style=display:flex><span>        Match Labels:
</span></span><span style=display:flex><span>          Environment:    production
</span></span><span style=display:flex><span>      Name:               production
</span></span><span style=display:flex><span>      Sorting Label Key:  order
</span></span><span style=display:flex><span>  Stages Status:
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Approval Request Name:  example-run-staging
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:21:54Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestCreated
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:22:55Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestApproved
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestApproved
</span></span><span style=display:flex><span>      Type:                    Approval
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:22:54Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskWaitTimeElapsed
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  WaitTimeElapsed
</span></span><span style=display:flex><span>      Type:                    TimedWait
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>      Cluster Name:  member1
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:21:39Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingStarted
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Started
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:21:54Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingSucceeded
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Succeeded
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:21:54Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingWaiting
</span></span><span style=display:flex><span>      Status:                False
</span></span><span style=display:flex><span>      Type:                  Progressing
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:22:55Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingSucceeded
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Succeeded
</span></span><span style=display:flex><span>    End Time:                2025-03-12T23:22:55Z
</span></span><span style=display:flex><span>    Stage Name:              staging
</span></span><span style=display:flex><span>    Start Time:              2025-03-12T23:21:39Z
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Approval Request Name:  example-run-canary
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:23:10Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestCreated
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestApproved
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestApproved
</span></span><span style=display:flex><span>      Type:                    Approval
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>      Cluster Name:  member2
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:22:55Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingStarted
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Started
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:23:10Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingSucceeded
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Succeeded
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:23:10Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingWaiting
</span></span><span style=display:flex><span>      Status:                False
</span></span><span style=display:flex><span>      Type:                  Progressing
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingSucceeded
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Succeeded
</span></span><span style=display:flex><span>    End Time:                2025-03-12T23:25:15Z
</span></span><span style=display:flex><span>    Stage Name:              canary
</span></span><span style=display:flex><span>    Start Time:              2025-03-12T23:22:55Z
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskWaitTimeElapsed
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  WaitTimeElapsed
</span></span><span style=display:flex><span>      Type:                    TimedWait
</span></span><span style=display:flex><span>      Approval Request Name:   example-run-production
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestCreated
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-12T23:25:25Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestApproved
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestApproved
</span></span><span style=display:flex><span>      Type:                    Approval
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingWaiting
</span></span><span style=display:flex><span>      Status:                False
</span></span><span style=display:flex><span>      Type:                  Progressing
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingSucceeded
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Succeeded
</span></span><span style=display:flex><span>    End Time:                2025-03-12T23:26:15Z
</span></span><span style=display:flex><span>    Stage Name:              production
</span></span><span style=display:flex><span>Events:                      &lt;none&gt;
</span></span></code></pre></div><h3 id=updaterun-overall-status>UpdateRun overall status</h3><p>At the very top, <code>Status.Conditions</code> gives the overall status of the updateRun. The execution an update run consists of two phases: initialization and execution.
During initialization, the controller performs a one-time setup where it captures a snapshot of the updateRun strategy, collects scheduled and to-be-deleted <code>ClusterResourceBindings</code>,
generates the cluster update sequence, and records all this information in the updateRun status.
The <code>UpdateRunInitializedSuccessfully</code> condition indicates the initialization is successful.</p><p>After initialization, the controller starts executing the updateRun. The <code>UpdateRunStarted</code> condition indicates the execution has started.</p><p>After all clusters are updated, all after-stage tasks are completed, and thus all stages are finished, the <code>UpdateRunSucceeded</code> condition is set to <code>True</code>, indicating the updateRun has succeeded.</p><h3 id=fields-recorded-in-the-updaterun-status-during-initialization>Fields recorded in the updateRun status during initialization</h3><p>During initialization, the controller records the following fields in the updateRun status:</p><ul><li><code>PolicySnapshotIndexUsed</code>: the index of the policy snapshot used for the updateRun, it should be the latest one.</li><li><code>PolicyObservedClusterCount</code>: the number of clusters selected by the scheduling policy.</li><li><code>StagedUpdateStrategySnapshot</code>: the snapshot of the updateRun strategy, which ensures any strategy changes will not affect executing updateRuns.</li></ul><h3 id=stages-and-clusters-status>Stages and clusters status</h3><p>The <code>Stages Status</code> section displays the status of each stage and cluster. As shown in the strategy snapshot, the updateRun has three stages: <code>staging</code>, <code>canary</code>, and <code>production</code>. During initialization, the controller generates the rollout plan, classifies the scheduled clusters
into these three stages and dumps the plan into the updateRun status. As the execution progresses, the controller updates the status of each stage and cluster. Take the <code>staging</code> stage as an example, <code>member1</code> is included in this stage. <code>ClusterUpdatingStarted</code> condition indicates the cluster is being updated and <code>ClusterUpdatingSucceeded</code> condition shows the cluster is updated successfully.</p><p>After all clusters are updated in a stage, the controller executes the specified after-stage tasks. Stage <code>staging</code> has two after-stage tasks: <code>Approval</code> and <code>TimedWait</code>. The <code>Approval</code> task requires the admin to manually approve a <code>ClusterApprovalRequest</code> generated by the controller. The name of the <code>ClusterApprovalRequest</code> is also included in the status, which is <code>example-run-staging</code>. <code>AfterStageTaskApprovalRequestCreated</code> condition indicates the approval request is created and <code>AfterStageTaskApprovalRequestApproved</code> condition indicates the approval request has been approved. The <code>TimedWait</code> task enforces a suspension of the rollout until the specified wait time has elapsed and in this case, the wait time is 1 minute. <code>AfterStageTaskWaitTimeElapsed</code> condition indicates the wait time has elapsed and the rollout can proceed to the next stage.</p><p>Each stage also has its own conditions. When a stage starts, the <code>Progressing</code> condition is set to <code>True</code>. When all the cluster updates complete, the <code>Progressing</code> condition is set to <code>False</code> with reason <code>StageUpdatingWaiting</code> as shown above. It means the stage is waiting for
after-stage tasks to pass.
And thus the <code>lastTransitionTime</code> of the <code>Progressing</code> condition also serves as the start time of the wait in case there&rsquo;s a <code>TimedWait</code> task. When all after-stage tasks pass, the <code>Succeeded</code> condition is set to <code>True</code>. Each stage status also has <code>Start Time</code> and <code>End Time</code> fields, making it easier to read.</p><p>There&rsquo;s also a <code>Deletion Stage Status</code> section, which displays the status of the deletion stage. The deletion stage is the last stage of the updateRun. It deletes resources from the unscheduled clusters. The status is pretty much the same as a normal update stage, except that there are no after-stage tasks.</p><p>Note that all these conditions have <code>lastTransitionTime</code> set to the time when the controller updates the status. It can help debug and check
the progress of the updateRun.</p><h2 id=relationship-between-clusterstagedupdaterun-and-clusterresourceplacement>Relationship between ClusterStagedUpdateRun and ClusterResourcePlacement</h2><p>A <code>ClusterStagedUpdateRun</code> serves as the trigger mechanism for rolling out a <code>ClusterResourcePlacement</code>. The key points of this relationship are:</p><ul><li>The <code>ClusterResourcePlacement</code> remains in a scheduled state without being deployed until a corresponding <code>ClusterStagedUpdateRun</code> is created.</li><li>During rollout, the <code>ClusterResourcePlacement</code> status is continuously updated with detailed information from each target cluster.</li><li>While a <code>ClusterStagedUpdateRun</code> only indicates whether updates have started and completed for each member cluster (as described in <a href=/website/docs/concepts/staged-update/#understand-clusterstagedupdaterun-status>previous section</a>), the <code>ClusterResourcePlacement</code> provides comprehensive details including:<ul><li>Success/failure of resource creation</li><li>Application of overrides</li><li>Specific error messages</li></ul></li></ul><p>For example, below is the status of an in-progress <code>ClusterStagedUpdateRun</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe crsur example-run
</span></span><span style=display:flex><span>Name:         example-run
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Conditions:
</span></span><span style=display:flex><span>    Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>    Message:               ClusterStagedUpdateRun initialized successfully
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                UpdateRunInitializedSuccessfully
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Initialized
</span></span><span style=display:flex><span>    Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>    Message:               
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                UpdateRunStarted <span style=color:#8f5902;font-style:italic># updateRun started</span>
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Progressing
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>  Stages Status:
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Approval Request Name:  example-run-staging
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-17T21:37:29Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  ApprovalRequestCreated
</span></span><span style=display:flex><span>      Type:                    Approval
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-17T21:38:29Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                AfterStageTaskWaitTimeElapsed
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  WaitTimeElapsed
</span></span><span style=display:flex><span>      Type:                    TimedWait
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>      Cluster Name:  member1
</span></span><span style=display:flex><span>      Conditions:
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingStarted
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Started
</span></span><span style=display:flex><span>        Last Transition Time:  2025-03-17T21:37:29Z
</span></span><span style=display:flex><span>        Message:               
</span></span><span style=display:flex><span>        Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>        Reason:                ClusterUpdatingSucceeded <span style=color:#8f5902;font-style:italic># member1 has updated successfully</span>
</span></span><span style=display:flex><span>        Status:                True
</span></span><span style=display:flex><span>        Type:                  Succeeded
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:29Z
</span></span><span style=display:flex><span>      Message:               
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                StageUpdatingWaiting <span style=color:#8f5902;font-style:italic># waiting for approval</span>
</span></span><span style=display:flex><span>      Status:                False
</span></span><span style=display:flex><span>      Type:                  Progressing
</span></span><span style=display:flex><span>    Stage Name:              staging
</span></span><span style=display:flex><span>    Start Time:              2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Approval Request Name:  example-run-canary
</span></span><span style=display:flex><span>      Type:                   Approval
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>      Cluster Name:  member2
</span></span><span style=display:flex><span>    Stage Name:      canary
</span></span><span style=display:flex><span>    After Stage Task Status:
</span></span><span style=display:flex><span>      Type:                   TimedWait
</span></span><span style=display:flex><span>      Approval Request Name:  example-run-production
</span></span><span style=display:flex><span>      Type:                   Approval
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>    Stage Name:  production
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>In above status, member1 from stage <code>staging</code> has been updated successfully. The stage is waiting for approval to proceed to the next stage. And member2 from stage <code>canary</code> is not updated yet.</p><p>Let&rsquo;s take a look at the status of the <code>ClusterResourcePlacement</code> <code>example-placement</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe crp example-placement
</span></span><span style=display:flex><span>Name:         example-placement
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Conditions:
</span></span><span style=display:flex><span>    Last Transition Time:   2025-03-12T23:01:32Z
</span></span><span style=display:flex><span>    Message:                found all cluster needed as specified by the scheduling policy, found <span style=color:#0000cf;font-weight:700>2</span> cluster<span style=color:#ce5c00;font-weight:700>(</span>s<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    Observed Generation:    <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                 SchedulingPolicyFulfilled
</span></span><span style=display:flex><span>    Status:                 True
</span></span><span style=display:flex><span>    Type:                   ClusterResourcePlacementScheduled
</span></span><span style=display:flex><span>    Last Transition Time:   2025-03-13T07:35:25Z
</span></span><span style=display:flex><span>    Message:                There are still <span style=color:#0000cf;font-weight:700>1</span> cluster<span style=color:#ce5c00;font-weight:700>(</span>s<span style=color:#ce5c00;font-weight:700>)</span> in the process of deciding whether to roll out the latest resources or not
</span></span><span style=display:flex><span>    Observed Generation:    <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                 RolloutStartedUnknown
</span></span><span style=display:flex><span>    Status:                 Unknown
</span></span><span style=display:flex><span>    Type:                   ClusterResourcePlacementRolloutStarted
</span></span><span style=display:flex><span>  Observed Resource Index:  <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>  Placement Statuses:
</span></span><span style=display:flex><span>    Cluster Name:  member1
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:01:32Z
</span></span><span style=display:flex><span>      Message:               Successfully scheduled resources <span style=color:#204a87;font-weight:700>for</span> placement in <span style=color:#4e9a06>&#34;member1&#34;</span> <span style=color:#ce5c00;font-weight:700>(</span>affinity score: 0, topology spread score: 0<span style=color:#ce5c00;font-weight:700>)</span>: picked by scheduling policy
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                Scheduled
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Scheduled
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>      Message:               Detected the new changes on the resources and started the rollout process, resourceSnapshotIndex: 5, clusterStagedUpdateRun: example-run
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                RolloutStarted
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  RolloutStarted
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>      Message:               No override rules are configured <span style=color:#204a87;font-weight:700>for</span> the selected resources
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                NoOverrideSpecified
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Overridden
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>      Message:               All of the works are synchronized to the latest
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                AllWorkSynced
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  WorkSynchronized
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>      Message:               All corresponding work objects are applied
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                AllWorkHaveBeenApplied
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Applied
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style=display:flex><span>      Message:               All corresponding work objects are available
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                AllWorkAreAvailable <span style=color:#8f5902;font-style:italic># member1 is all good</span>
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Available
</span></span><span style=display:flex><span>    Cluster Name:            member2
</span></span><span style=display:flex><span>    Conditions:
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-12T23:01:32Z
</span></span><span style=display:flex><span>      Message:               Successfully scheduled resources <span style=color:#204a87;font-weight:700>for</span> placement in <span style=color:#4e9a06>&#34;member2&#34;</span> <span style=color:#ce5c00;font-weight:700>(</span>affinity score: 0, topology spread score: 0<span style=color:#ce5c00;font-weight:700>)</span>: picked by scheduling policy
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                Scheduled
</span></span><span style=display:flex><span>      Status:                True
</span></span><span style=display:flex><span>      Type:                  Scheduled
</span></span><span style=display:flex><span>      Last Transition Time:  2025-03-13T07:35:25Z
</span></span><span style=display:flex><span>      Message:               In the process of deciding whether to roll out the latest resources or not
</span></span><span style=display:flex><span>      Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>      Reason:                RolloutStartedUnknown <span style=color:#8f5902;font-style:italic># member2 is not updated yet</span>
</span></span><span style=display:flex><span>      Status:                Unknown
</span></span><span style=display:flex><span>      Type:                  RolloutStarted
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>In the <code>Placement Statuses</code> section, we can see the status of each member cluster. For member1, the <code>RolloutStarted</code> condition is set to <code>True</code>, indicating the rollout has started.
In the condition message, we print the <code>ClusterStagedUpdateRun</code> name, which is <code>example-run</code>. This indicates the most recent cluster update is triggered by <code>example-run</code>.
It also displays the detailed update status: the works are synced and applied and are detected available. As a comparison, member2 is still in <code>Scheduled</code> state only.</p><p>When troubleshooting a stalled updateRun, examining the <code>ClusterResourcePlacement</code> status offers valuable diagnostic information that can help identify the root cause.
For comprehensive troubleshooting steps, refer to the <a href=../troubleshooting/updaterun.md>troubleshooting guide</a>.</p><h2 id=concurrent-updateruns>Concurrent updateRuns</h2><p>Multiple concurrent <code>ClusterStagedUpdateRun</code>s can be created for the same <code>ClusterResourcePlacement</code>, allowing fleet administrators to pipeline the rollout of different resource versions. However, to maintain consistency across the fleet and prevent member clusters from running different resource versions simultaneously, we enforce a key constraint: all concurrent <code>ClusterStagedUpdateRun</code>s must use identical <code>ClusterStagedUpdateStrategy</code> settings.</p><p>This strategy consistency requirement is validated during the initialization phase of each updateRun. This validation ensures predictable rollout behavior and prevents configuration drift across your cluster fleet, even when multiple updates are in progress.</p><h2 id=next-steps>Next Steps</h2><ul><li>Learn how to <a href=../howtos/updaterun.md>rollout and rollback CRP resources with Staged Update Run</a></li><li>Learn how to <a href=../troubleshooting/updaterun.md>troubleshoot a Staged Update Run</a></li></ul><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/kubefleet-dev/website/issues/new>tell us how we can further improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=hhttps://github.com/kubefleet-dev/website/issues/new>tell us how we can fix the experience for you</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof gtag!="function")return;gtag("event","page_helpful",{event_category:"Helpful",event_label:window.location.pathname,value:e})};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(100)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/kubefleet-dev/kubefleet aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025&ndash;2025
<span class=td-footer__authors>KubeFleet Contributors | The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage</a> | <a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://github.com/kubefleet-dev/website/blob/main/PRIVACY_POLICY.md target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/website/js/main.min.032ba2ecbd3ce89b96bffcfec71c5da352125ee752e9873c3e0098f7c32a6497.js integrity="sha256-Ayui7L086JuWv/z+xxxdo1ISXudS6Yc8PgCY98MqZJc=" crossorigin=anonymous></script><script defer src=/website/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/website/js/tabpane-persist.js></script></body></html>